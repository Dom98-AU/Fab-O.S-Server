@*
═══════════════════════════════════════════════════════════════
LIST-TYPE PAGE
═══════════════════════════════════════════════════════════════
Page Type: List
Entity: Customer
Views: Table, List, Card
Features: ViewPreferences, ColumnManagement, Search, Selection
Pattern: Standard
Modern UI: Yes
Last Updated: 2025-10-23
═══════════════════════════════════════════════════════════════
*@
@page "/{tenantSlug}/trace/customers"
@rendermode InteractiveServer
@using FabOS.WebServer.Components.Shared
@using FabOS.WebServer.Components.Shared.Interfaces
@using FabOS.WebServer.Data.Contexts
@using FabOS.WebServer.Models.Entities
@using Microsoft.EntityFrameworkCore

<PageTitle>Customers - Fab.OS</PageTitle>

<!-- Standard Toolbar -->
<StandardToolbar ActionProvider="@this" OnSearch="@OnSearchChanged" SearchPlaceholder="Search customers..." />

<!-- Content -->
<div class="customers-container">
    @if (isLoading)
    {
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading customers...</p>
        </div>
    }
    else
    {
        <!-- Unified View Toolbar -->
        <TableViewToolbar TItem="Customer"
                         EnableViewPreferences="true"
                         EnableColumnManagement="true"
                         EntityType="Customer"
                         CurrentViewState="@currentViewState"
                         OnViewLoaded="@HandleViewLoaded"
                         HasUnsavedChanges="@hasUnsavedChanges"
                         Columns="@managedColumns"
                         OnColumnsChanged="@HandleColumnsChanged"
                         HasCustomColumnConfig="@hasCustomColumnConfig"
                         CurrentView="@currentView"
                         OnViewChanged="@OnViewChanged" />

        @if (filteredCustomers.Any())
        {
            @if (currentView == GenericViewSwitcher<Customer>.ViewType.Table)
            {
                <GenericTableView TItem="Customer"
                                 Items="@filteredCustomers"
                                 AllItems="@allCustomers"
                                 Columns="@tableColumns"
                                 AllowSelection="true"
                                 ShowCheckboxes="true"
                                 SelectedItems="@selectedTableItems"
                                 SelectedItemsChanged="@HandleTableSelectionChanged"
                                 OnRowClick="@HandleCustomerClick"
                                 OnRowDoubleClick="@HandleCustomerDoubleClick"
                                 EnableAdvancedFeatures="true"
                                 EnableColumnManagement="true"
                                 EnableFiltering="false"
                                 EnableViewPreferences="true"
                                 EntityType="Customer" />
            }
            else if (currentView == GenericViewSwitcher<Customer>.ViewType.List)
            {
                <GenericListView TItem="Customer"
                                Items="@filteredCustomers"
                                OnItemClick="@HandleCustomerClick"
                                OnItemDoubleClick="@HandleCustomerDoubleClick"
                                AllowSelection="true"
                                SelectedItems="@selectedListItems"
                                SelectedItemsChanged="@HandleListSelectionChanged">
                    <CustomListItemContent Context="customer">
                        <div class="customer-list-item">
                            <div class="customer-icon">
                                <i class="fas fa-building fa-2x"></i>
                            </div>
                            <div class="customer-info">
                                <div class="customer-name">
                                    <strong>@customer.Name</strong>
                                    @if (!string.IsNullOrEmpty(customer.Code))
                                    {
                                        <span class="customer-code">(@customer.Code)</span>
                                    }
                                </div>
                                <div class="customer-meta">
                                    <span>@(customer.ContactPerson ?? "No contact")</span>
                                    <span class="ms-2">@(customer.Email ?? "No email")</span>
                                    <span class="badge @(customer.IsActive ? "bg-success" : "bg-secondary") ms-2">
                                        @(customer.IsActive ? "Active" : "Inactive")
                                    </span>
                                </div>
                            </div>
                        </div>
                    </CustomListItemContent>
                </GenericListView>
            }
            else if (currentView == GenericViewSwitcher<Customer>.ViewType.Card)
            {
                <GenericCardView TItem="Customer"
                                Items="@filteredCustomers"
                                OnItemClick="@HandleCustomerClick"
                                OnItemDoubleClick="@HandleCustomerDoubleClick"
                                AllowSelection="true"
                                SelectedItems="@selectedCardItems"
                                SelectedItemsChanged="@HandleCardSelectionChanged">
                    <CustomCardContent Context="customer">
                        <div class="customer-card">
                            <div class="customer-card-icon">
                                <i class="fas fa-building fa-3x"></i>
                            </div>
                            <div class="customer-card-body">
                                <h5 class="customer-card-title">@customer.Name</h5>
                                @if (!string.IsNullOrEmpty(customer.Code))
                                {
                                    <p class="customer-card-code">@customer.Code</p>
                                }
                                <p class="customer-card-meta">
                                    <span class="badge @(customer.IsActive ? "bg-success" : "bg-secondary")">
                                        @(customer.IsActive ? "Active" : "Inactive")
                                    </span>
                                    @if (!string.IsNullOrEmpty(customer.Industry))
                                    {
                                        <span class="badge bg-info ms-2">@customer.Industry</span>
                                    }
                                </p>
                            </div>
                        </div>
                    </CustomCardContent>
                </GenericCardView>
            }
        }
        else
        {
            <div class="modern-empty-state">
                <i class="fas fa-users empty-icon"></i>
                <h3 class="empty-title">No customers found</h3>
                <p class="empty-subtitle">
                    @(string.IsNullOrEmpty(searchTerm) ? "Start by adding your first customer." : $"No customers match \"{searchTerm}\". Try adjusting your search.")
                </p>
            </div>
        }
    }
</div>
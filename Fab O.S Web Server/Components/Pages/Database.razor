@page "/database"
@using Microsoft.EntityFrameworkCore
@using FabOS.WebServer.Data.Contexts
@using FabOS.WebServer.Models.Entities
@using Microsoft.AspNetCore.Authorization
@rendermode InteractiveServer

<PageTitle>Database Explorer</PageTitle>

<h1>Database Explorer</h1>
<h3>Steel Estimation System - Entity Framework Models</h3>

@if (loading)
{
    <p><em>Loading...</em></p>
}
else if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">
        <h4>Error</h4>
        <p>@errorMessage</p>
    </div>
}
else
{
    <div class="row">
        <div class="col-md-6">
            <h3>Companies (@companies.Count)</h3>
            @if (companies.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Subscription</th>
                            <th>Status</th>
                            <th>Users</th>
                            <th>Domain</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var company in companies.Take(5))
                        {
                            <tr>
                                <td>@company.Id</td>
                                <td>@company.Name</td>
                                <td>@company.SubscriptionLevel</td>
                                <td>@(company.IsActive ? "Active" : "Inactive")</td>
                                <td>@company.Users.Count</td>
                                <td>@(company.Domain ?? "N/A")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No companies found.</p>
            }
        </div>
        <div class="col-md-6">
            <h3>Users (@users.Count)</h3>
            @if (users.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Job Title</th>
                            <th>Company</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in users.Take(5))
                        {
                            <tr>
                                <td>@user.Id</td>
                                <td>@user.FirstName @user.LastName</td>
                                <td>@user.Email</td>
                                <td>@user.JobTitle</td>
                                <td>@user.Company?.Name</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No users found.</p>
            }
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <h3>Projects (@projects.Count)</h3>
            @if (projects.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Owner</th>
                            <th>Estimation Stage</th>
                            <th>Packages</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var project in projects.Take(5))
                        {
                            <tr>
                                <td>@project.Id</td>
                                <td>@project.ProjectName</td>
                                <td>@project.Owner?.FirstName @project.Owner?.LastName</td>
                                <td>@project.EstimationStage</td>
                                <td>@project.Packages.Count</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No projects found.</p>
            }
        </div>
        <div class="col-md-6">
            <h3>Manufacturing</h3>
            <div class="card">
                <div class="card-body">
                    <h5>Machine Centers: @machineCenters</h5>
                    <h5>Work Centers: @workCenters</h5>
                    <h5>Trace Drawings: @traceDrawings</h5>
                    <h5>Welding Connections: @weldingConnections</h5>
                </div>
            </div>
        </div>
    </div>
}

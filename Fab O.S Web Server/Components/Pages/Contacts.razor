@*
═══════════════════════════════════════════════════════════════
LIST-TYPE PAGE
═══════════════════════════════════════════════════════════════
Page Type: List
Entity: Contact
Views: Table, List, Card
Features: ViewPreferences, ColumnManagement, Search, Selection
Pattern: Standard
Modern UI: Yes
Last Updated: 2025-10-23
═══════════════════════════════════════════════════════════════
*@
@page "/{tenantSlug}/trace/contacts"
@rendermode InteractiveServer
@using FabOS.WebServer.Components.Shared
@using FabOS.WebServer.Components.Shared.Interfaces
@using FabOS.WebServer.Data.Contexts
@using FabOS.WebServer.Models.Entities
@using Microsoft.EntityFrameworkCore

<PageTitle>Contacts - Fab.OS</PageTitle>

<!-- Standard Toolbar -->
<StandardToolbar ActionProvider="@this" OnSearch="@OnSearchChanged" SearchPlaceholder="Search contacts..." />

<!-- Content -->
<div class="contacts-container">
    @if (isLoading)
    {
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading contacts...</p>
        </div>
    }
    else
    {
        <!-- Unified View Toolbar -->
        <TableViewToolbar TItem="CustomerContact"
                         EnableViewPreferences="true"
                         EnableColumnManagement="true"
                         EntityType="Contact"
                         CurrentViewState="@currentViewState"
                         OnViewLoaded="@HandleViewLoaded"
                         HasUnsavedChanges="@hasUnsavedChanges"
                         Columns="@managedColumns"
                         OnColumnsChanged="@HandleColumnsChanged"
                         HasCustomColumnConfig="@hasCustomColumnConfig"
                         CurrentView="@currentView"
                         OnViewChanged="@OnViewChanged" />

        @if (filteredContacts.Any())
        {
            @if (currentView == GenericViewSwitcher<CustomerContact>.ViewType.Table)
            {
                <GenericTableView TItem="CustomerContact"
                                 Items="@filteredContacts"
                                 AllItems="@allContacts"
                                 Columns="@tableColumns"
                                 AllowSelection="true"
                                 ShowCheckboxes="true"
                                 SelectedItems="@selectedTableItems"
                                 SelectedItemsChanged="@HandleTableSelectionChanged"
                                 OnRowClick="@HandleContactClick"
                                 OnRowDoubleClick="@HandleContactDoubleClick"
                                 EnableAdvancedFeatures="true"
                                 EnableColumnManagement="true"
                                 EnableFiltering="false"
                                 EnableViewPreferences="true"
                                 EntityType="Contact" />
            }
            else if (currentView == GenericViewSwitcher<CustomerContact>.ViewType.List)
            {
                <GenericListView TItem="CustomerContact"
                                Items="@filteredContacts"
                                OnItemClick="@HandleContactClick"
                                OnItemDoubleClick="@HandleContactDoubleClick"
                                AllowSelection="true"
                                SelectedItems="@selectedListItems"
                                SelectedItemsChanged="@HandleListSelectionChanged">
                    <CustomListItemContent Context="contact">
                        <div class="contact-list-item">
                            <div class="contact-icon">
                                <i class="fas fa-user fa-2x"></i>
                            </div>
                            <div class="contact-info">
                                <div class="contact-name">
                                    <strong>@contact.FirstName @contact.LastName</strong>
                                    @if (contact.IsPrimary)
                                    {
                                        <span class="primary-indicator ms-2" title="Primary Contact">★</span>
                                    }
                                </div>
                                <div class="contact-meta">
                                    <span>@(contact.Customer?.Name ?? "No company")</span>
                                    @if (!string.IsNullOrEmpty(contact.Title))
                                    {
                                        <span class="ms-2">@contact.Title</span>
                                    }
                                    <span class="badge @(contact.IsActive ? "bg-success" : "bg-secondary") ms-2">
                                        @(contact.IsActive ? "Active" : "Inactive")
                                    </span>
                                </div>
                            </div>
                        </div>
                    </CustomListItemContent>
                </GenericListView>
            }
            else if (currentView == GenericViewSwitcher<CustomerContact>.ViewType.Card)
            {
                <GenericCardView TItem="CustomerContact"
                                Items="@filteredContacts"
                                OnItemClick="@HandleContactClick"
                                OnItemDoubleClick="@HandleContactDoubleClick"
                                AllowSelection="true"
                                SelectedItems="@selectedCardItems"
                                SelectedItemsChanged="@HandleCardSelectionChanged">
                    <CustomCardContent Context="contact">
                        <div class="contact-card">
                            <div class="contact-card-icon">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
                            <div class="contact-card-body">
                                <h5 class="contact-card-title">@contact.FirstName @contact.LastName</h5>
                                @if (!string.IsNullOrEmpty(contact.Title))
                                {
                                    <p class="contact-card-title-text">@contact.Title</p>
                                }
                                <p class="contact-card-meta">
                                    <span class="badge @(contact.IsActive ? "bg-success" : "bg-secondary")">
                                        @(contact.IsActive ? "Active" : "Inactive")
                                    </span>
                                    @if (contact.IsPrimary)
                                    {
                                        <span class="badge bg-warning ms-2">Primary</span>
                                    }
                                </p>
                            </div>
                        </div>
                    </CustomCardContent>
                </GenericCardView>
            }
        }
        else
        {
            <div class="modern-empty-state">
                <i class="fas fa-address-book empty-icon"></i>
                <h3 class="empty-title">No contacts found</h3>
                <p class="empty-subtitle">
                    @(string.IsNullOrEmpty(searchTerm) ? "Start by adding your first contact." : $"No contacts match \"{searchTerm}\". Try adjusting your search.")
                </p>
            </div>
        }
    }
</div>
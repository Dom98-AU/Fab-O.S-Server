@using FabOS.WebServer.Components.Shared.Interfaces
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web

<div class="fabos-toolbar">
    <div class="fabos-toolbar-content">
        <!-- Left Section: Search -->
        @if (ShowSearch)
        {
            <div class="fabos-toolbar-section fabos-toolbar-search">
                <div class="fabos-search-wrapper">
                    <i class="fas fa-search fabos-search-icon"></i>
                    <input type="text" 
                           class="fabos-search-input" 
                           placeholder="@SearchPlaceholder" 
                           @bind="SearchTerm" 
                           @onkeyup="@(async (e) => await OnSearchChanged.InvokeAsync(SearchTerm))" />
                    @if (!string.IsNullOrEmpty(SearchTerm))
                    {
                        <button type="button" class="fabos-search-clear" @onclick="ClearSearch">
                            <i class="fas fa-times"></i>
                        </button>
                    }
                </div>
            </div>
        }

        <!-- Center Section: Primary Actions (New, Delete, Actions, Related) -->
        <div class="fabos-toolbar-section fabos-toolbar-actions">
            @if (ActionProvider?.GetActions()?.PrimaryActions != null)
            {
                @foreach (var action in ActionProvider.GetActions().PrimaryActions)
                {
                    var buttonClass = action.Style switch
                    {
                        ToolbarActionStyle.Primary => "fabos-btn fabos-btn-primary",
                        ToolbarActionStyle.Danger => "fabos-btn fabos-btn-danger",
                        _ => "fabos-btn fabos-btn-secondary"
                    };
                    
                    <button type="button" 
                            class="@buttonClass @(action.IsDisabled ? "disabled" : "")" 
                            @onclick="() => ExecuteAction(action)"
                            disabled="@action.IsDisabled"
                            title="@action.Tooltip">
                        @if (!string.IsNullOrEmpty(action.Icon))
                        {
                            <i class="@action.Icon"></i>
                        }
                        <span class="fabos-btn-text">@action.Text</span>
                    </button>
                }
            }

            <!-- Actions Dropdown (for menu items) -->
            @if (ActionProvider?.GetActions()?.MenuActions?.Any() == true)
            {
                <div class="fabos-dropdown @(showActionsMenu ? "active" : "")">
                    <button type="button" class="fabos-btn fabos-btn-secondary" @onclick="ToggleActionsMenu">
                        <i class="fas fa-ellipsis-v"></i>
                        <span class="fabos-btn-text">Actions</span>
                    </button>
                    @if (showActionsMenu)
                    {
                        <div class="fabos-dropdown-menu">
                            @foreach (var action in ActionProvider.GetActions().MenuActions)
                            {
                                <button type="button" 
                                        class="fabos-dropdown-item @(action.IsDisabled ? "disabled" : "")" 
                                        @onclick="() => ExecuteAction(action)"
                                        disabled="@action.IsDisabled">
                                    @if (!string.IsNullOrEmpty(action.Icon))
                                    {
                                        <i class="@action.Icon"></i>
                                    }
                                    <span>@action.Text</span>
                                </button>
                            }
                        </div>
                    }
                </div>
            }

            <!-- Related Actions Dropdown -->
            @if (ActionProvider?.GetActions()?.RelatedActions?.Any() == true)
            {
                <div class="fabos-dropdown @(showRelatedMenu ? "active" : "")">
                    <button type="button" class="fabos-btn fabos-btn-secondary" @onclick="ToggleRelatedMenu">
                        <i class="fas fa-link"></i>
                        <span class="fabos-btn-text">Related</span>
                    </button>
                    @if (showRelatedMenu)
                    {
                        <div class="fabos-dropdown-menu">
                            @foreach (var action in ActionProvider.GetActions().RelatedActions)
                            {
                                <button type="button" 
                                        class="fabos-dropdown-item @(action.IsDisabled ? "disabled" : "")" 
                                        @onclick="() => ExecuteAction(action)"
                                        disabled="@action.IsDisabled">
                                    @if (!string.IsNullOrEmpty(action.Icon))
                                    {
                                        <i class="@action.Icon"></i>
                                    }
                                    <span>@action.Text</span>
                                </button>
                            }
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Right Section: Empty space for future expansion -->
        <div class="fabos-toolbar-section fabos-toolbar-menu">
            <!-- Reserved for additional features -->
        </div>
    </div>
</div>

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.Preview=t(require("UIExtension")):e.Preview=t(e.UIExtension)}(self,e=>(()=>{var t={151:(e,t,n)=>{var i=n(779);e.exports=function(e){"use strict";e=e||{};var t="",r=i.$escape,o=e.index,a=e.isCrop;return t+='<div class="fv__preview-page" data-page-index="',t+=r(o-1),t+='">\n<div class="fv__thumb-page-container">\n<img class="fv__thumb-loading" ',t+='src="'+n(891)+'"',t+=" />\n",a&&(t+='\n<div class="fv__thumb-cover">\n<div class="fv__thumb-cover-crop"></div>\n<div class="fv__thumb-cover-art"></div>\n<div class="fv__thumb-cover-trim"></div>\n<div class="fv__thumb-cover-bleed"></div>\n<div class="fv__thumb-cover-resize" action-type="move">\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n</div>\n</div>\n'),t+='\n<canvas class="fv__thumb-image fv__hide"></canvas>\n\n</div>\n</div>'}},530:(e,t,n)=>{n(779);e.exports=function(e){"use strict";var t="";return(e=e||{}).showTitle&&(t+='\n<div class="w_80 mb_10" data-i18n="preview:title" name="title"></div>\n'),t+='\n<div class="fv__ui-preview" name="preview-container">\n<div class="fv__preview-image-container-box">\n<div class="fv__preview-image-container">\n\n</div>\n<div style="clear:both;"></div>\n</div>\n</div>\n<div class="d_f jc_sb mt_5" name="page-show">\n<input class="w_50" type="number" min="1" value="1"  name="goto-input" />\n<div>\n<span class="ml_10 mr_10" data-i18n="preview:separator"></span>\n<span name="pageCount"></span>\n<span class="ml_10" data-i18n="preview:pages"></span>\n</div>\n</div>\n'}},837:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},r=Object.create(i),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var i="",r=void 0,a=void 0,s=void 0;for(r=n.index,a=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}a!==r&&(i+=t.substring(a,r)),a=r+1,i+=s}return a!==r?i+t.substring(a,r):i}(a(e))},r.$each=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,n)=>{"use strict";e.exports=n(585)},891:e=>{e.exports="data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9IiNkZGQiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyKSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAiIGNhbGNNb2RlPSJzcGxpbmUiIGR1cj0iMS4ycyIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC44IDAuNCAwLjgiIGtleXRpbWVzPSIwOy4yOy41OzEiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiB2YWx1ZXM9Ik0wIDEyIFYyMCBINCBWMTJ6OyBNMCA0IFYyOCBINCBWNHo7IE0wIDEyIFYyMCBINCBWMTJ6OyBNMCAxMiBWMjAgSDQgVjEyeiIvPjwvcGF0aD48cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuMiIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuNCIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwKSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuNiIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuOCIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjwvc3ZnPgo="},616:t=>{"use strict";t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function o(i,r,o){return r=e(r),n(i,t()?Reflect.construct(r,o||[],e(i).constructor):r.apply(i,o))}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):a(e,t)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}i.d(r,{default:()=>E});var g=i(616),f=i(837),p=i.n(f);function v(e,t,n,i,r,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function a(e){v(o,i,r,a,s,"next",e)}function s(e){v(o,i,r,a,s,"throw",e)}a(void 0)})}}function m(t,n,i){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,i){var r=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(i||t):o.value}},m(t,n,i||t)}function I(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var w=i(530),b=i.n(w),y=i(151),P=i.n(y),x=g.vendors.jQuery,C=function(t){function n(){return s(this,n),o(this,n,arguments)}return h(n,t),c(n,[{key:"createDOMElement",value:function(){return document.createElement("div")}},{key:"getContainerElement",value:function(){return x(this.element).find(".fv__preview-image-container")[0]}},{key:"render",value:function(){m(e(n.prototype),"render",this).call(this)}},{key:"initUI",value:function(){var e=this;if(this.inited)return Promise.resolve();var t=x(this.element),n=t.width();if(!n)return new Promise(function(t){setTimeout(function(){e.initUI().then(t)},50)});this.inited=1;var i=!0;return"false"===t.attr("showTitle")&&(i=!1),t[0].innerHTML=b()({showTitle:i}),this.height=Math.ceil(n/.852),t.children("[name=preview-container]").height(this.height),this.$previewImageContainerBox=t.find(".fv__preview-image-container-box"),this.$previewImageContainer=t.find(".fv__preview-image-container"),this.$pageCount=x("[name=pageCount]",t),this.$input=x("[name=goto-input]",t),this.currNum=1,this.scrollTop=0,this.pageCaches=[],this.$previewImageContainerBox.on("wheel",function(e){e.stopPropagation(),e.preventDefault()}),this.$previewImageContainerBox.scroll(function(t){var n=e.$previewImageContainerBox,i=n.scrollTop(),r=e.height,o=0;e.timer&&(clearTimeout(e.timer),e.timer=null),e.timer=setTimeout(function(){Math.abs(i-e.scrollTop)<2||((o=i>e.scrollTop?Math.ceil(i/r):Math.round(i/r))>=e.pageCount&&(o=e.pageCount-1),e.scrollTop!==Math.floor(r*o)&&(e.scrollTop=Math.floor(r*o),n.scrollTop(e.scrollTop)),e.currNum!==o+1&&o+1<=e.pageCount&&(e.currNum=o+1,e.$input.val(e.currNum),e.showPage(o))),e.timer=null},300)}),this.$input.on("input propertychange",function(t){var n=x(t.target),i=n.val().trim();""!==i&&(/^[1-9]\d*$/.test(i)?parseInt(i)>e.pageCount&&(i=e.pageCount):i=e.currNum,n.val(i),i!==e.currNum&&(e.currNum=parseInt(i),e.moveToPage(i-1)))}),this.$input.on("blur",function(t){var n=x(t.target),i=n.val().trim();""===i&&(i=1),n.val(i),i!==e.currNum&&(e.currNum=parseInt(i),e.moveToPage(i-1))}),Promise.resolve()}},{key:"mounted",value:function(){m(e(n.prototype),"mounted",this).call(this),this.initUI()}},{key:"initPageItems",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this.initUI().then(function(o){n.pageCaches=[];for(var a="",s=0;s<e;s++)a+=P()({isCrop:i,index:s+1});n.pageCount=e,n.$pageCount.text(e),n.$previewImageContainer.empty(),n.$previewImageContainer.append(a),n.$pages=n.$previewImageContainer.find(".fv__preview-page"),n.$pages.each(function(e,t){x(t).height(n.height)}),n.reset(t);for(var u=e>10?10:e,c=0;c<u;c++)n.showPage(c);r&&r()})}},{key:"showPage",value:function(e){this.pageCaches[e]||this.controller.showPage(e)}},{key:"reset",value:function(e){return d(function(){var t,n;return I(this,function(i){switch(i.label){case 0:return[4,this.controller.getPDFUI().getPDFDocRender()];case 1:return t=i.sent(),n=(n=t.getCurrentPageIndex())?n+1:1,this.currNum=e||n,this.scrollTop=0,this.timer=null,this.$input.val(this.currNum),this.$previewImageContainerBox.animate({scrollTop:this.scrollTop},100),[2]}})}).call(this)}},{key:"moveToPage",value:function(e){this.$previewImageContainerBox.scrollTop(Math.floor(this.height*e)),this.showPage(e)}},{key:"displayThumbImg",value:function(e,t){this.pageCaches[e]=!0;var n=x(this.$pages[e]);n.height(this.height),n.find(".fv__thumb-loading").hide();var i=n.find(".fv__thumb-image")[0];if(i){i.removeClass("fv__hide"),i.width=t.width,i.height=t.height;var r=i.getContext("2d");if(t.buffer){var o=new(Uint8ClampedArray||Uint8Array)(t.buffer),a=r.createImageData(t.width,t.height);a.data.set(o),r.putImageData(a,0,0)}else if(t.image){var s=new Image;s.onload=function(){r.drawImage(s,0,0),URL.revokeObjectURL(s.src)},s.src=URL.createObjectURL(t.image)}}}}],[{key:"getName",value:function(){return"preview-panel"}}]),n}(g.components.ContainerComponent);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=g.Controller,j=g.PDFViewCtrl.ViewerEvents,_=function(e){function t(e){var n;return s(this,t),(n=o(this,t,[e])).reload=!0,n}return h(t,e),c(t,[{key:"mounted",value:function(){var e,t=this,n=this.getPDFUI();this.addDestroyHook(n.addViewerEventListener((T(e={},j.pageRemoved,function(){t.reload=!0}),T(e,j.pageAdded,function(){t.reload=!0}),T(e,j.importPages,function(){t.reload=!0}),T(e,j.pagesRemoved,function(){t.reload=!0}),T(e,j.pageMoved,function(){t.reload=!0}),T(e,j.pagesMoved,function(){t.reload=!0}),T(e,j.willCloseDocument,function(){t.reload=!0}),T(e,j.pageRotationChange,function(e){t.reload=!0}),e)))}},{key:"showPreview",value:function(e){return d(function(){var t,n,i;return I(this,function(r){switch(r.label){case 0:return this.reload||e?(n=this,[4,this.getPDFUI().getCurrentPDFDoc()]):(this.component.reset(),[2]);case 1:return(t=n.currentPDFDoc=r.sent())?((i=t.getPageCount())<1||(this.component.initPageItems(i),this.reload=!1),[2]):[2]}})}).call(this)}},{key:"showPage",value:function(e){var t=this;if(!(e<0)){var n=this.currentPDFDoc;n&&n.getPageByIndex(e).then(function(e){return e.getThumb(0)}).then(function(n){t.component.displayThumbImg(e,n)})}}}],[{key:"getName",value:function(){return"PreviewPanelController"}}]),t}(M);const B=_;var D=UIExtension.PDFViewCtrl.ViewerEvents,A=function(t){function n(e){return s(this,n),o(this,n,[e])}return h(n,t),c(n,[{key:"mounted",value:function(){var t=this;m(e(n.prototype),"mounted",this).call(this);var i=this.getPDFUI();this.addDestroyHook(i.addViewerEventListener(T({},D.pagesBoxChange,function(e){t.reload=!0})))}},{key:"showPreview",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;m(e(n.prototype),"showPreview",this).call(this),this.component.restUI(t)}},{key:"showPage",value:function(e,t,n){var i=this,r=this.currentPDFDoc;r&&r.getPageByIndex(e).then(function(e){return e.getMediaBoxBitmap(t,n)}).then(function(t){i.component.displayThumbImg(e,t)})}},{key:"getMediaBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.currentPDFDoc;return n?n.getPageByIndex(e).then(function(e){return e.getPageBox(t)}):Promise.reject()}}],[{key:"getName",value:function(){return"CropPreviewPanelController"}}]),n}(B);const Z=A;function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){T(e,t,n[t])})}return e}var k=g.vendors.jQuery,z={cropBox:"black",artBox:"red",trimBox:"greenyellow",bleedBox:"blue"},R=function(t){function n(){return s(this,n),o(this,n,arguments)}return h(n,t),c(n,[{key:"mounted",value:function(){m(e(n.prototype),"mounted",this).call(this);var t=k(this.element);k("[name=title]",t).hide(),k("[name=page-show]",t).css("marginTop","60px"),this.$input.css({width:"100px",marginRight:"20px"}),this.$input.parent().removeClass("jc_sb").addClass("jc_c"),this.width=t.width(),this.height=Math.ceil(this.width/.852),t.children().eq(1).height(this.height),this.restUI();var i=this;Object.defineProperty(i,"currNum",{configurable:!0,set:function(e){this.value=e,i.callback&&i.callback(e)},get:function(){return this.value}})}},{key:"restUI",value:function(e){this.callback=e,this.currPageSize=[0,0,0,0],this.currPages=[],this.currPageBoxes={},this.currShowBoxes="all",this.isMoveWhite=!1,this.currPageRotate=0}},{key:"setCurrentPageRotation",value:function(e){this.currPageRotate=e}},{key:"changePageSize",value:function(e,t,n,i,r,o,a,s,u,c){this.currPageSize=[t,n,i,r],this.currPages=e,this.currPageBoxes=o,this.currShowBoxes=s,this.currSelectBoxes=u,this.pageType=c,this.isMoveWhite=a,this.callback&&this.callback(this.currNum),this.showPage(this.currNum-1)}},{key:"showPage",value:function(e){return d(function(){return I(this,function(t){switch(t.label){case 0:return[4,this.showZoomPage(e)];case 1:return t.sent(),this.pageCaches[e]?[2]:(this.controller.showPage(e,this.width,this.height),[2])}})}).call(this)}},{key:"showZoomPage",value:function(e){return d(function(){var t,n,i,r,o,a,s,u,c,l,h,g;return I(this,function(f){switch(f.label){case 0:return t=this.width,n=this.height,i=k(this.$pages[e]),r=i.find(".fv__thumb-image")[0],o=i.find(".fv__thumb-cover")[0],r.boxWidth&&r.boxHeight?(a=r.boxWidth,s=r.boxHeight,[3,3]):[3,1];case 1:return[4,this.controller.getMediaBox(e)];case 2:u=f.sent(),a=u.right-u.left,s=u.top-u.bottom,r.boxWidth=a,r.boxHeight=s,o.boxWidth=a,o.boxHeight=s,f.label=3;case 3:return this.currPages&&this.currPages.includes(e+1)&&this.currPageSize&&0!==this.currPageSize[0]&&0!==this.currPageSize[1]?(c=t*a/this.currPageSize[0],l=n*s/this.currPageSize[1],c>=t||l>=n?(this.displayZoomThumb(r,o,t,n,0,0),this.displayZoomBox(o,e),[2]):(h=this.currPageSize[2]*t/this.currPageSize[0],g=n-l-this.currPageSize[3]*n/this.currPageSize[1],this.displayZoomThumb(r,o,c,l,h,g),this.displayZoomBox(o,e),[2])):(this.displayZoomThumb(r,o,t,n,0,0),this.displayZoomBox(o,e),[2])}})}).call(this)}},{key:"displayZoomThumb",value:function(e,t,n,i,r,o){if(e.showHeight!==i||e.showWidth!==n||e.showLeft!==r||e.showTop!==o){e.showWidth=n,e.showHeight=i,e.showLeft=r,e.showTop=o;var a=k(e);a.css("width",n+"px"),a.css("height",i+"px"),a.css("left",r+"px"),a.css("top",o+"px"),a.css("transform","translate(0, 0)");var s=k(t);s.css("left",r+"px"),s.css("top",o+"px")}}},{key:"zoomBoxToPDFRect",value:function(e,t){if(e){var n=k(this.$pages[t]).find(".fv__thumb-cover")[0];if(!n)return null;var i,r,o,a,s=n.boxWidth,u=n.boxHeight,c=k(n).width(),l=k(n).height();return 1==this.currPageRotate?(o=e.bottom*s/l,i=e.top*s/l,r=e.left*u/c,a=e.right*u/c):2==this.currPageRotate?(o=(1-e.left/c)*s,i=(1-e.right/c)*s,r=e.bottom*u/l,a=e.top*u/l):3==this.currPageRotate?(o=(1-e.top/l)*s,i=(1-e.bottom/l)*s,r=(1-e.right/c)*u,a=(1-e.left/c)*u):(o=e.right*s/c,i=e.left*s/c,r=(1-e.bottom/l)*u,a=(1-e.top/l)*u),{left:i,bottom:r,right:o,top:a}}return null}},{key:"displayZoomBox",value:function(e,t){var n=this,i=e.boxWidth,r=e.boxHeight,o=k(e).width(),a=k(e).height(),s=["cropBox","artBox","trimBox","bleedBox","calcBox"],u="all"===this.currShowBoxes;if(this.cropDialogComponent){var c=k(this.cropDialogComponent.element.querySelector('[name="showAllBoxes"]'));c.length&&(u=c.prop("checked"))}var l="None"===this.pageType;k(e).children().each(function(e,c){return d(function(){var n,h,g,f,p,v,d,m,w,b,y,P;return I(this,function(I){if(n=0,h=0,g=0,f=0,p=o,v=a,d=c.classList.contains("fv__thumb-cover-resize"),m=this.currPages&&this.currPages.includes(t+1)){if(!this.currPageBoxes||!this.currPageBoxes.cropBox)return[2];this.isMoveWhite?(w=this.currPageBoxes.calcBoxes[t])||(w={left:0,bottom:0,right:p,top:v}):w=this.currPageBoxes[d?this.currSelectBoxes:s[e]],1==this.currPageRotate?(g=w.right*a/i,h=w.left*a/i,n=w.bottom*o/r,f=w.top*o/r):2==this.currPageRotate?(g=w.bottom*a/r,h=w.top*a/r,n=(1-w.right/i)*o,f=(1-w.left/i)*o):3==this.currPageRotate?(g=(1-w.left/i)*a,h=(1-w.right/i)*a,n=(1-w.top/r)*o,f=(1-w.left/r)*o):(g=(1-w.bottom/r)*a,h=(1-w.top/r)*a,n=w.left*o/i,f=w.right*o/i),p=f-n,v=g-h}return b=k(c),d?(y=p<=0||v<=0,c.classList="fv__thumb-cover-resize fv__thumb-cover-resize-".concat(this.currSelectBoxes).concat(y?" fv__thumb-cover-resize-zero":""),m&&l?b.show():b.hide()):u?this.currSelectBoxes!==s[e]?b.show():l?b.hide():b.show():this.currSelectBoxes===s[e]?b.show():b.hide(),c.showWidth=p,c.showHeight=v,c.showLeft=n,c.showTop=h,b.css("width",p+"px"),b.css("height",v+"px"),b.css("left",n-1+"px"),b.css("top",h+"px"),d?(P=z[this.currSelectBoxes],b.css("outlineColor",P),b.children().css("outlineColor",P)):b.css("outlineColor",z[s[e]]),[2]})}).call(n)})}},{key:"setCropDialog",value:function(e){this.cropDialogComponent=e}},{key:"initPageItems",value:function(t,i){m(e(n.prototype),"initPageItems",this).call(this,t,i,!0,this._bindEvent.bind(this))}},{key:"_bindEvent",value:function(){var e=this;k(this.element).find(".fv__thumb-cover").each(function(t,n){var i=n.querySelector(".fv__thumb-cover-resize");e.bindThumbCoverResizeEvent(n,i)})}},{key:"bindThumbCoverResizeEvent",value:function(e,t){var n=this,i=null,r=null,o=null,a=null,s=null,u=function(e,t){return{top:Math.min(e[1],t[1]),left:Math.min(e[0],t[0]),width:Math.abs(e[0]-t[0]),height:Math.abs(e[1]-t[1])}},c=function(e,i,r){if(e){(function(e){if(e){var n={};for(var i in e)Object.hasOwnProperty.call(e,i)&&(n[i]="".concat(e[i],"px"));k(t).css(n)}})(e=O(e,i,r));var o={left:e.left,top:e.top,right:e.left+e.width,bottom:e.top+e.height},a=n.zoomBoxToPDFRect(o,n.currNum-1);n.cropDialogComponent.controller.setCropBox(F({},a))}};this.startHandler=function(o){if(n.currPages&&n.currPages.includes(n.currNum)){var u=t.getBoundingClientRect();if(!(u.width<=0||u.height<=0)&&(a=k(o.target).attr("action-type"))){var c=e.getBoundingClientRect(),l=c.left,h=c.top;if(i=[S(o,"clientX")-l,S(o,"clientY")-h],"resize"===a){var g=t.getBoundingClientRect(),f=k(o.target).index();0===f?r=[g.left+g.width-l,g.top+g.height-h]:1===f?r=[g.left-l,g.top+g.height-h]:2===f?r=[g.left+g.width-l,g.top-h]:3===f&&(r=[g.left-l,g.top-h])}"move"===a&&(s=[S(o,"offsetX"),S(o,"offsetY")])}}},this.moveHandler=function(n){if(i){var l=e.getBoundingClientRect(),h=l.left,g=l.top,f=l.width,p=l.height,v=null,d=[S(n,"clientX")-h-i[0],S(n,"clientY")-g-i[1]],m=d[0],I=d[1];if(o=[i[0]+m,i[1]+I],"resize"===a)v=u(r,o);else if("move"===a){var w=[S(n,"offsetX"),S(n,"offsetY")],b=[w[0]-s[0],w[1]-s[1]],y=b[0],P=b[1],x=t.getBoundingClientRect();v={top:parseFloat(k(t).css("top"))+P,left:parseFloat(k(t).css("left"))+y,width:x.width,height:x.height}}c(v,f,p)}},this.endHandler=function(n){if(i){var l=null;if(o){var h=e.getBoundingClientRect(),g=h.top,f=h.left,p=h.width,v=h.height,d=[S(n,"clientX")-f-i[0],S(n,"clientY")-g-i[1]],m=d[0],I=d[1];if((o=[i[0]+m,i[1]+I])[0]=o[0]<0?0:o[0]>p?p:o[0],o[1]=o[1]<0?0:o[1]>v?v:o[1],"resize"===a)l=u(r,o);else if("move"===a){var w=t.getBoundingClientRect();l={top:parseFloat(k(t).css("top")),left:parseFloat(k(t).css("left")),width:w.width,height:w.height}}c(l,p,v)}i=null,r=null,o=null,a=null,s=null}},k(e).on("mousedown touchstart",this.startHandler).on("mousemove touchmove",this.moveHandler).on("mouseup touchend",this.endHandler).on("mouseleave touchcancel",this.endHandler)}},{key:"destroy",value:function(){var t=this;m(e(n.prototype),"destroy",this).call(this);var i=k(this.element).find(".fv__thumb-cover");i&&i.length>0&&i.each(function(e,n){k(n).off("mousedown touchstart",t.startHandler).off("mousemove touchmove",t.moveHandler).off("mouseup touchend",t.endHandler).off("mouseleave touchcancel",t.endHandler)})}}],[{key:"getName",value:function(){return"crop-preview-panel"}}]),n}(C),S=function(e,t){if(0!==e.type.indexOf("touch"))return e[t];switch(e.type){case"touchstart":case"touchmove":return e.touches[0][t];case"touchend":case"touchcancel":return e.changedTouches[0][t]}},O=function(e,t,n){var i=11,r=F({},e),o=r.left,a=r.top,s=r.width,u=r.height;return o+s>t-i&&(o=t-i-s),a+u>n-i&&(a=n-i-u),o<i&&(o=i),a<i&&(a=i),o+s>=t-i&&(s=t-i-o),a+u>=n-i&&(u=n-i-a),{left:o,top:a,width:s,height:u}},N=g.UIConsts.COMPONENT_EVENTS,Y=function(e){function t(){return s(this,t),o(this,t,arguments)}return h(t,e),c(t,[{key:"mounted",value:function(){var e=this;this.reload=!1,this.pageIndex=-1,this.component.on(N.SHOWN,function(){return d(function(){return I(this,function(e){switch(e.label){case 0:return[4,this.updatePageIndex()];case 1:return[2,e.sent()]}})}).call(e)})}},{key:"updatePageIndex",value:function(){return d(function(){return I(this,function(e){switch(e.label){case 0:return-1===this.pageIndex?[3,2]:[4,new Promise(function(e){return setTimeout(e,200)})];case 1:e.sent(),this.component.moveToPage(this.pageIndex-1),this.pageIndex=-1,e.label=2;case 2:return[2]}})}).call(this)}},{key:"initData",value:function(){this.currentPDFDoc=void 0,this.reload=!1}},{key:"setProps",value:function(e){return d(function(e){var t,n;return I(this,function(i){switch(i.label){case 0:return t=e.doc,n=e.pageIndex,t&&t!==this.currentPDFDoc&&(this.currentPDFDoc=t,this.reload=!0,this.reset(n)),"number"!=typeof n?[3,2]:(this.pageIndex=n,this.component.isVisible?[4,this.updatePageIndex()]:[3,2]);case 1:i.sent(),i.label=2;case 2:return[2]}})}).apply(this,arguments)}},{key:"reset",value:function(e){if(this.reload){var t=this.currentPDFDoc;if(t){var n=t.getPageCount();n<1||(this.component.initPageItems(n,e),this.reload=!1)}}else this.component.reset()}}],[{key:"getName",value:function(){return"PreviewPanelDocController"}}]),t}(B),E=(g.PDFViewCtrl.Events,function(e){function t(){return s(this,t),o(this,t,arguments)}return h(t,e),c(t,null,[{key:"getName",value:function(){return"Preview"}},{key:"getLoader",value:function(){return p()}},{key:"initOnLoad",value:function(){var e=g.modular.module("preview",[]);e.registerComponent(C),e.registerController(B),e.registerComponent(R),e.registerController(Z),e.registerController(Y)}}]),t}(g.UIXAddon))})(),r=r.default})());
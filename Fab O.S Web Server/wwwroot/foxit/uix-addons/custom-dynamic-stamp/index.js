!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],e):"object"==typeof exports?exports.CustomDynamicStamp=e(require("UIExtension")):t.CustomDynamicStamp=e(t.UIExtension)}(self,t=>(()=>{var e={642:(t,e,n)=>{n(779);t.exports=function(t){"use strict";t=t||{};return'<layer class="fv__ui-custom-dynamic-stamp-dialog" append-to="body" backdrop @var.self="$component" @controller="custom-dynamic-stamp:CreateCustomDynamicStampDialogController as cdsc" @isolate>\n<layer-header @draggable="{type: \'parent\'}" title="custom-dynamic-stamp:dialog.header"></layer-header>\n<layer-view class="fv__ui-custom-dynamic-stamp-dialog-body">\n<div class="fv__ui-custom-dynamic-stamp-preview d_f jc_c ai_c">\n<div class="fv__ui-custom-dynamic-stamp-preview-wrap d_f jc_c ai_c">\n<img class="fv__ui-custom-dynamic-stamp-preview-template" id="backgroundImage"/>\n<custom-dynamic-stamp:custom-dynamic-stamp-text name="dynamic-text"></custom-dynamic-stamp:custom-dynamic-stamp-text>\n</div>\n</div>\n<fieldset class="fv__ui-custom-dynamic-stamp-dialog-fieldset">\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="backgroundColor" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'backgroundColor\')"/>\n<label class="d_f ai_c f_1">\n<span class="w_128" data-i18n="custom-dynamic-stamp:dialog.backgroundColor"></span>\n<div class="color-picker" role="button" tabindex="0" name="backgroundColor" @aria:labelledby="::previousSiblings()" @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="template" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'template\')"/>\n<label class="d_f ai_c f_1">\n<label class="w_128" data-i18n="custom-dynamic-stamp:dialog.template"></label>\n<dropdown editable name="stamp-templates" class="f_1">\n<dropdown-button @foreach="item in cdsc.templateList" @sync.text="item.name" @on.click="cdsc.selectTemplate(item)"></dropdown-button>\n</dropdown>\n<div class="fv__ui-custom-dynamic-stamp-browseWrap">\n<input type="file" id="stamp-local-path" accept="image/jpg,image/jpeg,image/bmp,image/png,image/webp" class="p_a" @on.native.change="self.inputFile($event)"/>\n<div class="fv__ui-dialog-ok-button fv__ui-button" id="browse" >custom-dynamic-stamp:dialog.browse</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.category"></label>\n<dropdown editable name="stamp-category" class="f_1">\n<dropdown-button @foreach="name in cdsc.categoryList" @sync.text="name" @on.click="cdsc.selectCategory(name)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.name"></label>\n<input name="name" class="f_1 fv__ui-custom-dynamic-stamp-name" type="text" @model="cdsc.data.name"/>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.font"></label>\n<dropdown editable name="stamp-fontFamilies" id="fv__ui-fontFamilies" class="f_1">\n<dropdown-button @foreach="item in cdsc.fontFamilies" @sync.text="item.name" @on.click="cdsc.selectFontFamily(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.stampText"></label>\n<dropdown editable name="stamp-text-type" class="f_1">\n<dropdown-button @foreach="item in cdsc.textType" @sync.text="item.type" @on.click="cdsc.selectTextType(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field fv__ui-field-transforms d_f ai_c jc_sb">\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.fontSize"></label>\n<dropdown editable name="fontSizeSelect" selected="0" selectable="false">\n<dropdown-button @foreach="size in cdsc.fontSizes" @sync.text="size" @on.click="cdsc.selectFontSize(size)"></dropdown-button>\n</dropdown>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item fv__ui-color-pick d_f ai_c">\n<label class=" d_ib" data-i18n="custom-dynamic-stamp:dialog.color"></label>\n<div class="color-picker" role="button" tabindex="0" name="color" @aria:labelledby="::previousSiblings()"  @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</div>\n</div>\n\n</fieldset>\n</layer-view>\n<layer-toolbar class="fv__ui-custom-dynamic-stamp-dialog-footer d_f ai_c jc_fe">\n<xbutton class="fv__ui-dialog-ok-button" @on.native.click="cdsc.ok()">common-dialogs.ok</xbutton>\n<xbutton class="fv__ui-dialog-cancel-button" @on.click="self.cancel()">common-dialogs.cancel</xbutton>\n</layer-toolbar>\n</layer>'}},80:t=>{t.exports=null},585:(t,e,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},o=Object.create(a),i=/["&'<>]/;function r(t){return"string"!=typeof t&&(t=null==t?"":"function"==typeof t?r(t.call(t)):JSON.stringify(t)),t}o.$escape=function(t){return function(t){var e=""+t,n=i.exec(e);if(!n)return t;var a="",o=void 0,r=void 0,s=void 0;for(o=n.index,r=0;o<e.length;o++){switch(e.charCodeAt(o)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}r!==o&&(a+=e.substring(r,o)),r=o+1,a+=s}return r!==o?a+e.substring(r,o):a}(r(t))},o.$each=function(t,e){if(Array.isArray(t))for(var n=0,a=t.length;n<a;n++)e(t[n],n);else for(var o in t)e(t[o],o)},t.exports=o},779:(t,e,n)=>{"use strict";t.exports=n(585)},616:e=>{"use strict";e.exports=t}},n={};function a(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,a),i.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};return(()=>{"use strict";function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t(e)}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(e=function(){return!!t})()}function n(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}function i(a,o,i){return o=t(o),n(a,e()?Reflect.construct(o,i||[],t(a).constructor):o.apply(a,i))}function r(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):r(t,e)}function s(t,e){if(!r(t,e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function l(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}a.d(o,{default:()=>ft});var p=a(616),d=p.vendors,h=(p.PDFUI,p.UIXAddon),f=p.SeniorComponentFactory,y=p.modular,g=p.Controller,v=d.jQuery,b=d.Hammer,w=p.services.StampStorageService,x=p.PDFViewCtrl,T=x.storage.StorageFeature,S=x.shared,_=x.PDF,k=x._internal,C=x.PDFViewer,I=S.extendOptions,D=S.colorConvertor,E=x.commons.createDeferred,P=x.FontUtil.FontFamilies,U=x.Consts.CUSTOM_STAMPS_LOCALKEY,A=_.constant.STAMP_TEXT_TYPE,$=k.consts.ADD_FONT_MAP_LIST,O=x.DeviceInfo.isDesktop,F=x.keyboard.KeyboardUtils,z=F.isMatch,j=F.matchers.Enter,L="custom-dynamic-stamp",M="backgroundColor",N="template",R=["auto","6","8","10","12","14","16","18","20","22","24","26","28","30","32"],B="CUSTOM_DYNAMIC_STAMP_TEMPLATE",V="background",q="field",H=a(80),W=a.n(H),X=y.module("custom-dynamic-stamp",[]);function Y(t,e,n,a,o,i,r){try{var s=t[i](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(a,o)}function K(t){return function(){var e=this,n=arguments;return new Promise(function(a,o){var i=t.apply(e,n);function r(t){Y(i,a,o,r,s,"next",t)}function s(t){Y(i,a,o,r,s,"throw",t)}r(void 0)})}}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function J(t,e){var n,a,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),a.forEach(function(e){G(t,e,n[e])})}return t}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function tt(t){return function(t){if(Array.isArray(t))return Z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(t){return K(function(){var e;return J(this,function(n){return e=new FileReader,[2,new Promise(function(n){e.onload=function(t){var e;n(null==t||null===(e=t.target)||void 0===e?void 0:e.result)},e.readAsDataURL(t)})]})})()}function nt(t){var e,n=t.wrapWidth,a=void 0===n?290:n,o=t.wrapHeight,i=void 0===o?150:o,r=t.text,s=void 0===r?"":r,c=t.fontSize,l=void 0===c?"":c,u=t.pLeft,m=void 0===u?void 0:u,p=t.pTop,d=void 0===p?void 0:p,h=document.createElement("span");h.style.opacity="0",document.body.appendChild(h),h.innerText=s;var f=a/i,y=(e=h.getBoundingClientRect()).width/e.height;if(!y)return{width:0,height:0,left:0,right:a,top:i,bottom:0};var g,v,b,w,x=i,T=a;return parseFloat(l)?(h.style.fontSize="".concat(l,"px"),e=h.getBoundingClientRect(),v=(g=void 0!==m?m:(a-e.width)/2)+e.width,w=(b=void 0!==d?d:(i-e.height)/2+e.height)-e.height,document.body.removeChild(h),{width:e.width,height:e.height,left:g,right:v,top:b,bottom:w}):(y>f?(g=void 0!==m?m:0,v=a,x=a/y,w=(b=void 0!==d?d:(i-x)/2+x)-x):(w=(b=void 0!==d?d:i)-i,v=(T=i*y)+(g=void 0!==m?m:(a-T)/2)),document.body.removeChild(h),{left:g,right:v,top:b,bottom:w,width:T,height:x})}function at(t){var e=t.url;return r(e,Blob)?et(e).then(function(t){return ot(t)}):ot(e)}function ot(t){return O?new Promise(function(e,n){var a=new Image;a.setAttribute("crossOrigin","Anonymous"),a.onload=function(){var n=290/150,o=a.width/a.height,i=a.width,r=a.height;o>n?r=(i=290)/o:i=(r=150)*o,e({url:t,width:i,height:r,imgRatio:a.width/i})},a.src=t}):function(t){return new Promise(function(e,n){var a=document.createElement("canvas"),o=a.getContext("2d");a.width=290,a.height=150;var i=new Image;i.setAttribute("crossOrigin","Anonymous"),i.onload=function(){var t=290/150,n=i.width/i.height,r=i.width,s=i.height;n>t?s=(r=290)/n:r=(s=150)*n,a.width=r,a.height=s,o?(o.drawImage(i,0,0,r,s),e({url:a.toDataURL("image/png"),width:r,height:s,imgRatio:1})):e({url:a.toDataURL("image/png"),width:r,height:s,imgRatio:1})},i.src=t})}(t)}var it=function(){function t(){s(this,t),G(this,"viewer",void 0),G(this,"stampStorageService",void 0),G(this,"stampsArr",[]),G(this,"customTemplateArr",[]),G(this,"preparePromise",void 0)}return l(t,[{key:"allInjected",value:function(){return K(function(){var t,e,n;return J(this,function(a){switch(a.label){case 0:return t=E(),this.preparePromise=t.promise,e=this,[4,this.getTemplatesInLocal()];case 1:return e.customTemplateArr=a.sent(),n=this,[4,this.getDynamicStamps()];case 2:return n.stampsArr=a.sent(),t.resolve(),[2]}})}).call(this)}},{key:"prepare",value:function(){return this.preparePromise}},{key:"setStampTemplates",value:function(t){for(var e,n=function(e){var n=t[e];o.includes(n.name)?a.forEach(function(t){t.name==n.name&&(t.url=n.url)}):(o.push(n.name),a.push(n))},a=[],o=this.customTemplateArr.map(function(t){return t.name}),i=0;i<t.length;i++)n(i);(e=this.customTemplateArr).unshift.apply(e,tt(a)),this.storeTemplatesInLocal(this.customTemplateArr)}},{key:"removeStampTemplates",value:function(t){for(var e=tt(this.customTemplateArr),n=0;n<t.length;n++)for(var a=0;a<e.length;a++)t[n]==e[a].name&&e.splice(a,1);this.customTemplateArr=e,this.storeTemplatesInLocal(this.customTemplateArr)}},{key:"getStampTemplates",value:function(){return this.customTemplateArr}},{key:"getTemplatesInLocal",value:function(){return K(function(){return J(this,function(t){switch(t.label){case 0:return[4,this.viewer.getStorage().get(T.STAMP,B)];case 1:return[2,t.sent()||[]]}})}).call(this)}},{key:"storeTemplatesInLocal",value:function(t){return this.viewer.getStorage().set(T.STAMP,B,t)}},{key:"setDynamicStamp",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.formatData(t,n).then(function(t){var n;return(n=e.stampsArr).push.apply(n,tt(t)),e.getCustomStampIcons(t).then(function(n){e.stampStorageService.triggerCustomStampChange({});var a=[];return t.forEach(function(t,o){t.showUrl=n[o].showUrl,a.push(e.viewer.addAnnotationIcon(t))}),Promise.all(a).then(function(t){e.storeStampInLocal(n)})})})}},{key:"removeDynamicStamp",value:function(t){return K(function(){var e,n,a,o,i,r;return J(this,function(s){for(e=tt(this.stampsArr),n=[],a=0;a<t.length;a++)for(o=0;o<e.length;o++)t[a].category===e[o].category&&t[a].names.includes(e[o].name)&&(r=e.splice(o,1),(i=n).push.apply(i,tt(r)),this.viewer.removeAnnotationIcon("stamp",r[0].category,r[0].name,r[0].index),o--);return this.stampsArr=e,[2]})}).call(this)}},{key:"getDynamicStamp",value:function(){return K(function(){var t,e,n;return J(this,function(a){switch(a.label){case 0:return[4,this.getDynamicStamps()];case 1:return t=a.sent(),e=tt(t),n=["annotType","showUrl","fileType","url"],e.forEach(function(t){n.forEach(function(e){return delete t[e]})}),[2,e]}})}).call(this)}},{key:"getCustomStampsFromLocal",value:function(){return K(function(){return J(this,function(t){switch(t.label){case 0:return[3,1];case 1:return[4,this.viewer.getStorage().get(T.STAMP,U)];case 2:return[2,t.sent()||[]];case 3:return[2]}})}).call(this)}},{key:"getDynamicStamps",value:function(){return K(function(){var t,e,n,a,o;return J(this,function(i){switch(i.label){case 0:return[4,this.getCustomStampsFromLocal()];case 1:if(t=i.sent(),e=[],t)for(var r in t)a=t[r],o=a.filter(function(t){return!!(null==t?void 0:t.field)}),(n=e).push.apply(n,tt(o));return[2,e]}})}).call(this)}},{key:"storeStampInLocal",value:function(t){return K(function(){var e,n,a,o,i,r,s,c,l,u,m,p,d;return J(this,function(h){switch(h.label){case 0:return[4,this.getCustomStampsFromLocal()];case 1:if(e=h.sent(),n={},t.length&&t.forEach(function(t){var e=n[t.category]||[];e.push(t),n[t.category]=e}),e)for(var f in e){a=n[f]||[],o=tt(e[f]).concat(tt(a)),i=new Map,r=!0,s=!1,c=void 0;try{for(l=o[Symbol.iterator]();!(r=(u=l.next()).done);r=!0)m=u.value,p=m.index?m.index:f+m.name,i.set(p,m)}catch(t){s=!0,c=t}finally{try{r||null==l.return||l.return()}finally{if(s)throw c}}e[f]=tt(i.values())}for(var y in n)e[y]||(e[y]=n[y]);return[3,2];case 2:return[4,(d=this.viewer.getStorage()).remove(T.STAMP,U)];case 3:return h.sent(),[4,d.set(T.STAMP,U,e)];case 4:h.sent(),h.label=5;case 5:return[2]}})}).call(this)}},{key:"formatData",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];return t.map(function(t){var a=/[~!@#'\.\$%\^&\*\(\)\=;\[\]\{\}]/;if(!String(t.category)||!String(t.name))return Promise.reject(new Error("Category and name parameter cannot be empty."));if(a.test(t.category))throw new Error("[Illegal Argument] Invalid category: Special characters is invalid.");if(a.test(t.name))throw new Error("[Illegal Argument] Invalid name: Special characters is invalid.");n.push(at({url:t.fileData}).then(function(n){var a,o,i=n.url,r=n.width,s=n.height;if((null===(o=t.field)||void 0===o||null===(a=o.font)||void 0===a?void 0:a.size)&&e){var c=t.field,l=c.font,u=c.value,m=c.rect,p=m?m.left:void 0,d=m?m.top:void 0;t.field.rect=nt({wrapWidth:r,wrapHeight:s,text:u,fontSize:l.size,pLeft:p,pTop:d})}return I({},{width:r,height:s},t,{url:i,fileType:"png",annotType:"stamp",type:L,index:(Math.random()+"").substring(2)+Date.now()})}))}),Promise.all(n)}},{key:"getCustomStampIcons",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stampsArr;return Promise.all(e.map(function(e){return t.getStampIcon(Q({annotType:"stamp"},e))}))}},{key:"getStampIcon",value:function(t){return this.viewer.previewIconDoc(t).then(function(e){return et(e).then(function(e){return Q({showUrl:e},t)})}).catch(function(t){})}}],[{key:"inject",value:function(){return{viewer:C,stampStorageService:w}}}]),t}(),rt=function(t){function e(){var t;return s(this,e),G(t=i(this,e,arguments),"dynamicStampsService",void 0),t}return m(e,t),l(e,[{key:"handle",value:function(){return K(function(){var t;return J(this,function(e){switch(e.label){case 0:if(0===(t=this.component.getRoot().querySelectorAll("@custom-dynamic-stamp:create-custom-dynamic-stamp-dialog")).length)throw new Error("The `<custom-dynamic-stamp:create-custom-dynamic-stamp-dialog> ` should be added into your layout template");if(t.length>1)throw new Error("Found more than one of `<custom-dynamic-stamp:create-custom-dynamic-stamp-dialog>`. Please check if the component has been added repeatedly");return[4,this.dynamicStampsService.prepare()];case 1:return e.sent(),setTimeout(function(){var e=t[0];e.open(document.body),e.element.focus()}),this.component.parent.deactive(),[2]}})}).call(this)}}],[{key:"getName",value:function(){return"CreateDynamicStampButtonController"}},{key:"inject",value:function(){return{dynamicStampsService:it}}}]),e}(g);function st(e,n,a){return st="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,a){var o=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e}(e,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(a||e):i.value}},st(e,n,a||e)}X.registerController(rt),X.registerFragment("create-dynamic-stamp-button",{template:'\n        <xbutton class="fv__ui-create-dynamic-stamp-button"\n            name="create-dynamic-stamp-button"\n            @controller="custom-dynamic-stamp:CreateDynamicStampButtonController"\n            icon-class="fx-icon-sm fv__icon-create-custom-dynamic-stamp-icon">custom-dynamic-stamp:toolbar.createDynamicStampTextBtnText\n        </xbutton>\n    '});var ct=a(642),lt=a.n(ct),ut=function(e){function n(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];var o;return s(this,n),(o=i(this,n,tt(e))).insertText="",o.fontSize="",o}return m(n,e),l(n,[{key:"mounted",value:function(){var e=this;st(t(n.prototype),"mounted",this).call(this),this.$wrap=v(this.element),this.$text=v(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text")),this.$img=v(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text-img")),this.$shape=v(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text-shape"));var a=this.hammer=new b.Manager(this.$text[0],{recognizers:[[b.Pan,{direction:b.DIRECTION_ALL}]]});this.addDestroyHook(function(){e.hammer.destroy(),e.hammer=null});var o=this.getClosestComponentByName("fv--custom-dynamic-stamp-dialog"),i={left:0,top:0};this.element.addEventListener("touchstart",function(t){o.element.style.overflow="hidden"}),this.element.addEventListener("touchend",function(t){o.element.style.overflow="auto"}),a.on("panstart",function(t){i=e.$text.position(),e.$shape.css({display:"inline-block",width:"".concat(e.$text.width(),"px"),height:"".concat(e.$text.height(),"px"),top:"".concat(i.top,"px"),left:"".concat(i.left,"px")})}),a.on("panmove",function(t){e.$shape.css({top:"".concat(i.top+t.deltaY,"px"),left:"".concat(i.left+t.deltaX,"px")})}),a.on("panend",function(t){e.$text.css({top:"".concat(i.top+t.deltaY,"px"),left:"".concat(i.left+t.deltaX,"px")}),e.$shape.css({display:"none"});var n=e.$text.position(),a=e.$text.width(),o=e.$text.height(),r=e.$wrap.height();e.pdfUI.eventEmitter.emit("updateRect",{left:n.left,right:n.left+a,bottom:r-n.top-o,top:r-n.top,width:a,height:o})})}},{key:"initData",value:function(t){this.insertText=t.text,this.$text.text(t.text),this.fontSize=t.size,this.color=t.color,this.$text.css({fontSize:"".concat(t.size,"px"),width:"auto",height:"auto",color:t.color}),this.$img.css({width:"auto",height:"auto"})}},{key:"setSize",value:function(t){if(this.fontSize=t,this.$text.css({fontSize:"".concat(t,"px"),width:"auto",height:"auto"}),this.insertText){var e=this.$text.position();this.updateUI({text:this.insertText,fontSize:t,pLeft:e.left,pTop:this.$wrap.height()-e.top})}}},{key:"setText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.insertText=t,this.$text.text(t),this.$text.css({fontSize:"".concat(this.fontSize,"px"),width:"auto",height:"auto"}),t&&this.updateUI({text:t,fontSize:this.fontSize})}},{key:"setImg",value:function(t){if(this.$img.attr("src",t),t){var e=this.$text.position();this.$img.css({width:"".concat(this.$text.width(),"px"),height:"".concat(this.$text.height(),"px"),top:"".concat(e.top,"px"),left:"".concat(e.left,"px"),opacity:1})}else this.$img.css({width:"auto",height:"auto"})}},{key:"setColor",value:function(t){this.$text.css({color:t}),this.$shape.css({borderColor:t})}},{key:"updateUI",value:function(t){var e=this.$wrap.height(),n=this.$wrap.width(),a=nt(t=Object.assign({},{wrapWidth:n,wrapHeight:e},t)),o=a.width,i=a.height,r=a.left,s=a.top;this.pdfUI.eventEmitter.emit("updateRect",a),this.$shape.css({width:"".concat(o,"px"),height:"".concat(i,"px"),top:"".concat(e-s,"px"),left:"".concat(r,"px")}),this.$text.css({display:this.insertText?"block":"none",width:"".concat(o,"px"),height:"".concat(i,"px"),top:"".concat(e-s,"px"),left:"".concat(r,"px")})}},{key:"updateWrapUI",value:function(t,e){this.$wrap.css({width:"".concat(t,"px"),height:"".concat(e,"px")}),this.$shape.css({width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")}),this.insertText||(this.$img.css({width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")}),this.$text.css({display:"none",width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")}))}}],[{key:"getName",value:function(){return"custom-dynamic-stamp-text"}}]),n}(f.createSuperClass({template:'<div class="fv__ui-dynamic-stamp-insert-text-wrap" @var.self="$component">\n            <div class="fv__ui-dynamic-stamp-insert-text"></div>\n            <img class="fv__ui-dynamic-stamp-insert-text-img"/>\n            <div class="fv__ui-dynamic-stamp-insert-text-shape"></div>\n    </div>'}));X.registerComponent(ut);var mt=function(e){function n(){return s(this,n),i(this,n,arguments)}return m(n,e),l(n,[{key:"mounted",value:function(){st(t(n.prototype),"mounted",this).call(this);var e=v(this.element);this.$templateType=e.find('[name="templateType"]'),this.$backgroundImage=e.find("#backgroundImage"),this.$backgroundColor=e.find("#backgroundColor"),this.textComponent=this.getComponentByName("dynamic-text")}},{key:"show",value:function(){var e=this,a=this;return K(function(){return J(this,function(o){switch(o.label){case 0:return[4,this.controller.resetData()];case 1:return o.sent(),this.syncUI(),st(t(n.prototype),"show",e).call(a),[2]}})}).call(this)}},{key:"syncUI",value:function(){var t=this.controller.data;this.$backgroundImage.attr("src",t.url);var e=v(this.element.querySelector('[name="backgroundColor"] > div'));e.css("border-color",t.backgroundColor),e.find(".label").toggle(!t.backgroundColor);var n=v(this.element.querySelector('[name="color"] > div'));n.css("border-color",t.color),n.find(".label").toggle(!t.color),this.$templateType[0].checked=!0,this.controller.setImgType(V),this.selectType(t.type),this.textComponent.initData({text:t.stampText,color:t.color,size:t.fontSize})}},{key:"keydownColor",value:function(t){z(t,j)&&this.selectColor(t)}},{key:"selectColor",value:function(t){var e=this,n=this.controller.data,a=this.pdfUI.colorSpectrum,o=t.target,i=v(t.target),r="";if(i.hasClass("color-picker")?(r=i.attr("name"),i=i.find(".mask")):r=i.parent().parent().attr("name"),r!==M||n.type===M){a.setDefaultColor(D(n[r],"#")),a.show(o,function(t){!function(t){var n=D(t,"#"),a=i.parent();switch(n?a.css("border-color",D(t,"HTML")):a.css("border-top-color","blue").css("border-right-color","green"),a.find(".label").toggle(!t),r){case"backgroundColor":e.handlerBackgroundColor(t),e.controller.setData(r,t),e.controller.setImgType(V),e.controller.getIconUrl();break;case"color":e.getComponentByName("dynamic-text").setColor(n),e.controller.setData(r,n),e.controller.data.stampText&&e.controller.getIconUrl()}}(t)})}}},{key:"selectType",value:function(t){var e=v(this.element),n=N,a=this.getComponentByName("stamp-templates");if(this.resetStampText(),this.controller.setData("url",""),this.controller.setImgType(V),t===n){e.find("#stamp-local-path").removeAttr("disabled"),e.find("#browse").removeAttr("disabled"),a.enable();var o=a.getEditValue();a.trigger("change",o),this.updatePreviewImg("")}else e.find("#stamp-local-path").attr("disabled","disabled"),e.find("#browse").attr("disabled","disabled"),a.disable(),this.controller.setData("backgroundColor",this.controller.data.backgroundColor),this.handlerBackgroundColor(this.controller.data.backgroundColor),this.controller.setData("imgRatio",1),this.controller.getIconUrl();this.controller.setData("type",t)}},{key:"handlerBackgroundColor",value:function(t){var e=function(t){var e=t.bgColor,n=t.round,a=void 0===n?20:n,o=t.x,i=void 0===o?0:o,r=t.y,s=void 0===r?0:r,c=t.width,l=void 0===c?290:c,u=t.height,m=void 0===u?93:u,p=document.createElement("canvas"),d=p.getContext("2d");return d?(p.width=l,p.height=m,d.beginPath(),d.moveTo(i+a,s),d.lineTo(i+l-a,s),d.arc(i+l-a,s+a,a,1.5*Math.PI,2*Math.PI),d.lineTo(i+l,s+m-a),d.arc(i+l-a,s+m-a,a,0,.5*Math.PI),d.lineTo(i+a,s+m),d.arc(i+a,s+m-a,a,.5*Math.PI,Math.PI),d.lineTo(i,s+a),d.arc(i+a,s+a,a,Math.PI,1.5*Math.PI),d.fillStyle=e,d.strokeStyle=e,d.fill(),d.stroke(),d.closePath(),{url:p.toDataURL("image/png"),width:l,height:m}):{url:p.toDataURL("image/png"),width:l,height:m}}({bgColor:t}),n=e.url,a=e.width,o=e.height;this.textComponent.updateWrapUI(a,o),this.controller.setData("url",n)}},{key:"inputFile",value:function(t){var e=this;t.target.files.length<1||(this.loading=this.pdfUI.loading(this.element.querySelector(".fv__ui-layer-inner"),"",!0),this.controller.setImgType(V),this.$backgroundImage.attr("src",""),this.resetStampText(),this.textComponent.setText(""),et(t.target.files[0]).then(function(n){at({url:n}).then(function(n){var a=n.url,o=n.width,i=n.height,r=n.imgRatio;e.controller.currentTemplate={url:a,width:o,height:i,imgRatio:r},e.textComponent.updateWrapUI(o,i),e.controller.setData("url",a),e.controller.setData("imgRatio",r),t.target.value="",e.controller.getIconUrl()})}))}},{key:"resetStampText",value:function(){this.controller.setDropdownValue(this.controller.textTypeComponent,"stampTextType",this.controller.textType[0].type),this.controller.setData("stampText","")}},{key:"updatePreviewImg",value:function(t){this.$backgroundImage.attr("src",t),this.loading&&this.loading.then(function(t){return t.close()})}}],[{key:"getName",value:function(){return"create-custom-dynamic-stamp-dialog"}}]),n}(f.createSuperClass({template:lt()()}));X.registerComponent(mt);var pt={CUSTOM_TEXT:"customText",NAME:"name",NAME_DATE_TIME:"nameDateTime",DATE_TIME:"dateTime",DATE:"date"},dt=function(e){function n(t){var e;return s(this,n),G(e=i(this,n,[t]),"viewer",void 0),G(e,"dynamicStampService",void 0),e.fontSizes=R,e.fontFamilies=P,e.initData={type:M,backgroundColor:"#47BE9B",url:"",templateName:"",category:"",name:"New Stamp",font:e.fontFamilies[0].name,stampTextType:"",stampText:"",fontSize:"auto",color:"#FFFFFF",rect:null,imgRatio:1},e.templateList=[],e.category=[],e.categoryList=[],e.textType=[],e.dynamicBackgroundImg="",e.currentTemplate={},e.imgType=V,e}return m(n,e),l(n,[{key:"mounted",value:function(){var e=this;st(t(n.prototype),"mounted",this).call(this),this.templatesComponent=this.component.getComponentByName("stamp-templates"),this.categoryComponent=this.component.getComponentByName("stamp-category"),this.sizeComponent=this.component.getComponentByName("fontSizeSelect"),this.textTypeComponent=this.component.getComponentByName("stamp-text-type"),this.fontComponent=this.component.getComponentByName("stamp-fontFamilies"),this.textComponent=this.component.getComponentByName("dynamic-text"),v(this.fontComponent.element).find("input").attr("readonly","true"),this.addDestroyHook(this.textTypeComponent.on("change",function(t){"string"==typeof t&&(t={type:t,key:e.textType[0].key}),e.setData("stampTextType",A[t.key]),e.setData("stampText",t.type),e.textComponent.setText(e.data.stampText),e.setImgType(q),e.getIconUrl()}),this.categoryComponent.on("change",function(t){e.setData("category",t)}),this.sizeComponent.on("change",function(t){e.setData("fontSize",t),e.setImgType(q),e.getIconUrl()}),this.fontComponent.on("change",function(t){e.setData("font",t),e.setImgType(q),e.getIconUrl()}),this.templatesComponent.on("change",function(t){var n=e.templateList.find(function(e){return e.name===t});n&&e.selectTemplate(n),e.templateList[0].name===t&&(t=""),e.setData("templateName",t)})),this.pdfUI.eventEmitter.on("updateRect",function(t){e.data.rect=t,e.setImgType(q),e.getIconUrl()}),this.pdfUI.addViewerEventListener("change-language-success",function(){e.resetData()}),this.pdfUI.getStore().then(function(t){var n=t.subscribe($,function(t){var n,a=t.new,o=[];a.slice(0).forEach(function(t){o.push({name:t.name,value:t.name})}),(n=e.fontFamilies).push.apply(n,tt(o))});e.viewer.addDestroyHook(function(){n()})})}},{key:"customTemplateHandle",value:function(t){var e=this.templatesComponent.$container.children().find(function(e){var n=e.attrs,a=n.name,o=n.url;return a&&o&&a===t});return e&&e.attrs}},{key:"resetData",value:function(){return K(function(){var t,e,n,a;return J(this,function(o){return t=this,this.data=Q({},this.initData),e=this.pdfUI.i18n.t("custom-dynamic-stamp:dialog.categoryPlaceholder"),this.categoryList=[e].concat(tt(Object.keys(this.pdfUI.customStamps))),n=this.pdfUI.i18n.t("custom-dynamic-stamp:dialog.templatePlaceholder"),(a=[{url:"",backgroundImg:"",name:n,width:0,height:0,imgRatio:1}].concat(tt(this.dynamicStampService.getStampTemplates()))).length>6&&(a.length=6),this.templateList=a,this.textType=Object.keys(A).map(function(e){return{key:e,type:t.pdfUI.i18n.t("custom-dynamic-stamp:dialog.stampTextType.".concat(pt[e]))}}),this.setDropdownValue(this.textTypeComponent,"stampTextType",this.textType[0].type),this.selectCategory(this.categoryList[0]),this.setDropdownValue(this.templatesComponent,"templateName",this.templateList[0].name),this.setDropdownValue(this.sizeComponent,"fontSize",this.fontSizes[0]),this.setDropdownValue(this.fontComponent,"font",this.fontFamilies[0].name),this.digest(!0),[2]})}).call(this)}},{key:"ok",value:function(){return K(function(){var t,e,n,a,o,i,r,s,c,l,u,m,p,d,h,f,y,g,v,b,w,x,T,S,_;return J(this,function(k){switch(k.label){case 0:return t=this,e=this.data,n=e.category,a=e.stampText,o=e.templateName,i=e.type,r=e.name,s=e.url,c=e.font,l=e.fontSize,u=e.color,m=e.rect,p=e.imgRatio,d=this.isValidateParam(),h=d.type,f=d.text,y=this.getPDFUI().i18n,h?(g=y.t("custom-dynamic-stamp:alert.".concat(h)),f&&(v=y.t("custom-dynamic-stamp:alert.".concat(f)),g=g.replace("${1}",v)),this.pdfUI.alert({message:g,level:"warning"}),[3,4]):[3,1];case 1:return b=this.pdfUI.loading(),i!==N?[3,3]:(w=this.component.$backgroundImage.attr("src"),this.currentTemplate=Object.assign({},this.currentTemplate,{name:o,url:s,backgroundImg:w}),[4,this.dynamicStampService.setStampTemplates([this.currentTemplate])]);case 2:k.sent(),k.label=3;case 3:x=m.left,T=m.right,S=m.top,_=m.bottom,this.dynamicStampService.setDynamicStamp([{category:n,name:r,fileData:s,field:{textType:a,value:a,font:{name:c,color:D(u,"int"),size:Number.parseFloat(l)},rect:{left:x*p,right:T*p,top:S*p,bottom:_*p}}}],!0).then(function(e){t.component.cancel()}).catch(function(e){t.pdfUI.alert({message:e.message,level:"warning"})}).finally(function(){b.then(function(t){return t.close()})}),k.label=4;case 4:return[2]}})}).call(this)}},{key:"isValidateParam",value:function(){var t=this.data,e=t.category,n=t.stampText,a=t.templateName,o=t.type,i=t.name,r=t.url,s="",c="";if(o===N){if(!a||a===this.templateList[0].name)return{type:s="templateError",text:c="templateText"};if(!r)return{type:s="fileError",text:c};var l=this.templateList.find(function(t){return t.name==a});if(l&&r!==l.url)return{type:s="templateNameError",text:c}}if(!i)return{type:s="nameError",text:c};if(!e||e===this.categoryList[0])return{type:s="categoryError",text:c="categoryText"};if(!n||e===this.textType[0])return{type:s="textError",text:c="typeText"};var u=/[~!@#'\.\$%\^&\*\(\)\=;\[\]\{\}]/;return u.test(e)||u.test(i)?{type:s="specialError",text:c}:{type:s,text:c}}},{key:"setData",value:function(t,e){this.data.hasOwnProperty(t)&&(this.data[t]=e)}},{key:"setImgType",value:function(t){this.imgType=t}},{key:"selectFontSize",value:function(t){this.setDropdownValue(this.sizeComponent,"fontSize",t),this.textComponent.setSize(this.data.fontSize)}},{key:"selectFontFamily",value:function(t){var e=t.name;this.setDropdownValue(this.fontComponent,"font",e),this.getIconUrl()}},{key:"selectTextType",value:function(t){var e=this,n=t.type,a=t.key;if(this.setDropdownValue(this.textTypeComponent,"stampTextType",this.textType.find(function(t){return t.key==a}).type)){var o=Promise.resolve();switch(A[a]){case A.NAME:o=this.viewer.getUserName();break;case A.NAME_DATE_TIME:o=this.viewer.getUserName().then(function(t){return e.viewer.getFormatOfDynamicStamp().then(function(e){var n=t;return e.timeFormat.length>0&&(n.length>0&&(n+=e.seperator),n+=e.timeFormat),n})});break;case A.DATE_TIME:o=this.viewer.getFormatOfDynamicStamp().then(function(t){var e="";return t.timeFormat.length>0&&(e.length>0&&(e+=t.seperator),e+=t.timeFormat),e});break;case A.DATE:o=this.viewer.getFormatOfDynamicStamp().then(function(t){var e="";return t.timeFormat.length>0&&(e=t.timeFormat.split(t.seperator)[0]),e});break;case A.CUSTOM_TEXT:o=Promise.resolve(void 0);break;default:o=Promise.resolve(n)}o.then(function(t){e.setData("stampText",void 0!==t?A[a]:t),e.setImgType(q),e.textComponent.setText(t)})}}},{key:"selectCategory",value:function(t){this.setDropdownValue(this.categoryComponent,"category",t)}},{key:"selectTemplate",value:function(t){if(this.setDropdownValue(this.templatesComponent,"templateName",t.name),this.setData("url",t.url),this.setDropdownValue(this.textTypeComponent,"stampTextType",this.pdfUI.i18n.t("custom-dynamic-stamp:dialog.stampTextType.".concat(pt.CUSTOM_TEXT))),this.setData("stampText",""),!t.url)return this.component.updatePreviewImg(""),this.textComponent.setText(""),void this.textComponent.setImg("");var e=t.width,n=t.height,a=t.imgRatio;this.textComponent.updateWrapUI(e,n),this.setData("imgRatio",a),this.component.updatePreviewImg(t.backgroundImg),this.textComponent.setImg("")}},{key:"setDropdownValue",value:function(t,e,n){return t.getEditValue()!=n&&(t.setEditValue(n),this.setData(e,n),!0)}},{key:"getIconUrl",value:function(){var t=this,e=this.data,n=e.url,a=e.font,o=e.stampText,i=e.fontSize,r=e.color,s=e.rect,c=e.imgRatio,l=Promise.resolve();if(n){var u={category:"fv__template_category",name:"fv__template_name",url:n,fileType:"png",annotType:"stamp",type:L,stampType:"custom-dynamic",imgType:this.imgType};if(o){var m={textType:o,value:o,font:{name:a,color:D(r,"int"),size:Number.parseFloat(i)}};if(s){var p=s.left,d=s.right,h=s.top,f=s.bottom;m.rect={left:p*c,right:d*c,top:h*c,bottom:f*c}}u.field=m}l=this.dynamicStampService.getStampIcon(u)}return l.then(function(e){var n=e?e.showUrl:"";return t.imgType===V?(t.component.updatePreviewImg(n),!o&&t.textComponent.setImg("")):t.textComponent.setImg(n),n})}}],[{key:"getName",value:function(){return"CreateCustomDynamicStampDialogController"}},{key:"inject",value:function(){return{viewer:C,dynamicStampService:it}}}]),n}(g);X.registerController(dt);var ht=function(t){function e(){return s(this,e),i(this,e,arguments)}return m(e,t),l(e,[{key:"init",value:function(t){this.pdfUI=t}},{key:"setDynamicStamp",value:function(t){return this.pdfUI.getServiceInstance(it).setDynamicStamp(t)}},{key:"removeDynamicStamp",value:function(t){return this.pdfUI.getServiceInstance(it).removeDynamicStamp(t)}},{key:"getDynamicStamp",value:function(){return this.pdfUI.getServiceInstance(it).getDynamicStamp()}}],[{key:"getName",value:function(){return L}},{key:"getLoader",value:function(){return W()}}]),e}(h);const ft=ht})(),o=o.default})());
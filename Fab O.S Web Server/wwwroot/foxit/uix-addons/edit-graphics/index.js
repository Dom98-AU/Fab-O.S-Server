!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","commons"],["UIExtension","PDFViewCtrl"]],t):"object"==typeof exports?exports.UIExtension_EditGraphicsAddon=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl):e.UIExtension_EditGraphicsAddon=t(e.UIExtension,e.UIExtension.PDFViewCtrl.commons,e.UIExtension.PDFViewCtrl)}(self,(e,t,n)=>(()=>{var r={125:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="fv__ui-annot-properties-dialog fv__ui-graphics-object-properties-dialog" @var.dialog="$component" @isolate>\n<layer-header\n@sync.title="dialog.title"\n@draggable="{type: \'parent\'}">\n</layer-header>\n<layer-view class="body">\n<div class="tabPanel" name="tabPanel">\n<gtab\ngroup="graphics-properties-dialog-tab"\nbody="graphics-properties-dialog-appearance-tab-body"\ntext="sidebar.layers.importDialog.appearance"\nactive\nname="appearance-tab"\n></gtab>\n</div>\n<div\nname="graphics-properties-dialog-appearance-tab-body"\nclass="tabBody annot-properties-dialog-body"\n@init="dialog.appearanceTabBody=$component"\n>\n<div class="input-component borderWidth" @init="dialog.borderWidthFieldset = $component">\n<span>dialog.actionDialog.appearance.thickness</span>\n<number\nmin="0" max="12" step="1" \n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.borderWidth"\n@init="dialog.borderWidthElement = $component"\n name="borderWidth"\n></number>\n</div>\n<div class="input-component borderStyle" @init="dialog.borderStyleFieldset = $component">\n<span>annotPropertiesDialog.borderStyle</span>\n<choice\nclass="fv__property-component"\nname="graphics-property-borderStyle"\n@aria:labelledby="::previousSiblings()"\n@on.change="dialog.borderStyleChanged($component.getValue())"\n@init="dialog.borderStyleChoice = $component"\n name="borderStyle"\n></choice>\n</div>\n<div class="input-component fillColor" @init="dialog.fillColorFieldset = $component">\n<span>dialog.formPropertiesDialog.appearance.fillColor</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'fillColor\',$component, $event)" name="fillColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.fillColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component color" @init="dialog.borderColorFieldset = $component">\n<span>dialog.actionDialog.appearance.color</span>\n<button class="color-picker" @aria:labelledby="::previousSiblings()" @on.native.click="dialog.showColorPicker(\'borderColor\',$component, $event)" name="borderColor-picker">\n<div class="fv__ui-color-picker-previewer">\n<div class="label">?</div>\n<div class="mask" @init="dialog.borderColorMaskElement = $component.element"></div>\n</div>\n</button>\n</div>\n<div class="input-component opacity" @init="dialog.opacityInputFieldset = $component">\n<span>sidebar.layers.importDialog.opacity</span>\n<number\nmin="0" max="100" step="1"\n@aria:labelledby="::previousSiblings()"\n@model="dialog.properties.opacity"\n@init="dialog.opacityInput = $component"\nname="opacity"\n></number>\n<label>%</label>\n</div>\n<slider\nclass="fv__property-component opacity-slider"\nunit=\'%\'\nmax="100"\nmin="0"\nstep="1"\n@model="dialog.properties.opacity"\nname="annot-property-opacitySlider"\n@stop-drag\nhideinput="true"\n@aria:labelledby="::previousSiblings()::childAt(0)"\n@init="dialog.opacitySlider = $component"\n></slider>\n</div>\n</layer-view>\n<div class="footer">\n<div class="fv__left-buttons">\n<checkbox \n@cannotBeDisabled\ntext="sidebar.layers.properties.locked"\n@on.change="dialog.toggleLock($component.getValue())"\nvisible="false"\nname="fv__ui-property-locked"\n></checkbox>\n</div>\n<xbutton\ntext="dialog.close"\nclass="fv__ui-dialog-button fv__ui-dialog-ok-button fv__ui-annot-property-close"\n@on.click="dialog.hide()"\n@cannotBeDisabled\nname="fv__ui-property-close"\n></xbutton>\n</div>\n</layer>\n'}},485:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},i=Object.create(r),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}i.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var r="",i=void 0,a=void 0,s=void 0;for(i=n.index,a=0;i<t.length;i++){switch(t.charCodeAt(i)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}a!==i&&(r+=t.substring(a,i)),a=i+1,r+=s}return a!==i?r+t.substring(a,i):r}(a(e))},i.$each=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(e[n],n);else for(var i in e)t(e[i],i)},e.exports=i},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e},732:e=>{"use strict";e.exports=t},290:e=>{"use strict";e.exports=n}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return r[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function r(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(n,i,o){return i=e(i),r(n,t()?Reflect.construct(i,o||[],e(n).constructor):i.apply(n,o))}function s(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):s(e,t)}function c(e,t){if(!s(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function h(t,n,r){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,r){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(i){var o=Object.getOwnPropertyDescriptor(i,n);return o.get?o.get.call(r||t):o.value}},h(t,n,r||t)}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}o.d(a,{default:()=>Ut});var f=o(616),v=o(290);const g={print:4,modify:8,extract:16,annotForm:32,fillForm:256,extractAccess:512,assemble:1024,printHigh:2048};var E=v.Deps.jQuery,m=v.shared.browser.getPtPxRatio,y=v.Events,_=(v.shared.activation.ActivationGroup,v.commons.notImplemented),T=(v.PDF.engine.GraphicsObject,v.keyboard),C=T.BuiltinShortcutContext,A=T.BuiltinCommand,b=function(t){function n(e,t,r){var o;return c(this,n),(o=i(this,n)).isDestroyed=!1,o.graphicsObject=e,o.pageRender=t,o.dependences=r,o}return d(n,t),u(n,[{key:"doActive",value:function(){var e=this.$handler,t=this.dependences.pdfViewer;if(!e){e=this.initUI(),this.$handler=e;var n=this.getContextMenuConfig();n&&!this.contextmenu&&(this.contextmenu=t.viewerUI.createContextMenu(this,e.get(0),n))}e.addClass("fwr__active"),this.updateShapeControl(),this.bindEvent()}},{key:"getContextMenuConfig",value:function(){}},{key:"getContextMenuComponentName",value:function(){_()}},{key:"removeGraphicObject",value:function(){this.remove()}},{key:"remove",value:function(){var e=this;if(this.isActive){this.removeToolbar&&this.removeToolbar();var t=this.dependences.pdfViewer;t.getAllActiveElements().forEach(function(t){t.unActive(),t!==e&&t.remove&&t.remove()}),0===t.getAllActiveElements().length&&t.activeElement()}}},{key:"removeGraphicObjects",value:function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.removeToolbar&&n.removeToolbar(),n.unActive(),n.dependences.pdfViewer.unActiveElement(n),n.destroy(),!n.graphicsObject.doc.checkPermission(g.modify))throw new Error("Permission error");var r=0===t;n.graphicsObject.getPDFPage().removeGraphicsObjectEx(n.graphicsObject,r)}this.dependences.pdfViewer.activeElement()}},{key:"bindEvent",value:function(){var e=this,t=this.dependences.pdfViewer;t.getKeyboard().withContext(C.ACTIVATION_ANY,function(n){e.isDestroyed||(e.__off__delete__event__=n.keydown(A.DELETE_SELECTED_OBJECT,function(n){var r=t.getAllActiveElements();r.length>1?e===r[r.length-1]&&e.removeGraphicObjects(r):e.removeGraphicObject(),e.__off__delete__event__()}),e.__off__esc__event__=n.keydown(A.UNSELECT_OBJECT,function(t){e.unActive(!0)}))})}},{key:"unBindEvent",value:function(){this.__off__delete__event__&&this.__off__delete__event__(),this.__off__delete__event__=function(){},this.__off__esc__event__&&this.__off__esc__event__(),this.__off__esc__event__=function(){},this.__off_active_escape_event&&this.__off_active_escape_event(),delete this.__off_active_escape_event}},{key:"translateContextMenuName",value:function(e){for(var t in e)if("items"===t){var n=e[t],r=this.dependences.pdfViewer.i18n;for(var i in n){var o=n[i];o.nameI18nKey&&(o.name=r.t(o.nameI18nKey))}}return e}},{key:"updateShapeControl",value:function(){var e=this.getBoundary(),t=this._getShapeControllerBoundaryBox();this.shapeControl&&this.shapeControl.active(this.$handler,e,t)}},{key:"unActive",value:function(){this.isActive&&(h(e(n.prototype),"unActive",this).call(this),this.$handler&&(this.$handler.removeClass("fwr__active"),this.shapeControl&&this.shapeControl.deactive(),this.dependences.pdfViewer.eventEmitter.off(y.fitWidthResizeViewport,this.afterZoom),this.dependences.pdfViewer.eventEmitter.off(y.zoomToSuccess,this.afterZoom),this.$handler&&this.$handler.remove(),this.$handler=null,this.unBindEvent(),this.$charEditContainer&&this.$charEditContainer.off("focus"),this.removeToolbar&&this.removeToolbar()))}},{key:"doDeactive",value:function(){}},{key:"destroy",value:function(){this.isDestroyed=!0,this.unActive(),this.shapeControl&&this.shapeControl.destroy(),this.contextmenu&&this.contextmenu.destroy()}},{key:"getModel",value:function(){return this.graphicsObject}},{key:"_getShapeControllerBoundaryBox",value:function(){var e,t=this.pageRender.page,n=m()*this.pageRender.getScale(),r=[t.getPxWidth()*n,t.getPxHeight()*n],i=r[0],o=r[1];this.pageRender.rotate%180!=0&&(o=(e=[i,o])[0],i=e[1]);return{left:0,top:0,width:i,height:o}}},{key:"getBoundary",value:function(){var e=this.pageRender.page,t=this.graphicsObject.getRect(),n=e.getDeviceRect(t,this.pageRender.getScale(),this.pageRender.getRotation());return{left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top}}},{key:"initUI",value:function(){var e=this;if(!this.$handler){var t=this.$handler=E('<div class="fwr__graphics-object-handler"\n        ></div>');this.pageRender.pageHandler.$handler.append(t),t.get(0).__graphics_object_component=this;var n=!0;return this.predefineTextObject&&(n=!1),this.shapeControl=new v.ShapeControl({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:n,enableDiagonally:!0,enableFrame:!0,previewer:!0,auxiliaryLine:void 0}),this.dependences.pdfViewer.eventEmitter.on(y.zoomToSuccess,this.afterZoom=function(){e.updateShapeControl()}),this.dependences.pdfViewer.eventEmitter.on(y.fitWidthResizeViewport,this.afterZoom),this.$handler}}},{key:"onPrestart",value:function(){var e=this;this.dependences.pdfViewer.getAllActiveElements().forEach(function(t){t!==e&&s(t,n)&&e.shapeControl.companion(t.shapeControl)})}},{key:"onAfterShapeCtrlEnd",value:function(e){this.shapeControl.clearCompanions()}},{key:"onStartUpdateShape",value:function(e,t,n){var r=this;if("move"){if(this.dependences.pdfViewer.getAllActiveElements().length>1||!this.graphicsObject.getBitmap)return;E(this.shapeControl.ui.querySelector(".fv__shape-control-previewer")).show(),this.graphicsObject.getBitmap(this.pageRender.getScale(),this.pageRender.getRotation()).then(function(e){if(e){var t=r.shapeControl.getPreviewerContext();E(t.canvas).attr({width:e.width,height:e.height});var n=t.createImageData(e.width,e.height+1),i=new(Uint8ClampedArray||Uint8Array)(e.buffer);n.data.set(i),t.putImageData(n,0,0)}})}}},{key:"onShapeMoving",value:function(e,t){}},{key:"onShapeUpdating",value:function(e,t){}},{key:"onShapeUpdateEnd",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Object.assign({},e);o.right=o.left+o.width,o.bottom=o.top+o.height,o=this.pageRender.page.reverseDeviceRect(o,this.pageRender.getScale(),this.pageRender.getRotation()),this.graphicsObject.setRect(o,i).then(function(e){E(r.shapeControl.ui.querySelector(".fv__shape-control-previewer")).hide(),r.updateShapeControl()})}},{key:"setColor",value:function(e){return this.graphicsObject.setBorderColor(e)}},{key:"setBorderStyle",value:function(e,t){var n=this;return this.graphicsObject.setBorderStyle(e,t).then(function(e){n.updateShapeControl()})}},{key:"setOpacity",value:function(e){return this.graphicsObject.setOpacity(e)}},{key:"setFillColor",value:function(e){return this.graphicsObject.setFillColor(e)}},{key:"setBorderWidth",value:function(e){var t=this;return this.graphicsObject.setBorderWidth(e).then(function(e){t.updateShapeControl()})}},{key:"moveToPosition",value:function(e,t){var n=this;return this.graphicsObject.moveToPosition(e,t).then(function(e){n.updateShapeControl()})}},{key:"getGraphicsObject",value:function(){return this.graphicsObject}}]),n}(v.shared.activation.Activatable);function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const k={textObjectActive:"text-object-active",textObjectUnActive:"text-object-unactive",addTextObjectParamTransfer:"add-text-object-param-transfer"};var D,P={};"function"==typeof FontFace?D=function(e,t){return P[e]?P[e]:P[e]=new Promise(function(n,r){t().then(function(t){if(!t)return r(),void P[e];var i=new FontFace(e,t.buffer||t.url);i.load().then(function(){document.fonts.add(i),n(i)},function(){r(),delete P[e]})},function(){r(),delete P[e]})})}:D=function(e,t){return P[e]?P[e]:P[e]=new Promise(function(n,r){t().then(function(t){return t?t.buffer?URL.createObjectURL(new Blob([t.buffer],"application/x-font-woff")):t.url:(r("woff is invalid"),void delete P[e])}).then(function(t){if(!t)return r();var i=document.createElement("style");i.innerHTML='@font-face{font-family:"'+e+'"; src:url("'+t+'");}',document.head.appendChild(i),n(i)})})};var H,O=function(e){return e.STATE_HANDLER_HAND="hand",e.STATE_HANDLER_CHECK_THE_SEARCH="checkTheSearch",e.STATE_HANDLER_CREATE_CARET="createCaret",e.STATE_HANDLER_CREATE_ARROW="createArrow",e.STATE_HANDLER_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CIRCLE="createCircle",e.STATE_HANDLER_CREATE_FILE_ATTACHMENT="createFileAttachment",e.STATE_HANDLER_CREATE_HIGHLIGHT="createHighlight",e.STATE_HANDLER_CREATE_IMAGE="createImage",e.STATE_HANDLER_CREATE_LINK="createLink",e.STATE_HANDLER_CREATE_LINE="createLine",e.STATE_HANDLER_CREATE_DISTANCE="createDistance",e.STATE_HANDLER_CREATE_PERIMETER="createPerimeter",e.STATE_HANDLER_CREATE_AREA="createArea",e.STATE_HANDLER_CREATE_CIRCLE_AREA="createCircleArea",e.STATE_HANDLER_CREATE_PENCIL="createPencil",e.STATE_HANDLER_CREATE_POLYGON_CLOUD="createPolygonCloud",e.STATE_HANDLER_CREATE_POLYGON="createPolygon",e.STATE_HANDLER_CREATE_POLYLINE="createPolyline",e.STATE_HANDLER_CREATE_REPLACE="createReplace",e.STATE_HANDLER_CREATE_SQUARE="createSquare",e.STATE_HANDLER_CREATE_SQUIGGLY="createSquiggly",e.STATE_HANDLER_CREATE_STAMP="createStamp",e.STATE_HANDLER_CREATE_STRIKE_OUT="createStrikeOut",e.STATE_HANDLER_CREATE_TEXT="createText",e.STATE_HANDLER_CREATE_UNDERLINE="createUnderline",e.STATE_HANDLER_MARQUEE="marquee",e.STATE_HANDLER_ERASER="eraser",e.STATE_HANDLER_LOUPE="loupe",e.STATE_HANDLER_SELECT_TEXT_ANNOTATION="select-text-annotation",e.STATE_HANDLER_SELECT_TEXT_IMAGE="select-text-image",e.STATE_HANDLER_SELECT_ANNOTATION="select-annotation",e.STATE_HANDLER_CREATE_FREETEXT_BOX="createFreeTextBox",e.STATE_HANDLER_CREATE_FREETEXT_CALLOUT="createFreeTextCallout",e.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER="createFreeTextTypewriter",e.STATE_HANDLER_CREATE_FIELD_TEXT="CreateTextStateHandler",e.STATE_HANDLER_CREATE_FIELD_SIGNATURE="CreateSignStateHandler",e.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON="CreatePushButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_CHECK_BOX="CreateCheckBoxStateHandler",e.STATE_HANDLER_CREATE_RADIO_BUTTON="CreateRadioButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_COMBO_BOX="CreateComboBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_LIST_BOX="CreateListBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_DATE="CreateDateStateHandler",e.STATE_HANDLER_CREATE_FIELD_IMAGE="CreateImageStateHandler",e.STATE_HANDLER_SNAPSHOT_TOOL="snapshot-tool",e.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT="createDocumentAttachment",e}({}),I=O.STATE_HANDLER_HAND,L=(O.STATE_HANDLER_CHECK_THE_SEARCH,O.STATE_HANDLER_CREATE_CARET),j=O.STATE_HANDLER_CREATE_ARROW,N=O.STATE_HANDLER_CREATE_AREA_HIGHLIGHT,B=(O.STATE_HANDLER_CREATE_AREA_HIGHLIGHT,O.STATE_HANDLER_CREATE_CIRCLE),F=O.STATE_HANDLER_CREATE_FILE_ATTACHMENT,U=O.STATE_HANDLER_CREATE_HIGHLIGHT,M=O.STATE_HANDLER_CREATE_IMAGE,V=O.STATE_HANDLER_CREATE_LINK,G=O.STATE_HANDLER_CREATE_LINE,$=O.STATE_HANDLER_CREATE_DISTANCE,X=O.STATE_HANDLER_CREATE_PERIMETER,W=O.STATE_HANDLER_CREATE_AREA,Y=O.STATE_HANDLER_CREATE_CIRCLE_AREA,K=O.STATE_HANDLER_CREATE_PENCIL,z=O.STATE_HANDLER_CREATE_POLYGON_CLOUD,q=O.STATE_HANDLER_CREATE_POLYGON,Q=O.STATE_HANDLER_CREATE_POLYLINE,J=O.STATE_HANDLER_CREATE_REPLACE,Z=O.STATE_HANDLER_CREATE_SQUARE,ee=O.STATE_HANDLER_CREATE_SQUIGGLY,te=O.STATE_HANDLER_CREATE_STAMP,ne=O.STATE_HANDLER_CREATE_STRIKE_OUT,re=O.STATE_HANDLER_CREATE_TEXT,ie=O.STATE_HANDLER_CREATE_UNDERLINE,oe=(O.STATE_HANDLER_MARQUEE,O.STATE_HANDLER_ERASER,O.STATE_HANDLER_LOUPE,O.STATE_HANDLER_SELECT_TEXT_ANNOTATION,O.STATE_HANDLER_SELECT_TEXT_IMAGE,O.STATE_HANDLER_SELECT_ANNOTATION,O.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER),ae=O.STATE_HANDLER_CREATE_FREETEXT_CALLOUT,se=O.STATE_HANDLER_CREATE_FREETEXT_BOX,ce=(O.STATE_HANDLER_SNAPSHOT_TOOL,O.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT,O.STATE_HANDLER_CREATE_FIELD_TEXT,O.STATE_HANDLER_CREATE_FIELD_SIGNATURE,O.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON,O.STATE_HANDLER_CREATE_FIELD_CHECK_BOX,O.STATE_HANDLER_CREATE_RADIO_BUTTON,O.STATE_HANDLER_CREATE_FIELD_COMBO_BOX,O.STATE_HANDLER_CREATE_FIELD_LIST_BOX,O.STATE_HANDLER_CREATE_FIELD_DATE,O.STATE_HANDLER_CREATE_FIELD_IMAGE,O.STATE_HANDLER_CREATE_RADIO_BUTTON,R(H={},re,"text"),R(H,U,"highlight"),R(H,ne,"strikeout"),R(H,ie,"underline"),R(H,ee,"squiggly"),R(H,J,"strikeout"),R(H,L,"caret"),R(H,oe,"freetext"),R(H,ae,"freetext"),R(H,se,"freetext"),R(H,Z,"square"),R(H,B,"circle"),R(H,G,"line"),R(H,j,"line"),R(H,q,"polygon"),R(H,Q,"polyline"),R(H,z,"polygon"),R(H,N,"highlight"),R(H,K,"ink"),R(H,te,"stamp"),R(H,$,"line"),R(H,X,"polyline"),R(H,W,"polygon"),R(H,Y,"circle"),R(H,F,"fileattachment"),R(H,M,"screen"),R(H,V,"link"),R(H,"create-multi-media-state","screen"),R(H,"create-redaction-text-image-state","redact"),R(H,"create-redaction-state","redact"),o(732)),le=v.Deps.jQuery,ue=v.shared.browser.getPtPxRatio,he=v.ViewerEvents.renderPageSuccess,pe=v.ViewerEvents.switchStateHandler,de=v.keyboard,fe=de.BuiltinCommand,ve=de.BuiltinShortcutContext,ge=v.shared.debounce,Ee=v.commons,me=Ee.colorConvertor,ye=(Ee.KeyCodes,Ee.KeyboardUtils),_e=(ye.isMatch,ye.matchers,function(t){function n(e,t,r){var o;return c(this,n),(o=i(this,n,[e,t,r])).fillSign=!1,o}return d(n,t),u(n,[{key:"initUI",value:function(){var e=this,t=this.$handler=le('<div class="fwr__graphics-object-handler fwr__text-object-edit"\n        ></div>');this.pageRender.pageHandler.$handler.after(t),t.get(0).__graphics_object_component=this;this.shapeControl=new v.ShapeControl({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},rotate:function(t,n){return e.onRotate(t,n)},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:!0,enableDiagonally:!0,enableFrame:!0,previewer:!0});return t.on("dblclick",function(){e.unActive(),e.activeCharEdit()}),this.$handler}},{key:"reActive",value:function(){}},{key:"active",value:function(){var t=this,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h(e(n.prototype),"active",this).call(this),this.reActive=function(){t.unActive(),t.active()};var i=this.pageRender.pdfViewer.getEventEmitter();r&&i.emit(k.textObjectActive,this),this.pageRedrawBind&&i.off(he,this.pageRedrawBind),i.on(he,this.pageRedrawBind=function(e){e.index===t.getModel().getPDFPage().getIndex()&&t.reActive()}),i.on(pe,this.switchStateHandlerBind=function(){t.eCharInput&&t.applyEdit()})}},{key:"unActive",value:function(){this.dependences.pdfViewer._setSaveBefore(),h(e(n.prototype),"unActive",this).call(this),this.unActiveCharEdit();var t=this.pageRender.pdfViewer.getEventEmitter();t.off(he,this.pageRedrawBind),t.off(pe,this.switchStateHandlerBind),t.emit(k.textObjectUnActive,this)}},{key:"unActiveCharEdit",value:function(){this.$charEditContainer&&this.$charEditContainer.remove(),this.$charEditContainer=null,this.unswitchBinder&&this.unswitchBinder()}},{key:"applyEdit",value:function(){var e=this;if(!this.eCharInput)return Promise.reject(new Error("text input box has not been initialized!"));var t=this.eCharInput.innerText;"string"!=typeof t&&(t=this.eCharInput.textContent);for(var n="",r=0,i=0;i<t.length;i++){this.eCharInput.innerText=t.substring(0,i+1);for(var o=t[i];("\n"==o||"\r"==o)&&i<t.length;)o=t[++i];var a=this.eCharInput.offsetHeight;void 0!==o&&(n+=0!==r&&r<a?"\n"+o:o),r=a}return t=n.replace(/\u00a0/g," "),this.isApplyEdit=!0,this.setTextChar(t).then(function(){e.unActive()}).finally(function(){e.isApplyEdit=!1})}},{key:"initCharEditContainer",value:function(){var e,t=this;e=this.fillSign?le('<div class="fv__text-object-edit-char-container"><div class="fv__text-object-edit-char-mask-layer"></div><div><span class="fv_fillsign-moving"></span><span class="fv__text-object-edit-char-input fv_fillsign-input" contenteditable></span></div></div>'):le('<div class="fv__text-object-edit-char-container"><div class="fv__text-object-edit-char-mask-layer"></div><span class="fv__text-object-edit-char-input " contenteditable></span></div>'),this.pageRender.$handler.after(e);var n=e.find(".fv__text-object-edit-char-input"),r=n[0];return this.eCharInput=r,n.on("keydown",function(r){if(!r.shiftKey&&(13===r.keyCode&&(r.preventDefault(),t.applyEdit()),t.fillSign)){var i=e.find(".fv__text-object-edit-char-mask-layer"),o=n[0].getBoundingClientRect().width;i.width()<o+15&&i.css("width",o+15+"px")}}),this.fillSign&&this.bindMovingEvent(e),e}},{key:"activeCharEdit",value:function(e){var t=this;this.isActive=!0;var n=this.$charEditContainer=this.$charEditContainer||this.initCharEditContainer(),r=n.find(".fv__text-object-edit-char-mask-layer"),i=n.find(".fv__text-object-edit-char-input");this.dependences.pdfViewer._setSaveBefore(function(){return t.applyEdit()});var o=this.graphicsObject,a=o.getRect(),s=this.pageRender,c=s.pdfViewer;return i.off("focus").on("focus",function(){var e,n=c.getKeyboard(),r=n.activeContext(ve.EDIT_TEXT_OBJECT),i=!1;n.withContext(ve.EDIT_TEXT_OBJECT,function(n){i||(e=n.keyup(fe.BLUR_EDITTING_TEXT_OBJECT,function(){var e=t.eCharInput.innerText;"string"!=typeof e&&(e=t.eCharInput.textContent),t.setTextChar(e).then(function(){t.unActive()}),c.getStateHandlerManager().switchTo(I)}))}),t.unswitchBinder=function(){i||(i=!0,r(),e&&e())}}),c.getEventEmitter().on(pe,this.switchStateHandlerBind=function(){t.eCharInput&&t.applyEdit()}),Promise.all([s.getPDFPage(),s.getScale(),s.getRotation()]).then(function(e){var t=x(e,3),n=t[0],r=t[1],i=t[2];return[n.getDeviceRect(a,r,i),n,r,i]}).then(function(i){var a=x(i,4),c=a[0],l=a[1],u=a[2],h=a[3],p=function(){var e=s.$ui[0].getBoundingClientRect(),t=f.getBoundingClientRect();return{maxWidth:e.right-t.left,maxHeight:e.bottom-t.top}};n.css({left:c.left+"px",top:c.bottom+"px"});var d=n.find(".fv__text-object-edit-char-input"),f=d[0];r.css({width:c.right-c.left+"px",height:c.bottom-c.top+"px"});var g=o.getText();g=g.replace(/\u0020/g,"Â "),void 0===e&&(e=g),"string"==typeof f.innerText?f.innerText=g:f.textContent=g;var E=o.getFontSize(),m=o.getMatrix().toArray().slice(0,4),y=12,_=E*ue()<y;_&&(E*=y,m[0]/=y,m[1]/=y,m[2]/=y,m[3]/=y),m[0]*=u,m[1]*=-u,m[2]*=-u,m[3]*=u;var T=new v.Matrix(m[0],m[1],m[2],m[3],0,0),C=l.getRotationAngle()+h;if(T.rotate(C/180*Math.PI),t.fillSign)d.css(R({fontSize:E+"pt",transform:"matrix("+T.toArray().join(",")+")",color:me(16777215&o.getFillColor(),"#")},"transform","matrix("+T.toArray().join(",")+")"));else{if("TimesNewRoman"===o.info.textState.font.baseName)otherFontName="Times New Roman";d.css({fontFamily:'"'+[o.info.textState.font.baseName,o.info.textState.font.familyName,o.info.textState.font.nameKey,o.info.textState.font.name,"FoxitPDFSDKForWeb"].join('","')+'"',fontSize:E+"pt",fontWeight:o.info.textState.font.isBold?700:400,fontStyle:o.info.textState.font.isItalic?"italic":"",transform:"matrix("+T.toArray().join(",")+")",color:me(16777215&o.getFillColor(),"#")})}var A,b,S=d.height(),w=d.width(),P=T.transformPoint(w,S),H=P[0],O=P[1];t.fillSign&&t.showToolbar(Math.abs(O)),H>=0&&O>0?(A=-T.transformPoint(w,0)[1]-S,b=0):H<0&&O>=0?(A=-T.transformPoint(w,0)[1]-S,b=-T.transformPoint(0,w)[1]):H<=0&&O<0?(A=T.transformPoint(0,S)[1]-S,b=-H+T.transformPoint(0,S)[0]):H>0&&O<=0&&(A=-T.transformPoint(0,S)[1]-S,b=H-T.transformPoint(w,0)[0]),d.css({top:A+"px",left:b+"px",transformOrigin:"left "+S+"px",bottom:"auto"}),e!==g&&("string"==typeof f.innerText?f.innerText=e:f.textContent=e),t.fillSign||D(o.info.textState.font.nameKey||o.info.textState.font.name,o.getWoff.bind(o)).catch(function(){}),t.reActive=function(e){t.unActive(),t.activeCharEdit(e)};var I=t.pageRender.pdfViewer.getEventEmitter();t.fillSign||I.emit(k.textObjectActive,t),document.activeElement!==f&&f.focus();var L=p(),j=L.maxWidth,N=L.maxHeight,B=_?u/y:u;f.style.cssText+="\n                max-width: ".concat(j/B,"px;\n            ");var F=f.textContent,U=function(){f.style.cssText+="\n                    white-space: pre;\n                    width: auto;\n                ";var e=f.getBoundingClientRect().width;f.style.cssText+="\n                    width: ".concat(Math.min(j,e)/B,"px;\n                    white-space: pre-line;\n                ");var t=(0,ce.getCursorPositionOfEditableElement)(f);f.getBoundingClientRect().height>N?(f.textContent=F,(0,ce.moveCursorTo)(f,t)):F=f.textContent},M=!1;f.addEventListener("input",function(){M||U()}),f.addEventListener("compositionstart",function(){M=!0,f.style.maxWidth=j/u+"px"});var V=ge(U,0);f.addEventListener("compositionupdate",function(){V()}),f.addEventListener("compositionend",function(){M=!1,f.style.maxWidth="",U()}),t.pageRedrawBind&&I.off(he,t.pageRedrawBind),I.on(he,t.pageRedrawBind=function(n){if(n.index===t.getModel().getPDFPage().getIndex()){e="string"==typeof f.innerText?f.innerText:f.textContent;var r=p(),i=r.maxWidth,o=r.maxHeight;j=i,N=o;var a=_?n.scale/y:n.scale;f.style.cssText+="\n                        max-width: ".concat(j/a,"px;\n                    ")}})})}},{key:"showToolbar",value:function(e){}},{key:"setTextChar",value:function(e){return this.graphicsObject.setText(e)}},{key:"getContextMenuConfig",value:function(){}},{key:"getTextChar",value:function(){if(this.$charEditContainer){var e=this.$charEditContainer.find(".fv__text-object-edit-char-input")[0],t=e.innerText;return"string"!=typeof t&&(t=e.textContent),t.replace(/\u00a0/g," ")}return this.getModel().getText()}},{key:"textCharSure",value:function(){return!this.isApplyEdit&&this.$charEditContainer?this.fillSign?this.saveFillSign():this.applyEdit():Promise.resolve()}},{key:"remove",value:function(){return h(e(n.prototype),"remove",this).call(this),this.dependences.pdfViewer.unActiveElement(this),this.destroy(),this.graphicsObject.remove()}}]),n}(b));function Te(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}}function Ce(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}var Ae=v.Deps.jQuery,be=v.commons.colorConvertor,Re=function(t){function n(e,t,r){return c(this,n),i(this,n,[e,t,r])}return d(n,t),u(n,[{key:"active",value:function(){h(e(n.prototype),"active",this).call(this)}},{key:"getPropertyOptions",value:function(){var e=this.graphicsObject,t=e.getBorderColor();t=this.graphicsObject.needStroke()?be(t||4278190080,"#"):0;var n=e.getFillColor();0==e.getFillMode()&&(n=0);var r=e.getBorderWidth();return{color:t,borderTransparent:!0,opacity:e.getOpacity(),fillColor:n,borderWidth:r}}},{key:"initUI",value:function(){var t=this;h(e(n.prototype),"initUI",this).call(this),this.$tip=Ae('<div class="fwr__path-object-tip"></div>'),this.$tip.appendTo(this.$handler);var r=this.rectHammer=new Hammer.Manager(this.$handler[0],{recognizers:[[Hammer.Press]]});return this.$handler.on("mousemove",function(e){t.$tip.hide()}),r.on("press",function(e){if(!Ae(".fv__ui-mobile").length){var n=t.graphicsObject.getRect(),r=Se(t.$handler.parent()[0],e),i={left:r.x+"px",top:r.y+20+"px"};r=t.pageRender.page.reverseDevicePoint([r.x,r.y],t.pageRender.getScale(),t.pageRender.getRotation()),t.$tip.show().css(i).html("object : x:".concat(n.left.toFixed(2),",y:").concat(n.bottom.toFixed(2))+"<br/>mouse: x:".concat(r[0].toFixed(2),",y:").concat(r[1].toFixed(2)))}}),this.$handler}},{key:"showPropertiesDialog",value:function(e){var t=this.dependences.pdfViewer.activePropertiesDialog;this.dependences.pdfViewer.activePropertiesDialog?(t.show(e),t.setViewerComponent(this),this.activePropertiesDialog=t):this.propertiesControl=new v.PropertiesControl(this)}},{key:"getContextMenuComponentName",value:function(){return"fv--path-graphics-object-contextmenu"}},{key:"getContextMenuConfig",value:function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){e.showPropertiesDialog(r)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){e.remove()}}}}}},{key:"unActive",value:function(t){var r=this.activePropertiesDialog;r&&r.viewerComponent===this&&r.hide(),h(e(n.prototype),"unActive",this).call(this,t)}},{key:"remove",value:function(){return h(e(n.prototype),"remove",this).call(this),this.dependences.pdfViewer.unActiveElement(this),this.destroy(),this.graphicsObject.remove()}},{key:"destroy",value:function(){this.contextmenu&&this.contextmenu.destroy(),this.propertiesControl&&this.propertiesControl.close(),this.propertiesControl=null,this.rectHammer&&this.rectHammer.destroy(),h(e(n.prototype),"destroy",this).call(this)}}]),n}(b),Se=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Te(r),o=Ce(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}},we=v.Deps.jQuery,xe=v.Events,ke=function(t){function n(){return c(this,n),i(this,n,arguments)}return d(n,t),u(n,[{key:"_resize",value:function(t,r,i){this.enableUniform="north"!=t&&"south"!=t&&"east"!=t&&"west"!=t,h(e(n.prototype),"_resize",this).call(this,t,r,i)}}]),n}(v.ShapeControl),De=function(t){function n(e,t,r){return c(this,n),i(this,n,[e,t,r])}return d(n,t),u(n,[{key:"initUI",value:function(){var e=this,t=this,n=this.$handler=we('<div class="fwr__graphics-object-handler" \n        ></div>');return this.pageRender.pageHandler.$handler.append(n),n.get(0).__graphics_object_component=this,this.shapeControl=new ke({prestart:function(){return e.onPrestart()},start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var i=r.offsetX,o=r.offsetY;return e.onShapeMoving(t,n,i,o)},update:function(t,n){return e.onShapeUpdating(t,n)},beforeRotateStart:function(){return e.onBeforeRotateStart()},rotateEnd:function(t,n,r,i){return e.onRotate(t)},afterRotateEnd:function(){return e.onAfterRotateEnd()},rotateStart:function(){return e.onRotateStart()},end:function(t,n,r,i){return e.onShapeUpdateEnd(t,n,r,i)},afterEnd:function(t){return e.onAfterShapeCtrlEnd(t)},resizable:!0,rotatable:!0,enableDiagonally:!0,enableFrame:!0,enableUniform:!0,previewer:!0,enableSizeBox:!0}),this.dependences.pdfViewer.eventEmitter.on(xe.zoomToSuccess,this.afterZoom=function(){t.updateShapeControl()}),this.$handler}},{key:"onBeforeRotateStart",value:function(){var e=this;this.dependences.pdfViewer.getAllActiveElements().forEach(function(t){t!==e&&s(t,n)&&e.shapeControl.companion(t.shapeControl)})}},{key:"onAfterRotateEnd",value:function(){this.shapeControl.rotateDegree=0,this.shapeControl.companions.forEach(function(e){return e.rotateDegree=0}),this.shapeControl.clearCompanions()}},{key:"onRotate",value:function(e){var t=this;return this.pageRender.$handler.get(0).classList.remove("fv__cursor-rotation"),this.graphicsObject.setRotation(e).then(function(e){t.updateShapeControl()})}},{key:"updateShapeControl",value:function(){h(e(n.prototype),"updateShapeControl",this).call(this),this.shapeControl.ui.style.transform=""}},{key:"onRotateStart",value:function(){this.pageRender.$handler.get(0).classList.add("fv__cursor-rotation")}},{key:"getContextMenuConfig",value:function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){e.showPropertiesDialog(r)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){var t=e.dependences.pdfViewer;if(t.getAllActiveElements().forEach(function(e){e.remove&&e.remove()}),0===t.getAllActiveElements().length){var n=t.getCurrentActivatable();n&&t.unActiveElement(n)}}}}}}},{key:"getContextMenuComponentName",value:function(){return"fv--image-graphics-object-contextmenu"}},{key:"getPropertyOptions",value:function(){return{opacity:this.graphicsObject.getOpacity(),borderStyle:!1}}},{key:"showPropertiesDialog",value:function(e){var t=this.dependences.pdfViewer.activePropertiesDialog;this.dependences.pdfViewer.activePropertiesDialog?(t.show(e),t.setViewerComponent(this),this.activePropertiesDialog=t):this.$propertiesControl=new v.PropertiesControl(this)}},{key:"hidePropertiesDialog",value:function(){this.$propertiesControl&&this.$propertiesControl.close()}},{key:"destroy",value:function(){this.contextmenu&&this.contextmenu.destroy(),this.dependences.pdfViewer.eventEmitter.off(xe.zoomToSuccess,this.afterZoom),h(e(n.prototype),"destroy",this).call(this)}},{key:"setOpacity",value:function(e){this.graphicsObject.setOpacity(e)}},{key:"remove",value:function(){h(e(n.prototype),"remove",this).call(this),this.graphicsObject.remove(),this.dependences.pdfViewer.unActiveElement(this),this.destroy()}},{key:"unActive",value:function(t){var r=this.activePropertiesDialog;r&&r.viewerComponent===this&&r.hide(),h(e(n.prototype),"unActive",this).call(this,t)}}]),n}(b),Pe=function(){function e(){c(this,e),this.matchRules=[]}return u(e,[{key:"registerMatchRule",value:function(e){return this.matchRules.push(e),e}},{key:"unRegisterMatchRule",value:function(e){var t=this.matchRules.indexOf(e);-1!==t&&this.matchRules.splice(t,1)}},{key:"get",value:function(e){for(var t=this.matchRules,n=this.getDefault(e),r=t.length;r--;){var i=t[r];if("function"==typeof i){var o=i(e,n);if(o)return o}}return n}},{key:"getDefault",value:function(e){switch(e.getType()){case 1:return _e;case 2:return Re;case 3:return De;default:return b}}}]),e}(),He=v.Deps.Hammer;function Oe(e,t){var n=e.graphicsManager,r=["","text","path","image","shading","all"][t],o=r?["fv__edit-",r,"-state-handler"].join(""):"";return o+=" fv__edit-graphics-state-handler",function(a){function s(e){return c(this,s),i(this,s,[e])}return d(s,a),u(s,[{key:"pageHandler",value:function(r){var i=this;this.pageRender=r;var a=r.getPDFPage(),s=r.$handler,c=s[0];s.addClass(o),(this.hammer=new He(c)).on("tap",function(o){if(-1!=o.target.className.indexOf("fv__shape-control-move-area"))return Promise.resolve();i.resetHandler();var s=Ie(c,o);a.then(function(e){return[e,e.reverseDevicePoint([s.x,s.y],r.getScale(),r.getRotation())]}).then(function(e){var n=x(e,2),r=n[0],i=x(n[1],2),o=i[0],a=i[1];return 5===t?r.getGraphicsObjectAtPoint([o,a],5,0):r.getGraphicsObjectAtPoint([o,a],3,t)}).then(function(e){return!e||e.type<1||e.type>3?Promise.reject():[n.get(e),e]}).then(function(t){var n=x(t,2);return new(0,n[0])(n[1],r,e)}).then(function(e){return i.currentComponent=e,e.active()}).catch(function(e){e&&console.error(e),i.currentComponent=null,i.pdfViewer.activeElement()})})}},{key:"destroyPageHandler",value:function(){this.unregisterKeyEvent&&this.unregisterKeyEvent(),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(o),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponent&&(this.currentComponent.textCharSure&&this.currentComponent.textCharSure(),this.currentComponent.unActive())}}],[{key:"getStateName",value:function(){return"edit-"+r}}]),s}(v.IStateHandler)}var Ie=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Te(r),o=Ce(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}},Le=v.Deps.Hammer;function je(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ne=function(){function e(){c(this,e)}return u(e,null,[{key:"pointsToRect",value:function(e,t,n){var r=e.x>t.x?t.x:e.x,i=e.x<t.x?t.x:e.x,o=e.y>t.y?t.y:e.y,a=e.y<t.y?t.y:e.y;if(n){var s=o;(o=a)-(a=s)<1&&(o=a+1,a-=1)}else a-o<1&&(a=o+1,o-=1);return i-r<1&&(i=r+1,r-=1),{left:r-2,top:a+1,right:i+2,bottom:o-1}}},{key:"generatePoints",value:function(t,n,r){var i=t.x,o=t.y,a=n.x-i,s=n.y-o;switch(r){case"line":return e.genLinePoints(i,o,a,s);case"square":return e.genSquarePoints(i,o,a,s);case"circle":return e.genOvalPoints(i,o,a,s);case"roundRect":return e.genRoundRectPoints(i,o,a,s)}}},{key:"genLinePoints",value:function(e,t,n,r){var i=[];return i.push(["m",e,t]),i.push(["l",e+n,t+r]),i}},{key:"genOvalPoints",value:function(e,t,n,r){var i=[];return i.push(["m",e+n/2,t]),(i=(i=(i=(i=i.concat(Be(e+n/2,t,n/2,r/2,1))).concat(Be(e+n,t+r/2,-n/2,r/2,0))).concat(Be(e+n/2,t+r,-n/2,-r/2,1))).concat(Be(e,t+r/2,n/2,-r/2,0))).push(["h",i[0][1],i[0][2]]),i}},{key:"genRoundRectPoints",value:function(e,t,n,r){var i=[],o=.2*n,a=.2*r,s=.8*n,c=.8*r;return i.push(["m",e+o,t]),i.push(["l",e+s,t]),(i=i.concat(Be(e+s,t,o,a,1))).push(["l",e+n,t+c]),(i=i.concat(Be(e+n,t+c,-o,a,0))).push(["l",e+o,t+r]),(i=i.concat(Be(e+o,t+r,-o,-a,1))).push(["l",e,t+a]),(i=i.concat(Be(e,t+a,o,-a,0))).push(["l",i[0][1],i[0][2]]),i.push(["h"]),i}},{key:"genSquarePoints",value:function(e,t,n,r){var i=[];return i.push(["m",e,t]),i.push(["l",e+n,t]),i.push(["l",e+n,t+r]),i.push(["l",e,t+r]),i.push(["h",e,t]),i}}]),e}();function Be(e,t,n,r,i){var o=[],a=.5522847498308;return i?(o.push(["c",e+a*n,t]),o.push(["c",e+n,t+a*r]),o.push(["c",e+n,t+r])):(o.push(["c",e,t+a*r]),o.push(["c",e+a*n,t+r]),o.push(["c",e+n,t+r])),o}var Fe=v.Deps.jQuery,Ue=v.Deps.Hammer,Me=v.IStateHandler,Ve=function e(){c(this,e),this.addon=null,this.pathType=0,this.canAdd=!1},Ge=function(e){function t(e){var n;return c(this,t),(n=i(this,t,[e])).destroyHooks=[],n}return d(t,e),u(t,[{key:"addDestroyHook",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;(r=this.destroyHooks).push.apply(r,je(t))}},{key:"addEventTo",value:function(e,t,n){return e.on(t,n),function(){e.off(t,n)}}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n,r,i=e.pdfViewer.getIoC().getInstanceByClass(Ve),o=e.$handler;o.addClass("fv__create-callout-state-handler "+this.cursorStyle),this.shapeDom=(0==(r=(n=o).find(".fv__add-path-preview")).length&&(r=Fe('<canvas class="fv__add-path-preview" style="position: absolute;display:none"></canvas>'),n.append(r)),r);var a,s,c=o[0],l=this.hammer=new Ue.Manager(c,{recognizers:[[Ue.Pan,{direction:Ue.DIRECTION_ALL}]]}),u=function(e){i.canAdd=-1!=e.target.className.indexOf("fv__pdf-page-handler-container")};this.addDestroyHook(this.addEventTo(o,"mousedown",u),this.addEventTo(o,"touchstart",u),function(){l.destroy()}),l.on("panstart",function(e){i.canAdd&&(a=$e(c,e))}).on("panend",function(n){if(a){s={x:a.x+n.deltaX,y:a.y+n.deltaY};var r=t.pageRender.page.reverseDevicePoint([a.x,a.y],t.pageRender.getScale(),t.pageRender.getRotation()),o=t.pageRender.page.reverseDevicePoint([s.x,s.y],t.pageRender.getScale(),t.pageRender.getRotation()),c={x:r[0],y:r[1]},l={x:o[0],y:o[1]},u=Ne.generatePoints(c,l,i.pathType),h=Ne.pointsToRect(c,l);t.pageRender.page.addGraphicsObject({type:2,points:u,rect:h}).then(function(e){return a=null,t.shapeDom.hide(),e}).then(function(e){return e?[i.addon.graphicsManager.get(e),e]:Promise.reject(new Error("Graphics object was not created!"))}).then(function(t){var n=x(t,2);return new(0,n[0])(n[1],e,i.addon)}).then(function(e){t.currentComponet=e,t.pdfViewer.activeElement(e)}).catch(function(e){throw t.currentComponet=null,t.pdfViewer.activeElement(),e})}}).on("panmove",function(e){if(a){s={x:a.x+e.deltaX,y:a.y+e.deltaY};var n=Ne.pointsToRect(a,s,!0);!function(e,t,n){var r=n[0],i=r.getContext("2d");i.clearRect(0,0,n.width(),n.height()),r.width=t.right-t.left+4,r.height=t.bottom-t.top+4,i.clearRect(0,0,n.width(),n.height()),i.beginPath(),i.lineWidth=2,i.strokeStyle="#5aa",i.transform(1,0,0,1,2-t.left,2-t.top);for(var o=[],a=0;a<e.length;a++)switch(e[a][0]){case"m":i.moveTo(e[a][1],e[a][2]);break;case"l":i.lineTo(e[a][1],e[a][2]);break;case"c":o.push(e[a][1],e[a][2]),6===o.length&&(i.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),o=[]);break;case"h":4===o.length?(i.bezierCurveTo(o[0],o[1],o[2],o[3],e[a][1],e[a][2]),o=[]):i.lineTo(e[a][1],e[a][2]),i.closePath()}i.stroke(),n.css({left:t.left,top:t.top}).show()}(Ne.generatePoints(a,s,i.pathType),n,t.shapeDom)}})}},{key:"destroyPageHandler",value:function(){this.destroyHooks.forEach(function(e){return e()}),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponet&&this.currentComponet.destroy()}}],[{key:"setAddon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e?e.pdfViewer:null;t&&(t.getIoC().getInstanceByClass(Ve).addon=e)}},{key:"getStateName",value:function(){return"add-path-object"}},{key:"setPathType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.getIoC().getInstanceByClass(Ve).pathType=t}}]),t}(Me),$e=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Te(r),o=Ce(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}};function Xe(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function We(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){Xe(o,r,i,a,s,"next",e)}function s(e){Xe(o,r,i,a,s,"throw",e)}a(void 0)})}}function Ye(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var Ke=v.Deps.jQuery,ze=v.IStateHandler,qe=v.Events,Qe=v.shared.QueuedAsyncTaskExecutor,Je=function e(){c(this,e),this.addon=null},Ze=function(e){function t(e){return c(this,t),i(this,t,[e])}return d(t,e),u(t,[{key:"pageHandler",value:function(e){var t=this,n=this;this.pageRender=e;var r,i,o=this.pdfViewer.getIoC().getInstanceByClass(Je),a=this.$handler=e.$handler,s=a[0],c=this.hammer=new Hammer.Manager(s,{recognizers:[[Hammer.Tap],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),l=new Qe;function u(){return We(function(){var t,n,o,s,c,l,u,h;return Ye(this,function(p){switch(p.label){case 0:return i?[2,i]:[4,nt(r)];case 1:return t=p.sent(),n=t.width,o=t.height,s=e.getRotation(),c=3*n/e.page.getPxWidth(),l=3*o/e.page.getPxHeight(),(c>1||l>1)&&((u=Math.max(c,l))>1&&(u=1/u),n*=u,o*=u),90!==s&&270!==s||(h=n,n=o,o=h),i=Ke('<img style="position: absolute;top:200%;left:0;border:2px solid transparent; width:'.concat(n,"px; height:").concat(o,'px" src="').concat(r,'"/>')),a.append(i),[2,i]}})})()}this.pdfViewer.eventEmitter.on(qe.addEditImage,this.loadFile=function(e){r=e}),a.off("mouseenter").on("mouseenter",function(e){r&&l.exec(function(){return We(function(){return Ye(this,function(e){switch(e.label){case 0:return[4,u()];case 1:return e.sent().show(),[2]}})})()})}),a.off("mousemove mousewheel").on("mousemove mousewheel",function(e){if(r){var t=s.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;l.exec(function(){return We(function(){return Ye(this,function(e){switch(e.label){case 0:return[4,u()];case 1:return e.sent().css({top:i,left:n}),[2]}})})()})}}),a.off("mouseleave").on("mouseleave",function(e){r&&l.exec(function(){return We(function(){return Ye(this,function(e){switch(e.label){case 0:return[4,u()];case 1:return e.sent().hide(),[2]}})})()})});var h=!0;c.on("tap",function(i){return We(function(){var t,a,c,l,p,d;return Ye(this,function(f){switch(f.label){case 0:return t=this,h?(h=!1,r?(a={},c=et(s,i),[4,u()]):[2]):[2];case 1:return l=f.sent(),p=l.width(),d=l.height(),e.getPDFPage().then(function(i){var s,u=e.getRotation(),f=3*p/i.getPxWidth(),v=3*d/i.getPxHeight();if(f>1||v>1){var g=Math.max(f,v);g>1&&(g=1/g),p*=g,d*=g}if(90===u||270===u){var E=p;p=d,d=E}a.top=c.y,a.left=c.x,a.right=a.left+p,a.bottom=a.top+d,(s=r,new Promise(function(e,t){var n=new XMLHttpRequest;n.open("GET",s),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300||304===n.status?e(n.response):t())},n.onerror=function(){t()},n.send()})).then(function(r){var s=i.reverseDeviceRect(a,e.getScale(),u);i.addImage(r,s,u).then(function(n){if(!n)return t.pdfViewer.getStateHandlerManager().switchTo("edit-all"),l.remove(),t.currentComponet=null,void t.pdfViewer.activeElement();var r=new(o.addon.graphicsManager.get(n))(n,e,o.addon);t.pdfViewer.getStateHandlerManager().switchTo("edit-all"),t.currentComponet=r,l.remove(),h=!0,t.pdfViewer.activeElement(r)}).catch(function(e){e&&console.error(e),n.currentComponet=null,n.pdfViewer.activeElement()})})}),[2]}})}).call(t)})}},{key:"destroyPageHandler",value:function(){this.$handler.off("mousemove mousewheel mouseleave"),this.$handler.empty(),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.pdfViewer.eventEmitter.off(qe.addEditImage,this.loadFile)}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"setAddon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e?e.pdfViewer:null;t&&(t.getIoC().getInstanceByClass(Je).addon=e)}},{key:"getStateName",value:function(){return"add-image-object"}}]),t}(ze),et=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,i=Te(r),o=Ce(r);return{x:i-n.left-t.deltaX,y:o-n.top-t.deltaY}};var tt=new Map;function nt(e){return tt.has(e)?Promise.resolve(tt.get(e)):new Promise(function(t,n){var r=new Image;r.setAttribute("crossOrigin","Anonymous"),r.onload=function(){var n=r.width,i=r.height;tt.set(e,{imageURL:e,width:n,height:i}),t({imageURL:e,width:n,height:i})},r.onerror=function(){n("Fail to load image:"+e)},r.src=e})}var rt="fv__add-text-object-state-handler",it=v.Deps.Hammer;var ot=function(e){return e[e.ALL=0]="ALL",e[e.TEXT=1]="TEXT",e[e.PATH=2]="PATH",e[e.IMAGE=3]="IMAGE",e[e.SHADING=4]="SHADING",e[e.FORM_X_OBJECT=5]="FORM_X_OBJECT",e}({}),at=v.shared.areaSelections,st=at.Selections,ct=at.SelectionEventType,lt=at.createAreaLimitationReducer,ut=at.BorderStyle,ht=v.Deps.Hammer,pt=v.shared.activation.ActivationGroup,dt=v.shared.keyboardStatus,ft=v.shared.QueuedAsyncTaskExecutor,vt={};function gt(e){var t=e.graphicsManager,n="fv__edit-all-state-handler fv__edit-graphics-state-handler";return function(r){function o(e){var t;return c(this,o),(t=i(this,o,[e])).destroyHooks=[],t}return d(o,r),u(o,[{key:"pageHandler",value:function(r){var i=this,o=new pt;this.pageRender=r;var a=r.getPDFPage(),s=r.$handler,c=s[0];s.addClass(n);var l=new ft;this.selections=new st({anchorElement:c,borderStyle:ut.DOTTED}),this.selections.reducer(lt(c)),this.selections.reducer(function(e){if(void 0!==e){var t=c.getBoundingClientRect();return Object.assign({left:e.clientLeft-t.left,top:e.clientTop-t.top},e)}}),this.selections.eventInterceptor(function(e){return e.target===c});var u=!1;this.selections.eventInterceptor(function(e){return u});var h=function(e){u=e.target===c};c.addEventListener("mousedown",h),c.addEventListener("touchstart",h),this.destroyHooks.push(function(){c.removeEventListener("mousedown",h),c.removeEventListener("touchstart",h)}),this.selections.on(ct.END,function(n){l.exec(function(){return a.then(function(a){var s=i.pageRender.scale,c=i.pageRender.getRotation(),l=a.reverseDeviceRect({left:n.left,right:n.left+n.width,top:n.top,bottom:n.top+n.height},s,c),u=Math.min(2/i.pageRender.scale,2);return a.getGraphicsObjectsInRect(l,u,ot.ALL).then(function(n){!n||n.length<1||(d()||o.clear(),i.pdfViewer.activeElement(o),n.forEach(function(n){var i=n.getRect();if(!(i.right-i.left<1||i.top-i.bottom<1)){var a=new(t.get(n))(n,r,e);o.add(a)}}),i.pdfViewer.eventEmitter.emit(v.Events.activeElementChanged))})})})});var p=this.hammer=new ht(c);p.on("tap",function(n){i.resetHandler();var s,l,u,h,p,f=(s=n,l=c.getBoundingClientRect(),u=s.srcEvent,h=Te(u),p=Ce(u),{x:h-l.left-s.deltaX,y:p-l.top-s.deltaY});a.then(function(e){return[e,e.reverseDevicePoint([f.x,f.y],r.getScale(),r.getRotation())]}).then(function(e){var t=x(e,2),n=t[0],r=x(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],5,0)}).then(function(e){return e?e.type<1||e.type>3?Promise.reject():[t.get(e),e]:Promise.reject(vt)}).then(function(t){var n=x(t,2);return new(0,n[0])(n[1],r,e)}).then(function(e){if(i.currentComponent=e,d()){var t=n.target.closest(".fwr__graphics-object-handler");if(t){var r=o.activations.find(function(e){return!!e.$handler&&e.$handler.get(0)===t});if(r)return o.remove(r),void i.pdfViewer.activeElement(o)}}else o.clear();o.add(e),i.pdfViewer.activeElement(o),i.pdfViewer.eventEmitter.emit(v.Events.tapGraphicsObject,e.getGraphicsObject())}).catch(function(e){e===vt&&d()||(e!==vt&&e&&console.error(e),i.currentComponent=null,i.pdfViewer.activeElement())})}),this.destroyHooks.push(function(){return p.destroy()},function(){return i.selections.destroy()},function(){o.clear(),i.pdfViewer.unActiveElement(o)});var d=function(){return!!i.pdfViewer.isShortcutKeyEnabled()&&(v.DeviceInfo.isMac?dt.isWin:dt.isCtrl)}}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.destroyHooks.forEach(function(e){return e()}),this.pageRender.$handler.removeClass(n),this.resetHandler(),this.pageRender=null,this.destroyHooks=null}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponent&&this.currentComponent.textCharSure&&this.currentComponent.textCharSure()}}],[{key:"getStateName",value:function(){return"edit-all"}}]),o}(v.IStateHandler)}var Et=function(){function e(t){c(this,e),this.pdfViewer=t,this.graphicsManager=new Pe,this.pdfViewer.addon=this}return u(e,[{key:"init",value:function(){var e,t,n,r=this,o=function(e){var t=e.graphicsManager,n="text",r=n?["fv__edit-",n,"-state-handler"].join(""):"";return r+=" fv__edit-graphics-state-handler",function(o){function a(e){return c(this,a),i(this,a,[e])}return d(a,o),u(a,[{key:"pageHandler",value:function(n){var i=this;this.pageRender=n;var o=n.$handler,a=o[0];o.addClass(r);var s=this.hammer=new Le.Manager(a,{recognizers:[[Le.Pan,{direction:Le.DIRECTION_ALL}]]});s.add(new Le.Tap({event:"doubletap",taps:2})),s.add(new Le.Tap({event:"singletap"})),s.get("doubletap").recognizeWith("singletap"),s.get("singletap").requireFailure("doubletap"),s.on("singletap",function(r){i.resetHandler();var o=r.changedPointers[0];n.getPDFPage().then(function(e){return[e,e.reverseDevicePoint([o.offsetX,o.offsetY],n.getScale(),n.getRotation())]}).then(function(e){var t=x(e,2),n=t[0],r=x(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],3,1)}).then(function(e){return e?[t.get(e),e]:Promise.reject(new Error("Text object not found at this position: [".concat(o.offsetX,", ").concat(o.offsetY,"]")))}).then(function(t){var r=x(t,2);return new(0,r[0])(r[1],n,e)}).then(function(e){return i.currentComponet=e,e.active()}).catch(function(e){e&&console.error(e),i.currentComponet=null,i.pdfViewer.activeElement()})}),s.on("doubletap",function(r){i.resetHandler();var o=r.changedPointers[0];n.getPDFPage().then(function(e){return[e,e.reverseDevicePoint([o.offsetX,o.offsetY],n.getScale(),n.getRotation())]}).then(function(e){var t=x(e,2),n=t[0],r=x(t[1],2),i=r[0],o=r[1];return n.getGraphicsObjectAtPoint([i,o],3,1)}).then(function(e){return e?[t.get(e),e]:Promise.reject(new Error("Text object not found at this position: [".concat(o.offsetX,", ").concat(o.offsetY,"]")))}).then(function(t){var r=x(t,2);return new(0,r[0])(r[1],n,e)}).then(function(e){return i.currentComponet=e,e.activeCharEdit()}).catch(function(e){e&&console.error(e),i.currentComponet=null,i.pdfViewer.activeElement()})})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(r),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.currentComponet&&(this.currentComponet.textCharSure&&this.currentComponet.textCharSure(),this.currentComponet.unActive())}}],[{key:"getStateName",value:function(){return"edit-"+n}}]),a}(v.IStateHandler)}(this),a=Oe(this,2),s=Oe(this,3),l=gt(this),h=(t=(e=this).graphicsManager,n=function(){function e(){c(this,e),this.currentEditingGraphicComponent=null}return u(e,[{key:"allInjected",value:function(){var e=this;this.pdfViewer.eventEmitter.on(v.ViewerEvents.willCloseDocument,function(){e.currentEditingGraphicComponent&&e.currentEditingGraphicComponent.isActive&&e.currentEditingGraphicComponent.unActive(),e.currentEditingGraphicComponent=null})}},{key:"applyCurrent",value:function(){var e=this.currentEditingGraphicComponent;e&&(e.textCharSure&&e.textCharSure(),e.unActive(),this.currentEditingGraphicComponent=null)}}],[{key:"inject",value:function(){return{pdfViewer:v.PDFViewer}}}]),e}(),function(r){function o(e){var t;return c(this,o),(t=i(this,o,[e])).service=e.getIoC().getInstanceByClass(n),t}return d(o,r),u(o,[{key:"pageHandler",value:function(n){var r=this;this.pageRender=n;var i=n.getPDFPage(),o=n.$handler,a=o[0];o.addClass(rt),(this.hammer=new it(a)).on("tap",function(o){r.resetHandler();var a=o.changedPointers[0];i.then(function(e){return[e,e.reverseDevicePoint([a.offsetX,a.offsetY],n.getScale(),n.getRotation())]}).then(function(e){var t=x(e,2),i=t[0],o=x(t[1],2),a=o[0],s=o[1],c=i.getRotationAngle(),l=new v.Matrix;l.rotate((c+n.getRotation())/180*Math.PI),l.translate(a,s);var u=r.pdfViewer.store.getCurrentValue("add-text-object-param-transfer");return i.addGraphicsObject(Object.assign({},u,{originPosition:{x:a,y:s}},{type:1,matrix:l.toArray()}))}).then(function(e){return e?[t.get(e),e]:Promise.reject(new Error("Graphics object was not created!"))}).then(function(t){var r=x(t,2);return new(0,r[0])(r[1],n,e)}).then(function(e){return r.service.currentEditingGraphicComponent=e,r.currentGraphicComponent=e,e.activeCharEdit()}).catch(function(e){e&&console.error(e),r.service.currentEditingGraphicComponent=null,r.currentGraphicComponent=null,r.pdfViewer.activeElement()})})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(rt),this.pdfViewer.getEventEmitter().off(k.addTextObjectParamTransfer,this.addTextObjectParamTransferBind),this.resetHandler()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"resetHandler",value:function(){this.service.currentEditingGraphicComponent&&this.service.applyCurrent()}}],[{key:"getStateName",value:function(){return"add-text-object"}}]),o}(v.IStateHandler)),p=this.pdfViewer.getStateHandlerManager();[o,a,s,l,Ge,h,Ze].forEach(function(e){e.setAddon&&e.setAddon(r),p.register(e)}),this.pdfViewer.addDestroyHook(function(){Ge.setAddon(null,r.pdfViewer),Ze.setAddon(null,r.pdfViewer)})}},{key:"getGraphicsManager",value:function(){return this.graphicsManager}},{key:"receiveAction",value:function(e,t){"activeFillSignText"===e&&(createPredefinedTextStateHandler.setParams(t[0],this.pdfViewer),this.pdfViewer.getStateHandlerManager().switchTo("add-fill-predefined-text","predefined-text"))}}]),e}(),mt=o(485),yt=o.n(mt);var _t=0,Tt=1,Ct={0:"None",1:"Square",2:"Circle",3:"Diamond",4:"OpenArrow",5:"ClosedArrow",6:"Butt",7:"ROpenArrow",8:"RClosedArrow",9:"Slash"},At=(Object.keys(Ct).reduce(function(e,t){return e[Ct[t]]=Number(t),e},{}),Promise.resolve(),function(e){function t(){return c(this,t),i(this,t,arguments)}return d(t,e),u(t,[{key:"handle",value:function(e){if(this.getPDFUI().checkAppSignIn()){var t=this.component.parent.getCurrentTarget();t.moveToPosition&&t.moveToPosition(_t,null)}}}],[{key:"getName",value:function(){return"MoveFrontGraphicsObjectController"}}]),t}(f.Controller)),bt=function(e){function t(){return c(this,t),i(this,t,arguments)}return d(t,e),u(t,[{key:"handle",value:function(e){if(this.getPDFUI().checkAppSignIn()){var t=this.component.parent.getCurrentTarget();t.moveToPosition&&t.moveToPosition(Tt,null)}}}],[{key:"getName",value:function(){return"MoveBackGraphicsObjectController"}}]),t}(f.Controller),Rt=function(e){function t(){return c(this,t),i(this,t,arguments)}return d(t,e),u(t,[{key:"initDialog",value:function(){var e=this,t="fv--graphics-object-properties-dialog";this.pdfUI.registerDialog(t,function(n){return e[t]?Promise.resolve(e[t]):e.pdfUI.getComponentByName("template-container").then(function(n){return e[t]=n.append("<edit-graphics:graphic-object-properties-dialog></edit-graphics:graphic-object-properties-dialog>")})})}},{key:"handle",value:function(e){this.getPDFUI().checkAppSignIn()&&(this.isInitDialog||(this.initDialog(),this.isInitDialog=!0),this.pdfUI.openDialog("fv--graphics-object-properties-dialog").then(function(t){t.showAt(e.pageX,e.pageY)}))}}],[{key:"getName",value:function(){return"ShowGraphicsObjectPropertiesController"}}]),t}(f.Controller),St=function(e){function t(){return c(this,t),i(this,t,arguments)}return d(t,e),u(t,[{key:"handle",value:function(){if(this.getPDFUI().checkAppSignIn()){var e=this.component.parent.getCurrentTarget();e.remove&&e.remove()}}}],[{key:"getName",value:function(){return"DeleteGraphicsObjectController"}}]),t}(f.Controller),wt=function(t){function n(){return c(this,n),i(this,n,arguments)}return d(n,t),u(n,[{key:"init",value:function(t){var r=this;h(e(n.prototype),"init",this).call(this,t);var i=t.getPDFUI();i.getPDFViewer().then(function(e){r.addDestroyHook(i.addViewerEventListener(f.PDFViewCtrl.Events.activeElementChanged,function(){e.getAllActivatedElements().some(function(e){return e.graphicsObject&&1===e.graphicsObject.info.type})?t.deactive():t.active()}))})}}],[{key:"getName",value:function(){return"check-activates"}}]),n}(f.Directive),xt=o(125),kt=o.n(xt),Dt=f.PDFViewCtrl.shared.colorConvertor,Pt={},Ht=[[],[2,2,2,2],[3,3,3,3],[4,4,4,4],[4,3,2,3],[8,4,4,4],[4,3,16,3]];var Ot=function(){function e(){c(this,e)}return u(e,[{key:"getMergedPropertiesOfActivateElements",value:function(e){var t=this,n=e.filter(function(e){return!!e.graphicsObject}).map(function(e){switch(e.graphicsObject.info.type){case 3:return t.exportImageProperties(e);case 2:return t.exportPathProperties(e)}}).filter(Boolean);return this.mergeAllProperties(n)}},{key:"mergeAllProperties",value:function(e){if(0===e.length)return{isEmpty:!0};var t=e.map(function(e){return Object.keys(e)});return t.sort(function(e,t){return e.length>t.length?1:-1}),t[0].reduce(function(t,n){return t[n]=function(t){var n=e[0][t];if(e.slice(1).some(function(e){return e[t]!==n}))return Pt;return n}(n),t},{})}},{key:"exportImageProperties",value:function(e){return{opacity:100*e.getPropertyOptions().opacity}}},{key:"exportPathProperties",value:function(e){var t=e.graphicsObject,n=e.getPropertyOptions(),r=n.color,i=n.opacity,o=n.fillColor;return{borderWidth:n.borderWidth,borderStyle:function(e){var t=e.getBorderStyle(),n=0,r=e.getBorderDashes();if(1==t&&r.length>0){var i=Math.max.apply(Math,r),o=Math.min.apply(Math,r);n=o==i?o>3?3:o>2?2:o<2||2==o?1:3:i>8?6:i>4?5:4}return n}(t),borderColor:r,fillColor:0===o?0:Dt(o,"#"),opacity:100*i}}},{key:"applyOpacityChange",value:function(e,t){e!==t.graphicsObject.getOpacity()&&t.setOpacity(e)}},{key:"applyBorderWidthChange",value:function(e,t){e!==t.graphicsObject.getBorderWidth()&&t.setBorderWidth(e)}},{key:"applyBorderColorChange",value:function(e,t){var n=0===e?0:Dt(e,"int");n!==t.graphicsObject.getBorderColor()&&t.setColor(n)}},{key:"applyFillColorChange",value:function(e,t){var n=0==e?0:Dt(e,"int");n!==t.graphicsObject.getFillColor()&&t.setFillColor(n)}},{key:"applyBorderStyleChange",value:function(e,t){var n,r=x([0===(n=e)?0:1,Ht[n]],2),i=r[0],o=r[1];t.setBorderStyle(i,o)}},{key:"isAllSame",value:function(e,t){return e[t]!==Pt}}]),e}(),It=f.PDFViewCtrl,Lt=It.DeviceInfo.isMobile,jt=It.ViewerEvents,Nt=f.PDFViewCtrl.keyboard.KeyboardUtils.matchers.Escape,Bt=It._internal.shared.attachKeypressEvent,Ft=function(t){function r(){return c(this,r),i(this,r,arguments)}return d(r,t),u(r,[{key:"init",value:function(){h(e(r.prototype),"init",this).call(this),this.title="ega:graphics-properties.dialog.title",this.properties={},this.digest()}},{key:"mounted",value:function(){var t=this;h(e(r.prototype),"mounted",this).call(this);var i=this.getPDFUI(),o=this.graphicsObjectService;this.addDestroyHook(i.addViewerEventListener(jt.activeElementChanged,function(){t.isVisible&&t.updateActivatedElements()}),this.watchProperty("fillColor",function(e){var r="string"==typeof e?e:"transparent";t.fillColorMaskElement.style.backgroundColor=r,"object"!==(void 0===e?"undefined":n(e))&&void 0!==e&&t.forEachGraphicObject(function(t){o.applyFillColorChange(e,t)})}),this.watchProperty("borderColor",function(e){var r="string"==typeof e?e:"transparent";t.borderColorMaskElement.style.backgroundColor=r,"object"!==(void 0===e?"undefined":n(e))&&void 0!==e&&t.forEachGraphicObject(function(t){o.applyBorderColorChange(e,t)})}),this.watchProperty("opacity",function(e){"object"!==(void 0===e?"undefined":n(e))&&void 0!==e&&t.forEachGraphicObject(function(t){o.applyOpacityChange(e/100,t)})}),this.watchProperty("borderWidth",function(e){"object"!==(void 0===e?"undefined":n(e))&&void 0!==e&&t.forEachGraphicObject(function(t){o.applyBorderWidthChange(e,t)})}),this.watchProperty("borderStyle",function(e){"object"!==(void 0===e?"undefined":n(e))&&void 0!==e&&t.forEachGraphicObject(function(t){o.applyBorderStyleChange(e,t)})}),Bt(this.element,function(e){t.hide(),e.stopPropagation()},Nt))}},{key:"watchProperty",value:function(e,t){var n=this;return this.watch("$component.properties.".concat(e),function(r){n.supportsProperty(e)&&t(r)})}},{key:"supportsProperty",value:function(e){return e in(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.properties)}},{key:"forEachGraphicObject",value:function(e){return this.getPDFUI().getAllActivatedElements().then(function(t){t.forEach(function(t){t.graphicsObject&&e(t)})})}},{key:"showAt",value:function(t,n){h(e(r.prototype),"show",this).call(this),this.updateActivatedElements(),Lt||this.resetPosition(t,n)}},{key:"resetPosition",value:function(e,t){var n=this.getRoot().element,r=this.element,i=r.offsetWidth,o=r.offsetHeight;e+i>n.offsetWidth?r.style.left=n.offsetWidth-i+"px":r.style.left=e+"px",t+o>n.offsetHeight?r.style.top=n.offsetHeight-o+"px":r.style.top=t+"px"}},{key:"updateActivatedElements",value:function(){var e=this;this.getPDFUI().getAllActivatedElements().then(function(t){var n=e.graphicsObjectService.getMergedPropertiesOfActivateElements(t);if(n.isEmpty)e.hide();else{var r=Array.from(new Set(t.filter(function(e){return!!e.graphicsObject}).map(function(e){return e.graphicsObject.getType()})));if(1!==r.length)e.title="ega:graphics-properties.dialog.title";else switch(r[0]){case 2:e.title="ega:graphics-properties.dialog.path-title";break;case 3:e.title="ega:graphics-properties.dialog.image-title"}e.correctPropertyKeys=Object.keys(n),e.properties=n,e.digest(),e.updateUIByProperties(n)}})}},{key:"updateUIByProperties",value:function(e){this.updateBorderWidthUI(e),this.updateBorderStyleUI(e),this.updateBorderColorUI(e),this.updateFillColorUI(e),this.updateOpacityUI(e)}},{key:"updateBorderWidthUI",value:function(e){this.supportsProperty("borderWidth",e)?(this.borderWidthFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderWidth")||(this.borderWidthElement.element.value="")):this.borderWidthFieldset.hide()}},{key:"updateBorderStyleUI",value:function(e){this.supportsProperty("borderStyle",e)?(this.borderStyleFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderStyle")?this.borderStyleChoice.setValue(e.borderStyle):this.borderStyleChoice.element.querySelector(".fv__ui-select-lable").className="fv__ui-select-lable"):this.borderStyleFieldset.hide()}},{key:"updateBorderColorUI",value:function(e){this.supportsProperty("borderColor",e)?(this.borderColorFieldset.show(),this.graphicsObjectService.isAllSame(e,"borderColor")||(this.borderColorMaskElement.style.backgroundColor="transparent")):this.borderColorFieldset.hide()}},{key:"updateFillColorUI",value:function(e){this.supportsProperty("fillColor",e)?(this.fillColorFieldset.show(),this.graphicsObjectService.isAllSame(e,"fillColor")||(this.fillColorMaskElement.style.backgroundColor="transparent")):this.fillColorFieldset.hide()}},{key:"updateOpacityUI",value:function(e){this.supportsProperty("opacity",e)?(this.opacityInputFieldset.show(),this.opacitySlider.show(),this.graphicsObjectService.isAllSame(e,"opacity")||(this.opacityInput.element.value="")):(this.opacityInputFieldset.hide(),this.opacitySlider.hide())}},{key:"toggleLock",value:function(e){e?this.appearanceTabBody.lock():this.appearanceTabBody.unlock()}},{key:"borderStyleChanged",value:function(e){this.properties.borderStyle=e,this.digest()}},{key:"showColorPicker",value:function(e,t){var r=this,i=this.getPDFUI().colorSpectrum;switch(e){case"fillColor":var o=this.properties.fillColor;"object"===(void 0===o?"undefined":n(o))&&(o=0),i.showTransparent(!0).setDefaultColor(o),i.show(t.element,function(e){r.properties.fillColor=e,r.digest()});break;case"borderColor":var a=this.properties.borderColor;"object"===(void 0===a?"undefined":n(a))&&(a=0),i.showTransparent(!0).setDefaultColor(a),i.show(t.element,function(e){r.properties.borderColor=e,r.digest()})}}}],[{key:"getName",value:function(){return"graphic-object-properties-dialog"}},{key:"services",value:function(){return{graphicsObjectService:Ot}}}]),r}(f.SeniorComponentFactory.createSuperClass({template:kt()(),fragments:[{target:"graphics-property-borderStyle",config:{iconclass:"fv__ui-property-icon-border-style",noOptionLable:!0,selectorClass:"fv__ui-border-style-selector",options:Array(7).fill(0).map(function(e,t){return{value:t,class:"fv__ui-line-style-"+t}})}}]})),Ut=function(t){function n(){return c(this,n),i(this,n,arguments)}return d(n,t),u(n,[{key:"init",value:function(t){var r=this;h(e(n.prototype),"init",this).call(this,t),t.getPDFViewer().then(function(e){(r.addon=new Et(e)).init()})}},{key:"receiveAction",value:function(e,t){if("getGraphicsObjectComponent"===e){var n=t.graphicsObject,r=t.pageRender;return new(this.addon.getGraphicsManager().get(n))(n,r,this.addon)}this.addon.receiveAction(e,t)}}],[{key:"getName",value:function(){return"edit-graphics"}},{key:"getLoader",value:function(){return yt()}},{key:"initOnLoad",value:function(){var e=f.modular.module("edit-graphics",[]);e.registerController(Rt),e.registerController(At),e.registerController(bt),e.registerController(St),e.registerComponent(Ft),e.getRegistry().registerDirective(wt),e.registerPreConfiguredComponent("contextmenu-item-properties",{template:'<contextmenu-item @controller="edit-graphics:ShowGraphicsObjectPropertiesController">ega:contextmenu.properties</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-set-to-front",{template:'<contextmenu-item @controller="edit-graphics:MoveFrontGraphicsObjectController">ega:contextmenu.set-to-front</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-set-to-back",{template:'<contextmenu-item @controller="edit-graphics:MoveBackGraphicsObjectController">ega:contextmenu.set-to-back</contextmenu-item>'}),e.registerPreConfiguredComponent("contextmenu-item-delete",{template:'<contextmenu-item @controller="edit-graphics:DeleteGraphicsObjectController">ega:contextmenu.delete</contextmenu-item>'}),e.registerPreConfiguredComponent("image-contextmenu",{template:'\n            <contextmenu name="fv--image-graphics-object-contextmenu" @edit-graphics:check-activates>\n                <edit-graphics:contextmenu-item-set-to-front name="fv--contextmenu-item-image-graphics-object-set-to-front"></edit-graphics:contextmenu-item-set-to-front>\n                <edit-graphics:contextmenu-item-set-to-back name="fv--contextmenu-item-image-graphics-object-set-to-back"></edit-graphics:contextmenu-item-set-to-back>\n                <edit-graphics:contextmenu-separator></edit-graphics:contextmenu-separator>\n                <edit-graphics:contextmenu-item-delete name="fv--contextmenu-item-image-graphics-object-delete"></edit-graphics:contextmenu-item-delete>\n                <edit-graphics:contextmenu-separator></edit-graphics:contextmenu-separator>\n                <edit-graphics:contextmenu-item-properties name="fv--contextmenu-item-image-graphics-object-properties"></edit-graphics:contextmenu-item-properties>\n            </contextmenu>\n            '})}}]),n}(f.UIXAddon)})(),a=a.default})());
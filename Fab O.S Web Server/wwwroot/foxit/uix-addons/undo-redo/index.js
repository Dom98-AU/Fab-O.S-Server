!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension"),require("UIExtension").PDFViewCtrl.PDF.actions,require("UIExtension").PDFViewCtrl.commons):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","PDF","actions"],["UIExtension","PDFViewCtrl","commons"]],e):"object"==typeof exports?exports.UndoRedoAddon=e(require("UIExtension"),require("UIExtension").PDFViewCtrl.PDF.actions,require("UIExtension").PDFViewCtrl.commons):t.UndoRedoAddon=e(t.UIExtension,t.UIExtension.PDFViewCtrl.PDF.actions,t.UIExtension.PDFViewCtrl.commons)}(self,(t,e,n)=>(()=>{var r={1843:t=>{t.exports=null},8552:(t,e,n)=>{var r=n(852)(n(5639),"DataView");t.exports=r},1989:(t,e,n)=>{var r=n(1789),o=n(401),i=n(7667),a=n(1327),u=n(1866);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},8407:(t,e,n)=>{var r=n(7040),o=n(4125),i=n(2117),a=n(7518),u=n(4705);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},7071:(t,e,n)=>{var r=n(852)(n(5639),"Map");t.exports=r},3369:(t,e,n)=>{var r=n(4785),o=n(1285),i=n(6e3),a=n(9916),u=n(5265);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=u,t.exports=c},3818:(t,e,n)=>{var r=n(852)(n(5639),"Promise");t.exports=r},8525:(t,e,n)=>{var r=n(852)(n(5639),"Set");t.exports=r},6384:(t,e,n)=>{var r=n(8407),o=n(7465),i=n(3779),a=n(7599),u=n(4758),c=n(4309);function s(t){var e=this.__data__=new r(t);this.size=e.size}s.prototype.clear=o,s.prototype.delete=i,s.prototype.get=a,s.prototype.has=u,s.prototype.set=c,t.exports=s},2705:(t,e,n)=>{var r=n(5639).Symbol;t.exports=r},1149:(t,e,n)=>{var r=n(5639).Uint8Array;t.exports=r},577:(t,e,n)=>{var r=n(852)(n(5639),"WeakMap");t.exports=r},7412:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},4963:t=>{t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}},4636:(t,e,n)=>{var r=n(2545),o=n(5694),i=n(1469),a=n(4144),u=n(5776),c=n(6719),s=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=i(t),l=!n&&o(t),f=!n&&!l&&a(t),d=!n&&!l&&!f&&c(t),h=n||l||f||d,p=h?r(t.length,String):[],v=p.length;for(var y in t)!e&&!s.call(t,y)||h&&("length"==y||f&&("offset"==y||"parent"==y)||d&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||u(y,v))||p.push(y);return p}},2488:t=>{t.exports=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}},4865:(t,e,n)=>{var r=n(9465),o=n(7813),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];i.call(t,e)&&o(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},8470:(t,e,n)=>{var r=n(7813);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},4037:(t,e,n)=>{var r=n(8363),o=n(3674);t.exports=function(t,e){return t&&r(e,o(e),t)}},3886:(t,e,n)=>{var r=n(8363),o=n(1704);t.exports=function(t,e){return t&&r(e,o(e),t)}},9465:(t,e,n)=>{var r=n(8777);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},5990:(t,e,n)=>{var r=n(6384),o=n(7412),i=n(4865),a=n(4037),u=n(3886),c=n(4626),s=n(278),l=n(8805),f=n(1911),d=n(8234),h=n(6904),p=n(4160),v=n(3824),y=n(9148),g=n(8517),m=n(1469),k=n(4144),b=n(6688),w=n(3218),A=n(2928),S=n(3674),O=n(1704),E="[object Arguments]",I="[object Function]",T="[object Object]",j={};j[E]=j["[object Array]"]=j["[object ArrayBuffer]"]=j["[object DataView]"]=j["[object Boolean]"]=j["[object Date]"]=j["[object Float32Array]"]=j["[object Float64Array]"]=j["[object Int8Array]"]=j["[object Int16Array]"]=j["[object Int32Array]"]=j["[object Map]"]=j["[object Number]"]=j[T]=j["[object RegExp]"]=j["[object Set]"]=j["[object String]"]=j["[object Symbol]"]=j["[object Uint8Array]"]=j["[object Uint8ClampedArray]"]=j["[object Uint16Array]"]=j["[object Uint32Array]"]=!0,j["[object Error]"]=j[I]=j["[object WeakMap]"]=!1,t.exports=function t(e,n,R,N,x,P){var C,_=1&n,D=2&n,V=4&n;if(R&&(C=x?R(e,N,x,P):R(e)),void 0!==C)return C;if(!w(e))return e;var U=m(e);if(U){if(C=v(e),!_)return s(e,C)}else{var L=p(e),F=L==I||"[object GeneratorFunction]"==L;if(k(e))return c(e,_);if(L==T||L==E||F&&!x){if(C=D||F?{}:g(e),!_)return D?f(e,u(C,e)):l(e,a(C,e))}else{if(!j[L])return x?e:{};C=y(e,L,_)}}P||(P=new r);var M=P.get(e);if(M)return M;P.set(e,C),A(e)?e.forEach(function(r){C.add(t(r,n,R,r,e,P))}):b(e)&&e.forEach(function(r,o){C.set(o,t(r,n,R,o,e,P))});var B=U?void 0:(V?D?h:d:D?O:S)(e);return o(B||e,function(r,o){B&&(r=e[o=r]),i(C,o,t(r,n,R,o,e,P))}),C}},3118:(t,e,n)=>{var r=n(3218),o=Object.create,i=function(){function t(){}return function(e){if(!r(e))return{};if(o)return o(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=i},8866:(t,e,n)=>{var r=n(2488),o=n(1469);t.exports=function(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}},4239:(t,e,n)=>{var r=n(2705),o=n(9607),i=n(2333),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?o(t):i(t)}},9454:(t,e,n)=>{var r=n(4239),o=n(7005);t.exports=function(t){return o(t)&&"[object Arguments]"==r(t)}},5588:(t,e,n)=>{var r=n(4160),o=n(7005);t.exports=function(t){return o(t)&&"[object Map]"==r(t)}},8458:(t,e,n)=>{var r=n(3560),o=n(5346),i=n(3218),a=n(346),u=/^\[object .+?Constructor\]$/,c=Function.prototype,s=Object.prototype,l=c.toString,f=s.hasOwnProperty,d=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!i(t)||o(t))&&(r(t)?d:u).test(a(t))}},9221:(t,e,n)=>{var r=n(4160),o=n(7005);t.exports=function(t){return o(t)&&"[object Set]"==r(t)}},8749:(t,e,n)=>{var r=n(4239),o=n(1780),i=n(7005),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return i(t)&&o(t.length)&&!!a[r(t)]}},280:(t,e,n)=>{var r=n(5726),o=n(6916),i=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=[];for(var n in Object(t))i.call(t,n)&&"constructor"!=n&&e.push(n);return e}},313:(t,e,n)=>{var r=n(3218),o=n(5726),i=n(3498),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=o(t),n=[];for(var u in t)("constructor"!=u||!e&&a.call(t,u))&&n.push(u);return n}},2545:t=>{t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},1717:t=>{t.exports=function(t){return function(e){return t(e)}}},4318:(t,e,n)=>{var r=n(1149);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},4626:(t,e,n)=>{t=n.nmd(t);var r=n(5639),o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}},7157:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},3147:t=>{var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},419:(t,e,n)=>{var r=n(2705),o=r?r.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},7133:(t,e,n)=>{var r=n(4318);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},278:t=>{t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},8363:(t,e,n)=>{var r=n(4865),o=n(9465);t.exports=function(t,e,n,i){var a=!n;n||(n={});for(var u=-1,c=e.length;++u<c;){var s=e[u],l=i?i(n[s],t[s],s,n,t):void 0;void 0===l&&(l=t[s]),a?o(n,s,l):r(n,s,l)}return n}},8805:(t,e,n)=>{var r=n(8363),o=n(9551);t.exports=function(t,e){return r(t,o(t),e)}},1911:(t,e,n)=>{var r=n(8363),o=n(1442);t.exports=function(t,e){return r(t,o(t),e)}},4429:(t,e,n)=>{var r=n(5639)["__core-js_shared__"];t.exports=r},8777:(t,e,n)=>{var r=n(852),o=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},1957:(t,e,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},8234:(t,e,n)=>{var r=n(8866),o=n(9551),i=n(3674);t.exports=function(t){return r(t,i,o)}},6904:(t,e,n)=>{var r=n(8866),o=n(1442),i=n(1704);t.exports=function(t){return r(t,i,o)}},5050:(t,e,n)=>{var r=n(7019);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},852:(t,e,n)=>{var r=n(8458),o=n(7801);t.exports=function(t,e){var n=o(t,e);return r(n)?n:void 0}},5924:(t,e,n)=>{var r=n(5569)(Object.getPrototypeOf,Object);t.exports=r},9607:(t,e,n)=>{var r=n(2705),o=Object.prototype,i=o.hasOwnProperty,a=o.toString,u=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}},9551:(t,e,n)=>{var r=n(4963),o=n(479),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,u=a?function(t){return null==t?[]:(t=Object(t),r(a(t),function(e){return i.call(t,e)}))}:o;t.exports=u},1442:(t,e,n)=>{var r=n(2488),o=n(5924),i=n(9551),a=n(479),u=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,i(t)),t=o(t);return e}:a;t.exports=u},4160:(t,e,n)=>{var r=n(8552),o=n(7071),i=n(3818),a=n(8525),u=n(577),c=n(4239),s=n(346),l="[object Map]",f="[object Promise]",d="[object Set]",h="[object WeakMap]",p="[object DataView]",v=s(r),y=s(o),g=s(i),m=s(a),k=s(u),b=c;(r&&b(new r(new ArrayBuffer(1)))!=p||o&&b(new o)!=l||i&&b(i.resolve())!=f||a&&b(new a)!=d||u&&b(new u)!=h)&&(b=function(t){var e=c(t),n="[object Object]"==e?t.constructor:void 0,r=n?s(n):"";if(r)switch(r){case v:return p;case y:return l;case g:return f;case m:return d;case k:return h}return e}),t.exports=b},7801:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},1789:(t,e,n)=>{var r=n(4536);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},401:t=>{t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},7667:(t,e,n)=>{var r=n(4536),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(e,t)?e[t]:void 0}},1327:(t,e,n)=>{var r=n(4536),o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}},1866:(t,e,n)=>{var r=n(4536);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},3824:t=>{var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},9148:(t,e,n)=>{var r=n(4318),o=n(7157),i=n(3147),a=n(419),u=n(7133);t.exports=function(t,e,n){var c=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return o(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return u(t,n);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return i(t);case"[object Symbol]":return a(t)}}},8517:(t,e,n)=>{var r=n(3118),o=n(5924),i=n(5726);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:r(o(t))}},5776:t=>{var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},7019:t=>{t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},5346:(t,e,n)=>{var r,o=n(4429),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!i&&i in t}},5726:t=>{var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},7040:t=>{t.exports=function(){this.__data__=[],this.size=0}},4125:(t,e,n)=>{var r=n(8470),o=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)}},2117:(t,e,n)=>{var r=n(8470);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},7518:(t,e,n)=>{var r=n(8470);t.exports=function(t){return r(this.__data__,t)>-1}},4705:(t,e,n)=>{var r=n(8470);t.exports=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}},4785:(t,e,n)=>{var r=n(1989),o=n(8407),i=n(7071);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||o),string:new r}}},1285:(t,e,n)=>{var r=n(5050);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},6e3:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).get(t)}},9916:(t,e,n)=>{var r=n(5050);t.exports=function(t){return r(this,t).has(t)}},5265:(t,e,n)=>{var r=n(5050);t.exports=function(t,e){var n=r(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}},4536:(t,e,n)=>{var r=n(852)(Object,"create");t.exports=r},6916:(t,e,n)=>{var r=n(5569)(Object.keys,Object);t.exports=r},3498:t=>{t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},1167:(t,e,n)=>{t=n.nmd(t);var r=n(1957),o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o&&r.process,u=function(){try{var t=i&&i.require&&i.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},5569:t=>{t.exports=function(t,e){return function(n){return t(e(n))}}},5639:(t,e,n)=>{var r=n(1957),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},7465:(t,e,n)=>{var r=n(8407);t.exports=function(){this.__data__=new r,this.size=0}},3779:t=>{t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},7599:t=>{t.exports=function(t){return this.__data__.get(t)}},4758:t=>{t.exports=function(t){return this.__data__.has(t)}},4309:(t,e,n)=>{var r=n(8407),o=n(7071),i=n(3369);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!o||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new i(a)}return n.set(t,e),this.size=n.size,this}},346:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},361:(t,e,n)=>{var r=n(5990);t.exports=function(t){return r(t,5)}},7813:t=>{t.exports=function(t,e){return t===e||t!=t&&e!=e}},5694:(t,e,n)=>{var r=n(9454),o=n(7005),i=Object.prototype,a=i.hasOwnProperty,u=i.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(t){return o(t)&&a.call(t,"callee")&&!u.call(t,"callee")};t.exports=c},1469:t=>{var e=Array.isArray;t.exports=e},8612:(t,e,n)=>{var r=n(3560),o=n(1780);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},4144:(t,e,n)=>{t=n.nmd(t);var r=n(5639),o=n(5062),i=e&&!e.nodeType&&e,a=i&&t&&!t.nodeType&&t,u=a&&a.exports===i?r.Buffer:void 0,c=(u?u.isBuffer:void 0)||o;t.exports=c},3560:(t,e,n)=>{var r=n(4239),o=n(3218);t.exports=function(t){if(!o(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},1780:t=>{t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},6688:(t,e,n)=>{var r=n(5588),o=n(1717),i=n(1167),a=i&&i.isMap,u=a?o(a):r;t.exports=u},3218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},7005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},2928:(t,e,n)=>{var r=n(9221),o=n(1717),i=n(1167),a=i&&i.isSet,u=a?o(a):r;t.exports=u},6719:(t,e,n)=>{var r=n(8749),o=n(1717),i=n(1167),a=i&&i.isTypedArray,u=a?o(a):r;t.exports=u},3674:(t,e,n)=>{var r=n(4636),o=n(280),i=n(8612);t.exports=function(t){return i(t)?r(t):o(t)}},1704:(t,e,n)=>{var r=n(4636),o=n(313),i=n(8612);t.exports=function(t){return i(t)?r(t,!0):o(t)}},479:t=>{t.exports=function(){return[]}},5062:t=>{t.exports=function(){return!1}},4616:e=>{"use strict";e.exports=t},2459:t=>{"use strict";t.exports=e},732:t=>{"use strict";t.exports=n}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={id:t,loaded:!1,exports:{}};return r[t](n,n.exports,i),n.loaded=!0,n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var a={};return(()=>{"use strict";function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t(e)}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(e=function(){return!!t})()}function n(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function r(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function o(n,o,i){return o=t(o),r(n,e()?Reflect.construct(o,i||[],t(n).constructor):o.apply(n,i))}function u(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):u(t,e)}function c(t,e){if(!u(t,e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function f(e,n,r){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,r){var o=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e}(e,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(r||e):i.value}},f(e,n,r||e)}function d(t,e){return d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},d(t,e)}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function y(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.d(a,{default:()=>xn});var g=i(4616);function m(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function k(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){m(i,r,o,a,u,"next",t)}function u(t){m(i,r,o,a,u,"throw",t)}a(void 0)})}}function b(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var w="ANNOTATIONSETTITLE",A="ANNOTATIONSETSUBJECT",S="ANNOTATIONSETCOLOR",O="ANNOTATIONSETOPACITY",E="ANNOTATIONSETFILLCOLOR",I="ANNOTATIONSETBORDERWIDTH",T="ANNOTATIONSETBORDERSTYLE",j="ANNOTATIONSETBORDERINFO",R="ANNOTATIONSETENDINGSTYLE",N="ANNOTATIONENABLECAPTION",x="ANNOTATIONSETROTATION",P="ANNOTATIONSETHIGHLIGHTINGMODE",C="REMOVEANNOT",_="ADDANNOT",D="ANNOTATIONSETRECT",V="ANNOTATION_MOVE_TO",U="ANNOTATION_SET_RECT",L="UPDATEQUADPOINTSBYCHARINDEX",F="ANNOTATIONUPDATECALLOUTPOINTS",M="ANNOTATIONUPDATELINEPOINTS",B="ANNOTATIONSETLEADERLINELENGTH",H="ANNOTATIONUPDATEVERTEXES",G="ANNOTATIONSETCONTENT",z="ANNOTATIONPLACEREDACT",W="ANNOTATIONADDREPLY",q="ANNOTATIONDELETEREPLY",Y="ANNOTATIONADDACTION",$="ANNOTATIONREMOVEACTION",X="ANNOTATIONMOVEACTION",K="ANNOTATIONUPDATEACTION",J="ANNOTATIONERASER",Q="ANNOTATIONMARKREDACTANNOT",Z="ANNOTATIONMAKEREDACTBYPAGES",tt="MARKCHECKEDRESULTREDACTION",et="ADDREVIEWSTATE",nt="ADD_MARKED_STATE",rt="DEFAULTAP",ot="moveAnnotsCrossPage",it="ANNOTATIONUPDATECAPTIONOFFSET",at="Group",ut="FlipPoint",ct="SETICONNAME",st="FLAG",lt="ANNOTATION_SET_MEASUREMENT_RATIO",ft="ANNOTATION_SET_MEASUREMENT_UNIT",dt="ANNOTATION_SET_MEASURE_CONVERSION_FACTOR",ht="ANNOTATION_SET_CAPTION_COLOR",pt="ANNOTATION_SET_END_POINT",vt="ANNOTATION_SET_START_POINT",yt="ANNOTATION_SET_STYLE_FILL_COLOR",gt="ANNOTATION_SET_LEADER_LINE_EXTEND",mt="ANNOTATION_SET_LEADER_LINE_OFFSET",kt="ANNOTATION_SET_LEADER_LINE_LENGTH",bt="ANNOTATION_SET_CAPTION_OFFSET",wt="ANNOTATION_SET_VERTEXES",At="ANNOTATION_SET_ALIGNMENT",St="ANNOTATION_SET_INNER_RECT",Ot="ANNOTATION_SET_CALLOUT_LINE_ENDING_STYLE",Et="FREETEXT_SET_DEFAULT_APPEARANCE",It="ANNOTATION_SET_INK_LIST",Tt="REDACT_SET_OVERLAY_TEXT",jt="REDACT_REMOVE_OVERLAY_TEXT",Rt="REDACT_REMOVE_OVERLAY_TEXT_ALIGNMENT",Nt="REDACT_SET_REPEAT",xt="REDACT_SET_AUTO_FONT_SIZE",Pt="REDACT_SET_REDACT_APPLY_FILL_COLOR",Ct="SCREEN_OR_STAMP_SET_IMAGE",_t="CHANGE_ANNOT_ORDER",Dt="ADD",Vt="REMOVE",Ut=g.PDFViewCtrl.Deps.jQuery,Lt=g.UIEvents,Ft=g.PDFViewCtrl.Consts.BORDER_STYLE,Mt=(PDFViewCtrl.PDF.constant.PosType,function(){function e(t,n){c(this,e),this.pdfViewer=t,this.controller=n}return l(e,[{key:"init",value:function(){var e,n=this.controller,r=this.pdfViewer,i=void 0,a=0,u=this.resetMergeStatus=function(){i=void 0,a=0,e=void 0};r.registerMatchRule(function(s,d){var p=function(t,o){if(!r.customs.pushUndoStack||r.customs.pushUndoStack(t,o))return n.create("annot",t,o,function(){if(a++,!i){if(i=s,!e){e=r.getAllActivatedElements().map(function(t){return t.annot}).filter(Boolean).filter(function(t){return"widget"!==t.getType()});var t=e.findIndex(function(t){return"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()});t>-1&&e.splice(t+1,1)}return 0===e.length||-1===e.indexOf(s)?(a--,i=void 0,e=void 0):e.length===a&&u(),!1}-1===e.indexOf(s)&&a--;var n=e.length;return a===n?(u(),!0):n>1}())};return function(i){function a(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var i;return c(this,a),(i=o(this,a,y(e))).undoRedoDataRecord={},i.handler=n.getAnnotHandler(i.annot),i}return h(a,i),l(a,[{key:"setTitle",value:function(t){var e=this;return this.handler.handleSetTitle(function(){return e.annot.setTitle(t)})}},{key:"setSubject",value:function(t){var e=this;return this.handler.handleSetSubject(function(){return e.annot.setSubject(t)})}},{key:"setColor",value:function(e){var n=this;return this.handler.handleSetColor(function(){return f(t(a.prototype),"setColor",n).call(n,e)})}},{key:"setOpacity",value:function(e){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.handler.handleSetOpacity(function(){return f(t(a.prototype),"setOpacity",n).call(n,e)},r,o)}},{key:"setFillColor",value:function(e){var n=this;if(f(t(a.prototype),"setFillColor",this))return this.handler.handleSetFillColor(function(){return f(t(a.prototype),"setFillColor",n).call(n,e)})}},{key:"setBorderWidth",value:function(e){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.handler.handleSetBorderWidth(function(){return f(t(a.prototype),"setBorderWidth",n).call(n,e)},r,o)}},{key:"setBorderStyle",value:function(e,n){var r=this;return this.handler.handleSetBorderStyle(function(){return f(t(a.prototype),"setBorderStyle",r).call(r,e,n)})}},{key:"flip",value:function(t){var e=this;return this.handler.handleFlip(function(){return e.annot.flip()},t)}},{key:"setEndingStyle",value:function(e,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.handler.handleSetEndingStyle(function(){return f(t(a.prototype),"setEndingStyle",r).call(r,e,n)},e,o)}},{key:"enableCaption",value:function(e){var n=this;return this.handler.handleEnableCaption(function(){return f(t(a.prototype),"enableCaption",n).call(n,e)})}},{key:"setRotation",value:function(e){var n=this;return this.handler.handleSetRotation(function(){return f(t(a.prototype),"setRotation",n).call(n,e)})}},{key:"setHighlightingMode",value:function(e){var n=this;return this.handler.handleSetHighlightingMode(function(){return f(t(a.prototype),"setHighlightingMode",n).call(n,e)})}},{key:"removeAnnot",value:function(){var n=this.annot,o=n.info.type,i=function(t){switch(t){case"sound":case"widget":case"watermark":return!1}return!0},u=i(o);return u&&!e&&(e=r.getAllActivatedElements().map(function(t){return t.annot}).filter(Boolean).filter(function(t){return i(t.info.type)})).slice(0).forEach(function(t){var n=t.getGroupHeader&&t.getGroupHeader();if(n!==t){var r=e.indexOf(n);r>-1&&e.splice(r,1)}}),f(t(a.prototype),"removeAnnot",this).call(this).then(function(t){u&&t&&t.length>0&&p(C,[t,n]);return t})}},{key:"textBoundaryStart",value:function(){this.undoRedoDataRecord[L]={annot:this.annot,oldStart:this.annot.getStartCharIndex(),oldEnd:this.annot.getEndCharIndex()}}},{key:"textBoundaryEnd",value:function(){var t=this.undoRedoDataRecord[L],e=Object.assign({},t,{annot:this.annot,newStart:this.annot.getStartCharIndex(),newEnd:this.annot.getEndCharIndex()});p(L,e)}},{key:"onStartUpdateShape",value:function(e){if(this.isCallingOnShapeUpdate=!0,e in{resize:1,text:1,area:1}&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent())this.undoRedoDataRecord[F]={annot:this.annot,oldRect:this.annot.getRect(),oldCalloutLinePoints:this.annot.getCalloutLinePoints(),oldInnerRect:this.annot.getInnerRect()};else{var n=this.annot.getType();"square"===n||"circle"===n||"freetext"===n&&this.annot.getIntent&&"FreeTextTextbox"===this.annot.getIntent()?this.undoRedoDataRecord[D]={annot:this.annot,oldRect:this.annot.getRect(),oldInnerRect:this.annot.getInnerRect()}:this.undoRedoDataRecord[D]={annot:this.annot,oldRect:this.annot.getRect()}}return f(t(a.prototype),"onStartUpdateShape",this).apply(this,arguments)}},{key:"onShapeUpdateEnd",value:function(e,n,r){var o=this,i=f(t(a.prototype),"onShapeUpdateEnd",this).apply(this,arguments);return i.finally(function(){o.isCallingOnShapeUpdate=!1}),r in{resize:1,text:1,area:1}&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent()?i.then(function(){var t=o.undoRedoDataRecord[F],e=Object.assign({},t,{annot:o.annot,newRect:o.annot.getRect(),newCalloutLinePoints:o.annot.getCalloutLinePoints(),newInnerRect:o.annot.getInnerRect()});p(F,e)}):i.then(function(){var t,e=o.undoRedoDataRecord[D],n=o.annot.getType();t="square"===n||"circle"===n||"freetext"===n&&o.annot.getIntent&&"FreeTextTextbox"===o.annot.getIntent()?Object.assign({},e,{annot:o.annot,newRect:o.annot.getRect(),newInnerRect:o.annot.getInnerRect()}):Object.assign({},e,{annot:o.annot,newRect:o.annot.getRect()}),p(D,t)})}},{key:"moveTo",value:function(e,n,r,o){var i=this,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=this.annot.getRect(),s=this.getPDFPage(),l=e,d=n;if(!u){var h=s.reverseDevicePoint([e,n],this.scale,this.rotate);l=h[0],d=h[1]}return f(t(a.prototype),"moveTo",this).apply(this,arguments).then(function(t){return i.isCallingOnShapeUpdate||p(V,{annot:i.annot,originLeft:c.left,originTop:c.top,left:l,top:d,action:r,apply:o}),t})}},{key:"setRect",value:function(e){var n=this,r=this.annot.getRect();this.annot.getBorderStyle()===Ft.CLOUDY&&(r=this.annot.getInnerRect());var o=this.getPDFPage().reverseDeviceRect({left:e.left,top:e.top,right:e.left+e.width,bottom:e.top+e.height},this.scale,this.rotate);return f(t(a.prototype),"setRect",this).apply(this,arguments).then(function(t){return n.isCallingOnShapeUpdate||p(U,{annot:n.annot,originRect:r,newRect:o}),t})}},{key:"boundaryChangeStart",value:function(t){if("line"===this.annot.getType())switch(Ut(t.target).data("index")||Ut(t.target).parent().data("index")){case 0:case 1:this.undoRedoDataRecord[M]={annot:this.annot,oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case 2:case 3:this.undoRedoDataRecord[B]={annot:this.annot,oldLeaderLinePoints:this.annot.getLeaderLinePoints(),oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case"caption":this.undoRedoDataRecord[it]={annot:this.annot,oldCaptionOffset:this.annot.getCaptionOffset()}}else this.undoRedoDataRecord[H]={annot:this.annot,oldVertexes:this.annot.getVertexes(),oldIndex:Ut(t.target).data("index")}}},{key:"boundaryChangeEnd",value:function(t){var e=Ut(t.target).data("index")||Ut(t.target).parent().data("index");if("line"===this.annot.getType())switch(e){case 0:case 1:var n=this.undoRedoDataRecord[M],r=Object.assign({},n,{annot:this.annot,newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});p(M,r);break;case 2:case 3:var o=this.undoRedoDataRecord[B],i=Object.assign({},o,{annot:this.annot,newLeaderLinePoints:this.annot.getLeaderLinePoints(),newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});p(B,i);break;case"caption":var a=this.undoRedoDataRecord[it],u=Object.assign({},a,{annot:this.annot,newCaptionOffset:this.annot.getCaptionOffset()});p(it,u)}else{var c=this.undoRedoDataRecord[H],s=Object.assign({},c,{annot:this.annot,newVertexes:this.annot.getVertexes(),newIndex:e});p(H,s)}}},{key:"setContent",value:function(e){var n=this;return this.handler.handleSetContent(function(){return f(t(a.prototype),"setContent",n).call(n,e)})}},{key:"placeRedact",value:function(e){return f(t(a.prototype),"placeRedact",this).call(this,e).then(function(t){var e=t.flat().flat().flat().filter(function(t){return"redact"===t.getType()});return p(z,{redacts:e}),t})}},{key:"setDefaultAppearance",value:function(e,n){var r=this;return this.handler.handleSetDefaultAppearance(function(){return f(t(a.prototype),"setDefaultAppearance",r).call(r,e,n)})}},{key:"setFlags",value:function(t){var e=this;return this.handler.handleSetFlags(function(){return e.annot.setFlags(t)})}},{key:"setAction",value:function(t,e,n){var r=this;return this.handler.handleSetAction(function(){return r.annot.setAction(t,e,n)},t,e,n)}},{key:"removeAction",value:function(t,e){var n=this;return this.handler.handleRemoveAction(function(){return n.annot.removeAction(t,e)},t,e)}},{key:"moveAction",value:function(t){return this.handler.handleMoveAction(t)}},{key:"setActionData",value:function(t,e){return this.handler.handleSetActionData(t,e)}},{key:"changeOrder",value:function(t){var e=this,n=this.annot.getIndex();return this.getPDFPage().changeAnnotOrder(t,this.annot).then(function(r){var o=e.annot.getIndex();return p(_t,{annot:s,newIndex:o,oldIndex:n,orderType:t}),r})}}]),a}(d)}),this.bindEvent()}},{key:"bindEvent",value:function(){var t=this.controller,e=this.pdfViewer;function n(e,n){t.create("annot",e,n)}e.eventEmitter.on(Lt.addReplySuccess,function(t,e){"sound"!==t.info.type&&n(W,{annot:t,replyAnnot:e})}),e.eventEmitter.on(Lt.deleteReplySuccess,function(t,e){n(q,{annot:t,replyAnnot:e})}),e.eventEmitter.on("annot-group-event",function(t,e,r){n(at,{page:t,annotIds:e,isGroup:r})}),e.eventEmitter.on(Lt.eraserSuccess,function(t,e){n(J,{beforeInks:t,afterInks:e})}),e.eventEmitter.on(Lt.addAnnotSuccess,function(t){n(_,{annot:t})}),e.eventEmitter.on(Lt.applyRedaction,function(e){t.clear()}),e.eventEmitter.on(Lt.addContentSuccess,function(t,e,r){n(G,{annot:t,oldContent:e,newContent:r})}),e.eventEmitter.on("markRedactAnnotSuccess",function(t){n(Q,{annot:t})}),e.eventEmitter.on("makeRedactByPagesSuccess",function(t){n(Z,{redacts:t})}),e.eventEmitter.on(Lt.markRedactionSuccess,function(t){n(tt,{redacts:t})}),e.eventEmitter.on(Lt.addReviewStateSuccess,function(t,e){"sound"!==t.info.type&&n(et,{annot:t,stateName:e.getState()})}),e.eventEmitter.on(Lt.annotationMarkedStateAnnotAdd,function(t,e,r){r||n(nt,{annot:e,stateName:t.getState()})}),e.eventEmitter.on(Lt.moveAnnotsToPages,function(t,e,r,o){o&&n(ot,{srcPage:t,destPage:e,annots:r})}),e.eventEmitter.on("setNoteIconName",function(t,e,r){e!==r&&n(ct,{annot:t,oldIconName:e,newIconName:r})});var r=function(){return t.clear()};e.eventEmitter.on(Lt.importPages,r),e.eventEmitter.on(Lt.pageAdded,r),e.eventEmitter.on(Lt.pageRemoved,r),e.eventEmitter.on(Lt.pagesRemoved,r),e.eventEmitter.on(Lt.pagesRotated,r),e.eventEmitter.on(Lt.pageMoved,r),e.eventEmitter.on(Lt.pagesMoved,r)}}]),e}()),Bt=function(){function t(){c(this,t),this.stackArray=[]}return l(t,[{key:"push",value:function(t){this.stackArray.push(t)}},{key:"pop",value:function(){return this.stackArray.pop()}},{key:"size",value:function(){return this.stackArray.length}},{key:"clear",value:function(){var t=this,e=this.stackArray,n=[];return this.stackArray=n,function(){t.stackArray===n&&(t.stackArray=e)}}},{key:"filter",value:function(t){this.stackArray=this.stackArray.filter(t)}}]),t}(),Ht=function(){function t(e,n){c(this,t),this.pdfViewer=e,this.controller=n,this.undoStack=new Bt,this.redoStack=new Bt}return l(t,[{key:"storage",value:function(t){var e=this;return this.undoStack.push(t),function(){var n=e.undoStack.indexOf(t);n>-1&&e.undoStack.splice(n,1)}}},{key:"mergeLast",value:function(t){var e=this,n=this.undoStack.pop();if(n){var r=this.doMerge(n,t);return this.undoStack.push(r),function(){var t=e.undoStack.indexOf(r);t>-1&&(e.undoStack[t]=n)}}return this.storage(t)}},{key:"doMerge",value:function(t,e){return{undo:function(){return Promise.resolve(t.undo()).finally(function(){return e.undo()})},redo:function(){return Promise.resolve(t.redo()).finally(function(){return e.redo()})}}}},{key:"undo",value:function(){var t=this.undoStack.pop();if(t)return this.redoStack.push(t),t}},{key:"redo",value:function(){var t=this.redoStack.pop();if(t)return this.undoStack.push(t),t}},{key:"removeById",value:function(t){this.undoStack.filter(function(e){return t!==e.uniqueId}),this.redoStack.filter(function(e){return t!==e.uniqueId})}},{key:"removeByName",value:function(t){this.undoStack.filter(function(e){if(e.annot)return t!==e.annot.info.name}),this.redoStack.filter(function(e){if(e.annot)return t!==e.annot.info.name})}},{key:"clear",value:function(){this.undoStack.clear(),this.redoStack.clear()}},{key:"getUndoStack",value:function(){return this.undoStack}},{key:"getRedoStack",value:function(){return this.redoStack}}]),t}();function Gt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var zt=g.PDFViewCtrl.Consts.BORDER_STYLE,Wt=function(){function t(e){c(this,t);var n=function(t){var e,n,r,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HTML",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u="";"number"==typeof t&&(t=["int",t]);switch(t[0]){case"int":e=(16711680&t[1])>>16,n=(65280&t[1])>>8,r=255&t[1];break;case"T":e=0,n=0,r=0,a=0;break;case"G":e=n=r=255*t[1];break;case"RGB":e=255*t[1],n=255*t[2],r=255*t[3];break;case"CMYK":e=(1-t[4])*(1-t[1])*255,n=(1-t[4])*(1-t[2])*255,r=(1-t[4])*(1-t[3])*255;break;case"r":e=+(o=t.match(/rgba?\((\d*),\s*(\d*),\s*(\d*),?\s*([\.0-9]*)?\)/))[1],n=+o[2],r=+o[3];break;case"#":var c=4==t.length?/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/:/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/;o=t.match(c),e=parseInt(o[1],16),n=parseInt(o[2],16),r=parseInt(o[3],16);break;default:throw new Error("Unsupported color format")}switch(i){case"HTML":u=e===n&&n===r&&-1===r?"transparent":"rgba("+parseInt(e)+","+parseInt(n)+","+parseInt(r)+","+a+")";break;case"RGB":u=["RGB",e/255,n/255,r/255];break;case"#":u+=e<16?"#0"+e.toString(16):"#"+e.toString(16),u+=n<16?"0"+n.toString(16):n.toString(16),u+=r<16?"0"+r.toString(16):r.toString(16);break;case"int":u=0,u|=(a*=255)<<24,u|=e<<16,u|=n<<8,u|=r,u>>>=0}return u}(e.info.borderColor,"int");this.json={objectNumber:e.info.objectNumber,name:e.getName(),flags:e.info.flag,rect:e.info.rect,color:n,style:e.info.borderInfo.style,contents:e.info.content,date:new Date(e.info.modifiedTimestamp).getTime(),type:e.info.type,borderWidth:e.info.borderInfo.width},e.info.isMarkup&&this.markup(e);var r=e.info.type;switch("strikeout"!==r&&"highlight"!==r&&"squiggly"!==r&&"underline"!==r||this.textMarkup(e),r){case"ink":this.ink(e);break;case"fileattachment":this.fileattachment(e);break;case"polygon":this.polygon(e);break;case"polyline":this.polyline(e);break;case"stamp":this.stamp(e);break;case"freetext":this.freetext(e);break;case"screen":this.screen(e);break;case"line":this.line(e);break;case"redact":this.redact(e);break;case"highlight":this.highlight(e);break;case"link":this.link(e);break;case"square":this.square(e);break;case"circle":this.circle(e)}}return l(t,[{key:"markup",value:function(t){var e="",n=!1;if(t.getPopup){var r=t.getPopup();r?(e=r.getName(),n=!1):n=!0}else n=!0;this.json=Object.assign({intent:t.info.intent,opacity:t.info.opacity,subject:t.info.subject,title:t.info.title,creationTimestamp:new Date(t.info.creationTimestamp).getTime(),popId:e,noPopup:n},this.json)}},{key:"textMarkup",value:function(t){var e=[];t.info.quadPoints.map(function(t){e.push({top:t[0].y,left:t[0].x,bottom:t[3].y,right:t[3].x})}),this.json=Object.assign(this.json,{coords:e})}},{key:"ink",value:function(t){this.json=Object.assign({inkList:t.info.inkList},this.json)}},{key:"fileattachment",value:function(t){this.json=Object.assign({fObjNum:t.info.fObjNum},this.json)}},{key:"polygon",value:function(t){var e=qt(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,borderStyle:e.style,borderStyleParam:e.param,fillColor:t.info.fillColor,style:void 0,measure:o})}},{key:"polyline",value:function(t){var e=qt(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,fillColor:t.info.fillColor,borderStyle:e.style,borderStyleParam:e.param,style:void 0,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,measure:o})}},{key:"stamp",value:function(t){this.json=Object.assign({icon:t.info.icon,rotate:(t.info.rotation+360)%360,apObjeNum:t.info.apObjeNum},this.json)}},{key:"freetext",value:function(t){var e=qt(t.info.borderInfo),n="FreeTextTypewriter"==t.info.intent?0:t.info.fillColor;this.json=Object.assign(this.json,{calloutLinePoints:t.info.calloutLinePoints,innerRect:t.info.innerRect,borderStyle:e.style,borderStyleParam:e.param,style:void 0,"interior-color":n,calloutLineEndingStyle:t.info.calloutLineEndingStyle,defaultAppearance:t.info.defaultAppearance,rotate:t.info.rotation})}},{key:"line",value:function(t){var e=qt(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n});var i=t.info.startPoint,a=t.info.endPoint;this.json=Object.assign(this.json,{styleFillColor:t.info.styleFillColor,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,enableCaption:t.info.hasCaption,startPoint:{x:i.x,y:i.y},endPoint:{x:a.x,y:a.y},measure:o,borderStyle:e.style,borderStyleParam:e.param,style:void 0})}},{key:"screen",value:function(t){var e=qt(t.info.borderInfo);this.json=Object.assign({apObjNum:t.info.apObjNum,opacity:t.info.opacity,rotate:{0:0,90:1,180:2,270:3}[t.info.rotation],iObjNum:t.info.iObjNum,aObjNum:t.info.aObjNum,intensity:e.param},this.json)}},{key:"redact",value:function(t){var e=t.info.quadPoints,n=[];e.length>0?e.map(function(t){n.push({left:t[0].x,right:t[3].x,top:t[0].y,bottom:t[3].y})}):n.push(t.info.rect),this.json=Object.assign(this.json,{rects:n,applyFillColor:t.info.applyFillColor})}},{key:"highlight",value:function(t){t.info.isArea&&(this.json=Object.assign(this.json,{coords:[t.info.rect],dicts:{AreaHi:"AreaHi"}}),delete this.json.startCharIndex,delete this.json.endCharIndex)}},{key:"link",value:function(t){var e=qt(t.info.borderInfo);this.json=Object.assign(this.json,{aObjNum:t.info.aObjNum,borderStyle:e.style,borderStyleParam:e.param,style:void 0,highlightingMode:t.info.highlightingMode})}},{key:"circle",value:function(t){var e=qt(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,borderStyle:e.style,borderStyleParam:e.param,style:void 0,measure:o})}},{key:"square",value:function(t){var e=qt(t.info.borderInfo),n=t.info.measureRatio,r=t.info.measureUnit,o=null;n&&r&&(o={unit:r,ratio:n}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,measure:o,borderStyle:e.style,borderStyleParam:e.param,style:void 0})}},{key:"getJson",value:function(){return this.json}}]),t}();function qt(t){var e,n=t.style,r=t.cloudIntensity,o=t.dashes;switch(n){case zt.SOLID:e=[];break;case zt.CLOUDY:e=r;break;case zt.DASHED:e=o}return{style:n,param:e}}var Yt=i(361),$t=i.n(Yt);function Xt(t){if(!t)return[];var e=[];return function t(n){if(e.push(n),1===n.subAction.length)t(n.subAction[0]);else for(var r=0;r<n.subAction.length;r++)e.push(n.subAction[r])}(t),e}g.PDFViewCtrl.Consts.Intents;var Kt=g.PDFViewCtrl.shared.QueuedAsyncTaskExecutor,Jt=g.PDFViewCtrl.Consts.BORDER_STYLE,Qt=PDFViewCtrl.PDF.constant.PosType,Zt=function(){function t(e){c(this,t),this.pdfViewer=e,this.pdfViewer.recordsMap={}}return l(t,[{key:w,value:function(t){var e=t.annot,n=t.oldTitle,r=t.newTitle,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setTitle(t)}}return{undo:i(n),redo:i(r)}}},{key:A,value:function(t){var e=t.annot,n=t.oldSubject,r=t.newSubject,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setSubject(t)}}return{undo:i(n),redo:i(r)}}},{key:S,value:function(t){var e=t.annot,n=t.oldColor,r=t.newColor,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return-1===t&&(t=0),n&&n.annot.setBorderColor(t).then(function(){n.updateRender()})}}return{undo:i(n),redo:i(r)}}},{key:O,value:function(t){var e=t.annot,n=t.oldOpacity,r=t.newOpacity,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setOpacity(t).then(function(){n.updateRender()})}}return{undo:i(n),redo:i(r)}}},{key:E,value:function(t){var e=t.annot,n=t.oldFillColor,r=t.newFillColor,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n?(n.annot.setStyleFillColor||n.annot.setFillColor).call(n.annot,t):Promise.resolve()}}return{undo:i(n),redo:i(r)}}},{key:I,value:function(t){var e=t.annot,n=t.oldBorderWidth,r=t.newBorderWidth;return this._common_interpreter(e,"setBorderWidth",[r],[n])}},{key:ut,value:function(t){var e=t.annot,n=this.pdfViewer;function r(t){return function(){var e=te(n,t);return e&&e.annot.flip()}}return{undo:r(e),redo:r(e)}}},{key:T,value:function(t){var e=t.annot,n=t.oldBorderStyle,r=t.newBorderStyle,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setBorderStyle(t.style,t.param)}}return{undo:i(n),redo:i(r)}}},{key:j,value:function(t){var e=t.annot,n=t.oldBorderInfo,r=t.newBorderInfo;return this._common_interpreter(e,"setBorderInfo",[r],[n])}},{key:lt,value:function(t){var e=t.annot,n=t.oldMeasureRatio,r=t.newMeasureRatio;return this._common_interpreter(e,"setMeasureRatio",[r],[n])}},{key:ft,value:function(t){var e=t.annot,n=t.oldUnit,r=t.newUnit;return this._common_interpreter(e,"setMeasureUnit",[r],[n])}},{key:dt,value:function(t){var e=t.annot,n=t.oldFactor,r=t.newFactor;return this._common_interpreter(e,"setMeasureConversionFactor",[r],[n])}},{key:ht,value:function(t){var e=t.annot,n=t.oldCaptionColor,r=t.newCaptionColor;return this._common_interpreter(e,"setCaptionColor",[r],[n])}},{key:R,value:function(t){var e=t.annot,n=t.isStart,r=t.oldStyle,o=t.newStyle,i=this.pdfViewer;function a(t){return function(){var r=te(i,e);return r&&r.annot.setCalloutLineEndingStyle?r.annot.setCalloutLineEndingStyle(+t).then(function(){r.redraw(),r.activeRect()}):r&&r.annot.setEndingStyle(n,+t).then(function(){r.redraw(),r.activeRect()})}}return{undo:a(r),redo:a(o)}}},{key:pt,value:function(t){var e=t.annot,n=t.oldEndPoint,r=t.newEndPoint;return this._common_interpreter(e,"setEndPoint",[r],[n])}},{key:vt,value:function(t){var e=t.annot,n=t.oldStartPoint,r=t.newStartPoint;return this._common_interpreter(e,"setStartPoint",[r],[n])}},{key:yt,value:function(t){var e=t.annot,n=t.oldStyleFillColor,r=t.newStyleFillColor;return this._common_interpreter(e,"setStyleFillColor",[r],[n])}},{key:gt,value:function(t){var e=t.annot,n=t.newLength,r=t.oldLength;return this._common_interpreter(e,"setLeaderLineExtend",[n],[r])}},{key:mt,value:function(t){var e=t.annot,n=t.newOffset,r=t.oldOffset;return this._common_interpreter(e,"setLeaderLineOffset",[n],[r])}},{key:kt,value:function(t){var e=t.annot,n=t.newLength,r=t.oldLength;return this._common_interpreter(e,"setLeaderLineLength",[n],[r])}},{key:bt,value:function(t){var e=t.annot,n=t.newOffset,r=t.oldOffset;return this._common_interpreter(e,"setCaptionOffset",[n.x,n.y],[r.x,r.y])}},{key:N,value:function(t){var e=t.annot,n=t.oldEnableCaption,r=t.newEnableCaption;return this._common_interpreter(e,"enableCaption",[r],[n])}},{key:x,value:function(t){var e=t.annot,n=t.oldRotation,r=t.newRotation,o=t.oldRect,i=t.newRect,a=this.pdfViewer;function u(t,n){return function(){return k(function(){var r,o;return b(this,function(i){switch(i.label){case 0:return[4,ee(a,e)];case 1:return r=i.sent(),o=te(a,e),"screen"===r.getType()?[2,r.setRect(n).then(function(e){if(e)return r.setRotation((t+360)%360).then(function(){o&&o.activeRect()})})]:[2,r.setRotation((t+360)%360).then(function(){o&&o.activeRect()})]}})})()}}return{undo:u(n,o),redo:u(r,i)}}},{key:P,value:function(t){var e=t.annot,n=t.oldHlMode,r=t.newHlMode,o=this.pdfViewer;function i(t){return function(){return k(function(){return b(this,function(n){switch(n.label){case 0:return[4,ee(o,e)];case 1:return[2,n.sent().setHighlightingMode(t)]}})})()}}return{undo:i(n),redo:i(r)}}},{key:C,value:function(t){var e=Gt(t,2),n=e[0],r=e[1],o=this.pdfViewer;return{undo:ne(o,n,r),redo:re(r,o)}}},{key:_,value:function(t){var e=t.annot,n=this.pdfViewer,r=[e],o=e.getPopup&&e.getPopup();return o&&!o.isEmpty()&&r.push(o),e.isReplace&&e.isReplace()&&(r=e.getGroupElements().map(function(t){return t})).push(e.getGroupHeader().getPopup()),{undo:re(e,n),redo:ne(n,r,e),annot:e}}},{key:L,value:function(t){var e=t.annot,n=t.oldStart,r=t.oldEnd,o=t.newStart,i=t.newEnd,a=this.pdfViewer;function u(t,n){return function(){var r=te(a,e);return r&&r.annot.updateQuadPointsByCharIndex(t,n).then(function(){if(r.redraw(),r.isReplace)return r.caretAnnot.moveRectByCharIndex(n).then(function(){r.getGroupRenders().map(function(t){t.active()})});r.active()})}}return{undo:u(n,r),redo:u(o,i)}}},{key:D,value:function(t){var e=t.annot,n=t.oldRect,r=t.newRect,o=t.oldInnerRect,i=t.newInnerRect,a=this.pdfViewer;function u(t,n){return function(){var r=te(a,e);return n?r&&r.annot.setRectAndInnerRect(t,n).then(function(){r.redraw(),r.active()}):r&&r.annot.setRect(t).then(function(){r.redraw(),r.active()})}}return{undo:u(n,o),redo:u(r,i)}}},{key:U,value:function(t){var e=t.annot,n=t.originRect,r=t.newRect,o=this.pdfViewer;function i(t){return function(){return k(function(){var n,r,i,a;return b(this,function(u){switch(u.label){case 0:return(n=te(o,e))?[4,e.getBorderStyle()]:[2,Promise.resolve()];case 1:return r=u.sent(),[4,e.getCloudIntensity()];case 2:return i=u.sent(),[4,e.getBorderWidth()];case 3:return a=u.sent(),r!==Jt.CLOUDY?[3,6]:[4,e.setBorderStyle(0)];case 4:return u.sent(),[4,e.setBorderWidth(0)];case 5:u.sent(),u.label=6;case 6:return[4,e.setRect(t)];case 7:return u.sent(),r!==Jt.CLOUDY?[3,10]:[4,e.setBorderStyle(r,i)];case 8:return u.sent(),[4,e.setBorderWidth(a)];case 9:u.sent(),u.label=10;case 10:return n.redraw(),n.active(),[2]}})})()}}return{undo:i(n),redo:i(r)}}},{key:V,value:function(t){var e=t.annot,n=t.originLeft,r=t.originTop,o=t.left,i=t.top,a=this.pdfViewer;function u(t,n){return function(){var r=te(a,e);return r&&r.annot?r.annot.moveTo({left:t,top:n}).then(function(){r.redraw(),r.active()}):Promise.resolve()}}return{undo:u(n,r),redo:u(o,i)}}},{key:F,value:function(t){var e=t.annot,n=t.oldRect,r=t.oldCalloutLinePoints,o=t.oldInnerRect,i=t.newRect,a=t.newCalloutLinePoints,u=t.newInnerRect,c=this.pdfViewer;function s(t,n,r){return function(){var o=te(c,e);return o&&o.annot.updateCalloutFigure(t,r,n).then(function(){o.redraw(),o.active()})}}return{undo:s(n,r,o),redo:s(i,a,u)}}},{key:M,value:function(t){var e=t.annot,n=t.oldStartPoint,r=t.oldEndPoint,o=t.newStartPoint,i=t.newEndPoint,a=this.pdfViewer;function u(t,n){return function(){var r=te(a,e);if(!r)return Promise.resolve();var o=[];return o.push(r.annot.setStartPoint(t)),o.push(r.annot.setEndPoint(n)),Promise.all(o).then(function(){r.active()})}}return{undo:u(n,r),redo:u(o,i)}}},{key:B,value:function(t){var e=t.annot,n=t.oldLeaderLinePoints,r=t.oldStartPoint,o=t.oldEndPoint,i=t.newLeaderLinePoints,a=t.newStartPoint,u=t.newEndPoint,c=this.pdfViewer;function s(t,n,r){var o=t.start,i=(t.end,Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2))),a=!0;return(r.x-n.x)*(o.y-r.y)-(o.x-r.x)*(r.y-n.y)>0&&(a=!1),a&&(i=-i),function(){var t=te(c,e);return t&&t.annot.setLeaderLineLength(i).then(function(){t.active()})}}return{undo:s(n,r,o),redo:s(i,a,u)}}},{key:H,value:function(t){var e=t.annot,n=t.oldVertexes,r=t.oldIndex,o=t.newVertexes,i=t.newIndex,a=this.pdfViewer;function u(t,n){return function(){var r=te(a,e);return r&&r.annot.updateVertexes(t,n[t]).then(function(){r.active()})}}return{undo:u(r,n),redo:u(i,o)}}},{key:wt,value:function(t){var e=t.annot,n=t.newVertexes,r=t.oldVertexes;return this._common_interpreter(e,"setVertexes",[n],[r])}},{key:G,value:function(t){var e=t.annot,n=t.oldContent,r=t.newContent,o=t.oldInnerRect,i=t.newInnerRect,a=t.oldRect,u=t.newRect,c=t.oldCalloutLinePoints,s=t.newCalloutLinePoints,l=this.pdfViewer,f=e.getId(),d=[];l.recordsMap[f]?d=l.recordsMap[f]:(l.recordsMap[f]=d,d.push({modifyDate:e.getCreateDateTime(),content:n}));var h=d.findIndex(function(t){return t.content===n});function p(t,n,r,o){return function(){return ee(l,e).then(function(e){return e.setContent(t).then(function(){var i=(l.recordsMap[e.getId()]||[]).map(function(i){if(i.content===t)return r?e.setRect(r).then(function(){return n&&e.setInnerRect(n).then(function(){return o&&e.setCalloutLinePoints(o).then(function(){var t=te(l,e);if(t)return t.redraw(),t.active(),e._setModifiedDateTime(i.modifyDate)})})}):e._setModifiedDateTime(i.modifyDate)});return Promise.all(i)})})}}return-1!==h&&(d.length=h+1),d.push({modifyDate:e.getModifiedDateTime(),content:r}),{undo:p(n,o,a,c),redo:p(r,i,u,s)}}},{key:z,value:function(t){var e=t.redacts,n=this.pdfViewer,r=e.map(function(t){var e=t.getPopup&&t.getPopup();return e&&!e.isEmpty()?[t,e]:[t]});return{undo:function(){return Promise.all(e.map(function(t){return t.getPDFPage().removeAnnot(t)}))},redo:function(){return Promise.all(r.map(function(t){if(!(t.length<1))return t[0].page.addAnnotObjects(t.map(function(t){return t.objectNumber})).then(function(e){n.killFocus();var r=te(n,t[0]);r&&r.active()})}))}}}},{key:W,value:function(t){var e=t.annot,n=t.replyAnnot,r=this.pdfViewer;return{undo:ie(e,ae(n),r),redo:oe(e,ae(n),r)}}},{key:q,value:function(t){var e=t.annot,n=t.replyAnnot,r=this.pdfViewer;return{undo:oe(e,ae(n),r),redo:ie(e,ae(n),r)}}},{key:Y,value:function(t){var e=t.annot,n=t.param,r=this.pdfViewer;function o(t,e,n,r){return function(){te(r,n);var o=e.trigger,i=e.action,a=e.append;switch(t){case Dt:return n.setAction(i,o,a);case Vt:var u=Xt(n.getAction(o));return i=u[u.length-1],n.removeAction(o,i)}}}return{undo:o(Vt,n,e,r),redo:o(Dt,n,e,r)}}},{key:$,value:function(t){var e=t.annot,n=t.param,r=this.pdfViewer;function o(t,e,n,r){return function(){te(r,n);var o=e.trigger,i=e.index,a=e.oldActions,u="screen"==n.getType()?n.getAdditionalAction(o):n.getAction(o);switch(t){case Dt:if(i>-1)return 0==i?n.removeAction(o).then(function(t){var e=[];return a.forEach(function(t){e.push(n.setAction(t,o,!0))}),Promise.all(e)}):u.insertSubAction(i-1,a[i].info);var c=[];return a.forEach(function(t){c.push(n.setAction(t,o,!0))}),Promise.all(c);case Vt:var s=Xt(u);return n.removeAction(o,s[i])}}}return{undo:o(Dt,n,e,r),redo:o(Vt,n,e,r)}}},{key:X,value:function(t){var e=t.annot,n=t.moveInfo,r=this.pdfViewer;function o(t){return function(){var n=te(r,e);return n&&n.annot.moveAction(t)}}return{undo:o(Object.assign({},n,{direction:!n.direction})),redo:o(n)}}},{key:K,value:function(t){var e=t.annot,n=t.action,r=t.oldData,o=t.newData,i=this.pdfViewer;function a(t,n){return function(){var r=te(i,e);return r&&r.annot.setActionData(t,n)}}return{undo:a(n,r),redo:a(n,o)}}},{key:J,value:function(t){var e=t.beforeInks,n=t.afterInks,r=this.pdfViewer;return{undo:function(){var t=e.map(function(t,e){var o=t.annot,i=t.inkList;if(t.isRemove)return ne(r,[n[e].annot],o,!1)().then(function(t){var e=te(r,o);return e&&e.annot.setInkList(i)});var a=te(r,o);return a&&a.annot.setInkList(i)});return Promise.all(t)},redo:function(){var t=n.map(function(t){var e=t.annot;t.inkList;if(t.isRemove)return re(e,r)();var n=te(r,t.annot);return n&&n.annot.setInkList(t.inkList)});return Promise.all(t)}}}},{key:Q,value:function(t){var e=t.annot,n=this.pdfViewer,r=[e],o=e.getPopup();return o&&!o.isEmpty()&&r.push(o),{undo:re(e,n),redo:ne(n,r,e)}}},{key:Z,value:function(t){var e=t.redacts,n=this.pdfViewer,r=[];return e.map(function(t){r.push(new Wt(t).getJson())}),{undo:function(){return Promise.all(e.map(function(t){return t.getPDFPage().removeAnnot(t)}))},redo:ne(n,e,e[0])}}},{key:tt,value:function(t){var e=t.redacts,n=this.pdfViewer,r=[];return e.map(function(t){r.push(new Wt(t).getJson())}),{undo:function(){return Promise.all(e.map(function(t){return t.getPDFPage().removeAnnot(t)}))},redo:ne(n,e,e[0])}}},{key:et,value:function(t){var e=t.annot,n=t.stateName,r=this.pdfViewer,o=e.getPDFPage(),i=e.getObjectNumber(),a=e.getReviewStates().find(function(t){return t.info.state===n});return{undo:function(){return o.getAnnotsByObjectNumArray([i]).then(function(t){return t[0]&&t[0].removeReviewState()})},redo:function(){return o.getAnnotsByObjectNumArray([i]).then(function(t){return function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=n[0].page;return i.addReviewStateAnnotObject(e,n.map(function(t){return t.objectNumber})).then(function(e){t.killFocus();var n=te(t,r);o&&n&&n.active()})}(r,t[0],[a],a)})}}}},{key:nt,value:function(t){var e=t.annot,n=t.stateName,r=this.pdfViewer,o=e.getMarkedStates().find(function(t){return t.info.state===n});function i(t){return e.page.getAnnotsByObjectNumArray([t]).then(function(t){return Gt(t,1)[0]})}return{undo:function(){return i(e.objectNumber).then(function(t){return t.removeMarkedState()})},redo:function(){return i(e.objectNumber).then(function(t){return function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return n[0].page.addMarkedStateAnnotObject(e,n.map(function(t){return t.objectNumber}),!0,!0).then(function(e){t.killFocus();var n=te(t,r);o&&n&&n.active()})}(r,t,[o],o)})}}}},{key:rt,value:function(t){var e=t.annot,n=t.oldDA,r=t.newDA,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setDefaultAppearance(t).then(function(){n.active()})}}return{undo:i(n),redo:i(r)}}},{key:ot,value:function(t){var e=t.srcPage,n=t.destPage,r=t.annots,o=this.pdfViewer.getCurrentPDFDoc(),i=Object.keys(r).reduce(function(t,e){var n=r[e];return t[e]={rect:n.oldRect,oldRect:n.rect},t},{});return{undo:function(){return o.moveAnnotsToPage(n,e,i,!0)},redo:function(){return o.moveAnnotsToPage(e,n,r,!0)}}}},{key:it,value:function(t){var e=t.annot,n=t.oldCaptionOffset,r=t.newCaptionOffset,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setCaptionOffset(t.x,t.y).then(function(){n.active()})}}return{undo:i(n),redo:i(r)}}},{key:at,value:function(t){var e=this,n=t.page,r=t.annotIds,o=t.isGroup;return{undo:function(){e.pdfViewer.killFocus(),n.handleGroupMarkup(r,!o)},redo:function(){e.pdfViewer.killFocus(),n.handleGroupMarkup(r,o)}}}},{key:ct,value:function(t){var e=t.annot,n=t.oldIconName,r=t.newIconName;return this._common_interpreter(e,"setIconName",[r],[n])}},{key:At,value:function(t){var e=t.annot,n=t.oldAlignment,r=t.newAlignment;return this._common_interpreter(e,"setAlignment",[r],[n])}},{key:St,value:function(t){var e=t.annot,n=t.oldInnerRect,r=t.newInnerRect;return this._common_interpreter(e,"setInnerRect",[r],[n])}},{key:st,value:function(t){var e=t.annot,n=t.oldFlag,r=t.newFlag,o=this.pdfViewer;function i(t){return function(){var n=te(o,e);return n&&n.annot.setFlags(t)}}return{undo:i(n),redo:i(r)}}},{key:Ot,value:function(t){var e=t.annot,n=t.newStyle,r=t.oldStyle;return this._common_interpreter(e,"setCalloutLineEndingStyle",[n],[r])}},{key:Et,value:function(t){var e=t.annot,n=t.newAp,r=t.oldAp;return this._common_interpreter(e,"setDefaultAppearance",[n],[r])}},{key:It,value:function(t){var e=t.annot,n=t.oldInkList,r=t.newInkList;return this._common_interpreter(e,"setInkList",[r],[n])}},{key:Tt,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,function(t,e){return"string"==typeof e?t.setOverlayText(e):t.removeOverlayText()},[n],[r])}},{key:jt,value:function(t){var e=t.annot,n=t.oldValue;return this._common_interpreter(e,function(t,e){return"string"==typeof e?t.setOverlayText(e):t.removeOverlayText()},[],[n])}},{key:Rt,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setOverlayTextAlignment",[n],[r])}},{key:Nt,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setRepeat",[n],[r])}},{key:xt,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setAutoFontSize",[n],[r])}},{key:Pt,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setRedactApplyFillColor",[n],[r])}},{key:Ct,value:function(t){var e=t.annot,n=t.newValue,r=t.oldValue;return this._common_interpreter(e,"setImage",[n],[r])}},{key:_t,value:function(t){var e=t.annot,n=t.newIndex,r=t.oldIndex,o=t.orderType,i=o;return[Qt.prev,Qt.next].includes(o)&&(i=o===Qt.prev?Qt.next:Qt.prev),this._common_interpreter(e,function(t,e,n){return[Qt.prev,Qt.next].includes(n)?t.page.changeAnnotOrder(n,t):(e>t.getIndex()&&"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()&&(e+=2),t.page.moveAnnotOrder(t,e))},[n,o],[r,i])}},{key:"_common_interpreter",value:function(t,e,n,r){var o=this.pdfViewer;function i(n){return function(){return k(function(){var r,i,a,u;return b(this,function(c){switch(c.label){case 0:return(i=te(o,t))?(u=i.annot,[3,3]):[3,1];case 1:return[4,ee(o,t)];case 2:u=c.sent(),c.label=3;case 3:return a=u,"function"==typeof e?[2,e.apply(void 0,[a].concat(y(n)))]:[2,(r=a)[e].apply(r,y(n))]}})})()}}return{undo:i(r),redo:i(n)}}}]),t}();function te(t,e){var n=t.getAnnotRender(e.page.getIndex(),e.objectNumber);return n?n.component:null}function ee(t,e){return t.getCurrentPDFDoc().getPageByIndex(e.page.getIndex()).then(function(t){return t.getAnnotsByObjectNumArray([e.objectNumber]).then(function(t){return t[0]})})}function ne(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(e.length<1)){var o=e[0].page;return function(){return o.addAnnotObjects(e.map(function(t){return t.objectNumber})).then(function(e){t.killFocus();var o=te(t,n);r&&o&&o.active()})}}}function re(t,e){return function(){e.activeElement();var n=te(e,t),r=n&&n.annot&&n.annot.getPDFPage().removeAnnot(n.annot);return r||(r=t&&t.getPDFPage().removeAnnot(t)),r&&r.then(function(t){var r=e.getCurrentActivatable();return r&&r.remove&&r.remove(n),t})}}function oe(t,e,n){return function(){var n=t.page;return n.addAnnotObjects([e.objectNumber],!1).then(function(r){t=n.annotIdMap[t.objectNumber];var o=e.reviewStates;if(o.length>0){var i=[];o.map(function(t){i.push(t.info.state)}),function(t,e){var n=new Kt;e.forEach(function(e){n.exec(function(){return t.addReviewState(e)})}),n.waitForCurrentRunningTasks()}(r[0],i)}t.info.repliesSummary.some(function(t){return t.objectNumber==e.objectNumber})||(t.info.repliesSummary.push({objectNumber:r[0].info.objectNumber,id:r[0].info.objectNumber,index:r[0].info.index}),t.replies.push(r[0])),n.doc.engine.eventEmitter.emit("annotation-reply-add",r[0],t),n.doc.engine.eventEmitter.emit("annotation-updated",[t],n,"add-replies")})}}function ie(t,e,n){return function(){return t.getPDFPage().removeAnnot(e)}}function ae(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(e.has(t))return e.get(t);var n=Object.create(t,{info:{value:$t()(t.info)}});e.set(t,n);var r=function(r){Object.defineProperty(n,r,{value:t[r].map(function(t){return ae(t,e)})})};return r("reviewStates"),r("markedStates"),r("replies"),r("groupElements"),n}var ue=function(){function t(e){c(this,t),this.pdfViewer=e}return l(t,[{key:"add",value:function(t,e){this[t]=e}}]),t}();function ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function se(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ce(t,e,n[e])})}return t}function le(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}var fe=function(){function t(e){c(this,t),this.pdfViewer=e}return l(t,[{key:"add",value:function(t){return{undo:ve(this.pdfViewer,t),redo:pe(this.pdfViewer,t)}}},{key:"remove",value:function(t){return he.push(t.bookmark.id),{undo:pe(this.pdfViewer,t),redo:ve(this.pdfViewer,t)}}},{key:"rename",value:function(t){var e=t.bookmark,n=t.newName,r=t.oldName;return{undo:ye(this.pdfViewer,{bookmark:e,name:r}),redo:ye(this.pdfViewer,{bookmark:e,name:n})}}},{key:"addV2",value:function(t){var e=t.bookmarkId,n=t.data;return{undo:me(this.pdfViewer,{bookmarkId:e}),redo:ge(this.pdfViewer,{bookmarkId:e,data:n})}}},{key:"removeV2",value:function(t){var e=t.bookmarkId,n=t.data;return{undo:ge(this.pdfViewer,{bookmarkId:e,data:n}),redo:me(this.pdfViewer,{bookmarkId:e})}}},{key:"renameV2",value:function(t){var e=t.bookmarkId,n=t.newTitle,r=t.oldTitle;return{undo:ke(this.pdfViewer,{bookmarkId:e,title:r}),redo:ke(this.pdfViewer,{bookmarkId:e,title:n})}}},{key:"setColorV2",value:function(t){var e=t.bookmarkId,n=t.newColor,r=t.oldColor;return{undo:we(this.pdfViewer,{bookmarkId:e,color:r}),redo:we(this.pdfViewer,{bookmarkId:e,color:n})}}},{key:"setDestinationV2",value:function(t){var e=t.bookmarkId,n=t.newDestination,r=t.oldDestination;return{undo:Ae(this.pdfViewer,{bookmarkId:e,destination:r}),redo:Ae(this.pdfViewer,{bookmarkId:e,destination:n})}}},{key:"setStyleV2",value:function(t){var e=t.bookmarkId,n=t.newStyle,r=t.oldStyle;return{undo:be(this.pdfViewer,{bookmarkId:e,style:r}),redo:be(this.pdfViewer,{bookmarkId:e,style:n})}}},{key:"setColor",value:function(t){var e=t.bookmark,n=t.newColor,r=t.oldColor;return{undo:Oe(this.pdfViewer,{bookmark:e,style:r}),redo:Oe(this.pdfViewer,{bookmark:e,style:n})}}},{key:"setStyle",value:function(t){var e=t.bookmark,n=t.newStyle,r=t.oldStyle;return{undo:Se(this.pdfViewer,{bookmark:e,style:r}),redo:Se(this.pdfViewer,{bookmark:e,style:n})}}},{key:"clear",value:function(){de={},he=[]}}]),t}(),de={},he=[];function pe(t,e){var n=e.bookmark,r=n.id,o=n.page,i=n.left||0,a=n.top||0,u=n.title,c=Object.assign([],n.children),s=e.siblingBookmark,l=s.id,f=e.position;return function(){n=de[r]||n,s=de[l]||s,u=n.title,c=c.filter(function(t){return-1===he.indexOf(t.id)}),s.insertBookmark(u,o,a,i,f).then(function(e){Ee(r,e),Ee(e.id,e),r=e.id,c.forEach(function(n){pe(t,{bookmark:n,siblingBookmark:e})()})})}}function ve(t,e){var n=e.bookmark,r=n.id,o=n.parent.children;return function(){if(n=de[r]||n,r=n.id,n){he.push(r),n.remove();for(var t=0;t<o.length;t++){if(o[t].id===n.id){o.splice(t,1);break}}}}}function ye(t,e){var n=e.bookmark,r=n.id,o=e.name;return function(){(n=de[r]||n)&&n.setProperty({title:o},!1).then(function(e){Ee(n.id,e),Ee(r,e),t.eventEmitter.emit("bookmark-update-attr",n.id,{name:o})})}}function ge(t,e){var n=e.bookmarkId,r=e.data;return function(){return k(function(){var e,o;return b(this,function(i){return e=t.getBookmarkDataService(),o=le(se({},r),{newBookmarkId:n,children:(r.children||[]).map(function t(e){return{newBookmarkId:e.id,title:e.title,destination:se({},e.destination),color:e.color,style:e.style,children:(e.children||[]).map(t)}})}),[2,e.addBookmark(o)]})})()}}function me(t,e){var n=e.bookmarkId;return function(){return k(function(){return b(this,function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().deleteBookmark(n)];case 1:return e.sent(),[2]}})})()}}function ke(t,e){var n=e.bookmarkId,r=e.title;return function(){return k(function(){return b(this,function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().renameBookmark(n,r)];case 1:return e.sent(),[2]}})})()}}function be(t,e){var n=e.bookmarkId,r=e.style;return function(){return k(function(){return b(this,function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setFontStyle(n,r)];case 1:return e.sent(),[2]}})})()}}function we(t,e){var n=e.bookmarkId,r=e.color;return function(){return k(function(){return b(this,function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setColor(n,r)];case 1:return e.sent(),[2]}})})()}}function Ae(t,e){var n=e.bookmarkId,r=e.destination;return function(){return k(function(){return b(this,function(e){switch(e.label){case 0:return[4,t.getBookmarkDataService().setDestination(n,r)];case 1:return e.sent(),[2]}})})()}}function Se(t,e){var n=(null==t?void 0:t.getCurrentPDFDoc()).bookmarkAPI,r=e.bookmark,o=r.id,i=Gt(e.style,2),a=i[0],u=i[1];return function(){r=de[o]||r,n.setProperties(o,{style:{italic:a,bold:u}},!1).then(function(){r.style.italic=a,r.style.bold=u,Ee(o,r),t.eventEmitter.emit("bookmark-update-attr",r.id,{isBold:u,isItalic:a})})}}function Oe(t,e){var n=(null==t?void 0:t.getCurrentPDFDoc()).bookmarkAPI,r=e.bookmark,o=r.id,i=e.style;return function(){r=de[o]||r,n.setProperties(o,{color:i}).then(function(){r.color=i,Ee(o,r),t.eventEmitter.emit("bookmark-update-attr",r.id,{color:i})})}}function Ee(t,e){var n=de[t];if(de[t]=e,n)for(var r in de){de[r].id===n.id&&(de[r]=e)}}var Ie=function(){function t(e){c(this,t),this.pdfViewer=e,this.fileNameObjNumMapping={}}return l(t,[{key:"add",value:function(t){return{undo:Re(this.pdfViewer,t),redo:je(this.pdfViewer,t)}}},{key:"remove",value:function(t){return{undo:je(this.pdfViewer,t),redo:Re(this.pdfViewer,t)}}},{key:"setDesc",value:function(t){var e=t.fileName,n=t.description,r=t.objNum,o=t.annot;return Te[e=(o?"annot_":"")+e]||(Te[e]={objNum:r,description:n}),{undo:Ne(this.pdfViewer,{fileName:t.fileName,objNum:t.objNum,description:t.descriptionOld,annot:o}),redo:Ne(this.pdfViewer,{fileName:t.fileName,objNum:t.objNum,description:t.description,annot:o})}}},{key:"replace",value:function(t){var e=this,n=this.pdfViewer.currentPDFDoc,r=t.oldFile,o=r.fileName,i=r.objNum,a=r.description,u=t.objNum;return{undo:function(){n.setEmbeddedFileByAttachments(o,i).then(function(){a&&Ne(e.pdfViewer,{fileName:o,objNum:i,description:a})})},redo:function(){n.setEmbeddedFileByAttachments(o,u)}}}},{key:"clear",value:function(){Te={}}}]),t}(),Te={};function je(t,e){var n=e.fileName;return Te[n]||(Te[n]={}),e.hasOwnProperty("objNum")&&(Te[n].objNum=e.objNum),e.hasOwnProperty("fileBuffer")&&(Te[n].fileBuffer=e.fileBuffer),function(){var e=t.currentPDFDoc,r=Te[n],o=r.fileBuffer,i=r.description;return e.addFileSpec(n,o,new Date).then(function(t){return Te[n].objNum=t,e.addEmbeddedFileByAttachments(n,t).then(function(){return i&&e.setFileSpecDesc(i,t)})})}}function Re(t,e){var n=e.fileName;return function(){t.currentPDFDoc.removeEmbeddedFileByAttachments(n)}}function Ne(t,e){var n,r,o=e.fileName,i=e.description,a=e.annot,u=e.objNum;return a&&(n=a.getPage().getIndex(),r=a.getObjectNumber(),o="annot_"+o),function(){var e=Te[o];t.currentPDFDoc.setFileSpecDesc(i,e.objNum||u).then(function(){if(Te[o].description=i,r){var e=t.getAnnotRender(n,r),a=e&&e.annot;a&&a.setContent(i).then(function(){return a.update()})}})}}var xe=function(){function t(e){c(this,t),this.pdfViewer=e}return l(t,[{key:"rotate",value:function(t){var e={},n={};for(var r in t){var o=t[r],i=o.from,a=o.to;e[r]=i,n[r]=a}return{undo:Pe(this.pdfViewer,e),redo:Pe(this.pdfViewer,n)}}},{key:"clear",value:function(){}}]),t}();function Pe(t,e){return function(){for(var n in e){var r=e[n];t.getPDFDocRender().getPDFPageRender(n).page.setRotation(r),t.collaborate("ppo-rotate-page",{pageIndex:n,angle:90*r})}}}var Ce="onUndoRedo",_e=function(){function t(e){c(this,t),this.action=e,this.json={};var n=e.type;this[n]&&this[n]()}return l(t,[{key:"TypeGoto",value:function(){var t=this.action.destination;this.json=Object.assign(t,{type:t.zoomMode})}},{key:"TypeURI",value:function(){var t=this.action.uri;this.json=Object.assign({},{uri:t})}},{key:"TypeJavaScript",value:function(){var t=this.action.javascript;this.json=Object.assign({},{script:t})}},{key:"TypeNamed",value:function(){var t=this.action.name;this.json=Object.assign({},{name:t})}},{key:"TypeHide",value:function(){var t=this.action,e=t.fieldNames,n=t.hideState;this.json=Object.assign({},{fieldNames:e,hideState:n})}},{key:"TypeSubmitForm",value:function(){var t=this.action,e=t.flags,n=t.url,r=t.fieldNames;this.json=Object.assign({},{flags:e,url:n,fieldNames:r})}},{key:"TypeResetForm",value:function(){var t=this.action,e=t.flags,n=t.fieldNames;this.json=Object.assign({},{flags:e,fieldNames:n})}},{key:"TypeGoToR",value:function(){var t=this.action,e=t.destinationName,n=t.destination;this.json=Object.assign({},{destinationName:e,destination:n})}},{key:"TypeLaunch",value:function(){var t=this.action.fileSpec;this.json=Object.assign({},{fileSpec:t})}},{key:"toJson",value:function(){return this.json}}]),t}(),De=function(){function t(e,n){c(this,t),ce(this,"controller",void 0),ce(this,"annot",void 0),ce(this,"manager",void 0),this.controller=e,this.annot=n,this.manager=e.annotUndoRedoManager}return l(t,[{key:"handleSetTitle",value:function(t){var e=this,n=this.annot.getTitle();return t().then(function(t){var r=e.annot.getTitle();return n!==r&&e.manager.pushUndoStack(e.annot,w,{annot:e.annot,oldTitle:n,newTitle:r}),t})}},{key:"handleSetSubject",value:function(t){var e=this,n=this.annot.getSubject();return t().then(function(t){var r=e.annot.getSubject();return n!==r&&e.manager.pushUndoStack(e.annot,A,{annot:e.annot,oldSubject:n,newSubject:r}),t})}},{key:"handleSetColor",value:function(t){var e=this,n=this.annot.getBorderColor();return t().then(function(t){var r=e.annot.getBorderColor();return n!==r&&e.manager.pushUndoStack(e.annot,S,{annot:e.annot,oldColor:n,newColor:r}),t})}},{key:"handleSetOpacity",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;n&&r&&r.oldValue!==r.commitValue&&this.manager.pushUndoStack(this.annot,O,{annot:this.annot,oldOpacity:r.oldValue,newOpacity:r.commitValue});var o=this.annot.getOpacity();return t().then(function(t){var i=e.annot.getOpacity();return n&&!r&&o!==i&&e.manager.pushUndoStack(e.annot,O,{annot:e.annot,oldOpacity:o,newOpacity:i}),t})}},{key:"handleSetFillColor",value:function(t){var e=this,n=this.annot.getStyleFillColor||this.annot.getFillColor,r=n.call(this.annot);return t().then(function(t){var o=n.call(e.annot);return r!==o&&e.manager.pushUndoStack(e.annot,E,{annot:e.annot,oldFillColor:r,newFillColor:o}),t})}},{key:"handleSetBorderWidth",value:function(t,e,n){var r=this;e&&n&&n.oldValue!==n.commitValue&&this.manager.pushUndoStack(this.annot,I,{annot:this.annot,oldBorderWidth:n.oldValue,newBorderWidth:n.commitValue});var o=this.annot.getBorderWidth();return t().then(function(t){var i=r.annot.getBorderWidth();return e&&!n&&o!==i&&r.manager.pushUndoStack(r.annot,I,{annot:r.annot,oldBorderWidth:o,newBorderWidth:i}),t})}},{key:"handleSetBorderStyle",value:function(t){var e=this,n=this.annot.getBorderStyleWithParam();return t().then(function(t){var r=e.annot.getBorderStyleWithParam();return n!==r&&e.manager.pushUndoStack(e.annot,T,{annot:e.annot,oldBorderStyle:n,newBorderStyle:r}),t})}},{key:"handleSetBorderInfo",value:function(t){var e=this,n=this.annot.getBorderInfo();return this.annot.setBorderInfo(t).then(function(t){var r=e.annot.getBorderInfo();return e.manager.pushUndoStack(e.annot,j,{annot:e.annot,oldBorderInfo:n,newBorderInfo:r}),t})}},{key:"handleFlip",value:function(t,e){var n=this;return t().then(function(t){return n.controller.create("annot",ut,{annot:n.annot},e),t})}},{key:"handleSetEndingStyle",value:function(t,e,n){var r,o=this,i=(r=e?this.annot.getStartStyle||this.annot.getCalloutLineEndingStyle:this.annot.getEndingStyle).call(this.annot);return t().then(function(t){var a=r.call(o.annot);return o.controller.create("annot",R,{annot:o.annot,isStart:e,oldStyle:i,newStyle:a},n),t})}},{key:"handleEnableCaption",value:function(t){var e=this,n=this.annot.hasCaption();return t().then(function(t){var r=e.annot.hasCaption();return n!==r&&e.manager.pushUndoStack(e.annot,N,{annot:e.annot,oldEnableCaption:n,newEnableCaption:r}),t})}},{key:"handleSetRotation",value:function(t){var e=this,n=this.annot.getRotation(),r=this.annot.getRect();return t().then(function(t){var o=e.annot.getRotation(),i=e.annot.getRect();return e.manager.pushUndoStack(e.annot,x,{annot:e.annot,oldRotation:n,newRotation:o,oldRect:r,newRect:i}),t})}},{key:"handleSetHighlightingMode",value:function(t){var e=this,n=this.annot.getHighlightingMode();return t().then(function(t){var r=e.annot.getHighlightingMode();return e.manager.pushUndoStack(e.annot,P,{annot:e.annot,oldHlMode:n,newHlMode:r}),t})}},{key:"handleSetContent",value:function(t){var e=this,n=this.annot.getContent(),r=this.annot.getInnerRect&&this.annot.getInnerRect(),o=this.annot.getRect(),i=this.annot.getCalloutLinePoints&&this.annot.getCalloutLinePoints();return t().then(function(t){var a=e.annot.getContent();if(a!==n)if("freetext"===e.annot.getType()){var u=e.annot.getInnerRect(),c=e.annot.getRect(),s=e.annot.getCalloutLinePoints();e.manager.pushUndoStack(e.annot,G,{annot:e.annot,oldContent:n,newContent:a,oldInnerRect:r,newInnerRect:u,oldRect:o,newRect:c,oldCalloutLinePoints:i,newCalloutLinePoints:s})}else e.manager.pushUndoStack(e.annot,G,{annot:e.annot,oldContent:n,newContent:a});return t})}},{key:"handlePlaceRedact",value:function(t){var e=this;return t().then(function(t){var n=t.flat().flat().flat().filter(function(t){return"redact"===t.getType()});return e.manager.pushUndoStack(e.annot,z,{redacts:n}),t})}},{key:"handleSetDefaultAppearance",value:function(t){var e=this,n=this.annot.getDefaultAppearance();return t().then(function(t){var r=e.annot.getDefaultAppearance();e.manager.pushUndoStack(e.annot,rt,{annot:e.annot,oldDA:n,newDA:r})})}},{key:"handleSetFlags",value:function(t){var e=this,n=this.annot.getFlags();return t().then(function(t){var r=e.annot.getFlags();e.manager.pushUndoStack(e.annot,st,{annot:e.annot,oldFlag:n,newFlag:r})})}},{key:"handleSetAction",value:function(t,e,n,r){var o=this;return t().then(function(t){o.manager.pushUndoStack(o.annot,Y,{annot:o.annot,param:{action:e,trigger:n,append:r}})})}},{key:"handleRemoveAction",value:function(t,e,n){var r=this,o=Xt("screen"==this.annot.getType()?this.annot.getAdditionalAction(e):this.annot.getAction()),i=-1;return n&&(i=o.findIndex(function(t){return t.info.objNumber===n.info.objNumber})),t().then(function(t){r.manager.pushUndoStack(r.annot,$,{annot:r.annot,param:{trigger:e,index:i,oldActions:o}})})}},{key:"handleMoveAction",value:function(t){var e=this;return this.annot.moveAction(t).then(function(n){e.manager.pushUndoStack(e.annot,X,{annot:e.annot,moveInfo:t})})}},{key:"handleSetActionData",value:function(t,e){var n=this,r=new _e(t.info).toJson();return this.annot.setActionData(t,e).then(function(o){n.manager.pushUndoStack(n.annot,K,{annot:n.annot,action:t,oldData:r,newData:e})})}},{key:"handleSetRect",value:function(t){var e=this,n=this.annot.getRect(),r=this.annot.getInnerRect();return this.annot.setRect(t).then(function(){e.manager.pushUndoStack(e.annot,D,{annot:e.annot,oldRect:n,oldInnerRect:r,newRect:e.annot.getRect(),newInnerRect:e.annot.getInnerRect()})})}}]),t}(),Ve=function(){function t(e,n){c(this,t),ce(this,"pdfViewer",void 0),ce(this,"controller",void 0),ce(this,"firstUndoAnnot",void 0),ce(this,"handledAnnotCount",void 0),ce(this,"activateAnnots",void 0),this.pdfViewer=e,this.controller=n,this.handledAnnotCount=0}return l(t,[{key:"requireMergeLast",value:function(t){if(this.handledAnnotCount++,!this.firstUndoAnnot){if(this.firstUndoAnnot=t,!this.activateAnnots){this.activateAnnots=this.pdfViewer.getAllActivatedElements().map(function(t){return t.annot}).filter(Boolean).filter(function(t){return"widget"!==t.getType()});var e=this.activateAnnots.findIndex(function(t){return"strikeout"===t.getType()&&"StrikeOutTextEdit"===t.getIntent()});e>-1&&this.activateAnnots.splice(e+1,1)}return 0===this.activateAnnots.length||-1===this.activateAnnots.indexOf(t)?(this.handledAnnotCount--,this.firstUndoAnnot=void 0,this.activateAnnots=void 0):this.activateAnnots.length===this.handledAnnotCount&&this.reset(),!1}-1===this.activateAnnots.indexOf(t)&&this.handledAnnotCount--;var n=this.activateAnnots.length;return this.handledAnnotCount===n?(this.reset(),!0):n>1}},{key:"reset",value:function(){this.firstUndoAnnot=void 0,this.handledAnnotCount=0,this.activateAnnots=void 0}},{key:"pushUndoStack",value:function(t,e,n){if(!this.pdfViewer.customs.pushUndoStack||this.pdfViewer.customs.pushUndoStack(e,n))return this.controller.create("annot",e,n,this.requireMergeLast(t))}}]),t}(),Ue=function(){function t(e){c(this,t),ce(this,"pdfViewer",void 0),this.pdfViewer=e}return l(t,[{key:"exitEdit",value:function(){var t=this;return{undo:function(){var e=t.pdfViewer.getPDFDocRender();e&&e.doc&&(e.doc.getTouchup().handleEvent("Undo",!0,!1),t.pdfViewer.eventEmitter.emit("undoRedo",{type:"touch",operation:"undo"}))},redo:function(){var e=t.pdfViewer.getPDFDocRender();e&&e.doc&&(e.doc.getTouchup().handleEvent("Undo",!1,!1),t.pdfViewer.eventEmitter.emit("undoRedo",{type:"touch",operation:"redo"}))}}}}]),t}(),Le=function(){function t(e){c(this,t),ce(this,"pdfViewer",void 0),this.pdfViewer=e}return l(t,[{key:"exitEdit",value:function(t){var e=this;return{undo:function(){var t=e.pdfViewer.getPDFDocRender();t&&t.doc&&(t.doc.getPageEditor().undoRedo(!1,!0),e.pdfViewer.eventEmitter.emit("undoRedo",{type:"pageEditor",operation:"undo"}))},redo:function(){var t=e.pdfViewer.getPDFDocRender();t&&t.doc&&(t.doc.getPageEditor().undoRedo(!1,!1),e.pdfViewer.eventEmitter.emit("undoRedo",{type:"pageEditor",operation:"redo"}))}}}}]),t}(),Fe=i(2459),Me=function(){function t(e){c(this,t),ce(this,"pdfViewer",void 0),this.pdfViewer=e}return l(t,[{key:"appendAction",value:function(t){var e=t.widget,n=t.appendActionData,r=n.trigger,o=n.actionData;return{undo:function(){return k(function(){return b(this,function(t){return[2,Be(e,{trigger:r})]})})()},redo:function(){return e.appendAdditionalAction(r,o)}}}},{key:"removeAdditionalActionByTrigger",value:function(t){var e=t.widget,n=t.trigger,r=t.hierarchy;return{undo:function(){return k(function(){var t,o,i,a,u,c,s,l;return b(this,function(f){switch(f.label){case 0:t=(0,Fe.iterateActionHierarchy)(r),o=!0,i=!1,a=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),u=t[Symbol.iterator](),f.label=2;case 2:return(o=(c=u.next()).done)?[3,5]:(s=c.value,[4,e.appendAdditionalAction(n,{type:s.hierarchy.type,data:s.hierarchy.data})]);case 3:f.sent(),f.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return l=f.sent(),i=!0,a=l,[3,8];case 7:try{o||null==u.return||u.return()}finally{if(i)throw a}return[7];case 8:return[2]}})})()},redo:function(){return e.removeAdditionalAction(n)}}}},{key:"removeSpecAdditionalAction",value:function(t){var e=t.widget,n=t.trigger,r=t.actionObjNumber,o=t.actionSpec;return{undo:function(){return e.appendAdditionalAction(n,o)},redo:function(){return e.removeAdditionalAction(n,r)}}}},{key:"moveActionAcross",value:function(t){var e=t.doc;return{undo:function(){return e.undoAnnotActionOperation()},redo:function(){return e.redoAnnotActionOperation()}}}},{key:"moveAction",value:function(t){var e=t.widget,n=t.actionData;return{undo:function(){return n.direction="up"===n.direction?"down":"up",e.moveAdditionalAction(n)},redo:function(){return e.moveAdditionalAction(n)}}}},{key:"updateAction",value:function(t){var e=t.widget,n=t.trigger,r=t.actionObjNumber,o=t.oldActionData,i=t.newActionData;return{undo:function(){return He(e,{trigger:n,actionObjNumber:r,actionData:o})},redo:function(){return He(e,{trigger:n,actionObjNumber:r,actionData:i})}}}},{key:"updateNormalAction",value:function(t){var e=t.widget,n=t.actionObjNumber,r=t.oldActionData,o=t.newActionData,i=function(t,e,n){return t.updateAction(e,n)};return{undo:function(){return i(e,n,r)},redo:function(){return i(e,n,o)}}}},{key:"removeNormalAction",value:function(t){t.widget,t.actionObjNumber,t.actionSpec;return{undo:function(){},redo:function(){}}}}]),t}();function Be(t,e){return k(function(t,e){var n,r,o,i,a;return b(this,function(u){switch(u.label){case 0:return n=e.trigger,[4,t.getAdditionalActions([n])];case 1:return r=u.sent(),o=r[0].data,i=o.subAction,a=i.length?i[i.length-1].objNumber:o.objNumber,[2,t.removeAdditionalAction(n,a)]}})}).apply(this,arguments)}function He(t,e){return k(function(t,e){var n,r,o;return b(this,function(i){switch(i.label){case 0:return n=e.trigger,r=e.actionObjNumber,o=e.actionData,[4,t.updateAdditionalAction(n,r,o)];case 1:return[2,i.sent()]}})}).apply(this,arguments)}var Ge=UIExtension.UIEvents,ze=function(){function t(e,n){c(this,t),this.pdfViewer=e,this.undoRedoManager=n,this.annoutInitStatesManager={};var r=Promise.resolve();this.interpreter={annot:new Zt(e),user:new ue(e),bookmark:new fe(e),attachment:new Ie(e),rotatePage:new xe(e),touchup:new Ue(e),pageEditor:new Le(e),formDesigner:new Me(e),undo:function(t){return r=r.finally(function(){return t.undo()})},redo:function(t){return r=r.finally(function(){return t.redo()})}},this.annotUndoRedoManager=new Ve(e,this)}return l(t,[{key:"getAnnotHandler",value:function(t){return new De(this,t)}},{key:"before",value:function(t,e,n){this.beforeData={type:t,fnName:e,data:n}}},{key:"after",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.beforeData;o.type===t||o.fnName===e?this.create(t,e,Object.assign(o.data,n),r):this.beforeData=null}},{key:"create",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&1===Object.keys(n).length&&n.annot&&(this.annoutInitStatesManager[n.annot.objectNumber]=n.annot);var o,i=this.interpreter[t][e](n);o=r?this.undoRedoManager.mergeLast(i):this.undoRedoManager.storage(i);var a=this.undoRedoManager.getRedoStack().clear();return this.pdfViewer.eventEmitter.emit(Ge.undoRedoStoreChange,this),function(){o(),a()}}},{key:"removeByName",value:function(t){this.undoRedoManager.removeByName(t),this.pdfViewer.eventEmitter.emit(Ge.undoRedoStoreChange,this)}},{key:"clear",value:function(){this.undoRedoManager.clear(),this.annoutInitStatesManager={};var t=this.interpreter;[t.bookmark,t.attachment,t.rotatePage,t.formDesigner].forEach(function(t){t.clear&&t.clear()}),this.pdfViewer.eventEmitter.emit(Ge.undoRedoStoreChange,null,"clearAll")}},{key:"undo",value:function(){var t=this.undoRedoManager.undo();if(t){var e=this.interpreter.undo(t);return this.pdfViewer.eventEmitter.emit(Ge.undoRedoStoreChange,this),this.pdfViewer.eventEmitter.emit(Ce,!0),e}}},{key:"redo",value:function(){var t=this.undoRedoManager.redo();if(t){var e=this.interpreter.redo(t);return this.pdfViewer.eventEmitter.emit(Ge.undoRedoStoreChange,this),this.pdfViewer.eventEmitter.emit(Ce,!1),e}}},{key:"popUndoStack",value:function(){this.undoRedoManager.getUndoStack().pop()}},{key:"undoAll",value:function(){for(var t in this.annoutInitStatesManager){var e=this.annoutInitStatesManager[t],n=this.pdfViewer.getAnnotRender(e.page.info.index,e.objectNumber);n&&n.component&&n.component.hideUI()}for(var r=this,o="",i=[];o=this.undoRedoManager.undo();)(function(t){i.push(function(){return r.interpreter.undo(t)})})(o);return i.reduce(function(t,e){return t.then(function(){return e()})},Promise.resolve())}}]),t}(),We=(g.UIEvents,function(){function t(e,n){c(this,t),this.pdfViewer=e,this.controller=n}return l(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("bookmark",t,e)}}]),t}()),qe=(g.UIEvents,function(){function t(e,n){c(this,t),this.pdfViewer=e,this.controller=n}return l(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("attachment",t,e)}}]),t}()),Ye=(g.UIEvents,function(){function t(e,n){c(this,t),this.pdfViewer=e,this.controller=n}return l(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){}},{key:"pushUndoStack",value:function(t,e){this.controller.create("rotatePage",t,e)}}]),t}()),$e=i(732),Xe="vertical",Ke="horizontal",Je=function(){function t(e,n){c(this,t),this.fromInchRate=e,this.name=n,Object.defineProperties(this,{fromInchRate:{value:e,enumerable:!0,writable:!1,configurable:!0},name:{value:n,enumerable:!0,writable:!1,configurable:!0}})}return l(t,[{key:"isPixel",get:function(){return!1}},{key:"convertTo",value:function(t,e){return t/this.fromInchRate*e.fromInchRate}},{key:"convertAreaTo",value:function(t,e){return t/Math.pow(this.fromInchRate,2)*Math.pow(e.fromInchRate,2)}}]),t}(),Qe=function(t){function e(t){var n;return c(this,e),(n=o(this,e,[0,"px"])).orientation=t,Object.defineProperty(n,"fromInchRate",{get:function(){var e=(0,$e.getDPI)();switch(t){case Ke:return e.x;case Xe:return e.y;default:return e.x}}}),n}return h(e,t),l(e,[{key:"isPixel",get:function(){return!0}}]),e}(Je);const Ze={inch:"inch",custom:"custom",mi:"mi",pt:"pt",ft:"ft",yd:"yd",km:"km",m:"m",cm:"cm",mm:"mm",pica:"pica"};var tn,en=new Je(1,Ze.inch),nn=new Je(1,Ze.custom),rn=new Je(1/63360,Ze.mi),on=new Je(72,Ze.pt),an=new Je(1/12,Ze.ft),un=new Je(1/36,Ze.yd),cn=new Je(.0254/1e3,Ze.km),sn=new Je(.0254,Ze.m),ln=new Je(2.54,Ze.cm),fn=new Je(25.4,Ze.mm),dn=new Je(6,Ze.pica),hn=new Qe(Ke),pn=(new Qe(Xe),ce(tn={},en.name,en),ce(tn,nn.name,nn),ce(tn,rn.name,rn),ce(tn,on.name,on),ce(tn,an.name,an),ce(tn,un.name,un),ce(tn,cn.name,cn),ce(tn,sn.name,sn),ce(tn,ln.name,ln),ce(tn,fn.name,fn),ce(tn,dn.name,dn),ce(tn,hn.name,hn),tn);function vn(t){switch(t=(t=t.toLowerCase()).replace(/[^a-z]/g,"")){case"in":t="inch";break;case"p":t="pica"}return pn[t]}function yn(e,r){if(e){if("popup"===e.getType()||e.isStateAnnot&&e.isStateAnnot())return e;var i=$e.Proxy.getProxyClass(e.constructor,function(t,n,r){var o;return(o=n).call.apply(o,[e].concat(y(r)))},function(){}),a=r.getAnnotHandler(e),u=r.annotUndoRedoManager,s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setContent",value:function(e){var r=this;return a.handleSetContent(function(){return f(t(n.prototype),"setContent",r).call(r,e)})}},{key:"setRect",value:function(t){return a.handleSetRect(t)}},{key:"setBorderColor",value:function(e){var r=this;return a.handleSetColor(function(){return f(t(n.prototype),"setBorderColor",r).call(r,e)})}},{key:"setBorderInfo",value:function(t){return a.handleSetBorderInfo(t)}},{key:"setFlags",value:function(e,r){var o=this;return a.handleSetFlags(function(){return f(t(n.prototype),"setFlags",o).call(o,e,r)})}}]),n}(i);return e.isMarkup()&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setOpacity",value:function(e){var n=this;return a.handleSetOpacity(function(){return f(t(r.prototype),"setOpacity",n).call(n,e)},!0,null)}},{key:"setSubject",value:function(e){var n=this;return a.handleSetSubject(function(){return f(t(r.prototype),"setSubject",n).call(n,e)})}},{key:"setTitle",value:function(e){var n=this;return a.handleSetTitle(function(){return f(t(r.prototype),"setTitle",n).call(n,e)})}},{key:"addReply",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return[4,f(t(r.prototype),"addReply",o).call(i,n)];case 1:return(a=c.sent())&&u.pushUndoStack(e,W,{annot:e,replyAnnot:a}),[2,a]}})})()}},{key:"addReviewState",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return[4,f(t(r.prototype),"addReviewState",o).call(i,n)];case 1:return(a=c.sent())&&u.pushUndoStack(e,et,{annot:e,stateName:n}),[2,a]}})})()}},{key:"addMarkedState",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return[4,f(t(r.prototype),"addMarkedState",o).call(i,n)];case 1:return(a=c.sent())&&u.pushUndoStack(e,nt,{annot:e,stateName:n}),[2,a]}})})()}}]),r}(s)),e.setFillColor&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setFillColor",value:function(e){var r=this;return a.handleSetFillColor(function(){return f(t(n.prototype),"setFillColor",r).call(r,e)})}}]),n}(s)),e.setMeasureRatio&&e.getMeasureRatio&&(s=function(r){function i(){return c(this,i),o(this,i,arguments)}return h(i,r),l(i,[{key:"setMeasureRatio",value:function(r){var o=function(t){var e=t.match(/(\d+(\.\d+)?)\s+(\w+)\s+=\s+(\d+(\.\d+)?)\s+(\w+)/);if(e){var n=Gt(e,7),r=n[1],o=n[3],i=n[4],a=n[6];return"in"===o&&(o="inch"),"in"===a&&(a="inch"),{fScale:parseFloat(r),fUnit:vn(o),tScale:parseFloat(i),tUnit:vn(a)}}}(f(t(i.prototype),"getMeasureRatio",this).call(this))||{fScale:1,fUnit:Ze.inch,tScale:1,tUnit:Ze.inch};"object"===n(o.fUnit)&&(o.fUnit=o.fUnit.name),"object"===n(o.tUnit)&&(o.tUnit=o.tUnit.name);var a={userSpaceValue:o.fScale,userSpaceUnit:o.fUnit,realValue:o.tScale,realUnit:o.tUnit},c=Object.assign({},r);return f(t(i.prototype),"setMeasureRatio",this).call(this,r).then(function(){u.pushUndoStack(e,lt,{annot:e,oldMeasureRatio:a,newMeasureRatio:c})})}}]),i}(s)),e.getMeasureUnit&&e.setMeasureUnit&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setMeasureUnit",value:function(n){var o=f(t(r.prototype),"getMeasureUnit",this).call(this);return f(t(r.prototype),"setMeasureUnit",this).call(this,n).then(function(){u.pushUndoStack(e,ft,{annot:e,oldUnit:o,newUnit:n})})}}]),r}(s)),e.setMeasureConversionFactor&&e.getMeasureConversionFactor&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setMeasureConversionFactor",value:function(n){var o=f(t(r.prototype),"getMeasureConversionFactor",this).call(this);return f(t(r.prototype),"setMeasureConversionFactor",this).call(this,n).then(function(){u.pushUndoStack(e,dt,{annot:e,oldFactor:o,newFactor:n})})}}]),r}(s)),e.enableCaption&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"enableCaption",value:function(e){var r=this;return a.handleEnableCaption(function(){return f(t(n.prototype),"enableCaption",r).call(r,e)})}}]),n}(s)),e.setCaptionColor&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setCaptionColor",value:function(n){var o=f(t(r.prototype),"getCaptionColor",this).call(this);return f(t(r.prototype),"setCaptionColor",this).call(this,n).then(function(){u.pushUndoStack(e,ht,{annot:e,oldCaptionColor:o,newCaptionColor:n})})}}]),r}(s)),e.setEndPoint&&e.getEndPoint&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setEndPoint",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getEndPoint",o)};return k(function(){var c,s;return b(this,function(l){switch(l.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setEndPoint",o).call(i,n)];case 1:return l.sent(),s=a().call(i),u.pushUndoStack(e,pt,{annot:e,oldEndPoint:c,newEndPoint:s}),[2]}})})()}}]),r}(s)),e.setStartPoint&&e.getStartPoint&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setStartPoint",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getStartPoint",o)};return k(function(){var c,s;return b(this,function(l){switch(l.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setStartPoint",o).call(i,n)];case 1:return l.sent(),s=a().call(i),u.pushUndoStack(e,vt,{annot:e,oldStartPoint:c,newStartPoint:s}),[2]}})})()}}]),r}(s)),e.setEndingStyle&&e.getEndingStyle&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setEndingStyle",value:function(e,r){var o=this,i=this;return k(function(){return b(this,function(u){return[2,a.handleSetEndingStyle(function(){return f(t(n.prototype),"setEndingStyle",o).call(i,e,r)},e,r)]})})()}}]),n}(s)),e.setStyleFillColor&&e.setStyleFillColor&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setStyleFillColor",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return a=f(t(r.prototype),"getStyleFillColor",o).call(i),[4,f(t(r.prototype),"setStyleFillColor",o).call(i,n)];case 1:return c.sent(),u.pushUndoStack(e,yt,{annot:e,oldStyleFillColor:a,newStyleFillColor:n}),[2]}})})()}}]),r}(s)),e.setLeaderLineExtend&&e.getLeaderLineExtend&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setLeaderLineExtend",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return a=this.getLeaderLineExtend(),[4,f(t(r.prototype),"setLeaderLineExtend",o).call(i,n)];case 1:return c.sent(),u.pushUndoStack(e,gt,{annot:e,oldLength:a,newLength:n}),[2]}})}).call(this)}}]),r}(s)),e.setLeaderLineOffset&&e.getLeaderLineOffset&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setLeaderLineOffset",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return a=this.getLeaderLineOffset(),[4,f(t(r.prototype),"setLeaderLineOffset",o).call(i,n)];case 1:return c.sent(),u.pushUndoStack(e,mt,{annot:e,oldOffset:a,newOffset:n}),[2]}})}).call(this)}}]),r}(s)),e.setLeaderLineLength&&e.getLeaderLineLength&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setLeaderLineLength",value:function(n){var o=this,i=this;return k(function(){var a;return b(this,function(c){switch(c.label){case 0:return a=this.getLeaderLineLength(),[4,f(t(r.prototype),"setLeaderLineLength",o).call(i,n)];case 1:return c.sent(),u.pushUndoStack(e,kt,{annot:e,oldLength:a,newLength:n}),[2]}})}).call(this)}}]),r}(s)),e.setCaptionOffset&&e.getCaptionOffset&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setCaptionOffset",value:function(n,o){var i=this,a=this;return k(function(){var c,s;return b(this,function(l){switch(l.label){case 0:return c=this.getCaptionOffset(),[4,f(t(r.prototype),"setCaptionOffset",i).call(a,n,o)];case 1:return l.sent(),s=this.getCaptionOffset(),u.pushUndoStack(e,bt,{annot:e,oldOffset:c,newOffset:s}),[2]}})}).call(this)}}]),r}(s)),e.getVertexes&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"updateVertexes",value:function(n,o){var i=this,a=this,c=function(){return f(t(r.prototype),"getVertexes",i)};return k(function(){var s,l;return b(this,function(d){switch(d.label){case 0:return s=c().call(a),[4,f(t(r.prototype),"updateVertexes",i).call(a,n,o)];case 1:return d.sent(),l=c().call(a),u.pushUndoStack(e,H,{annot:e,oldIndex:n,newIndex:n,newVertexes:l,oldVertexes:s}),[2]}})})()}},{key:"setVertexes",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getVertexes",o)};return k(function(){var c,s;return b(this,function(l){switch(l.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setVertexes",o).call(i,n)];case 1:return l.sent(),s=a().call(i),u.pushUndoStack(e,wt,{annot:e,newVertexes:s,oldVertexes:c}),[2]}})})()}}]),r}(s)),e.setIconName&&e.getIconName&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setIconName",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getIconName",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setIconName",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),c===l?[2,s]:(u.pushUndoStack(e,ct,{annot:e,oldIconName:c,newIconName:l}),[2,s])}})})()}}]),r}(s)),e.getAlignment&&e.setAlignment&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setAlignment",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getAlignment",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setAlignment",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),c===l?[2,s]:(u.pushUndoStack(e,At,{annot:e,oldAlignment:c,newAlignment:l}),[2,s])}})})()}}]),r}(s)),"freetext"===e.getType()&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setInnerRect",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getInnerRect",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setInnerRect",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),u.pushUndoStack(e,St,{annot:e,oldInnerRect:c,newInnerRect:l}),[2,s]}})})()}},{key:"setCalloutLinePoints",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getRect",o)},c=function(){return f(t(r.prototype),"getCalloutLinePoints",o)},s=function(){return f(t(r.prototype),"getInnerRect",o)};return k(function(){var l,d,h,p,v,y,g;return b(this,function(m){switch(m.label){case 0:return l=a().call(i),d=c().call(i),h=s().call(i),[4,f(t(r.prototype),"setCalloutLinePoints",o).call(i,n)];case 1:return p=m.sent(),v=a().call(i),y=c().call(i),g=s().call(i),u.pushUndoStack(e,F,{annot:e,oldRect:l,oldCalloutLinePoints:d,oldInnerRect:h,newRect:v,newCalloutLinePoints:y,newInnerRect:g}),[2,p]}})})()}},{key:"setCalloutLineEndingStyle",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getCalloutLineEndingStyle",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setCalloutLineEndingStyle",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),c!==l&&u.pushUndoStack(e,Ot,{annot:e,oldStyle:c,newStyle:l}),[2,s]}})})()}}]),r}(s)),e.setDefaultAppearance&&e.getDefaultAppearance&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setDefaultAppearance",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getDefaultAppearance",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setDefaultAppearance",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),u.pushUndoStack(e,Et,{annot:e,oldAp:c,newAp:l}),[2,s]}})})()}}]),r}(s)),e.setRotation&&e.getRotation&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setRotation",value:function(e){var r=this,o=this;return k(function(){return b(this,function(i){return[2,a.handleSetRotation(function(){return f(t(n.prototype),"setRotation",r).call(o,e)})]})})()}}]),n}(s)),e.setInkList&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setInkList",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getInkList",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setInkList",o).call(i,n)];case 1:return s=d.sent(),l=a().call(i),u.pushUndoStack(e,It,{annot:e,oldInkList:c,newInkList:l}),[2,s]}})})()}}]),r}(s)),e.setHighlightingMode&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setHighlightingMode",value:function(e){var r=this,o=this;return k(function(){return b(this,function(i){return[2,a.handleSetHighlightingMode(function(){return f(t(n.prototype),"setHighlightingMode",r).call(o,e)})]})})()}}]),n}(s)),e.setAction&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"setAction",value:function(e,r,o){var i=this,u=this;return k(function(){return b(this,function(c){return[2,a.handleSetAction(function(){return f(t(n.prototype),"setAction",i).call(u,e,r,o)},e,r,o)]})})()}}]),n}(s)),e.moveAction&&(s=function(t){function e(){return c(this,e),o(this,e,arguments)}return h(e,t),l(e,[{key:"moveAction",value:function(t){return k(function(){return b(this,function(e){return[2,a.handleMoveAction(t)]})})()}}]),e}(s)),e.removeAction&&(s=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"removeAction",value:function(e,r){var o=this,i=this;return k(function(){return b(this,function(u){return[2,a.handleRemoveAction(function(){return f(t(n.prototype),"removeAction",o).call(i,e,r)},e,r)]})})()}}]),n}(s)),e.setActionData&&(s=function(t){function e(){return c(this,e),o(this,e,arguments)}return h(e,t),l(e,[{key:"setActionData",value:function(t,e){return k(function(){return b(this,function(n){return[2,a.handleSetActionData(t,e)]})})()}}]),e}(s)),"redact"===e.getType()&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setOverlayText",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getOverlayText",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setOverlayText",o).call(i,n)];case 1:return s=d.sent(),(l=a().call(i))!==c&&u.pushUndoStack(e,Tt,{annot:e,newValue:l,oldValue:c}),[2,s]}})})()}},{key:"removeOverlayText",value:function(){var n=this,o=this;return k(function(){var i,a;return b(this,function(c){switch(c.label){case 0:return i=f(t(r.prototype),"getOverlayText",n).call(o),[4,f(t(r.prototype),"removeOverlayText",n).call(o)];case 1:return a=c.sent(),void 0!==i&&u.pushUndoStack(e,jt,{annot:e,oldValue:i}),[2,a]}})})()}},{key:"setOverlayTextAlignment",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getOverlayTextAlignment",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setOverlayTextAlignment",o).call(i,n)];case 1:return s=d.sent(),(l=a().call(i))!==c&&u.pushUndoStack(e,Rt,{annot:e,newValue:l,oldValue:c}),[2,s]}})})()}},{key:"setRepeat",value:function(n){var o=this,i=this,a=function(){return f(t(r.prototype),"getRepeat",o)};return k(function(){var c,s,l;return b(this,function(d){switch(d.label){case 0:return c=a().call(i),[4,f(t(r.prototype),"setRepeat",o).call(i,n)];case 1:return s=d.sent(),(l=a().call(i))!==c&&u.pushUndoStack(e,Nt,{annot:e,newValue:l,oldValue:c}),[2,s]}})})()}},{key:"setRedactApplyFillColor",value:function(n){var o=this,i=this;return k(function(){var a,c,s;return b(this,function(l){switch(l.label){case 0:return a=e.info.applyFillColor,[4,f(t(r.prototype),"setRedactApplyFillColor",o).call(i,n)];case 1:return c=l.sent(),(s=e.info.applyFillColor)!==a&&u.pushUndoStack(e,Pt,{annot:e,newValue:s,oldValue:a}),[2,c]}})})()}}]),r}(s)),e.setImage&&e.getImage&&(s=function(n){function r(){return c(this,r),o(this,r,arguments)}return h(r,n),l(r,[{key:"setImage",value:function(n){var o=this,i=this;return k(function(){var a,c,s;return b(this,function(l){switch(l.label){case 0:return[4,f(t(r.prototype),"getImage",o).call(i,"buffer")];case 1:return a=l.sent(),[4,f(t(r.prototype),"setImage",o).call(i,n)];case 2:return c=l.sent(),s=n,u.pushUndoStack(e,Ct,{annot:e,oldValue:a,newValue:s}),[2,c]}})})()}}]),r}(s)),new s}}function gn(e,n){var r=function(e){function r(){return c(this,r),o(this,r,arguments)}return h(r,e),l(r,[{key:"getPageByIndex",value:function(e){return f(t(r.prototype),"getPageByIndex",this).call(this,e).then(function(t){return mn(t,n)})}},{key:"getPageById",value:function(e){var o=f(t(r.prototype),"getPageById",this).call(this,e);return o?mn(o,n):o}},{key:"addAnnot",value:function(e,o){var i=this,a=this;return k(function(){var u;return b(this,function(c){switch(c.label){case 0:return[4,f(t(r.prototype),"addAnnot",i).call(a,e,o)];case 1:return u=c.sent(),n.create("annot",_,{annot:u[0]}),[2,kn(u,n)]}})})()}},{key:"getAnnots",value:function(){var e=this,o=this;return k(function(){return b(this,function(i){switch(i.label){case 0:return[4,f(t(r.prototype),"getAnnots",e).call(o)];case 1:return[2,i.sent().map(function(t){return kn(t,n)})]}})})()}}]),r}($e.Proxy.getProxyClass(e.constructor,function(t,n,r){var o;return(o=n).call.apply(o,[e].concat(y(r)))},function(){}));return new r}function mn(e,n){var r=function(e){function r(){return c(this,r),o(this,r,arguments)}return h(r,e),l(r,[{key:"addAnnot",value:function(e){for(var o=this,i=arguments.length,a=new Array(i>1?i-1:0),u=1;u<i;u++)a[u-1]=arguments[u];var c=this;return k(function(){var i,u;return b(this,function(s){switch(s.label){case 0:return[4,(i=f(t(r.prototype),"addAnnot",o)).call.apply(i,[c,e].concat(y(a)))];case 1:return u=s.sent(),n.create("annot",_,{annot:u[0]}),[2,kn(u,n)]}})})()}},{key:"removeAnnotById",value:function(e){var o=this,i=this;return k(function(){var a,u,c;return b(this,function(s){switch(s.label){case 0:return[4,f(t(r.prototype),"getAnnots",o).call(i)];case 1:return a=s.sent(),(u=a.find(function(t){return e&&e===t.getUniqueID()}))?[4,f(t(r.prototype),"removeAnnotById",o).call(i,e)]:[2,[]];case 2:return 0===(c=s.sent()).length?[2,[]]:(n.create("annot",C,[c,u]),[2,c])}})})()}},{key:"removeAnnotByObjectNumber",value:function(e){var o=this,i=this;return k(function(){var a,u,c;return b(this,function(s){switch(s.label){case 0:return[4,f(t(r.prototype),"getAnnots",o).call(i)];case 1:return a=s.sent(),(u=a.find(function(t){return e===t.getId()}))?[4,f(t(r.prototype),"removeAnnotByObjectNumber",o).call(i,e)]:[2,[]];case 2:return 0===(c=s.sent()).length?[2,[]]:(n.create("annot",C,[c,u]),[2,c])}})})()}},{key:"getAnnots",value:function(){for(var e=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];var u=this;return k(function(){var o;return b(this,function(a){switch(a.label){case 0:return[4,(o=f(t(r.prototype),"getAnnots",e)).call.apply(o,[u].concat(y(i)))];case 1:return[2,kn(a.sent(),n)]}})})()}},{key:"getAnnotsByObjectNumArray",value:function(){for(var e=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];var u=this;return k(function(){var o;return b(this,function(a){switch(a.label){case 0:return[4,(o=f(t(r.prototype),"getAnnotsByObjectNumArray",e)).call.apply(o,[u].concat(y(i)))];case 1:return[2,kn(a.sent(),n)]}})})()}},{key:"getAnnotsByIdArray",value:function(){for(var e=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];var u=this;return k(function(){var o;return b(this,function(a){switch(a.label){case 0:return[4,(o=f(t(r.prototype),"getAnnotsByIdArray",e)).call.apply(o,[u].concat(y(i)))];case 1:return[2,kn(a.sent(),n)]}})})()}},{key:"getMarkupAnnots",value:function(){var e=this,o=this;return k(function(){return b(this,function(i){switch(i.label){case 0:return[4,f(t(r.prototype),"getMarkupAnnots",e).call(o)];case 1:return[2,kn(i.sent(),n)]}})})()}},{key:"getAnnotTree",value:function(){var e=this,o=this;return k(function(){return b(this,function(i){switch(i.label){case 0:return[4,f(t(r.prototype),"getAnnotTree",e).call(o)];case 1:return[2,kn(i.sent(),n)]}})})()}}]),r}($e.Proxy.getProxyClass(e.constructor,function(t,n,r){var o;return(o=n).call.apply(o,[e].concat(y(r)))},function(){}));return new r}function kn(t,e){if(0===t.length)return t;var r=[];return new window.Proxy(t,{get:function(t,o){return"symbol"===(void 0===o?"undefined":n(o))?t[o]:o>-1&&o<t.length?r[o]?r[o]:r[o]=yn(t[o],e):"__isProxy"===o||t[o]}})}var bn=function(){function t(e,n){c(this,t),ce(this,"pdfViewer",void 0),ce(this,"controller",void 0),this.pdfViewer=e,this.controller=n}return l(t,[{key:"pushUndoStack",value:function(t,e){this.controller.create("touchup",t,e)}}]),t}(),wn=function(){function t(e,n){c(this,t),ce(this,"pdfViewer",void 0),ce(this,"controller",void 0),ce(this,"lastItem",void 0),this.pdfViewer=e,this.controller=n}return l(t,[{key:"init",value:function(){this.bindEvent()}},{key:"bindEvent",value:function(){var t=this;this.pdfViewer.eventEmitter.on("pageeditor-notify",function(e,n){"onAddUndo"===e&&n&&t.lastItem!==n.item&&(t.lastItem=n.item,t.pushUndoStack("exitEdit",{isEditing:!1}))})}},{key:"pushUndoStack",value:function(t,e){this.controller.create("pageEditor",t,e)}}]),t}(),An=function(){function t(e,n){c(this,t),ce(this,"pdfViewer",void 0),ce(this,"controller",void 0),this.pdfViewer=e,this.controller=n}return l(t,[{key:"pushUndoStack",value:function(t,e){this.controller.create("formDesigner",t,e)}}]),t}(),Sn=g.UIEvents,On=g.PDFViewCtrl.keyboard,En=On.BuiltinCommand,In=On.BuiltinShortcutContext,Tn=On.interceptors,jn=function(){function t(e){c(this,t),this.pdfViewer=e}return l(t,[{key:"isDisabled",value:function(){return-1!==["touch-up-editor","page-editor"].indexOf(this.pdfViewer.stateHandlerManager.getCurrentStates().getStateName())}},{key:"init",value:function(){var t=this,e=this.undoRedoManager=new Ht(this.pdfViewer),n=this.controller=new ze(this.pdfViewer,e);(this.annotModule=new Mt(this.pdfViewer,n)).init(),(this.bookmarkModule=new We(this.pdfViewer,n)).init(),(this.attachmentModule=new qe(this.pdfViewer,n)).init(),(this.rotatePageModule=new Ye(this.pdfViewer,n)).init();this.touchUpModule=new bn(this.pdfViewer,n);(this.pageEditorModule=new wn(this.pdfViewer,n)).init();this.formDesignerModule=new An(this.pdfViewer,n);var r=!1,o=!1;this.pdfViewer.getKeyboard().withContext(In.VIEWER,function(e){var n={interceptors:[Tn.excludeEditableElementInterceptor(),Tn.preventDefaultInterceptor()]};e.keydown(En.UNDO_OPERATION,function(){t.isDisabled()||r||(t.undo(),r=!0,setTimeout(function(){return r=!1},300))},n),e.keydown(En.REDO_OPERATION,function(){t.isDisabled()||o||(t.redo(),o=!0,setTimeout(function(){return o=!1},300))},n)}),this.pdfViewer.eventEmitter.on(Sn.willCloseDocument,function(){n.clear()})}},{key:"undo",value:function(){return this.controller.undo()}},{key:"redo",value:function(){return this.controller.redo()}},{key:"undoAll",value:function(){return this.controller.undoAll()}},{key:"pushUndoStack",value:function(t,e,n){switch(t){case"bookmark":this.bookmarkModule.pushUndoStack(e,n);break;case"touchup":this.touchUpModule.pushUndoStack(e,n);break;case"formDesigner":this.formDesignerModule.pushUndoStack(e,n)}}},{key:"restMergeStatus",value:function(){this.annotModule.resetMergeStatus()}},{key:"invoke",value:function(t){return k(function(){var e;return b(this,function(n){if("function"!=typeof t)throw new Error("Incorrect parameter: The callback is not a function");return(e=this.pdfViewer.getCurrentPDFDoc())?[2,t(gn(e,this.controller))]:[2,t(null)]})}).call(this)}}]),t}(),Rn=i(1843),Nn=i.n(Rn);const xn=function(e){function n(){return c(this,n),o(this,n,arguments)}return h(n,e),l(n,[{key:"init",value:function(e){var r=this;f(t(n.prototype),"init",this).call(this,e),this.addonPromise=e.getPDFViewer().then(function(t){if(!t.collaborationOptions||!t.collaborationOptions.enable)return r.addon=new jn(t),r.addon.init(),r.addon})}},{key:"undo",value:function(){return this.receiveAction("undo",[])}},{key:"undoAll",value:function(){return this.receiveAction("undoAll",[])}},{key:"redo",value:function(){return this.receiveAction("redo",[])}},{key:"invoke",value:function(t){return this.receiveAction("invoke",[t])}},{key:"pushUndoStack",value:function(t,e,n){return this.receiveAction("pushUndoStack",[t,e,n])}},{key:"receiveAction",value:function(t,e){return this.addonPromise.then(function(n){var r;if(!n)throw new Error("undo/redo is not supported when collaboration is enabled!");return(r=n)[t].apply(r,y(e||[]))})}}],[{key:"getName",value:function(){return"undo-redo"}},{key:"getLoader",value:function(){return Nn()}}]),n}(g.UIXAddon)})(),a=a.default})());
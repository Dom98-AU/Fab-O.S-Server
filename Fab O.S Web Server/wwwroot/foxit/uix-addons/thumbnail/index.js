!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl.form):"function"==typeof define&&define.amd?define(["UIExtension",["UIExtension","PDFViewCtrl","commons"],["UIExtension","PDFViewCtrl","form"]],t):"object"==typeof exports?exports.Thumbnail=t(require("UIExtension"),require("UIExtension").PDFViewCtrl.commons,require("UIExtension").PDFViewCtrl.form):e.Thumbnail=t(e.UIExtension,e.UIExtension.PDFViewCtrl.commons,e.UIExtension.PDFViewCtrl.form)}(self,(e,t,n)=>(()=>{var i={325:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<contextmenu name="fv--thumbnail-contextmenu" @thumbnail:permission>\n<contextmenu-item feature="rotate" name="contextmenu-item-thumbnail-rotate-left" @controller="thumbnail:RotateLeftController">thumbnail:contextmenu.rotateLeft</contextmenu-item>\n<contextmenu-item feature="rotate" name="contextmenu-item-thumbnail-rotate-right" @controller="thumbnail:RotateRightController">thumbnail:contextmenu.rotateRight</contextmenu-item>\n<contextmenu-separator></contextmenu-separator>\n<contextmenu-item feature="insert" name="contextmenu-item-thumbnail-add-blank-page" @controller="thumbnail:InsertBlankPageController">thumbnail:contextmenu.addBlankPage</contextmenu-item>\n<contextmenu-separator></contextmenu-separator>\n<thumbnail:delete-page-contextmenu-item name="contextmenu-item-thumbnail-delete"></thumbnail:delete-page-contextmenu-item>\n\x3c!--\n<contextmenu-item @controller="crop-pages:ShowCropPagesDialogController">thumbnail:contextmenu.crop</contextmenu-item>\n--\x3e\n</contextmenu>\n'}},87:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<thumbnail:thumbnail-list\n@thumbnail:centered\n@thumbnail:rearrange-pages\n@thumbnail:drop-to-merge-doc\n@aria:label="thumbnail:title"\nname="thumbnail-list"\n>\n<thumbnail:thumbnail-item\n@foreach="thumbnail in thumbnail_list.thumbnails track by id"\n@setter.thumbnail_id="thumbnail.id"\n@lazy-content="visible"\nname="thumbnail-item"\n>\n<div class="fv__ui-thumbnail-viewer-container">\n<thumbnail:thumbnail-viewer @setter.thumbnail="thumbnail" @thumbnail:visible-rect-control name="thumbnail-page-viewer"></thumbnail:thumbnail-viewer>\n</div>\n<thumbnail:page-number name="thumbnail-page-number">@{thumbnail.pageIndex+1}</thumbnail:page-number>\n</thumbnail:thumbnail-item>\n</thumbnail:thumbnail-list>\n'}},784:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ol class="fv__ui-thumbnail-list" @var.thumbnail_list="$component"></ol>'}},355:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<thumbnail:sidebar-panel name="sidebar-thumbnail-panel" @lazy-content="active">\n<thumbnail:toolbar></thumbnail:toolbar>\n<thumbnail:complete-thumbnail-list></thumbnail:complete-thumbnail-list>\n</thumbnail:sidebar-panel>\n'}},706:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<sidebar-panel\n@tooltip tooltip-placement="right"\ntooltip-title="thumbnail:tooltip"\ntitle="thumbnail:title"\nclass="fv__ui-thumbnail-sidebar"\nicon-class="fv__icon-sidebar-thumbnail"\n@lazy-content="active">\n</sidebar-panel>'}},811:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<div class="fv__ui-thumbnail-toolbar">\n<thumbnail:enlarge-thumbnail name="thumbnail-zoom-in"></thumbnail:enlarge-thumbnail>\n<thumbnail:reduce-thumbnail name="thumbnail-zoom-out"></thumbnail:reduce-thumbnail>\n</div>\n'}},358:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},r=Object.create(i),a=/["&'<>]/;function o(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?o(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,n=a.exec(t);if(!n)return e;var i="",r=void 0,o=void 0,s=void 0;for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}o!==r&&(i+=t.substring(o,r)),o=r+1,i+=s}return o!==r?i+t.substring(o,r):i}(o(e))},r.$each=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e},732:e=>{"use strict";e.exports=t},515:e=>{"use strict";e.exports=n}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,a),n.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function i(i,r,a){return r=e(r),n(i,t()?Reflect.construct(r,a||[],e(i).constructor):r.apply(i,a))}function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):r(e,t)}function s(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}a.d(o,{default:()=>Ft});var d=a(616),v=d.PDFUI,f=d.UIXAddon,m=d.SeniorComponentFactory,p=d.modular,g=d.ServiceScope,b=d.Directive,y=d.Controller,S=d.Component,I=d.ContainerComponent,k=d.UIEvents,w=d.shared,P=w.keyboardStatus,x=w.attachContextMenuEvent,C=(w.addEventListener,d.PDFViewCtrl),E=C.PDFViewer,T=C.ViewerEvents,D=C.DeviceInfo,L=C.BrowserInfo,R=C.shared,A=R.Disposable,_=R.Store,O=(R.debounce,R.observeResize),z=(R.throttle,R.Draggable,R.browser,R.DebounceAsyncTaskExecutor,R.ThrottleAsyncTaskExecutor,R.QueuedAsyncTaskExecutor,R.BuiltinIntersectionObserver),F=R.FileFormat,V=R.getClientX,U=R.getClientY,N=(C.Log.LoggerFactory,C.collab.COLLABORATION_ACTION),j=C.vendors.Hammer,M=C.PDF.DataEvents,B=C.Consts.PDFDocPermission,H=C.keyboard,$=(H.BuiltinShortcutCommand,H.BuiltinShortcutContext,H.KeyboardUtils),W=C._internal.shared,q=(W.IoCScope,W.Lazy),X=a(358),K=a.n(X);function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y="zoom",J=function(){function e(){s(this,e),G(this,"initScaleLevel",D.isMobile?2:3),G(this,"scaleLevel",this.initScaleLevel),G(this,"zoomToScaleRatio",0),G(this,"lastScaleRatio",0),G(this,"availableScaleValues",void 0),G(this,"store",new _)}return l(e,[{key:"allInjected",value:function(){this.availableScaleValues=[.24,.48,.72,.96,1.2,1.44,1.68,1.92,2.16,2.4],this.zoomToScaleRatio=this.availableScaleValues[this.initScaleLevel],this.dispatchScaleLevelChange()}},{key:"setInitializeScaleLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;e>=0&&e<this.availableScaleValues.length&&(this.scaleLevel=~~e)}},{key:"zoomIn",value:function(){return!(this.scaleLevel>=this.availableScaleValues.length-1)&&(this.scaleLevel++,this.lastScaleRatio=this.zoomToScaleRatio,this.zoomToScaleRatio=this.availableScaleValues[this.scaleLevel],this.dispatchScaleLevelChange(),!0)}},{key:"zoomOut",value:function(){return!(this.scaleLevel<=0)&&(this.scaleLevel--,this.lastScaleRatio=this.zoomToScaleRatio,this.zoomToScaleRatio=this.availableScaleValues[this.scaleLevel],this.dispatchScaleLevelChange(),!0)}},{key:"zoomTo",value:function(e){if(e>10||e<0)return!1;var t=this.availableScaleValues.indexOf(e);if(-1===t){var n=this.availableScaleValues.findIndex(function(t){return t>e})-1,i=this.availableScaleValues[n],r=this.availableScaleValues[n+1];this.scaleLevel=void 0===r||e-i<=r-e?n:n+1}else this.scaleLevel=t;return this.lastScaleRatio=this.zoomToScaleRatio,this.zoomToScaleRatio=e,this.dispatchScaleLevelChange(),!0}},{key:"resetScale",value:function(){this.scaleLevel=this.initScaleLevel,this.lastScaleRatio=this.zoomToScaleRatio,this.zoomToScaleRatio=this.availableScaleValues[this.scaleLevel],this.dispatchScaleLevelChange()}},{key:"dispatchScaleLevelChange",value:function(){this.store.dispatch(Y,this.zoomToScaleRatio)}},{key:"isMaxScale",value:function(){return this.scaleLevel===this.availableScaleValues.length-1}},{key:"isMinScale",value:function(){return 0===this.scaleLevel}},{key:"isSmallScale",value:function(){return this.scaleLevel<this.initScaleLevel}},{key:"getScaleRatio",value:function(){return this.zoomToScaleRatio}},{key:"getLastScaleRatio",value:function(){return this.lastScaleRatio}},{key:"scaleEqualInitialize",value:function(){return this.scaleLevel===this.initScaleLevel}},{key:"onScaleChanged",value:function(e){var t=this;return this.store.subscribe(Y,function(){return e({scaleRatio:t.getScaleRatio(),isMinScale:t.isMinScale(),isMaxScale:t.isMaxScale(),isSmall:t.isSmallScale(),lastScaleRatio:t.lastScaleRatio})})}},{key:"setAvailableScaleValues",value:function(e,t){this.availableScaleValues=e;var n=e.indexOf(t);return this.initScaleLevel=n,this.zoomTo(n)}}]),e}();function Q(t,n,i){return Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,i){var r=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(r){var a=Object.getOwnPropertyDescriptor(r,n);return a.get?a.get.call(i||t):a.value}},Q(t,n,i||t)}var Z=a(706),ee=a.n(Z),te=p.module("thumbnail",[]),ne=function(e){return e[e.CLICK=0]="CLICK",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e}({});function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function re(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ae(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||re(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var oe=function(){function e(t,n){s(this,e),G(this,"id",void 0),G(this,"pageIndex",void 0),G(this,"onChangePageIndexCallback",void 0),this.id=t,this.pageIndex=n,this.onChangePageIndexCallback=function(){}}return l(e,[{key:"setPageIndex",value:function(e){this.pageIndex!==e&&(this.pageIndex=e,this.onChangePageIndexCallback())}},{key:"onChangePageIndex",value:function(e){this.onChangePageIndexCallback=e}}]),e}(),se=0;function ue(){return"thumbnail-"+se++}var le=function(){function e(t){s(this,e),G(this,"doc",void 0),G(this,"items",void 0),this.doc=t,this.items=Array(this.doc.getPageCount()).fill(null).map(function(e,t){var n=ue();return new oe(n,t)})}return l(e,[{key:"reload",value:function(){var e=this.doc.pageCache,t=this.items.reduce(function(e,t){return e[t.id]=t,e},{});this.items=Array(this.doc.getPageCount()).fill(null).map(function(n,i){var r=e[i],a=(null==r?void 0:r.$$thumbnailId)||ue();r&&(r.$$thumbnailId=a);var o=t[a];return o?(o.setPageIndex(i),o):new oe(a,i)})}},{key:"addThumbnail",value:function(e){var t=e.getIndex(),n=e.$$thumbnailId=ue(),i=new oe(n,t);if(!(-1===this.items.findIndex(function(e){return e.pageIndex===t}))){this.items.splice(t,0,i);var r=this.items.slice(t+1);return r.forEach(function(e){e.setPageIndex(e.pageIndex+1)}),r}for(var a=this.items.length-1;a>0;){if(this.items[a].pageIndex<t){a+=1;break}a--}-1===a?this.items.push(i):(0===a&&(a+=1),this.items.splice(a,0,i))}},{key:"removeThumbnail",value:function(e){-1===e&&(e=this.items.length-1),this.items.splice(e,1);var t=this.items.slice(e);return t.forEach(function(e){e.setPageIndex(e.pageIndex-1)}),t}},{key:"removeThumbnails",value:function(e){var t=this,n=(e=e.map(function(e){return-1===e?t.items.length-1:e})).slice(0).sort(function(e,t){return e>t?-1:1});return n.forEach(function(e){t.items.splice(e,1)}),this.refreshIndex(),this.items.slice(n[n.length-1])}},{key:"moveThumbnails",value:function(e,t){var n,i=this,r=e.map(function(e){return i.items[e]});e.slice(0).sort(function(e,t){return e>t?-1:1}).forEach(function(e){e<t&&t--,i.items.splice(e,1)}),(n=this.items).splice.apply(n,[t,0].concat(ae(r))),this.refreshIndex()}},{key:"insertThumbnails",value:function(e){var t=this;e.sort(function(e,t){return e.getIndex()>t.getIndex()?1:-1}),e.forEach(function(e){var n=e.getIndex(),i=e.$$thumbnailId=ue();t.items.splice(n,0,new oe(i,n))}),this.refreshIndex()}},{key:"getThumbnailId",value:function(e){var t,n;return null===(n=this.items)||void 0===n||null===(t=n[e])||void 0===t?void 0:t.id}},{key:"getThumbnailItemById",value:function(e){return this.items.find(function(t){return t.id===e})}},{key:"refreshIndex",value:function(){this.items.forEach(function(e,t){e.setPageIndex(t)})}},{key:"sync",value:function(e){if(!e.$$thumbnailId){var t=this.getThumbnailId(e.getIndex());e.$$thumbnailId=t}}},{key:"clear",value:function(){this.items=[]}},{key:"getThumbnailItems",value:function(){return this.items.slice(0)}}]),e}();var ce="thumbnail-list-updated",he="thumbnail-selected-item",de="thumbnail-list-freeze-status-updated",ve=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"pdfui",void 0),G(e,"store",new _),G(e,"thumbnailItemList",void 0),G(e,"lastSelectedItem",void 0),G(e,"selectItemWay",ne.INTERNAL_EVENT),G(e,"freezed",!1),e}return h(t,e),l(t,[{key:"allInjected",value:function(){var e=this;this.clear(),this.addDestroyHook(this.pdfui.addViewerEventListener(T.willCloseDocument,function(){e.clear()}),this.pdfui.addViewerEventListener(M.obtainsPageFromEngine,function(t){var n;null===(n=e.thumbnailItemList)||void 0===n||n.sync(t)}),this.pdfui.addViewerEventListener(T.openFileSuccess,function(t){e.thumbnailItemList=new le(t),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.pageRemoved,function(t){var n;null===(n=e.thumbnailItemList)||void 0===n||n.removeThumbnail(t),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.pagesRemoved,function(t){var n,i=t.reduce(function(e,t){return 1===t.length?e.concat(t[0]):t.length>1?e.concat(function(e,t,n){n||(n=e>t?-1:1);for(var i=[],r=e;r<t;r+=n)i.push(r);return i.push(t),i}(t[0],t[1]-1)):e},[]);null===(n=e.thumbnailItemList)||void 0===n||n.removeThumbnails(i),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.pageAdded,function(t){var n;null===(n=e.thumbnailItemList)||void 0===n||n.addThumbnail(t),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.insertPages,function(t){var n;null===(n=e.thumbnailItemList)||void 0===n||n.insertThumbnails(t),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.pagesReplace,function(t,n){e.reloadThumbnailItems()}),this.pdfui.addViewerEventListener(M.pageMoved,function(t,n){var i;null===(i=e.thumbnailItemList)||void 0===i||i.moveThumbnails([t],n),e.triggerUpdateThumbnailList()}),this.pdfui.addViewerEventListener(M.pagesMoved,function(t,n){var i;null===(i=e.thumbnailItemList)||void 0===i||i.moveThumbnails(t,n),e.triggerUpdateThumbnailList()})),this.triggerUpdateThumbnailList()}},{key:"freeze",value:function(e){this.freezed=e,this.store.dispatch(de,e)}},{key:"onFreezeStatusUpdated",value:function(e){return this.store.subscribe(de,e)}},{key:"isFreezed",value:function(){return this.freezed}},{key:"reloadThumbnailItems",value:function(){var e;null===(e=this.thumbnailItemList)||void 0===e||e.reload(),this.triggerUpdateThumbnailList()}},{key:"triggerUpdateThumbnailList",value:function(){var e,t=(null===(e=this.thumbnailItemList)||void 0===e?void 0:e.getThumbnailItems())||[];this.store.dispatch(ce,t)}},{key:"onUpdateThumbnailList",value:function(e){var t=this;return this.store.subscribe(ce,function(n){if(!t.freezed)return e(n);(window.requestIdleCallback||window.setTimeout)(function(){e(n)})})}},{key:"getCurrentThumbnailList",value:function(){return this.store.getCurrentValue(ce)||[]}},{key:"getThumbnailItemByIndex",value:function(e){return this.getCurrentThumbnailList().find(function(t){return t.pageIndex===e})}},{key:"getThumbnailItemById",value:function(e){return this.getCurrentThumbnailList().find(function(t){return t.id===e})}},{key:"isSelected",value:function(e){var t,n=null===(t=this.thumbnailItemList)||void 0===t?void 0:t.getThumbnailItemById(e);return!!n&&this.getSelectedItems().has(n)}},{key:"selectItem",value:function(e,t){var n,i=null===(n=this.thumbnailItemList)||void 0===n?void 0:n.getThumbnailItemById(e);if(!i)return Promise.resolve();var r=t===ne.CLICK,a=this.getSelectedItems();if(r&&this.isMultipleSelectionArea()){var o=this.getCurrentThumbnailList(),s=this.lastSelectedItem;if(s){a.clear();for(var u=Math.min(s.pageIndex,i.pageIndex),l=Math.max(s.pageIndex,i.pageIndex),c=u;c<=l;c++){var h=o[c];a.add(h)}}else a.add(i),this.lastSelectedItem=i}else r&&this.isMultipleSelection()?(a.has(i)?a.size>1&&a.delete(i):a.add(i),this.lastSelectedItem=i):(a.clear(),a.add(i),this.lastSelectedItem=i);return this.selectItemWay=t,this.store.dispatch(he,a)}},{key:"getSelectedItems",value:function(){return this.store.getCurrentValue(he)}},{key:"getSelectedWay",value:function(){return this.selectItemWay}},{key:"onSelectedItemChange",value:function(e){return this.store.subscribe(he,e)}},{key:"isMultipleSelection",value:function(){return P.isCtrl}},{key:"isMultipleSelectionArea",value:function(){return P.isShift}},{key:"clear",value:function(){this.lastSelectedItem=void 0,this.selectItemWay=ne.INTERNAL_EVENT,this.thumbnailItemList=void 0,this.store.dispatch(he,new Set),this.store.dispatch(ce,[])}}],[{key:"inject",value:function(){return{pdfui:v}}},{key:"isLazy",value:function(){return!1}}]),t}(A),fe=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"listService",void 0),e}return h(n,t),l(n,[{key:"render",value:function(){Q(e(n.prototype),"render",this).call(this),this.bodyElement.classList.add("fv__ui-thumbnail-sidebar-body")}},{key:"doActive",value:function(){Q(e(n.prototype),"doActive",this).call(this),this.listService.freeze(!1)}},{key:"doDeactive",value:function(){Q(e(n.prototype),"doDeactive",this).call(this),this.listService.freeze(!0)}}],[{key:"getName",value:function(){return"sidebar-panel"}},{key:"inject",value:function(){return{listService:ve}}}]),n}(m.createSuperClass({template:ee()()}));te.registerComponent(fe);var me=a(784),pe=a.n(me);function ge(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function be(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function o(e){ge(a,i,r,o,s,"next",e)}function s(e){ge(a,i,r,o,s,"throw",e)}o(void 0)})}}function ye(e,t){var n,i,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var Se=function(){function e(){s(this,e),G(this,"record",{})}return l(e,[{key:"getOrCreate",value:function(e,t,n,i){var r=this.record[e]||{};this.record[e]=r;var a="".concat(e,"_").concat(t,"_").concat(n),o=r[a];return o||(r[a]=i())}},{key:"clearThat",value:function(e){var t=this;if(Array.isArray(e))return e.forEach(function(e){t.record[e.$$thumbnailId]={}}),e.map(function(e){return e.$$thumbnailId});if("string"==typeof e)return this.record[e]={},[e];var n=e.$$thumbnailId;return this.record[n]={},[n]}},{key:"clearAll",value:function(){var e=Object.keys(this.record);return this.record={},e}}]),e}(),Ie=a(732),ke=a(515),we="XTHUMBNAIL-CACHE-UPDATED",Pe=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"viewer",void 0),G(e,"pdfui",void 0),G(e,"thumbnailCache",new Se),G(e,"store",new _),G(e,"defered",(0,Ie.createDeferred)()),G(e,"isEditing",!1),e}return h(t,e),l(t,[{key:"allInjected",value:function(){var e,t=this,n=this.viewer.getFormFillerService();this.addDestroyHook(function(){t.thumbnailCache.clearAll()},this.pdfui.addViewerEventListener(T.beforeOpenFile,function(){t.defered.isSettled&&(t.defered=(0,Ie.createDeferred)())}),this.pdfui.addViewerEventListener(T.renderPageSuccess,function(){t.defered.resolve()}),this.pdfui.addViewerEventListener(T.willCloseDocument,function(){t.thumbnailCache.clearAll()}),this.pdfui.addViewerEventListener((G(e={},M.pageRotationChanged,function(e){t.clearCache(e)}),G(e,M.pagesRotated,function(e){t.clearCache(e)}),G(e,M.pagesBoxChange,function(e){t.clearCache(e)}),G(e,M.annotationAdded,function(e,n){t.clearCache(n)}),G(e,M.annotationUpdated,function(e,n){t.clearCache(n)}),G(e,M.annotationRemoved,function(e,n){t.clearCache(n)}),G(e,M.flattenAnnotation,function(e,n){t.clearCache(e)}),G(e,M.graphicsUpdated,function(e){t.clearCache(e)}),G(e,M.xfaContentChanged,function(e){var n=t.listService.getThumbnailItemByIndex(e);n&&t.clearCache(n.id)}),G(e,M.annotationImported,function(e,n){var i=function(e){var i=n[e],r=i.newAnnots,a=i.page;r.length?t.clearCache(a):t.pdfui.getPDFPageRender(a.getIndex()).then(function(e){e.isRendered&&t.clearCache(a)})};for(var r in n)i(r)}),G(e,M.annotationAppearanceUpdated,function(e,n){t.clearCache(n)}),G(e,M.imageAdded,function(e){t.clearCache(e)}),G(e,M.afterDocumentRotation,function(){var e=t.thumbnailCache.clearAll();t.dispatchCacheUpdate(e)}),G(e,k.objectAdded,function(e){var n=e.pageIndex;t.clearCacheByPageIndex(n)}),G(e,k.objectContentChanged,function(e){var n=e.pageIndex;t.clearCacheByPageIndex(n)}),G(e,"undoRedo",function(e){var n=t.viewer.getPDFDocRender();n&&n.getVisiblePageIndexes().forEach(function(e){n.getPDFPageRender(e).getPDFPage().then(function(e){t.clearCache(e)})})}),G(e,"pageeditor-notify",function(e,n){"enterEdit"===e?t.isEditing=!0:"exitEdit"===e&&(t.isEditing=!1)}),G(e,M.objectEndEdit,function(){t.isEditing=!1}),G(e,M.paragraphTextEnterEdit,function(){t.isEditing=!0}),G(e,M.paragraphTextExitEdit,function(){t.isEditing=!1}),G(e,M.paragraphContentChanged,function(e){var n=e.pageIndex;t.clearCacheByPageIndex(n)}),G(e,M.formFieldImported,function(e){var n=t.thumbnailCache.clearAll();t.dispatchCacheUpdate(n)}),G(e,M.formFieldPropertyUpdated,function(e){var n=e.doc,i=e.fieldName,r=e.propertyName;return be(function(){var e,t,a,o,s,u;return ye(this,function(l){switch(l.label){case 0:switch(r){case ke.FormFieldPropertyName.VALUE:case ke.FormFieldPropertyName.SELECT_OPTION_ITEM:case ke.FormFieldPropertyName.CHOICE_OPTION_ITEMS:break;default:return[2]}return[4,n.form.getField(i)];case 1:return(e=l.sent())?[4,e.getWidgetsCount()]:[2];case 2:return t=l.sent(),a=Array.from({length:t},function(t,n){return e.getWidget(n).then(function(e){return e.getPage()})}),s=Array.from,u=Set.bind,[4,Promise.all(a)];case 3:return o=s.apply(Array,[new(u.apply(Set,[void 0,l.sent().filter(Boolean)]))]),this.clearCache(o),[2]}})}).call(t)}),G(e,k.watermarkAdded,function(e){t.clearCache(e)}),G(e,k.watermarksAdded,function(e,n,i){return be(function(){var e;return ye(this,function(t){switch(t.label){case 0:e=n,t.label=1;case 1:return e<=i?[4,this.clearCacheByPageIndex(e)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})}).call(t)}),G(e,k.watermarkRemoved,function(){return be(function(){var e,t,n;return ye(this,function(i){switch(i.label){case 0:if(!(e=this.viewer.getCurrentPDFDoc()))return[2];t=e.getPageCount(),n=0,i.label=1;case 1:return n<t?[4,this.clearCacheByPageIndex(n)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}})}).call(t)}),G(e,k.headerFooterAdded,function(e){return be(function(){var t,n,i,r;return ye(this,function(a){switch(a.label){case 0:if(!e)return[3,5];t=e.start,a.label=1;case 1:return t<=e.end?[4,this.clearCacheByPageIndex(t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[3,9];case 5:if(!(n=this.viewer.getCurrentPDFDoc()))return[2];i=n.getPageCount(),r=0,a.label=6;case 6:return r<i?[4,this.clearCacheByPageIndex(r)]:[3,9];case 7:a.sent(),a.label=8;case 8:return r++,[3,6];case 9:return[2]}})}).call(t)}),G(e,k.headerFooterUpdated,function(e){return be(function(){var t,n,i,r;return ye(this,function(a){switch(a.label){case 0:if(!e)return[3,5];t=e.start,a.label=1;case 1:return t<=e.end?[4,this.clearCacheByPageIndex(t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[3,9];case 5:if(!(n=this.viewer.getCurrentPDFDoc()))return[2];i=n.getPageCount(),r=0,a.label=6;case 6:return r<i?[4,this.clearCacheByPageIndex(r)]:[3,9];case 7:a.sent(),a.label=8;case 8:return r++,[3,6];case 9:return[2]}})}).call(t)}),e)),n.onDataChanged(function(e,n){t.clearCacheByPageIndex(n.pageIndex)}))}},{key:"dispatchIntersectionVisibleChange",value:function(e,t){return this.store.dispatch(e,t)}},{key:"onIntersectionVisibleChange",value:function(e,t){return this.store.subscribe(e,t)}},{key:"clearCacheByPageIndex",value:function(e){return be(function(){var t,n;return ye(this,function(i){switch(i.label){case 0:return(t=this.viewer.getCurrentPDFDoc())?[4,t.getPageByIndex(e)]:[2];case 1:return n=i.sent(),this.clearCache(n),[2]}})}).call(this)}},{key:"clearCache",value:function(e){var t=this.thumbnailCache.clearThat(e);this.dispatchCacheUpdate(t)}},{key:"dispatchCacheUpdate",value:function(e){this.store.dispatch(we,e)}},{key:"getSize",value:function(){var e=this.zoomService.getScaleRatio();return{width:200*e,height:300*e}}},{key:"onCacheUpdated",value:function(e){return this.store.subscribe(we,e)}},{key:"loadThumbnail",value:function(e){return be(function(){var t,n,i,r,a,o;return ye(this,function(s){switch(s.label){case 0:if("number"!=typeof(t=e.pageIndex)||t<0)throw new Error("Incorrect pageIndex: ".concat(t));return this.viewer.getPDFDocRender().isDocRendered?[3,2]:[4,this.defered.promise];case 1:s.sent(),s.label=2;case 2:if(!(n=this.viewer.getCurrentPDFDoc()))return[2,Promise.resolve(void 0)];if(i=n.getPageCount(),t>=i)throw new Error("Incorrect pageIndex: ".concat(t," is greater or equals to page count ").concat(i));return r=this.zoomService.getScaleRatio(),[4,n.getPageRotation(t)];case 3:return a=s.sent(),o=this.viewer.getPDFDocRender().getRotation(),[2,this.thumbnailCache.getOrCreate(e.id,r,"".concat(a,"_").concat(o),function(){return n.loadThumbnailTemp({pageIndex:t,type:"image",scale:r,rotation:o})})]}})}).call(this)}}],[{key:"scope",value:function(){return g.COMPONENT_TREE}},{key:"inject",value:function(){return{zoomService:J,listService:ve,viewer:"PDFViewer",pdfui:v}}}]),t}(Ie.Disposable),xe=$.match,Ce=$.matchers,Ee=Ce.Home,Te=Ce.End,De=Ce.ArrowUp,Le=Ce.ArrowDown,Re=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"listService",void 0),G(e,"_thumbnails",[]),G(e,"observer",void 0),G(e,"ignorePageNumberChangeEvent",!1),e}return h(n,t),l(n,[{key:"thumbnails",get:function(){return this._thumbnails}},{key:"allInjected",value:function(){var e=this;this.addDestroyHook(this.listService.onUpdateThumbnailList(function(t){e.isDestroyed||(e._thumbnails=t,e.digest(),e.selectThumbnailItemOfCurrentPage())}))}},{key:"selectThumbnailItemOfCurrentPage",value:function(){var e=this;return this.pdfUI?this.pdfUI.getPDFDocRender().then(function(t){if(t){var n=t.getCurrentPageIndex(),i=e.listService.getThumbnailItemByIndex(n);i&&e.listService.selectItem(i.id,ne.INTERNAL_EVENT)}}):Promise.resolve()}},{key:"createDOMElement",value:function(){return document.createElement("ol")}},{key:"postlink",value:function(){var t=this;Q(e(n.prototype),"postlink",this).call(this),this.observer=new z(this.element,.1),this.addDestroyHook(function(){t.observer.destroy()},this.listService.onSelectedItemChange(function(e){if(e&&1===e.size&&t.listService.getSelectedWay()===ne.CLICK){var n=e.values().next().value.pageIndex;return t.pdfUI.goToPage(n,0,0,!1)}}),this.pdfUI.addViewerEventListener(T.pageNumberChange,function(e){if(t.ignorePageNumberChangeEvent)t.ignorePageNumberChangeEvent=!1;else{var n=e-1,i=t.listService.getThumbnailItemByIndex(n);i&&t.listService.selectItem(i.id,ne.INTERNAL_EVENT)}}))}},{key:"mounted",value:function(){var t=this;Q(e(n.prototype),"mounted",this).call(this),this.attachEventToElement(this.element,"keyup",function(e){var n,i=t.listService.getCurrentThumbnailList();xe(e).when(Ee,function(){n=i[0],e.stopPropagation(),e.preventDefault()}).when(Te,function(){var n=i[i.length-1];n&&t.listService.selectItem(n.id,ne.CLICK),e.stopPropagation(),e.preventDefault()}).when(De,function(){var e,r=Array.from(t.listService.getSelectedItems()),a=((e=Math).min.apply(e,ae(r.map(function(e){return i.indexOf(e)})))-1+i.length)%i.length;n=i[a]}).when(Le,function(){var e,r=Array.from(t.listService.getSelectedItems()),a=((e=Math).max.apply(e,ae(r.map(function(e){return i.indexOf(e)})))+1+i.length)%i.length;n=i[a]}),n&&(t.ignorePageNumberChangeEvent=!0,t.listService.selectItem(n.id,ne.CLICK))})}},{key:"observeIntersection",value:function(e,t){return this.observer.observe(e,function(e,n){t(n)})}}],[{key:"getName",value:function(){return"thumbnail-list"}},{key:"inject",value:function(){return{listService:ve,viewerService:Pe}}}]),n}(m.createSuperClass({template:pe()()}));te.registerComponent(Re);var Ae,_e="fv__ui-thumbnail-viewer-loading",Oe=((Ae=document.createElement("div")).classList.add("fv__ui-thumbnail-viewer",_e),Ae),ze=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"thumbnailItem",void 0),G(e,"viewerService",void 0),G(e,"zoomService",void 0),G(e,"thumbnailImage",void 0),G(e,"pdfUI",void 0),G(e,"isIntersectionVisible",!1),G(e,"unobserveIntersectionVisibleChange",function(){}),G(e,"renderSequence",0),e}return h(n,t),l(n,[{key:"createDOMElement",value:function(){return Oe.cloneNode()}},{key:"setThumbnail",value:function(e){var t=this;this.thumbnailItem=e,e.onChangePageIndex(function(){t.isIntersectionVisible&&t.renderThumbnail()}),this.unobserveIntersectionVisibleChange(),this.unobserveIntersectionVisibleChange=this.viewerService.onIntersectionVisibleChange(e.id,function(e){if(t.isIntersectionVisible=e,e)return t.renderThumbnail()})}},{key:"getThumbnailId",value:function(){var e;return null===(e=this.thumbnailItem)||void 0===e?void 0:e.id}},{key:"postlink",value:function(){var t=this;Q(e(n.prototype),"postlink",this).call(this),this.addDestroyHook(this.pdfUI.addViewerEventListener(M.pageRotationChanged,function(e){t.thumbnailItem&&t.thumbnailItem.pageIndex===e.getIndex()&&t.isIntersectionVisible&&t.renderThumbnail()}),this.pdfUI.addViewerEventListener(T.afterDocumentRotation,function(){t.thumbnailItem&&t.isIntersectionVisible&&t.renderThumbnail()}),function(){t.unobserveIntersectionVisibleChange()},this.viewerService.onCacheUpdated(function(e){t.thumbnailItem&&-1!==e.indexOf(t.thumbnailItem.id)&&t.isIntersectionVisible&&t.renderThumbnail()}),this.zoomService.onScaleChanged(function(){t.updateSize(t.getEstimateSize()),t.isIntersectionVisible&&t.renderThumbnail()})),this.updateSize()}},{key:"getEstimateSize",value:function(){var e=this.zoomService.getScaleRatio(),t=this.zoomService.getLastScaleRatio();if(!this.thumbnailImage||0===t)return this.viewerService.getSize();var n=e/t;return{width:this.thumbnailImage.width*n,height:this.thumbnailImage.height*n}}},{key:"renderThumbnail",value:function(){var e=this,t=this.thumbnailItem;if(!t)return Promise.resolve(!1);var n=++this.renderSequence;return this.viewerService.loadThumbnail(t).then(function(i){var r;return n<e.renderSequence||!e.isDestroyed&&(e.thumbnailImage===i?(e.unloading(),!0):(e.updateSize(e.getEstimateSize()),null===(r=e.thumbnailImage)||void 0===r||r.remove(),e.thumbnailImage=i,!!i&&(e.updateSize(),e.unloading(),e.element.appendChild(i),e.trigger("update-thumbnail",t),!0)))})}},{key:"getThumbnailImage",value:function(){return this.thumbnailImage}},{key:"updateSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.thumbnailImage||this.viewerService.getSize(),t=e.width,n=e.height;(0,Ie.cssText)(this.element,{width:t+"px",height:n+"px"})}},{key:"unloading",value:function(){this.element.classList.remove(_e)}}],[{key:"getName",value:function(){return"thumbnail-viewer"}},{key:"inject",value:function(){return{viewerService:Pe,zoomService:J}}}]),n}(S);te.registerComponent(ze);var Fe,Ve=((Fe=document.createElement("li")).classList.add("fv__ui-thumbnail-item"),Fe.tabIndex=0,Fe),Ue=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"listService",void 0),G(e,"zoomService",void 0),G(e,"viewerService",void 0),G(e,"thumbnailId",void 0),G(e,"ofsWidth",void 0),G(e,"ofsHeight",void 0),G(e,"isIntersectionVisible",!1),e}return h(n,t),l(n,[{key:"createDOMElement",value:function(){return Ve.cloneNode()}},{key:"setThumbnail_id",value:function(e){this.thumbnailId=e,this.setAttribute("thumbnail-id",e),this.dispatchChanges(),this.updateSelectionStatus()}},{key:"getThumbnailId",value:function(){return this.thumbnailId}},{key:"mounted",value:function(){var t=this;Q(e(n.prototype),"mounted",this).call(this),this.addDestroyHook(this.listService.onSelectedItemChange(function(){t.updateSelectionStatus()}),this.zoomService.onScaleChanged(function(){t.updateSize()})),this.attachEventToElement(this.element,"mousedown,touchstart",function(e){t.thumbnailId&&(t.listService.isMultipleSelectionArea()||t.listService.isMultipleSelection()?t.select():t.listService.isSelected(t.thumbnailId)||t.select())}),this.attachEventToElement(this.element,"mouseup,touchend",function(e){t.thumbnailId&&0===e.button&&t.listService.isSelected(t.thumbnailId)&&(t.listService.isMultipleSelectionArea()||t.listService.isMultipleSelection()||t.select())}),this.addDestroyHook(x(this.element,function(e){t.onContextMenu(e)})),this.updateSize();var i=this.parent;r(i,Re)&&this.addDestroyHook(i.observeIntersection(this.element,function(e){t.isIntersectionVisible!==e&&(t.isIntersectionVisible=e,e&&t.trigger("visible"),t.dispatchChanges())}))}},{key:"updateSelectionStatus",value:function(){var e=this,t=this.listService.getSelectedItems();if(t)if(Array.from(t).find(function(t){return t.id===e.thumbnailId})){if(!this.isActive&&this.listService.getSelectedWay()!==ne.CLICK)if(document.activeElement!==document.body&&document.activeElement&&document.activeElement.contains(this.element))this.element.focus();else if(this.listService.isFreezed())var n=this.listService.onFreezeStatusUpdated(function(t){e.isActive&&!e.isDestroyed?t||(e.element.focus(),n()):n()});this.active()}else this.deactive()}},{key:"updateSize",value:function(){var e=this.viewerService.getSize(),t=getComputedStyle(this.element),n=parseInt(t.borderLeftWidth)+parseInt(t.borderRightWidth),i=parseInt(t.borderTopWidth)+parseInt(t.borderBottomWidth),r=Ne(e.width,this.ofsWidth)+n,a=Ne(e.height,this.ofsHeight)+i;this.element.style.cssText+="\n            width: ".concat(r,"px;\n            height: ").concat(a,"px;\n        ")}},{key:"doActive",value:function(){this.element.classList.add("fv__ui-thumbnail-item-active"),this.element.scrollIntoView({block:"nearest"})}},{key:"doDeactive",value:function(){this.element.classList.remove("fv__ui-thumbnail-item-active")}},{key:"select",value:function(){this.thumbnailId&&this.listService.selectItem(this.thumbnailId,ne.CLICK)}},{key:"onContextMenu",value:function(e){var t=this.getContextMenu();t&&(t.showAt(e.clientX+1,e.clientY+1),e.preventDefault())}},{key:"hideContextMenu",value:function(){var e=this.getContextMenu();e&&e.hide()}},{key:"getContextMenu",value:function(){return this.getRoot().getComponentByName("fv--thumbnail-contextmenu")}},{key:"dispatchChanges",value:function(){this.thumbnailId&&this.viewerService.dispatchIntersectionVisibleChange(this.thumbnailId,this.isIntersectionVisible)}}],[{key:"getName",value:function(){return"thumbnail-item"}},{key:"getMetadata",value:function(){return{options:{thumbnail_id:"string","ofs-height":{type:"number",field:"ofsHeight",defaultValue:20},"ofs-width":{type:"number",field:"ofsWidth",defaultValue:0}}}}},{key:"inject",value:function(){return{listService:ve,zoomService:J,viewerService:Pe}}}]),n}(I);function Ne(e,t){return isFinite(t)?Math.floor(t)!==t?e*t:e+t:e}te.registerComponent(Ue);var je=function(){var e=document.createElement("div");return e.classList.add("fv__ui-thumbnail-page-number"),e}(),Me=function(e){function t(){return s(this,t),i(this,t,arguments)}return h(t,e),l(t,[{key:"createDOMElement",value:function(){return je.cloneNode()}},{key:"setPage_index",value:function(e){this.element.innerText=e+1+""}}],[{key:"getName",value:function(){return"page-number"}}]),t}(I);te.registerComponent(Me);var Be=a(87),He=a.n(Be);te.registerPreConfiguredComponent("complete-thumbnail-list",{template:He()()});var $e=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"zoomService",void 0),e}return h(t,e),l(t,[{key:"zoomIn",value:function(){this.zoomService.zoomIn()}}],[{key:"getName",value:function(){return"enlarge-thumbnail"}},{key:"inject",value:function(){return{zoomService:J}}}]),t}(m.createSuperClass({template:'\n        <xbutton class="fv__ui-thumbnail-tool-btn" icon-class="fv__icon-thumbnail-tool-enlarge" @on.click="$component.zoomIn()" @tooltip tooltip-title="thumbnail:zoom.zoom-in">\n    '}));te.registerComponent($e);var We=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"zoomService",void 0),e}return h(t,e),l(t,[{key:"zoomOut",value:function(){this.zoomService.zoomOut()}}],[{key:"getName",value:function(){return"reduce-thumbnail"}},{key:"inject",value:function(){return{zoomService:J}}}]),t}(m.createSuperClass({template:'\n        <xbutton class="fv__ui-thumbnail-tool-btn" icon-class="fv__icon-thumbnail-tool-reduce" @on.click="$component.zoomOut()"  @tooltip tooltip-title="thumbnail:zoom.zoom-out">\n    '}));te.registerComponent(We);var qe=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"service",void 0),e}return h(n,t),l(n,[{key:"init",value:function(t){Q(e(n.prototype),"init",this).call(this,t);var i=this.subName;this.addDestroyHook(this.service.onScaleChanged(function(e){e.scaleRatio;var n=e.isMinScale,r=e.isMaxScale;switch(i){case"zoomin":r?t.disable():t.enable();break;case"zoomout":n?t.disable():t.enable()}}))}}],[{key:"getName",value:function(){return"zoom-status"}},{key:"inject",value:function(){return{service:J}}}]),n}(b);te.getRegistry().registerDirective(qe);var Xe=a(811),Ke=a.n(Xe),Ge=function(e){function t(){return s(this,t),i(this,t,arguments)}return h(t,e),l(t,null,[{key:"getName",value:function(){return"toolbar"}}]),t}(m.createSuperClass({template:Ke()()}));te.registerComponent(Ge);var Ye=d.PDFViewCtrl.shared.securityUtils,Je=function(){},Qe=function(){function e(){s(this,e),G(this,"pdfui",void 0),G(this,"viewer",void 0)}return l(e,[{key:"rotatePage",value:function(e,t){var n=this,i=this.viewer.getCurrentPDFDoc();return i?this.viewer.killFocus(null).then(function(t){return i.getPageByIndex(e)}).then(function(i){if(!i)return!1;var r=i.getRotation(),a=(r+t+4)%4;return a==r||i.setRotation(a).then(function(){return n.pdfui.collaborate(N.PPO_ROTATE_PAGE,{pageIndex:e,angle:90*a}),!0})}):Promise.resolve(!1)}},{key:"insertBlankPageAfter",value:function(e){var t=this,n=this.viewer.getCurrentPDFDoc();if(!n)return Promise.resolve(!1);var i=e+1;return n.getPageByIndex(e).then(function(e){return n.insertPage(i,e.getWidth(),e.getHeight()).then(function(){return t.pdfui.collaborate(N.PPO_INSERT_PAGE,{pageIndex:i,width:e.getWidth(),height:e.getHeight()}),!0})})}},{key:"deletePage",value:function(e){var t=this,n=this.viewer.getCurrentPDFDoc();return n?n.removePage(e).then(function(n){return t.pdfui.collaborate(N.PPO_REMOVE_PAGE,{pageIndex:e}),n}):Promise.resolve(!1)}},{key:"deletePages",value:function(e){var t=this,n=this.viewer.getCurrentPDFDoc();return n?n.removePages(e).then(function(n){return t.pdfui.collaborate(N.PPO_REMOVE_PAGES,{pageRange:e}),n}):Promise.resolve(!1)}},{key:"copyPages",value:function(e,t){var n=this.viewer.getCurrentPDFDoc();if(!n)return Promise.resolve(!1);var i=e.map(function(e){return[e]});return n.copyPages(i,t).then(function(){return!0})}},{key:"movePages",value:function(e,t){var n=this.viewer.getCurrentPDFDoc();if(!n)return Promise.resolve(!1);var i=e.map(function(e){return[e]});return n.movePagesToThenUpdatePageLabel(i,t).then(function(){return!0})}},{key:"mergeDoc",value:function(e,t){var n=this;return this.viewer.loadPDFDocByFile(t,{errorHandler:function(e,t,i,r){if(3===i.code){var a=e.getFileName(),o=n.viewer.i18n.t("thumbnail:retry.title");o=o.replace("${filename}",a||"");var s=t.password,u="",l="";return s&&(u="error",l=t.protected?"password-protect:warning.incorrect-owner-pwd":"retry.invalidPassword"),n.pdfui.promptPassword(s,o,"retry.Password","body",u,l).then(function(n){if(n)return t.password=n,r(t);var i=new Error("Invalid password value: null");return i.error=-2,i.pdfDoc=e,Promise.reject(i)},function(){})}if(2===i.code)return n.pdfui.alert({message:"alert.formatError",level:"error"});throw n.pdfui.alert({message:"thumbnail:insertFailed",level:"error"}),i}}).then(function(i){if(i)if(i.isDynamicXFA())n.pdfui.alert({message:"thumbnail:nonsupportDynamicXFA",level:"error"});else{var r=function(){var r=n.viewer.getCurrentPDFDoc();return!!r&&r.mergePDFDoc({doc:i,insertIndex:e,layerName:(t.name||"").replace(/\.pdf$/,"")}).catch(Je)};i.hasOwnerPassword()&&!i.isOwnerPassword()?Ye.requestOwnerPassword(n.pdfui,function(e){r()},i):r()}})}}],[{key:"inject",value:function(){return{pdfui:v,viewer:E}}}]),e}(),Ze=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"ppoService",void 0),G(e,"thumbnailListService",void 0),e}return h(n,t),l(n,[{key:"mounted",value:function(){var t=this;Q(e(n.prototype),"mounted",this).call(this);var i=this.getPDFUI();this.addDestroyHook(i.addViewerEventListener(T.openFileSuccess,function(){t.updateStatus()}))}},{key:"changePermission",value:function(){this.updateStatus()}}],[{key:"inject",value:function(){return{ppoService:Qe,thumbnailListService:ve}}}]),n}(y);function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var tt=function(){function e(){s(this,e),G(this,"viewer",void 0)}return l(e,[{key:"onModPermissionChange",value:function(e){var t=this,n=function(){t.hasModPermission().then(e)};return n(),this.viewer.eventEmitter.on(T.openFileSuccess,n),this.viewer.eventEmitter.on(T.willCloseDocument,n),this.viewer.eventEmitter.on(T.pageRemoved,n),this.viewer.eventEmitter.on("permission-changed",n),function(){t.viewer.eventEmitter.off(T.openFileSuccess,n),t.viewer.eventEmitter.off(T.willCloseDocument,n),t.viewer.eventEmitter.off(T.pageRemoved,n),t.viewer.eventEmitter.off("permission-changed",n)}}},{key:"hasRotatePermission",value:function(){return Promise.all([this.hasPermission(!1),this.isReadonlyDoc()]).then(function(e){var t=et(e,2),n=t[0],i=t[1];return n&&!i})}},{key:"hasInsertPermission",value:function(){return Promise.all([this.hasPermission(!1),this.isReadonlyDoc()]).then(function(e){var t=et(e,2),n=t[0],i=t[1];return n&&!i})}},{key:"hasDeletePermission",value:function(){return Promise.all([this.hasPermission(!0),this.isReadonlyDoc()]).then(function(e){var t=et(e,2),n=t[0],i=t[1];return n&&!i})}},{key:"hasModPermission",value:function(){return Promise.all([this.hasPermission(!1),this.isReadonlyDoc()]).then(function(e){var t=et(e,2),n=t[0],i=t[1];return n&&!i})}},{key:"isReadonlyDoc",value:function(){return be(function(){var e;return ye(this,function(t){return(e=this.viewer.getPDFDocRender())?[2,e.doc.readonly()]:[2,Promise.resolve(!1)]})}).call(this)}},{key:"hasPermission",value:function(e){var t=this.viewer.getPDFDocRender();if(!t)return Promise.resolve(!1);var n=t.getUserPermission().getValue(),i=B.Assemble;return e&&1==t.doc.getPageCount()?Promise.resolve(!1):t.doc.isXFA().then(function(e){return!e&&0!==(n&i)})}}],[{key:"inject",value:function(){return{viewer:E}}}]),e}(),nt=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"permissionService",void 0),e}return h(t,e),l(t,[{key:"handle",value:function(){var e=this,t=this.getPDFUI(),n=this.thumbnailListService.getCurrentThumbnailList(),i=Array.from(this.thumbnailListService.getSelectedItems());return i.length===n.length?t.alert("thumbnail:removePageAlert"):t.confirm(i.length>1?"thumbnail:removePageConfirm":"thumbnail:deletePageConfirm").then(function(){return t.loading().then(function(n){return t.getCurrentPDFDoc().then(function(t){if(t){var n=i.map(function(e){return e.pageIndex}).sort().map(function(e){return[e]});return e.ppoService.deletePages(n)}}).finally(function(){n.close()})})},function(){})}},{key:"updateStatus",value:function(){var e=this.component;this.permissionService.hasDeletePermission().then(function(t){t?e.unlock():e.lock()})}}],[{key:"getName",value:function(){return"DeletePageController"}},{key:"inject",value:function(){return Object.assign(Ze.inject(),{permissionService:tt})}}]),t}(Ze);te.registerController(nt);var it=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"permissionService",void 0),e}return h(t,e),l(t,[{key:"handle",value:function(){var e,t=Array.from(this.thumbnailListService.getSelectedItems());if(0!==t.length){var n=(e=Math).max.apply(e,ae(t.map(function(e){return e.pageIndex})));return this.ppoService.insertBlankPageAfter(n)}}},{key:"updateStatus",value:function(){var e=this.component;this.permissionService.hasInsertPermission().then(function(t){t?e.unlock():e.lock()})}}],[{key:"getName",value:function(){return"InsertBlankPageController"}},{key:"inject",value:function(){return Object.assign(Ze.inject(),{permissionService:tt})}}]),t}(Ze);te.registerController(it);var rt=function(e){return e[e.LEFT=-1]="LEFT",e[e.RIGHT=1]="RIGHT",e}({}),at=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"permissionService",void 0),e}return h(t,e),l(t,[{key:"handle",value:function(){var e=this,t=this.thumbnailListService.getSelectedItems();if(0!==t.size)return Promise.all(Array.from(t).map(function(t){return e.ppoService.rotatePage(t.pageIndex,rt.LEFT)}))}},{key:"updateStatus",value:function(){var e=this.component;this.permissionService.hasRotatePermission().then(function(t){t?e.unlock():e.lock()})}}],[{key:"getName",value:function(){return"RotateLeftController"}},{key:"inject",value:function(){return Object.assign(Ze.inject(),{permissionService:tt})}}]),t}(Ze);te.registerController(at);var ot=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"permissionService",void 0),e}return h(t,e),l(t,[{key:"handle",value:function(){var e=this,t=this.thumbnailListService.getSelectedItems();if(0!==t.size)return Promise.all(Array.from(t).map(function(t){return e.ppoService.rotatePage(t.pageIndex,rt.RIGHT)}))}},{key:"updateStatus",value:function(){var e=this.component;this.permissionService.hasRotatePermission().then(function(t){t?e.unlock():e.lock()})}}],[{key:"getName",value:function(){return"RotateRightController"}},{key:"inject",value:function(){return Object.assign(Ze.inject(),{permissionService:tt})}}]),t}(Ze);te.registerController(ot);var st=a(325),ut=a.n(st);te.registerPreConfiguredComponent("contextmenu",{template:ut()()}),te.registerPreConfiguredComponent("thumbnail-contextmenu",{template:ut()()});var lt=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"zoomService",void 0),e}return h(n,t),l(n,[{key:"init",value:function(t){var i=this;Q(e(n.prototype),"init",this).call(this,t);var r=t.element,a=[],o=function(){a.forEach(function(e){e.style.cssText+="left: 0"});var e=Array.from(r.querySelectorAll(".fv__ui-thumbnail-item"));if(0!==e.length&&0!==r.clientWidth){var t=e[0].offsetTop,n=[];e.some(function(e){return e.offsetTop!==t||(n.push(e),!1)});var i=n.length,o=e.length%i;if(o>0){var s=e.slice(-o);s.forEach(function(e,t){var i=n[t].offsetLeft-e.offsetLeft;e.style.cssText+="left: ".concat(i,"px")}),a=s}else a=[]}};if(window.MutationObserver){var s=new MutationObserver(function(){Promise.resolve().then(o)});s.observe(r,{childList:!0}),this.addDestroyHook(function(){s.disconnect()})}else{["DOMNodeInserted","DOMNodeRemoved"].forEach(function(e){r.addEventListener(e,o),i.addDestroyHook(function(){r.removeEventListener(e,o)})})}this.addDestroyHook(O(r,o),this.zoomService.onScaleChanged(function(){Promise.resolve().then(o)}))}}],[{key:"getName",value:function(){return"centered"}},{key:"inject",value:function(){return{zoomService:J}}}]),n}(b);te.getRegistry().registerDirective(lt);var ct=function(e){return e.upper="upper",e.bottom="bottom",e.left="left",e.right="right",e}({}),ht=document.createElement("div");ht.className="fv__ui-ppo-utils-helper-dom";var dt=ht.cloneNode(!0);dt.setAttribute("side","upper");var vt=ht.cloneNode(!0);vt.setAttribute("side","bottom");var ft=ht.cloneNode(!0);ft.setAttribute("side","left");var mt=ht.cloneNode(!0);function pt(e,t){var n,i,a,o,s,u,l,c,h=!1,d=0,v=0,f=!1,m=function(){},p=function(t){m();var n=!1;requestAnimationFrame(function i(){n||(e.scrollTop+=10*t,requestAnimationFrame(i))}),m=function(){n=!0}},g=function(e,t){return be(function(){return ye(this,function(n){return o?(o.style.cssText+="\n            left: ".concat(e-d,"px;\n            top: ").concat(t-v,"px;\n        "),[2]):[2]})})()},b=function(e){if((!f||"mousedown"!==e.type)&&t.usable()){var n=e.target;if(n&&t.isDragTarget(n)){var i=t.transformTarget(n);if(i){if(a&&(a.classList.remove("fv__ui-ppo-utils-dragging"),i.removeAttribute("draggable")),a=i,window.TouchEvent&&r(e,TouchEvent)){(o=i.cloneNode(!0)).classList.add("fv__ui-ppo-utils-shadow"),o.classList.remove("fv__ui-thumbnail-item-active"),document.body.appendChild(o);var s=V(e),u=U(e),l=a.getBoundingClientRect();d=s-l.left,v=u-l.top,g(s,u)}a.classList.add("fv__ui-ppo-utils-dragging"),i.setAttribute("draggable","true"),t.listeners.dragstart(i,e)}}}},y=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.target;if(a&&r&&t.isDragTarget(r)){var o=t.transformTarget(r);if(o){var s=yt(r);if(s)return h=!1,n=s,i=o,void t.listeners.dragenter({dragFromElement:a,dragOverElement:o,side:s,sourceEvent:e});gt(o,t.detectDirection())}}},S=function(e){var r=i,s=a,u=n;a&&a.classList.remove("fv__ui-ppo-utils-dragging"),i=void 0,n=void 0,a=void 0,o&&document.body.removeChild(o),o=void 0,h||r&&u&&s&&(r.removeAttribute("draggable"),t.listeners.dragend({side:u,dragFromElement:s,dragOverElement:r,sourceEvent:e}),bt())},I=[];(I.push(St(document.body,"touchmove",function(t){if(o){var n=V(t),i=U(t);if(g(n,i),D.isTouchDevice){!function(){s=document.createElement("div"),u=document.createElement("div"),s.classList.add("fv__ui-scroll-trigger-top"),u.classList.add("fv__ui-scroll-trigger-bottom");var t=e.getBoundingClientRect();u.style.cssText+="\n            left: ".concat(t.left,"px;\n            top: ").concat(t.bottom-10,"px;\n            width: ").concat(t.width,"px;\n        "),s.style.cssText+="\n            left: ".concat(t.left,"px;\n            top: ").concat(t.top,"px;\n            width: ").concat(t.width,"px;\n        "),e.append(s,u)}();var r=null==s?void 0:s.getBoundingClientRect(),a=null==u?void 0:u.getBoundingClientRect();r&&a&&(i<=r.bottom?p(-1):i>=a.top?p(1):m())}}},!0),St(document.body,"mouseup",function(){a&&a.classList.remove("fv__ui-ppo-utils-dragging")},!0)),D.isTouchDevice&&!D.isChromebook||I.push(St(e,"mousedown",b,!0),St(e,"dragenter",y,!0),St(e,"dragleave",function(n){var i=document.elementFromPoint(n.clientX,n.clientY);e.contains(i)||(h=!0,t.listeners.dragleave())}),St(document.body,"dragend",S,!0)),D.isTouchDevice)&&I.push(St(document.body,"mouseup",function(){f=!1},!0),St(e,"touchstart",function(e){f=!0,c=setTimeout(function(){b(e)},500)},!0),St(e,"touchmove",function(e){if(clearTimeout(c),t.usable()){var n=e.touches[0];if(n&&a){e.preventDefault();var i=document.elementFromPoint(n.clientX,n.clientY);if(i){var r;switch(i){case dt:case vt:case mt:case ft:r=i;break;default:r=t.transformTarget(i)}l!==r&&r&&(l=r,y(e,r))}}}},{capture:!0,passive:!1}),St(document.body,"touchend",function(e){clearTimeout(c),m(),s&&s.remove(),u&&u.remove(),S(e)},!0));return L.isFirefox&&I.push(St(e,"drop",function(e){e.preventDefault(),e.stopPropagation()})),function(){I.forEach(function(e){return e()})}}function gt(e,t){switch(t){case"vertical":ft.remove(),mt.remove(),e.appendChild(dt),e.appendChild(vt);break;case"row":dt.remove(),vt.remove(),e.appendChild(ft),e.appendChild(mt)}}function bt(){dt.remove(),vt.remove(),ft.remove(),mt.remove()}function yt(e){switch(e){case dt:return"upper";case vt:return"bottom";case mt:return"right";case ft:return"left"}}function St(e,t,n,i){return e.addEventListener(t,n,i),function(){e.removeEventListener(t,n,i)}}mt.setAttribute("side","right");var It=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{offset:8,offsetHeightRatio:.06,width:2,container:document.body,side:ct.left};s(this,e),G(this,"defaultOptions",void 0),G(this,"element",void 0),this.defaultOptions=t,this.element=document.createElement("div"),this.element.classList.add("fv__ui-thumbnail-indicator-line")}return l(e,[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({},this.defaultOptions,t),i=n.offset,r=void 0===i?8:i,a=n.offsetHeightRatio,o=void 0===a?.06:a,s=n.width,u=void 0===s?2/(window.devicePixelRatio||1):s,l=n.container,c=void 0===l?document.body:l,h=n.side,d=void 0===h?ct.left:h;if(d===ct.left||d===ct.right){var v=e.offsetTop,f=e.offsetHeight;if(this.element.style.cssText+="\n                top: ".concat(v-f*o*.5,"px;\n                width: ").concat(u,"px;\n                height: ").concat(f*(1+o),"px;\n            "),d===ct.left){var m=e.offsetLeft;this.element.style.cssText+="\n                    left: ".concat(m-r,"px;\n                ")}else{var p=e.offsetLeft+e.offsetWidth;this.element.style.cssText+="\n                    left: ".concat(p+r,"px;\n                ")}}else this.element.style.cssText+="\n                width: ".concat(e.offsetWidth,"px;\n                height: ").concat(u,"px;\n                left: ").concat(e.offsetLeft,"px;\n            "),d===ct.upper?this.element.style.cssText+="\n                    top: ".concat(e.offsetTop-r,"px;\n                "):this.element.style.cssText+="\n                    top: ".concat(e.offsetTop+e.offsetHeight+r,"px;\n                ");c.appendChild(this.element)}},{key:"hide",value:function(){this.element.parentElement&&this.element.parentElement.removeChild(this.element)}}]),e}(),kt=function(e){function t(){var e;return s(this,t),G(e=i(this,t,arguments),"listService",void 0),G(e,"ppoService",void 0),G(e,"ppoPermission",void 0),G(e,"component",void 0),e}return h(t,e),l(t,[{key:"isDisplayInARow",value:function(){var e=this.component,t=e.childAt(0),n=e.childAt(1);return!(!t||!n)&&t.element.offsetTop!==n.element.offsetTop}},{key:"componentMounted",value:function(){var e=this,t=this.component.element,n=new It({container:t,width:2}),i=!1;this.addDestroyHook(this.ppoPermission.onModPermissionChange(function(e){i=e}),this.listService.onSelectedItemChange(function(e){t.querySelectorAll("[thumbnail-id][draggable]").forEach(function(e){e.removeAttribute("draggable")}),e.size>0&&t.querySelectorAll(Array.from(e).map(function(e){return"[thumbnail-id=".concat(e.id,"]")}).join(",")).forEach(function(e){e.setAttribute("draggable","true")})}));var a=pt(t,{usable:function(){return i},isDragTarget:function(e){return!!r(e,Element)&&!!e.closest(".fv__ui-thumbnail-item")},detectDirection:function(){return e.isDisplayInARow()?"vertical":"row"},transformTarget:function(e){return r(e,Element)?e.closest(".fv__ui-thumbnail-item"):null},listeners:{dragstart:function(e,t){},dragenter:function(t){var i=t.dragOverElement;n.hide();var r=t.dragOverElement.getAttribute("thumbnail-id");if(r){var a=e.listService.getThumbnailItemById(r);if(a){e.component.childAt(a.pageIndex).hideContextMenu();var o=e.getDestPageIndex(r,t.side);if(!(o<0)){var s=e.getSelectedPageIndexes();e.shouldOperationBeIgnored(s,o)||n.show(i,{side:t.side})}}}},dragend:function(t){n.hide();var i=t.dragOverElement.getAttribute("thumbnail-id");i&&e.movePage(i,t)},dragleave:function(){n.hide()}}});this.addDestroyHook(a)}},{key:"isCopyPagesOperation",value:function(){return!1}},{key:"shouldOperationBeIgnored",value:function(e,t){var n,i;if(this.isCopyPagesOperation())return!1;e.sort();var r=(n=Math).max.apply(n,[t].concat(ae(e)))+1,a=Array(r).fill(0).map(function(e,t){return t}),o=a.slice(0);return e.slice(0).sort(function(e,t){return e>t?-1:1}).forEach(function(e){e<t&&t--,o.splice(e,1)}),(i=o).splice.apply(i,[t,0].concat(ae(e))),!o.some(function(e,t){return a[t]!==e})}},{key:"getDestPageIndex",value:function(e,t){var n=this.listService.getThumbnailItemById(e);if(!n)return-1;switch(t){case ct.left:case ct.upper:return n.pageIndex;case ct.right:case ct.bottom:return n.pageIndex+1}}},{key:"getSelectedPageIndexes",value:function(){return Array.from(this.listService.getSelectedItems()).map(function(e){return e.pageIndex}).sort()}},{key:"movePage",value:function(e,t){var n=t.side,i=this.getDestPageIndex(e,n);if(!(i<0)){var r=this.getSelectedPageIndexes();if(this.isCopyPagesOperation())this.ppoService.copyPages(r,i);else{if(this.shouldOperationBeIgnored(r,i))return;this.ppoService.movePages(r,i)}}}}],[{key:"getName",value:function(){return"rearrange-pages"}},{key:"inject",value:function(){return{listService:ve,ppoService:Qe,ppoPermission:tt}}}]),t}(b);te.getRegistry().registerDirective(kt);var wt={width:12,height:12},Pt="fv__ui-thumbnail-visible-rect-control-resizing",xt="fv__ui-thumbnail-visible-rect-control-moving",Ct=Math.max,Et=Math.min,Tt=function(e){function t(e){var n;return s(this,t),G(n=i(this,t),"element",document.createElement("div")),G(n,"currentRatio",1),G(n,"isVisible",!0),G(n,"getThumbnailSize",void 0),G(n,"onPositionUpdated",void 0),G(n,"onRectUpdated",void 0),G(n,"onStartOperate",void 0),G(n,"onEndOperate",void 0),n.getThumbnailSize=e.getThumbnailSize,n.onPositionUpdated=e.onPositionUpdated,n.onRectUpdated=e.onRectUpdated,n.onStartOperate=e.onStartOperate,n.onEndOperate=e.onEndOperate,n.init(),n}return h(t,e),l(t,[{key:"init",value:function(){var e=this;this.element.classList.add("fv__ui-thumbnail-visible-rect-control");var t,n,i,r,a=2,o=function(e){2!==a&&(e.preventDefault(),e.stopPropagation())},s=new j.Manager(this.element);s.add(new j.Pan({direction:j.DIRECTION_ALL})),s.on("panstart",function(o){i=t={left:e.element.offsetLeft,top:e.element.offsetTop},r=n={width:e.element.offsetWidth,height:e.element.offsetHeight},e.onStartOperate(a)}),s.on("panmove",function(o){if(0===a){var s={left:o.deltaX,top:o.deltaY};i=e.handleMove(t,s,n)}else if(1===a){var u={width:o.deltaX,height:o.deltaY};r=e.handleResize(n,u)}}),s.on("panend",function(t){0===a?e.triggerPositionUpdate(i):1===a&&e.triggerSizeUpdate(i,r),e.onEndOperate(a)}),this.addDestroyHook(function(){s.destroy()},this.addEventListener("mousemove",function(t){a=e.resolveOperationType(t.offsetX,t.offsetY),e.updateOperatingStyle(a)}),this.addEventListener("dragstart",o),this.addEventListener("pointerdown",o))}},{key:"triggerPositionUpdate",value:function(e){this.onPositionUpdated({left:e.left/this.currentRatio,top:e.top/this.currentRatio})}},{key:"triggerSizeUpdate",value:function(e,t){this.onRectUpdated({left:e.left/this.currentRatio,top:e.top/this.currentRatio,width:t.width/this.currentRatio,height:t.height/this.currentRatio})}},{key:"handleResize",value:function(e,t){var n=e.width+t.width,i=e.height+t.height,r=this.getThumbnailSize(),a=r.width-this.element.offsetLeft,o=r.height-this.element.offsetTop,s=Ct(wt.width,Et(n,a)),u=Ct(wt.height,Et(i,o));return this.element.style.cssText+="\n            width: ".concat(s,"px;\n            height: ").concat(u,"px;\n        "),{width:s,height:u}}},{key:"handleMove",value:function(e,t,n){var i=this.getThumbnailSize(),r=i.width-n.width,a=i.height-n.height,o=e.left+t.left,s=e.top+t.top,u=Ct(0,Et(o,r)),l=Ct(0,Et(s,a));return this.element.style.cssText+="\n            left: ".concat(u,"px;\n            top: ").concat(l,"px;\n        "),{left:u,top:l}}},{key:"resolveOperationType",value:function(e,t){var n=this.element.offsetWidth-6,i=this.element.offsetHeight-6;return e>=n&&t>=i?1:e<=6||e>=n||t<=6||t>=i?0:2}},{key:"updateOperatingStyle",value:function(e){switch(this.element.classList.remove(Pt),this.element.classList.remove(xt),e){case 1:this.element.classList.add(Pt);break;case 0:this.element.classList.add(xt)}}},{key:"addEventListener",value:function(e,t){var n=this;return this.element.addEventListener(e,t),function(){n.element.removeEventListener(e,t)}}},{key:"show",value:function(){this.isVisible=!0,this.element.classList.remove("fv__ui-hide")}},{key:"hide",value:function(){this.isVisible=!1,this.element.classList.add("fv__ui-hide")}},{key:"update",value:function(e,t){var n=this.getThumbnailSize(),i=t.width,r=t.height,a=n.width/e.width;this.currentRatio=a,this.element.style.cssText+="\n            left: ".concat(t.left*a,"px;\n            top: ").concat(t.top*a,"px;\n            width: ").concat(i*a,"px;\n            height: ").concat(r*a,"px;\n        ")}}]),t}(A),Dt=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"listService",void 0),G(e,"viewer",void 0),G(e,"attrName",void 0),G(e,"component",void 0),G(e,"control",void 0),e}return h(n,t),l(n,[{key:"init",value:function(t){var i=this;if(Q(e(n.prototype),"init",this).call(this,t),!r(t,ze))throw new Error("The directive @".concat(this.attrName," must be used on <thumbnail:thumbnail-viewer> component!"));q.property(this,"control",function(){var e=!1,n=new Tt({getThumbnailSize:function(){return i.getThumbnailSize()},onPositionUpdated:function(e){return i.updatePagePosition(e)},onRectUpdated:function(e){return i.updatePageRect(e)},onStartOperate:function(){e=!0},onEndOperate:function(){e=!1}});t.element.appendChild(n.element);var r=i.viewer.getPDFViewerRender();return i.addDestroyHook(r.scrollWrap.addScrollEventListener(function(){e||i.updateVisibleRect()})),n}),this.addDestroyHook(t.on("update-thumbnail",function(){i.updateVisibleRect()}),t.pdfUI.addViewerEventListener(T.renderPageSuccess,function(e){var t=i.getPageRender(),n=q.isPropertyIntialized(i,"control")?i.control:void 0;(t===e||(null==n?void 0:n.isVisible))&&i.updateVisibleRect()}))}},{key:"getThumbnailSize",value:function(){var e=this.component.getThumbnailImage();return e?{width:e.width,height:e.height}:{width:0,height:0}}},{key:"updatePagePosition",value:function(e){var t=this.getPageRender();if(t){var n=t.getCurrentVisibleRect(),i=e.left-n.left,r=e.top-n.top;this.viewer.getPDFViewerRender().scrollWrap.scrollBy(i,r)}}},{key:"updatePageRect",value:function(e){var t=this;if(this.viewer.getPDFViewerRender()){var n=this.getPageRender();if(n){var i=n.getCurrentVisibleRect(),r=i.width/e.width,a=i.height/e.height,o=Math.min(r,a),s=n.scale,u=n.rotate,l=s*o;n.getPDFPage().then(function(i){var r=et(i.reverseDevicePoint([e.left,e.top],s,u),2),a=r[0],o=r[1];t.component.pdfUI.zoomTo(l,{pageIndex:n.index,x:a,y:o})})}}}},{key:"getPageRender",value:function(){var e=this.component.getThumbnailId();if(e){var t=this.viewer.getPDFDocRender();if(t){var n=this.listService.getThumbnailItemById(e);if(n){var i=t.getPDFPageRender(n.pageIndex);if(i)return i}}}}},{key:"updateVisibleRect",value:function(){var e=this.viewer.getPDFDocRender();if(e){var t=this.getPageRender();if(t)if(e.getCurrentPageIndex()===t.index){this.control.show();var n=t.getCurrentVisibleRect(),i={width:t.$ui.width(),height:t.$ui.height()};this.control.update(i,n)}else q.isPropertyIntialized(this,"control")&&this.control.hide()}}}],[{key:"getName",value:function(){return"visible-rect-control"}},{key:"inject",value:function(){return{listService:ve,viewer:E}}}]),n}(b);te.getRegistry().registerDirective(Dt);var Lt=a(355),Rt=a.n(Lt);p.root().registerPreConfiguredComponent("thumbnail-sidebar-panel",{template:Rt()()});var At=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"thumbnailListService",void 0),G(e,"text","thumbnail:contextmenu.deletePage"),e}return h(n,t),l(n,[{key:"mounted",value:function(){var t=this;Q(e(n.prototype),"mounted",this).call(this),this.addDestroyHook(this.parent.on("shown",function(){t.thumbnailListService.getSelectedItems().size>1?t.text="thumbnail:contextmenu.delete":t.text="thumbnail:contextmenu.deletePage",t.digest(!0)}))}}],[{key:"getName",value:function(){return"delete-page-contextmenu-item"}},{key:"inject",value:function(){return{thumbnailListService:ve}}}]),n}(m.createSuperClass({template:'\n        <contextmenu-item feature="delete" @controller="thumbnail:DeletePageController" @setter.text="$component.text"></contextmenu-item>\n    '}));te.registerComponent(At);var _t=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"component",void 0),G(e,"viewer",void 0),G(e,"ppoFeaturesService",void 0),G(e,"listService",void 0),G(e,"ppoPermissionService",void 0),e}return h(n,t),l(n,[{key:"init",value:function(t){Q(e(n.prototype),"init",this).call(this,t),t.setAttribute("draggable","true")}},{key:"componentMounted",value:function(){var e=this;if(!D.isMobile){var t,n,i,a,o=this.component.element,s=new It({container:o}),u=!1;this.addDestroyHook(this.ppoPermissionService.onModPermissionChange(function(e){u=e})),n={usable:function(){return u},isDragTarget:function(e){return!!r(e,Element)&&!!e.closest(".fv__ui-thumbnail-item")},transformTarget:function(e){return r(e,Element)?e.closest(".fv__ui-thumbnail-item"):null},detectDirection:function(){return e.isDisplayInARow()?"vertical":"row"},listeners:{dragover:function(e){u&&s.show(e.dragOverElement,{side:e.side})},drop:function(t){if(u){s.hide();var n=t.fileList[0];if(n){var i=e.getDropOverPageIndex(t.dragOverElement,t.side);-1!==i&&e.mergeFile(n,i)}}},dragleave:function(){s.hide()},abort:function(){s.hide()}}},St(t=o,"dragover",function(e){var t;if(e.preventDefault(),L.isSafari||(null===(t=e.dataTransfer)||void 0===t?void 0:t.items.length)){var r=e.target;if(r&&n.isDragTarget(r)){var o=n.transformTarget(r);if(o){var s=yt(r);if(s)return i=s,a=o,void n.listeners.dragover({dragOverElement:o,side:s,sourceEvent:e});gt(o,n.detectDirection())}}}},!0),St(t,"dragleave",function(e){var r=document.elementFromPoint(e.clientX,e.clientY);a&&i&&!t.contains(r)&&n.listeners.dragleave()}),St(t,"drop",function(e){var t;e.preventDefault();var r=null===(t=e.dataTransfer)||void 0===t?void 0:t.files,o=i,s=a;i=void 0,a=void 0,r&&o&&s?(n.listeners.drop({fileList:r,side:o,dragOverElement:s}),bt()):n.listeners.abort()})}}},{key:"getDropOverPageIndex",value:function(e,t){var n=e.getAttribute("thumbnail-id");if(n){var i=this.listService.getThumbnailItemById(n);if(i)switch(t){case ct.left:case ct.upper:return i.pageIndex;case ct.right:case ct.bottom:return i.pageIndex+1}}var r=this.viewer.getCurrentPDFDoc();return r?r.getPageCount():-1}},{key:"mergeFile",value:function(e,t){var n=this,i=this.component.getPDFUI(),r=function(){i.alert({message:"alert.formatError",level:"error"})};this.viewer.getCurrentPDFDoc()&&F.isPDFFile(e).then(function(a){a?i.loading().then(function(i){try{return n.ppoFeaturesService.mergeDoc(t,e).finally(function(){i.close()})}catch(e){throw i.close(),e}}):r()},function(e){r()})}},{key:"isDisplayInARow",value:function(){var e=this.component,t=e.childAt(0),n=e.childAt(1);return!(!t||!n)&&t.element.offsetTop!==n.element.offsetTop}},{key:"checkPermission",value:function(){var e=this;return this.ppoPermissionService.hasModPermission().then(function(t){e.component.ableModDoc=t})}}],[{key:"getName",value:function(){return"drop-to-merge-doc"}},{key:"inject",value:function(){return{ppoFeaturesService:Qe,listService:ve,ppoPermissionService:tt,viewer:E}}}]),n}(b);te.getRegistry().registerDirective(_t);var Ot=function(t){function n(){var e;return s(this,n),G(e=i(this,n,arguments),"permissionService",void 0),G(e,"permissionChecker",{rotate:function(){return e.permissionService.hasRotatePermission()},delete:function(){return e.permissionService.hasDeletePermission()},insert:function(){return e.permissionService.hasInsertPermission()},mod:function(){return e.permissionService.hasModPermission()}}),e}return h(n,t),l(n,[{key:"init",value:function(t){var i=this;Q(e(n.prototype),"init",this).call(this,t);var r=Object.keys(this.permissionChecker);this.addDestroyHook(t.on("shown",function(){r.forEach(function(e){(0,i.permissionChecker[e])().then(function(n){t.querySelectorAll("[feature=".concat(e,"]")).forEach(function(e){n?e.unlock():e.lock()})})})}))}}],[{key:"getName",value:function(){return"permission"}},{key:"inject",value:function(){return{permissionService:tt}}}]),n}(b);te.getRegistry().registerDirective(Ot);var zt=function(e){function t(){return s(this,t),i(this,t,arguments)}return h(t,e),l(t,[{key:"init",value:function(e){this.pdfUI=e}},{key:"zoomTo",value:function(e){return"number"==typeof e&&this.pdfUI.getServiceInstance(J).zoomTo(e)}},{key:"getZoomScale",value:function(){return this.pdfUI.getServiceInstance(J).getScaleRatio()}},{key:"setAvailableScaleValues",value:function(e,t){return!(!Array.isArray(e)||-1===e.indexOf(t))&&this.pdfUI.getServiceInstance(J).setAvailableScaleValues(e,t)}},{key:"onSelectThumbnail",value:function(e){var t;return this.pdfUI.getServiceInstance(ve).onSelectedItemChange(function(n){var i=Array.from(n).map(function(e){return e.pageIndex});t?(i.length!==t.length||i.some(function(e){return-1===t.indexOf(e)}))&&e(i,t):e(i,[]),t=i})}}],[{key:"getName",value:function(){return"thumbnail"}},{key:"getLoader",value:function(){return K()}}]),t}(f);const Ft=zt})(),o=o.default})());
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.DocAttachmentUIXAddon=t(require("UIExtension")):e.DocAttachmentUIXAddon=t(e.UIExtension)}(self,e=>(()=>{var t={597:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer name="doc-attachment-dialog" @controller="doc-attachment:DocAttachmentDialogController" class="fv__ui-doc-attachment-layer center websdk-modal" append-to="body" @draggable backdrop>\n<layer-header title="doc-attachment:dialog.title"></layer-header>\n<div class="c_a" @stop-drag>\n<div class="fv__ui-dialog-button fv__ui-dialog-ok-button w_160" name="addFilesBtn" tabindex="0" @aria:labelledby="::parent()::previousSiblings()::childAt(0)">doc-attachment:dialog.addFiles</div>\n<input type="file" multiple name="fileInput" class="d_n"/>\n<div class="mt_10" data-i18n="doc-attachment:dialog.addTip"></div>\n<div class="mt_5 mb_10" data-i18n="doc-attachment:dialog.okTip"></div>\n<div class="fv__table-fixed-head" name="attachment-table">\n<div class="thead">\n<div class="tr">\n<div class="td w_40z" data-i18n="doc-attachment:dialog.fileName"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileSize"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileType"></div>\n</div>\n</div>\n<div class="tbody" name="fileTable"></div>\n</div>\n<div class="d_f jc_fe mt_20 footer">\n<button class="fv__ui-dialog-ok-button fv__button-ok ml_10" name="okBtn">doc-attachment:dialog.ok</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="cancelBtn">doc-attachment:dialog.cancel</button>\n</div>\n</div>\n</layer>'}},912:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer name="same-file-name-confirm" @controller="doc-attachment:SameFileNameConfirmController" class="fv__ui-same-file-name-layer center" append-to="body" @draggable backdrop>\r\n<div class="d_f ai_c jc_sb fs_16 h_30 mb_20">\r\n<div data-i18n="doc-attachment:dialog.title" class="fs_16"></div>\r\n<div class="c_p pb_5 c_666 fs_24 w_30 h_30 lh_30 d_f jc_c ai_c" name="closeBtn">Ã—</div>\r\n</div>\r\n<div class="c_a" @stop-drag>\r\n<div name="content"></div>\r\n<div class="d_f jc_sb mt_20 fw_w">\r\n<label class="d_f ai_c h_30">\r\n<input type="checkbox" name="applyToAllFiles"/>\r\n<div class="fs_0" data-i18n="doc-attachment:same-file-name-confirm.applyToAllFiles"></div>\r\n</label>\r\n<div class="fs_0 footer">\r\n<button class="fv__ui-dialog-cancel-button fv__button-cancel" name="replaceBtn">doc-attachment:same-file-name-confirm.replace</button>\r\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="renameBtn">doc-attachment:same-file-name-confirm.renameAndAttached</button>\r\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="skipBtn">doc-attachment:same-file-name-confirm.skip</button>\r\n</div>\r\n</div>\r\n</div>\r\n</layer>'}},207:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},a=Object.create(i),o=/["&'<>]/;function r(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?r(e.call(e)):JSON.stringify(e)),e}a.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var i="",a=void 0,r=void 0,l=void 0;for(a=n.index,r=0;a<t.length;a++){switch(t.charCodeAt(a)){case 34:l="&#34;";break;case 38:l="&#38;";break;case 39:l="&#39;";break;case 60:l="&#60;";break;case 62:l="&#62;";break;default:continue}r!==a&&(i+=t.substring(r,a)),r=a+1,i+=l}return r!==a?i+t.substring(r,a):i}(r(e))},a.$each=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n);else for(var a in e)t(e[a],a)},e.exports=a},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function o(i,a,o){return a=e(a),n(i,t()?Reflect.construct(a,o||[],e(i).constructor):a.apply(i,o))}function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):r(e,t)}function l(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o=[],r=!0,l=!1;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);r=!0);}catch(e){l=!0,a=e}finally{try{r||null==n.return||n.return()}finally{if(l)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.d(a,{default:()=>x});var h=i(616),p=i(207),v=i.n(p);function b(t,n,i){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,i){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(a){var o=Object.getOwnPropertyDescriptor(a,n);return o.get?o.get.call(i||t):o.value}},b(t,n,i||t)}h.PDFViewCtrl.PDF.constant.NameTreeType;var g=h.PDFViewCtrl.Deps.jQuery,y=h.UIConsts.COMPONENT_EVENTS,_=function(t){function n(){return l(this,n),o(this,n,arguments)}return d(n,t),s(n,[{key:"mounted",value:function(){b(e(n.prototype),"mounted",this).call(this),this.$dialog=g(this.component.element),this.$closeBtn=g("[name=closeBtn]",this.$dialog),this.$content=g("[name=content]",this.$dialog),this.$applyToAllFiles=g("[name=applyToAllFiles]",this.$dialog),this.$replaceBtn=g("[name=replaceBtn]",this.$dialog),this.$renameBtn=g("[name=renameBtn]",this.$dialog),this.$skipBtn=g("[name=skipBtn]",this.$dialog),this._bindEvent()}},{key:"_bindEvent",value:function(){var e=this;this.getPDFUI();this.component.on(y.HIDDEN,function(){e.$applyToAllFiles.prop("checked",!1).hide()}),this.$closeBtn.on("click",function(t){e.component.hide()}),this.$replaceBtn.on("click",function(t){e.replaceCallback&&e.replaceCallback(e.$applyToAllFiles.prop("checked")),e.component.hide()}),this.$renameBtn.on("click",function(t){e.renameCallback&&e.renameCallback(e.$applyToAllFiles.prop("checked")),e.component.hide()}),this.$skipBtn.on("click",function(t){e.skipCallback&&e.skipCallback(e.$applyToAllFiles.prop("checked")),e.component.hide()})}},{key:"_setContent",value:function(e){this.$content.html(e)}},{key:"_setApplyToAllFilesVisible",value:function(e){this.$applyToAllFiles[e?"show":"hide"]()}},{key:"_setReplaceCallback",value:function(e){this.replaceCallback=e}},{key:"_setRenameCallback",value:function(e){this.renameCallback=e}},{key:"_setSkipCallback",value:function(e){this.skipCallback=e}}],[{key:"getName",value:function(){return"SameFileNameConfirmController"}}]),n}(h.Controller),k=h.PDFViewCtrl.shared.fileUtils.formatFileSize,w=h.PDFViewCtrl.PDF.constant.NameTreeType,C=h.PDFViewCtrl.Deps.jQuery,T=h.UIConsts.COMPONENT_EVENTS,A=function(t){function n(e){return l(this,n),o(this,n,[e])}return d(n,t),s(n,[{key:"mounted",value:function(){b(e(n.prototype),"mounted",this).call(this),this.$dialog=C(this.component.element),this.$cancelBtn=C("[name=cancelBtn]",this.$dialog),this.$okBtn=C("[name=okBtn]",this.$dialog),this.$addFilesBtn=C("[name=addFilesBtn]",this.$dialog),this.$fileInput=C("[name=fileInput]",this.$dialog),this.$fileTable=C("[name=fileTable]",this.$dialog),this.$headTr=C(".fv__table-fixed-head > .thead > .tr",this.$dialog),this._bindEvent()}},{key:"_bindEvent",value:function(){var e=this,t=this.getPDFUI(),n=t.i18n,i=function(){e.$fileTable.empty(),e.$fileInput.val(""),e.files=[],e.$headTr.css("paddingRight","")};this.component.on(T.SHOWN,i),this.component.on(T.HIDDEN,i),this.$cancelBtn.on("click",function(t){e.component.hide()}),this.$okBtn.on("click",function(i){e.files.length?t.getPDFViewer().then(function(i){var a=i.currentPDFDoc;a.getNameTree(w.EmbeddedFiles).then(function(i){var o=Object.keys(i),r=[],l=function(){if(r.length===e.files.length){var l=t.addonInstanceMap.UndoRedoAddon.addon,c=(l.controller,l.attachmentModule),s=e.files.map(function(e,t){var l=r[t];return"rename"===l&&(e.fileName=$(o,e.fileName,n.t("doc-attachment:dialog.nameTail"))),a.addFileSpec(e.fileName,e.fileBuffer,e.modifiedDateTime).then(function(t){if("normal"===l)return c&&c.pushUndoStack("add",{fileName:e.fileName,objNum:t,fileBuffer:e.fileBuffer}),a.addEmbeddedFileByAttachments(e.fileName,t);if("replace"===l){var n=i[e.fileName];return c&&c.pushUndoStack("replace",{oldFile:n,objNum:t}),a.setEmbeddedFileByAttachments(e.fileName,t)}if("rename"===l){var o=e.fileName;return c&&c.pushUndoStack("add",{fileName:o,objNum:t,fileBuffer:e.fileBuffer}),a.addEmbeddedFileByAttachments(o,t)}return"skip"===l||void 0})});Promise.all(s).then(function(t){t.reduce(function(e,t){return e+Number(t)},0)===t.length&&e.component.hide()})}},c=function(t,n,i){n?(r=e.files.map(function(e){return o.indexOf(e.fileName)>=0?t:"normal"}),l()):(r.push(t),e.files[i+1]?setTimeout(function(){s(i+1)},100):l())},s=function(t){var i=e.files[t];if(o.indexOf(i.fileName)>=0){var a=$(o,i.fileName,n.t("doc-attachment:dialog.nameTail")),r=n.t("doc-attachment:same-file-name-confirm.tip1",{oldFileName:i.fileName}),l=n.t("doc-attachment:same-file-name-confirm.tip2",{newFileName:a}),s=e.getComponentByName("same-file-name-confirm");s.controller._setContent("".concat(r,"<br>").concat(l)),s.controller._setApplyToAllFilesVisible(!0),s.controller._setReplaceCallback(function(e){return c("replace",e,t)}),s.controller._setRenameCallback(function(e){return c("rename",e,t)}),s.controller._setSkipCallback(function(e){return c("skip",e,t)}),s.show()}else c("normal",!1,t)};s(0)})}):t.alert("doc-attachment:dialog.noFileWarning")}),this.$addFilesBtn.on("click",function(t){e.$fileInput.trigger("click")}),this.$fileInput.on("change",function(n){for(var i=function(i){var a=n.target.files[i];if(e.files.find(function(e){return e.fileName===a.name}))return"continue";if(a.size>268435456)return t.confirm({message:"sidebar.attachment.addAttachmentSizeLimit",level:"warning"}),"continue";if(/(\.exe)$/i.test(a.name))return t.confirm({message:"sidebar.attachment.addAttachmentFileFormat",level:"warning"}),"continue";var o=new FileReader;o.onload=function(){e.$fileTable.append(N(a.name,k(a.size),a.type)),e.files.push({fileName:a.name,fileBuffer:new Uint8Array(o.result),modifiedDateTime:a.lastModifiedDate||a.lastModified||(new Date).getTime()}),i===n.target.files.length-1&&e.$fileInput.val("")},o.readAsArrayBuffer(a)},a=0;a<n.target.files.length;a++)i(a)});var a=function(){var t=e.$fileTable.get(0),n=t.offsetWidth-t.clientWidth;e.$headTr.css("paddingRight",n>0?"".concat(n,"px"):"")};if(window.MutationObserver){var o=new MutationObserver(function(){a()});o.observe(this.$fileTable.get(0),{childList:!0}),this.addDestroyHook(function(){o.disconnect()})}else this.$fileTable.on("DOMNodeInserted",a)}}],[{key:"getName",value:function(){return"DocAttachmentDialogController"}}]),n}(h.Controller),N=function(e,t,n){return'\n        <div class="tr '.concat(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?"selected":"",'">\n            <div class="td w_40z">').concat(e,'</div>\n            <div class="td w_30z">').concat(t,'</div>\n            <div class="td w_30z">').concat(n,"</div>\n        </div>\n    ")},$=function(e,t,n){var i=t,a=function(t){if(e.indexOf(t)>=0){var o=m(t.split("."),2),r=o[0],l=o[1];i="".concat(r).concat(n,".").concat(l),a(i)}};return a(i),i},F=i(597),D=i.n(F),B=i(912),O=i.n(B),E=h.shared.replaceRibbonButton2XButton,I=h.UIConsts.COMPONENT_EVENTS,P=h.PDFViewCtrl.constants.STATE_HANDLER_NAMES.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT,S=function(){function e(t){return l(this,e),o(this,e,[t])}return d(e,PDFViewCtrl.IStateHandler),s(e,null,[{key:"getStateName",value:function(){return P}}]),e}(),x=function(e){function t(){return l(this,t),o(this,t,arguments)}return d(t,e),s(t,[{key:"fragments",value:function(){return[]}},{key:"init",value:function(e){this.pdfUI=e,this.pdfUI.getPDFViewer().then(function(e){e.getStateHandlerManager().register(S)})}},{key:"receiveAction",value:function(e,t){var n=this.pdfUI;if("showDialog"===e){var i=n.getComponentByName("template-container");this.inited||(i=i.then(function(e){e.append(D()()),e.append(O()())}),this.inited=!0),i.then(function(e){n.getComponentByName("doc-attachment-dialog").then(function(e){e&&e.show(),e.on(I.HIDDEN,function(){n.getStateHandlerManager().then(function(e){e.switchTo()})}),e.on(I.CANCEL,function(){n.getStateHandlerManager().then(function(e){e.switchTo()})})})})}}}],[{key:"getName",value:function(){return"docAttachment"}},{key:"getLoader",value:function(){return v()}},{key:"initOnLoad",value:function(){var e=h.modular.module("doc-attachment",[]),t={template:'<ribbon-button text="doc-attachment:button-tooltip.title" @tooltip name="doc-attachment-button" icon-class="fv__icon-toolbar-doc-attachment">doc-attachment:button-tooltip.title</ribbon-button>',config:[{target:"doc-attachment-button",tooltip:{title:"doc-attachment:button-tooltip.title"},callback:function(e){function t(e){return l(this,t),o(this,t,[e,S])}return d(t,e),s(t,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then(function(t){return Promise.all([t&&t.getUserPermission().getValue(),e.readonly()])}).then(function(e){var n=m(e,2),i=n[0],a=n[1];8&i&&!a?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})}},{key:"handle",value:function(){this.pdfUI.getStateHandlerManager().then(function(e){e.switchTo(P)}),this.pdfUI.callAddonAPI("DocAttachmentUIXAddon","showDialog")}}],[{key:"getName",value:function(){return"DocAttachmentController"}},{key:"permission",get:function(){return h.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm}}]),t}(h.StatefulController)}]};e.registerPreConfiguredComponent("doc-attachment-ribbon-button",t),e.registerPreConfiguredComponent("doc-attachment-button",Object.assign({},t,{template:E(t.template)})),e.registerController(A),e.registerController(_)}}]),t}(h.UIXAddon)})(),a=a.default})());
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.RedactionAddon=t(require("UIExtension")):e.RedactionAddon=t(e.UIExtension)}(self,e=>(()=>{var t={819:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer name="redaction-page-popup" class="fv__redaction-page-popup center"  append-to="body" class="center" modal backdrop >\n<layer-header title="redaction:buttons.redact_page" @draggable="{type:\'parent\'}"></layer-header>\n<div class="fv__range-body">\n<div class="fv__range-title">redaction:dialog.pageRange</div>\n<div class="fv__range-types">\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" checked value="1" />\n<span data-i18n="redaction:dialog.redaction_page.mark_current_page"></span>\n</label>\n</div>\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" value="2" />\n<span data-i18n="redaction:dialog.redaction_page.mark_specific_page"></span>\n<div class="fv__redaction-range">\n<range:input\nname="redactPages"\nlayer-name="redaction-page-popup"\ntype="common"\nrange="1"\npage-count="1"></range:input>\n</div>\n</label>\n</div> \n</div> \n</div> \n<div class="fv__redaction-container footer" style="text-align:right">\n<button type="button" class="fv__redaction-btn fv__ui-dialog-ok-button" name="fv__ui-dialog-ok-button" data-i18n="redaction:buttons.ok"></button>\n<button type="button" class="fv__redaction-cancel fv__ui-dialog-cancel-button" name="fv__ui-dialog-cancel-button" data-i18n="redaction:buttons.cancel"></button>\n</div>\n</layer>'}},6:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<dropdown @tooltip name="create-redaction-controllers" tooltip-title="redaction:tooltips.redaction" icon-class="fv__icon-toolbar-redaction" popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" text="redaction:buttons.title" separate="false">\n<dropdown-button class="fv__ui-redaction-item" name="create-text-redaction" @controller="redaction:RedactionTextAndImageController" icon-class="fv__icon-toolbar-text-redaction" tabindex="0">\nredaction:buttons.redact_text\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-area-redaction" @controller="redaction:RedactionController" icon-class="fv__icon-toolbar-area-redaction" tabindex="0">\nredaction:buttons.redact_area\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-page-redaction" @controller="redaction:RedactionPageController" icon-class="fv__icon-toolbar-page-redaction" tabindex="0">\nredaction:buttons.redact_page\n</dropdown-button>\n</dropdown>'}},437:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button icon-class="fv__icon-toolbar-redaction" @tooltip name="create-redaction-controllers" @var.self="$component"  tooltip-title="redaction:tooltips.redaction" text="redaction:buttons.title" not-immediately="true">\n<dropdown popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" name="create-redactions-ribbon-inner-dropdown" separate="false">\n\x3c!-- <redaction:create-text-image-redaction-button></redaction:create-text-image-redaction-button> --\x3e\n\x3c!-- <redaction:create-area-redaction-button></redaction:create-area-redaction-button> --\x3e\n<redaction:create-text-images-redaction-button></redaction:create-text-images-redaction-button>\n<redaction:create-page-redaction-button @require-modules="range"></redaction:create-page-redaction-button>\n<redaction:redaction-search-button></redaction:redaction-search-button>\n<li class="fv__ui-dropdown-separator"></li>\n<redaction:apply-redactions-button></redaction:apply-redactions-button>\n</dropdown>\n</ribbon-button>'}},557:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-redaction-item"\nname="create-page-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_page"\n@controller="redaction:RedactionPageController"\nicon-class="fx-icon-sm fv__icon-toolbar-page-redaction">\nredaction:buttons.redact_page\n</xbutton>'}},683:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-redaction-item"\nname="create-text-image-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_text_image"\n@controller="redaction:RedactionController"\nicon-class="fx-icon-sm fv__icon-toolbar-text-image-redaction">\nredaction:buttons.redact_text_image\n</xbutton>'}},408:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},o=Object.create(r),a=/["&'<>]/;function i(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?i(e.call(e)):JSON.stringify(e)),e}o.$escape=function(e){return function(e){var t=""+e,n=a.exec(t);if(!n)return e;var r="",o=void 0,i=void 0,c=void 0;for(o=n.index,i=0;o<t.length;o++){switch(t.charCodeAt(o)){case 34:c="&#34;";break;case 38:c="&#38;";break;case 39:c="&#39;";break;case 60:c="&#60;";break;case 62:c="&#62;";break;default:continue}i!==o&&(r+=t.substring(i,o)),i=o+1,r+=c}return i!==o?r+t.substring(i,o):r}(i(e))},o.$each=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(e[n],n);else for(var o in e)t(e[o],o)},e.exports=o},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function a(r,o,a){return o=e(o),n(r,t()?Reflect.construct(o,a||[],e(r).constructor):o.apply(r,a))}function i(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):i(e,t)}function c(e,t){if(!i(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}r.d(o,{default:()=>ye});var p=r(616);function f(t,n,r){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,r){var o=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(o){var a=Object.getOwnPropertyDescriptor(o,n);return a.get?a.get.call(r||t):a.value}},f(t,n,r||t)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const v="apply-redaction",m="apply-all-redaction",y="annotation-removed",b="add-redaction-area",P="flatten-annotation";function w(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){w(a,r,o,i,c,"next",e)}function c(e){w(a,r,o,i,c,"throw",e)}i(void 0)})}}function x(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var C=p.PDFViewCtrl,_=p.getDevicePagePoint,D=p.vendors.Hammer,R=C.shared.DebouncePromiseQueue,A=C.PDF.constant.Graphics_ObjectType,S=C.stateHandler.StateHandlerUtils,F=S.appendSelectMark,E=S.removeSelectMark,I=function(){function e(t){c(this,e),this.owner=t,this.cursorStyle="fv__cursor-text",this.destroyHooks=[],this.isTextSelect=!1,this.pdfViewer=t.pdfViewer}return u(e,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n,r=e.$handler,o=r.get(0),a=function(e){t.owner.shapeControl||t.panStatus?n&&clearTimeout(n):(n&&clearTimeout(n),n=setTimeout(function(){var n=_(o,{srcEvent:e,deltaX:0,deltaY:0}),a=[n.x,n.y],i=[a[0]+10,a[1]+10];t.getTextRect(a,i,-1,-1).then(function(e){var n=t.isTextSelect=e&&e.length>0;r.removeClass(t.cursorStyle).removeClass(t.owner.cursorStyle).addClass(n?t.cursorStyle:t.owner.cursorStyle)})},50))},i=this.pdfViewer.customs.OtelFnWrapper||function(e,t,n){return n};o.addEventListener("mousemove",a),this.destroyHooks.push(function(){o.removeEventListener("mousemove",a)});var c=this.owner.hammer;c.add(new D.Tap({event:"doubletap",taps:2})),c.on("doubletap",i("doubletap",!0,function(e){t.hideSelectMark(),t.doubleClickSelectHandle(e,o)}))}},{key:"panstart",value:function(e){this.panStatus="start";var t=this.pageRender.$handler.get(0);this.start=-1,this.end=-1;var n=_(t,e);this.startPoint=[n.x,n.y],this.hideSelectMark(),this.debouncePromiseQueue=new R}},{key:"panmove",value:function(e){var t=this;this.debouncePromiseQueue.push(function(){var n=t.pageRender,r=t.startPoint,o=[r[0]+e.deltaX,r[1]+e.deltaY];return t.getTextRect(r,o,t.start,t.end).then(function(e){var r;return(r=e[0])&&"string"==typeof r.text&&(t.start=r.start,t.end=r.end),Promise.all([n.getPDFPage(),e])}).then(function(e){var t=g(e,2),r=t[0],o=t[1];return n.transformRectArray(r,o)}).then(function(e){t.showSelectMark(e)})})}},{key:"panend",value:function(e){var t=this;this.debouncePromiseQueue.end(),this.debouncePromiseQueue=null,this.panStatus=void 0;var n=this.pageRender,r=this.startPoint,o=[r[0]+e.deltaX,r[1]+e.deltaY];return this.getTextRect(r,o,this.start,this.end).then(function(e){var r;return(r=e[0])&&"string"==typeof r.text&&(t.start=r.start,t.end=r.end),t.hideSelectMark(),Promise.all([n.getPDFPage(),e])}).then(function(e){var n=g(e,2),r=n[0],o=n[1];return o.length<1?Promise.resolve():t.addAnnot(r,o).then(function(e){var n=e[0],r=t.pageRender.annotsRender.getAnnotRender(n.getId()).component;return t.afterAddAnnot(r),t.pageRender.annotsRender.activeAnnot(n.getId()),e}).then(function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}).catch(function(e){})})}},{key:"getTextRect",value:function(e,t,n,r){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,r)}},{key:"showSelectMark",value:function(e){F(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){E(this.pageRender.$handler)}},{key:"addAnnot",value:function(e,t){var n=this;return e.markRedactAnnot(t).then(function(e){var t=e[0];t.setViewRotate(n.pageRender.getRotation()),t.setSubject(n.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var r=n.pdfViewer.getAnnotDefaultProperty("redact"),o=16711680;return r.defaultAppearance&&void 0!==r.defaultAppearance.textColor&&(o=r.defaultAppearance.textColor),t.setRedactAppearance(Object.assign({textColor:o},r)),e}).catch(function(e){if(-6===e.error)return n.pdfViewer.viewerUI.alert("dialog.error.noRedactionLicense"),Promise.reject(e)})}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit("markRedactAnnotSuccess",e.annot)}},{key:"doubleClickSelectHandle",value:function(e,t){var n=this,r=_(t,e),o=[r.x,r.y],a=this.pageRender;a.getPDFPage().then(function(e){return[e,e.reverseDevicePoint(o,a.getScale(),a.getRotation())]}).then(function(e){var t=g(e,2),r=t[0],i=g(t[1],2),c=i[0],s=i[1];r.getGraphicsObjectAtPoint([c,s],0,A.All).then(function(e){if(e){var t=e.getType();if(t===A.Image||t===A.Text){var r=Promise.resolve([e.getRect()]);return t===A.Text&&(r=a.getDoubleClickTextRectAtPoint(o)),Promise.all([a.getPDFPage(),r]).then(function(e){var t=g(e,2),r=t[0],o=t[1];n.addAnnotWithRectArray(r,o)})}}})})}},{key:"addAnnotWithRectArray",value:function(e,t){var n=this;return t.length<1?Promise.resolve():this.addAnnot(e,t).then(function(e){var t=e[0],r=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(r),n.pageRender.annotsRender.activeAnnot(t.getId()),r}).then(function(e){n.pdfViewer.config.showCommentList&&e.showReplyDialog()}).catch(function(e){})}},{key:"destroyPageHandler",value:function(){this.pageRender.$handler.removeClass(this.cursorStyle),this.destroyHooks.forEach(function(e){return e()})}}]),e}(),V=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e,"square"])).pdfViewer=e,n.cursorStyle="fv__cursor-cross",n.destroyHooks=[],n}return d(t,e),u(t,[{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(n,e.y))}}},{key:"start",value:function(e,t){var n=t.left,r=t.top;this.shapeControl||(this.shapeControl=new C.ShapeControl({resizable:!1,enableDiagonally:!0}),this.shapeControl.active(e.$handler,e.$handler,{left:n,top:r,width:0,height:0}))}},{key:"adjust",value:function(e,t,n){var r,o,a=t.x,i=t.y,c=n.x,s=n.y,u=Math.abs(a-c),l=Math.abs(i-s),d={left:r=Math.min(a,c),top:o=Math.min(i,s),width:u=Math.max(u,1),height:l=Math.max(l,1)},p={left:r,top:o,right:r+u,bottom:o+l};e._applyAnnotBoundary(d),e.shape.boundary=p,e.shape.shape=d,e._updatePreviewer()}},{key:"pageHandler",value:function(e){return k(function(){var t,n,r,o,a,i;return x(this,function(c){return t=this,n=this.constructor.getStateName(),this.pageRender=e,r=e.$handler.get(0),e.$handler.addClass(this.cursorStyle),o=this.hammer=new D.Manager(r),(a=this.createnTextAndImageHandler=new I(this)).pageHandler(e),this.addAnnot&&(a.addAnnot=this.addAnnot),o.add(new D.Pan({direction:D.DIRECTION_ALL})),i=this.pdfViewer.customs.OtelFnWrapper||function(e,t,n){return n},o.on("panstart",i(n+"_panStart",!1,function(n){if(t.startPoint=_(r,n),a.isTextSelect)return a.panstart(n);e.getPDFPage().then(function(n){var r=g(n.reverseDevicePoint([t.startPoint.x,t.startPoint.y],t.pageRender.scale,t.pageRender.getRotation()),2),o=r[0],a=r[1];t.start(e,{left:o,top:a})})})),o.on("panmove",function(e){if(a.isTextSelect)return a.panmove(e);var n=t.correctPosition({x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY});return t.currentPoint=n,t.adjust(t.shapeControl,t.startPoint,t.currentPoint)}),o.on("panend",i(n+"_panEnd",!1,function(n){if(a.isTextSelect)return a.panend(n);var r=t.correctPosition({x:t.startPoint.x+n.deltaX,y:t.startPoint.y+n.deltaY});if(t.currentPoint=r,t.adjust(t.shapeControl,t.startPoint,t.currentPoint),t.addAnnot){var o=e.page,i=t.shapeControl.shape.boundary,c=o.reverseDeviceRect(i,e.scale,e.getRotation());t.addAnnot(o,[c])}else t.pdfViewer.eventEmitter.emit(b,e,t.shapeControl.shape.boundary);t.shapeControl.destroy(),t.shapeControl=null})),o.on("pancancel",function(e){t.shapeControl.destroy(),t.shapeControl=null}),[2]})}).call(this)}},{key:"destroyPageHandler",value:function(){this.createnTextAndImageHandler&&(this.createnTextAndImageHandler.destroyPageHandler(),this.createnTextAndImageHandler=void 0),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.destroyHooks.forEach(function(e){return e()})}}],[{key:"getStateName",value:function(){return"create-redaction-state"}}]),t}(C.IStateHandler),T=p.PDFViewCtrl.ViewerEvents,O=p.PDFViewCtrl.Consts.PDFDocPermission;const j=function(t){function n(e){return c(this,n),a(this,n,[e,V])}return d(n,t),u(n,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then(function(t){return Promise.all([t&&t.getUserPermission().getValue(),e.readonly()])}).then(function(e){var n=g(e,2),r=n[0],o=n[1];r&t.constructor.permission&&!o?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI();this.addDestroyHook(t.addViewerEventListener(b,function(e,n){e.getPDFPage().then(function(r){var o=r.reverseDeviceRect(n,e.scale,e.getRotation());return r.markRedactAnnot([o]).then(function(t){t[0].setViewRotate(e.getRotation()),t[0].setSubject(e.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var n=e.pdfViewer.getAnnotDefaultProperty("redact"),r=16711680;return n.defaultAppearance&&void 0!==n.defaultAppearance.textColor&&(r=n.defaultAppearance.textColor),t[0].setRedactAppearance(Object.assign({textColor:r},n)).then(function(e){return t})}).catch(function(e){if(-6===e.error)return t.alert("dialog.error.noRedactionLicense"),Promise.reject(e);console.error(e)})}).then(function(n){var r=n[0],o=e.annotsRender.getAnnotRender(r.getId()).component;return t.eventEmitter.emit("markRedactAnnotSuccess",o.annot),e.annotsRender.activeAnnot(r.getId()),o}).then(function(t){e.pdfViewer.config.showCommentList&&t.showReplyDialog()}).catch(function(){})}),t.addViewerEventListener(T.openFileSuccess,function(t){return e.changePermission(t)}),t.addViewerEventListener(T.permissionChanged,function(t){return e.changePermission(t)})),t.getCurrentPDFDoc().then(function(t){return t&&e.changePermission(t)})}},{key:"stateOut",value:function(){f(e(n.prototype),"stateOut",this).call(this);var t=this.component.parent.element.classList;this.getPDFUI().getStateHandlerManager().then(function(e){"create-redaction-text-image-state"!==e.getCurrentStates().getStateName()&&t.remove("selected")})}},{key:"handle",value:function(){f(e(n.prototype),"handle",this).call(this),this.component.parent.element.classList.add("selected"),this.getPDFUI().getStateHandlerManager().then(function(e){e.switchTo("create-redaction-state")})}}],[{key:"getName",value:function(){return"RedactionController"}},{key:"permission",get:function(){return O.AnnotForm}}]),n}(p.StatefulController);var L=p.PDFViewCtrl.PDF.constant.Graphics_ObjectType,H=p.PDFViewCtrl.stateHandler.StateHandlerUtils.getDevicePagePoint,U=p.vendors.Hammer,M=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).cursorStyle="fv__cursor-highlight",t}return d(n,t),u(n,[{key:"pageHandler",value:function(t){var r=this;f(e(n.prototype),"pageHandler",this).call(this,t);var o=t.$handler[0],a=this.hammer;a.add(new U.Tap({event:"doubletap",taps:2})),a.add(new U.Tap({event:"singletap"})),a.get("doubletap").recognizeWith("singletap"),a.get("singletap").requireFailure("doubletap"),a.on("doubletap",function(e){r.hideSelectMark(),r.doubleClickSelectHandle(e,o)})}},{key:"doubleClickSelectHandle",value:function(e,t){var n=this,r=H(t,e),o=[r.x,r.y],a=this.pageRender;a.getPDFPage().then(function(e){return[e,e.reverseDevicePoint(o,a.getScale(),a.getRotation())]}).then(function(e){var t=g(e,2),r=t[0],i=g(t[1],2),c=i[0],s=i[1];r.getGraphicsObjectAtPoint([c,s],0,L.All).then(function(e){if(e){var t=e.getType();if(t===L.Image||t===L.Text){var r=Promise.resolve([e.getRect()]);return t===L.Text&&(r=a.getDoubleClickTextRectAtPoint(o)),Promise.all([a.getPDFPage(),r]).then(function(e){var t=g(e,2),r=t[0],o=t[1];n.addAnnotWithRectArray(r,o)})}}})})}},{key:"addAnnotWithRectArray",value:function(e,t){var n=this;return t.length<1?Promise.resolve():this.addAnnot(e,t).then(function(e){var t=e[0],r=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(r),n.pageRender.annotsRender.activeAnnot(t.getId()),r}).then(function(e){n.pdfViewer.config.showCommentList&&e.showReplyDialog()}).catch(function(e){})}},{key:"addAnnot",value:function(e,t){var n=this;return e.markRedactAnnot(t).then(function(e){var t=e[0];t.setSubject(n.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var r=n.pdfViewer.getAnnotDefaultProperty("redact"),o=16711680;return r.defaultAppearance&&void 0!==r.defaultAppearance.textColor&&(o=r.defaultAppearance.textColor),t.setRedactAppearance(Object.assign({textColor:o},r)),e}).catch(function(e){if(-6===e.error)return n.pdfViewer.viewerUI.alert("dialog.error.noRedactionLicense"),Promise.reject(e)})}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit("markRedactAnnotSuccess",e.annot)}}],[{key:"getStateName",value:function(){return"create-redaction-text-image-state"}}]),n}(p.TextMarkupStateHandler);const N=function(t){function n(e){return c(this,n),a(this,n,[e,M])}return d(n,t),u(n,[{key:"stateOut",value:function(){f(e(n.prototype),"stateOut",this).call(this);var t=this.component.parent.element.classList;this.getPDFUI().getStateHandlerManager().then(function(e){"create-redaction-state"!==e.getCurrentStates().getStateName()&&t.remove("selected")})}},{key:"handle",value:function(){f(e(n.prototype),"handle",this).call(this),this.component.parent.element.classList.add("selected"),this.getPDFUI().getStateHandlerManager().then(function(e){e.switchTo("create-redaction-text-image-state")})}}],[{key:"getName",value:function(){return"RedactionTextAndImageController"}},{key:"permission",get:function(){return p.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm}}]),n}(p.StatefulController);var B=p.vendors.jQuery,$="password-input-tip",q=function(){B("."+$).remove()},W=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(q(),e){var r=B('<span class="'.concat($,'"><span>')),o=B('<i class="password-input-tip-text" role="alert" aria-live="assertive" ><i>');if(o.text(e),r.empty().append(o),n)B(t).before(r),r.css({left:0,top:"calc(100% + 8px)"}).addClass("relative");else{var a=t.getBoundingClientRect();r.css({left:a.left-13+"px"}).appendTo("body"),r.css({top:a.top+35+"px"})}}},Q=p.PDFViewCtrl.Deps.jQuery,X=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).unBindEventHooks=[],t}return d(n,t),u(n,[{key:"getElement",value:function(){return this.component.element}},{key:"updateText",value:function(e,t){this.docPageCount=t,Q(this.getElement()).find("[name=pageCount]").text(t),this.getComponentByName("redactPages").updatePageCount(t)}},{key:"bindEvent",value:function(e,t,n){var r=this,o=this.getElement().querySelectorAll(e);0!=o.length&&o.forEach(function(e){e.addEventListener(t,n),r.unBindEventHooks.push(function(){e.removeEventListener(t,n)})})}},{key:"mounted",value:function(){var e=this;this.bindEvent(".redaction-page-radio","change",function(t){if(t.target.checked){e.hideError();var n=e.getElement().querySelector(".range-input__input");if("1"==t.target.value)n.setAttribute("disabled","");else{n.removeAttribute("disabled");var r=e.pdfUI.pdfViewer.getPDFDocRender(),o=r.doc,a=r.getCurrentPageIndex()+1;e.getComponentByName("redactPages").reset({doc:o,pageCount:e.docPageCount,currentIndexOrPages:""+a})}}}),this.bindEvent(".fv__redaction-cancel","click",function(t){e.hide()}),this.bindEvent(".fv__redaction-btn","click",function(t){e.submit()}),this.bindEvent(".range-input__input","keydown",function(t){e.hideError()})}},{key:"setSubmitCallback",value:function(e){this.submitCallback=e}},{key:"submit",value:function(){this.docPageCount;var e=!1;this.getElement().querySelectorAll(".redaction-page-radio").forEach(function(t){t.checked&&"1"==t.value&&(e=!0)});var t=[];if(e){var n=this.pdfUI.pdfViewer.getPDFDocRender();t.push(n.getCurrentPageIndex())}else t=this.computePages();this.submitCallback(t)}},{key:"reset",value:function(){this.hideError(),this.getElement().querySelector(".redaction-page-radio").click();var e=this.getElement().querySelector(".range-input__input");e.value="",e.disabled=1}},{key:"showError",value:function(e){var t=this.getElement().querySelector(".range-input__input");t.classList.add("fv__redaction-error"),W(t.getAttribute("placeholder"),t)}},{key:"hideError",value:function(){this.getElement().querySelector(".range-input__input").classList.remove("fv__redaction-error"),q()}},{key:"hide",value:function(){this.component.hide(),W()}},{key:"destroy",value:function(){this.unBindEventHooks.forEach(function(e){return e()}),f(e(n.prototype),"destroy",this).call(this)}},{key:"computePages",value:function(){for(var e=[],t=(this.getComponentByName("redactPages").getRange()+"").split(","),n=0;n<t.length;n++){var r=t[n];if(r)if(r.indexOf("-")<1){var o=parseInt(r);o>0&&e.push(o-1)}else{for(var a=r.split("-"),i=0,c=0,s=0;s<a.length;s++){var u=a[s];if(u){var l=parseInt(u);0===i?(i=l,c=l):l<i?i=l:l>c&&(c=l)}}if(i>0)for(var d=i;d<=c;d++)e.push(d-1)}}return e.length>0&&(e=e.sort()),e}}],[{key:"getName",value:function(){return"RedactionPagesController"}}]),n}(p.Controller),G=r(819),Y=r.n(G),z=(p.PDFViewCtrl._internal.shared.Lazy,p.PDFViewCtrl.Events);const J=function(e){function t(e){return c(this,t),a(this,t,[e])}return d(t,e),u(t,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then(function(t){return Promise.all([t&&t.getUserPermission().getValue(),e.readonly()])}).then(function(e){var n=g(e,2),r=n[0],o=n[1];r&t.constructor.permission&&!o?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})}},{key:"handle",value:function(){var e,t=this;this.uiInited?e=Promise.resolve(this.popop=this.getComponentByName("redaction-page-popup")).then(function(e){t.resetDialog()}):(e=this.getPDFUI().getComponentByName("template-container").then(function(e){e.append(Y()(),[{target:"redaction-page-popup",config:{callback:X}}]),t.popop=e.getComponentByName("redaction-page-popup"),t.resetDialog()}),this.uiInited=!0),e.then(function(e){t.popop.show(),t.popop.controller.reset()})}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI(),n=function(){e.popop&&t.getCurrentPDFDoc().then(function(n){var r=n.getPageCount(),o=t.i18n.t("redaction:dialog.readaction_page_max")+r;e.popop.controller.updateText(o,r)})},r=function(t){e.pdfDoc=t,e.resetDialog(),e.changePermission(t)};this.addDestroyHook(t.addViewerEventListener("change-language-success",function(n){if(e.popop){var r=e.pdfDoc?e.pdfDoc.getPageCount():0,o=t.i18n.t("redaction:dialog.readaction_page_max")+r;e.popop.controller.updateText(o,r)}}),t.addViewerEventListener(z.pageRemoved,n),t.addViewerEventListener(z.pagesRemoved,n),t.addViewerEventListener(z.pageAdded,n),t.addViewerEventListener(z.insertPages,n),t.addViewerEventListener(z.openFileSuccess,r),t.addViewerEventListener(z.willCloseDocument,function(){e.pdfDoc=null}),t.addViewerEventListener(z.permissionChanged,function(t){return e.changePermission(t)})),t.getCurrentPDFDoc().then(function(e){return e&&r(e)})}},{key:"resetDialog",value:function(){var e=this;if(this.popop){var t=this.pdfDoc,n=this.getPDFUI(),r=t.getPageCount();this.popop.controller.setSubmitCallback(function(t){n.activateElement(),0==t.length?n.getPDFViewer().then(function(r){t=[r.getPDFDocRender().getCurrentPageIndex()],e.pdfDoc.makeRedactByPages(t).then(function(t){a(t),e.popop.hide()}).catch(function(e){-6===e.error&&n.alert("dialog.error.noRedactionLicense")})}):e.pdfDoc.makeRedactByPages(t).then(function(t){a(t),e.popop.hide()}).catch(function(e){-6===e.error&&n.alert("dialog.error.noRedactionLicense")})});var o=n.i18n.t("redaction:dialog.readaction_page_max")+r;this.popop.controller.updateText(o,r)}function a(e){n.getPDFViewer().then(function(t){var n=t.getAnnotDefaultProperty("redact"),r=[],o=16711680;n.defaultAppearance&&void 0!==n.defaultAppearance.textColor&&(o=n.defaultAppearance.textColor),e.map(function(e){var a=e[0];r.push(a);var i=a.getPage().getIndex(),c=t.getPDFDocRender().getPDFPageRender(i);c&&a.setViewRotate(c.getRotation()),a.setRedactAppearance(Object.assign({textColor:o},n))}),t.eventEmitter.emit("makeRedactByPagesSuccess",r)})}}}],[{key:"getName",value:function(){return"RedactionPageController"}},{key:"permission",get:function(){return p.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm}}]),t}(p.Controller);const K={print:4,modify:8,extract:16,annotForm:32,fillForm:256,extractAccess:512,assemble:1024,printHigh:2048};var Z=p.PDFViewCtrl.Events;const ee=function(e){function t(e){return c(this,t),a(this,t,[e])}return d(t,e),u(t,[{key:"handle",value:function(){var e=this;if(!this.component.disabled){var t=this.getPDFUI();return t.getPDFViewer().then(function(n){return e.checkApplicablePermission(n).then(function(e){e?t.confirm({message:"redaction:dialog.apply_alert",level:"warning",hideOnConfirm:!1}).then(function(e){e.hide();var r=n.getCurrentPDFDoc();r.applyRedaction().then(function(){t.eventEmitter.emit(p.UIEvents.undoRedoStoreChange,null,"clearAll")},function(e){if(-6!==e.error)throw e;t.alert({message:"dialog.error.noRedactionLicense",level:"warning"})}),r.redacted=!0}):t.alert({message:"dialog.error.noRedactionApplyPermission",level:"warning"})})})}}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI();t.addDestroyHook(t.addViewerEventListener(m,function(t,n){e.component.lock()}),t.addViewerEventListener(v,function(t,n){e.isRedactExist()}),t.addViewerEventListener(Z.openFileSuccess,function(t){e.component.lock()}),t.addViewerEventListener(Z.renderPageSuccess,function(n){e.component.isLocked&&t.getPDFDocRender().then(function(t){return k(function(){var e;return x(this,function(r){switch(r.label){case 0:return 8&t.getUserPermission().getValue()?!(e=t.getPDFDoc())||e.isDestroyed?[2]:[4,e.hasRedactAnnot(n.index)]:[3,2];case 1:r.sent()&&this.component.unlock(),r.label=2;case 2:return[2]}})}).call(e)})}),t.addViewerEventListener(Z.annotationAdd,function(n){e.component.isLocked&&t.getPDFDocRender().then(function(t){8&t.getUserPermission().getValue()&&(n.some(function(e){return function(e){return"redact"==e.info.type&&!1===e.info.isDeleted}(e)})&&e.component.unlock())})}),t.addViewerEventListener(y,function(n){t.getCurrentPDFDoc().then(function(t){t&&t.checkPermission(K.modify)&&t.checkPermission(K.annotForm)&&e.isRedactExist()})}),t.addViewerEventListener(P,function(n,r){t.getCurrentPDFDoc().then(function(t){t&&t.checkPermission(K.modify)&&t.checkPermission(K.annotForm)&&e.isRedactExist()})})),t.getCurrentPDFDoc().then(function(t){t&&t.checkPermission(K.modify)&&t.checkPermission(K.annotForm)&&t.pageCache.some(function(e){return e.annots.some(function(e){return"redact"==e.getType()})})?e.component.unlock():e.component.lock()})}},{key:"isRedactExist",value:function(){var e=this;this.getPDFUI().getPDFViewer().then(function(e){return e.currentPDFDoc.isRedactExist()}).then(function(t){t?e.component.unlock():e.component.lock()})}},{key:"checkApplicablePermission",value:function(e){return Promise.resolve(!0)}}],[{key:"permission",get:function(){return p.PDFViewCtrl.Consts.PDFDocPermission.ModifyDocument}}]),t}(p.Controller);var te=p.UIEvents;const ne=function(e){function t(e){return c(this,t),a(this,t,[e])}return d(t,e),u(t,[{key:"changePermission",value:function(e){var t=this;(PDFViewCtrl.DeviceInfo.isMobile||PDFViewCtrl.DeviceInfo.isTablet)&&this.getPDFUI().getPDFDocRender().then(function(t){return Promise.all([t&&t.getUserPermission().getValue(),e.readonly()])}).then(function(e){var n=g(e,2),r=n[0],o=n[1];r&t.constructor.permission&&!o?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})}},{key:"handle",value:function(){PDFViewCtrl.DeviceInfo.isMobile||PDFViewCtrl.DeviceInfo.isTablet?(this.getComponentByName("sidebar").expand(),this.getComponentByName("sidebar-search").active(),this.getComponentByName("fv-search-sidebar-panel").activeRedactionMode(),this.getPDFUI().eventEmitter.emit(te.redeModeShowSidebar)):this.pdfUI.callAddonAPI("SearchAddon","openPanel",["redaction","exact"])}}]),t}(p.Controller);var re=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-crosshair",n}return d(t,e),u(t,[{key:"addAnnot",value:function(e,t){var n=this;return e.markRedactAnnot(t).then(function(e){var t=e[0];return t.setBorderColor(8231855),t.setRedactAppearance({applyFillColor:16777215}),e}).then(function(e){n.pdfViewer.viewerUI.confirm({message:"redaction:dialog.apply_whiteout_alert",again:!0,id:"WhiteoutConfirm",level:"warning"}).then(function(){e[0].apply()},function(){e.forEach(function(e){e.getPDFPage().removeAnnot(e)})})})}}],[{key:"getStateName",value:function(){return"create-whiteout-state"}}]),t}(V);const oe=function(t){function n(e){return c(this,n),a(this,n,[e,re])}return d(n,t),u(n,[{key:"stateOut",value:function(){f(e(n.prototype),"stateOut",this).call(this);var t=this.component.parent.element.classList;this.getPDFUI().getStateHandlerManager().then(function(e){"create-whiteout-state"!==e.getCurrentStates().getStateName()&&t.remove("selected")})}},{key:"handle",value:function(){f(e(n.prototype),"handle",this).call(this),this.component.parent.element.classList.add("selected"),this.getPDFUI().getStateHandlerManager().then(function(e){e.switchTo("create-whiteout-state")})}}],[{key:"getName",value:function(){return"WhiteoutController"}},{key:"permission",get:function(){return p.PDFViewCtrl.Consts.PDFDocPermission.ModifyDocument}}]),n}(p.StatefulController);var ae=r(6),ie=r.n(ae),ce=r(437),se=r.n(ce),ue=r(557),le=r.n(ue),de=r(683),pe=r.n(de),fe=r(408),he=r.n(fe),ge=p.shared.replaceRibbonButton2XButton,ve=ie()(),me=se()(),ye=function(e){function t(){return c(this,t),a(this,t,arguments)}return d(t,e),u(t,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"redaction"}},{key:"getLoader",value:function(){return he()}},{key:"initOnLoad",value:function(){var e=p.modular.module("redaction",[]),t=e.getRegistry();this.module=e,t.registerController(j),t.registerController(N),t.registerController(J);var n={template:ve,config:[{target:"create-redaction-controllers",callback:function(e){function t(){return c(this,t),a(this,t,arguments)}return d(t,e),u(t,[{key:"changePermission",value:function(e){}}]),t}(p.Controller)}]};e.registerPreConfiguredComponent("create-redactions-dropdown",n),e.registerPreConfiguredComponent("create-redactions-ribbon-dropdown",Object.assign({},n,{template:me}));var r={template:'<ribbon-button text="redaction:buttons.apply" name="redaction-apply"  icon-class="fx-icon-sm fv__icon-toolbar-apply-redaction"  @tooltip>redaction:buttons.apply</ribbon-button>',config:[{target:"redaction-apply",tooltip:{title:"redaction:tooltips.apply"},callback:ee}]};e.registerPreConfiguredComponent("apply-redactions-button",Object.assign({},r,{template:ge(r.template)}));var o={template:'<ribbon-button text="redaction:buttons.redact_search" name="redaction-search" icon-class="fx-icon-sm fv__icon-toolbar-search-redaction" @tooltip>redaction:buttons.redact_search</ribbon-button>',config:[{target:"redaction-search",tooltip:{title:"redaction:buttons.redact_search"},callback:ne}]};e.registerPreConfiguredComponent("redaction-search-button",Object.assign({},o,{template:ge(o.template)})),e.registerPreConfiguredComponent("create-page-redaction-button",{template:le()()}),e.registerPreConfiguredComponent("create-text-images-redaction-button",{template:pe()()}),e.registerPreConfiguredComponent("create-whiteout-button",{template:'<ribbon-button text="redaction:buttons.whiteout" name="whiteout" icon-class="fv__icon-toolbar-whiteout" @tooltip>redaction:buttons.whiteout</ribbon-button>',config:[{target:"whiteout",tooltip:{title:"redaction:tooltips.whiteout"},callback:oe}]})}}]),t}(p.UIXAddon)})(),o=o.default})());
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.SignDoc=t(require("UIExtension")):e.SignDoc=t(e.UIExtension)}(self,e=>(()=>{var t={456:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button\nname="sign-certify-dropdown"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.signCertify"\ntext="phantom_online:toolbar.protect.signCertify"\nicon-class="fx-icon-ribbon_protect_sign_certify_certify_with_visible_signature-32"\nnot-immediately="true"\n>\n<dropdown separate="false">\n<dropdown-button\nname="place-signature"\n@tooltip\ntooltip-title="SignDoc:placeSig.tip"\nicon-class="fx-icon-page-sig"\ntext="SignDoc:placeSig.text"\n>SignDoc:placeSig.text\n</dropdown-button>\n<dropdown-button\nname="sign-document"\n@tooltip\ntooltip-title="SignDoc:signDoc.tip"\nicon-class="fx-icon-sign-document"\ntext="SignDoc:signDoc.text"\n>SignDoc:signDoc.text\n</dropdown-button>\n<dropdown-button\nname="certify-with-sig"\n@tooltip\ntooltip-title="SignDoc:certify.visibleDesc"\nicon-class="fx-icon-certify-sig"\ntext="SignDoc:certify.visible"\n>SignDoc:certify.visible\n</dropdown-button>\n<dropdown-button\nname="certify-without-sig"\n@tooltip\ntooltip-title="SignDoc:certify.invisibleDesc"\nicon-class="fx-icon-certify"\ntext="SignDoc:certify.invisible"\n>SignDoc:certify.invisible\n</dropdown-button>\n<li class="fv__ui-dropdown-separator"></li>\n<dropdown-button\nname="digital-ids-btn"\n@tooltip\ntooltip-title="phantom_online:toolbar.protect.digitalIDs"\nicon-class="fx-icon-ribbon_protect_signature_digital_ids-16"\ntext="phantom_online:toolbar.protect.digitalIDs"\n>phantom_online:toolbar.protect.digitalIDs\n</dropdown-button>\n<dropdown-button\nname="trust-certs"\n@tooltip\ntooltip-title="SignDoc:certify.trustCertsDesc"\nicon-class="fx-icon-trust-root"\ntext="SignDoc:certify.trustCerts"\n>SignDoc:certify.trustCerts\n</dropdown-button>\n</dropdown>\n</ribbon-button>\n'}},254:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__export-cert-dialog" modal @var.self="$component">\n<layer-header class="fv__export-cert-header" @draggable="{type:\'parent\'}" title="SignDoc:exportCert.header" ></layer-header>\n<layer-view>\n<div class="upper">\n<div class="subtitle">SignDoc:exportCert.subtitle</div>\n<div class="certTitle">SignDoc:exportCert.certTitle</div>\n<div class="certInfo">SignDoc:exportCert.certInfo</div>\n</div>\n<div class="lower">\n<div class="optionTitle">SignDoc:exportCert.option.title</div>\n<div class="formatHint">SignDoc:exportCert.option.formatHint</div>\n<div class="input disabled">\n<input type="radio" disabled class="disabled"/>\n<span>SignDoc:exportCert.option.email</span>\n</div>\n<div class="input"><input type="radio" checked="1"/>\n<span>SignDoc:exportCert.option.file</span></div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>'}},963:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__trust-certs-dialog" modal @var.self="$component">\n<layer-header class="fv__trust-certs-header" @draggable="{type:\'parent\'}" title="SignDoc:certify.header" ></layer-header>\n<layer-view>\n<div class="tools">\n<div @on.click="self.onEditCertView()">SignDoc:certify.edit</div>\n<div class="addCert">\n<div>\nSignDoc:certify.add\n</div>\n<input title="" type="file" accept=".p7b,.pbc,.cer" />\n</div>\n<div @on.click="self.onViewTrustCert()">SignDoc:certify.view</div>\n<div @on.click="self.onExportTrustCert()">SignDoc:certify.export</div>\n<div @on.click="self.onDeleteTrustCert()">SignDoc:certify.delete</div>\n</div>\n<div class="cert-list">\n<div class="header">\n<div class="w30p">SignDoc:certify.name</div>\n<div class="w30p">SignDoc:certify.issuedBy</div>\n<div class="w20p">SignDoc:certify.trust</div>\n<div>SignDoc:certify.expiredData</div>\n</div>\n<div class="body" name="cert-body"></div>\n</div>\n<div class="cert-info">\n<div class="subjectName">\n<label>SignDoc:certify.certName</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="validPeriodFrom">\n<label>SignDoc:certify.validFrom</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:certify.validTo</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:certify.intent</label>\n<div></div>\n</div>\n</div>\n<div class="footer">\n<div class="closeButton" @on.click="self.hide()">SignDoc:certify.close</div>\n</div>\n</layer-view>\n</layer>'}},182:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer class="center fv__view-certs-dialog" modal @var.self="$component">\n<layer-header\nclass="fv__view-certs-header"\n@draggable="{type:\'parent\'}"\ntitle="SignDoc:viewCert.header"\n></layer-header>\n<layer-view>\n<div class="details">\n<div class="title">SignDoc:viewCert.detailTitle</div>\n<div class="subjectName">\n<label>SignDoc:viewCert.subject</label>\n<div></div>\n</div>\n<div class="issuerName">\n<label>SignDoc:certify.issuer</label>\n<div></div>\n</div>\n<div class="keyUsageStr">\n<label>SignDoc:viewCert.usage</label>\n<div></div>\n</div>\n<div class="validPeriodTo">\n<label>SignDoc:viewCert.expiration</label>\n<div></div>\n</div>\n</div>\n<div class="trust">\n<div class="title">SignDoc:viewCert.trust</div>\n<div class="info">SignDoc:viewCert.trustInfo</div>\n<div class="input">\n<input type="checkbox" id="trustRoot"></input>\n<label type="trustRoot">SignDoc:viewCert.trustRoot</label>\n</div>\n<div class="afterSign">SignDoc:viewCert.afterSign</div>\n<div class="input">\n<input type="checkbox" class="disabled" id="valid"></input>\n<label type="trustRoot">SignDoc:viewCert.valid</label>\n</div>\n<div class="input">\n<input type="checkbox" id="validCert"></input>\n<label type="trustRoot">SignDoc:viewCert.validCert</label>\n</div>\n</div>\n<div class="footer">\n<div class="okButton" @on.click="self.onOk()">SignDoc:viewCert.ok</div>\n<div class="closeButton" @on.click="self.hide()">SignDoc:viewCert.cancel</div>\n</div>\n</layer-view>\n</layer>\n'}},180:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},r=Object.create(i),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var i="",r=void 0,a=void 0,c=void 0;for(r=n.index,a=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:c="&#34;";break;case 38:c="&#38;";break;case 39:c="&#39;";break;case 60:c="&#60;";break;case 62:c="&#62;";break;default:continue}a!==r&&(i+=t.substring(a,r)),a=r+1,i+=c}return a!==r?i+t.substring(a,r):i}(a(e))},r.$each=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(e,t,n,i,r,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(i,r)}function t(t){return function(){var n=this,i=arguments;return new Promise(function(r,o){var a=t.apply(n,i);function c(t){e(a,r,o,c,s,"next",t)}function s(t){e(a,r,o,c,s,"throw",t)}c(void 0)})}}function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function o(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(o=function(){return!!e})()}function a(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function c(e,t,i){return t=n(t),a(e,o()?Reflect.construct(t,i||[],n(e).constructor):t.apply(e,i))}function s(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):s(e,t)}function l(e,t){if(!s(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function y(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(e){c=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw r}}return o}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.d(r,{default:()=>q});function b(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],i=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var S,w,D=i(616),C=i(180),k=i.n(C),x=i(456),N=i.n(x);function I(e,t,i){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(i||e):o.value}},I(e,t,i||e)}function T(e){return function(e){function t(e){return l(this,t),c(this,t,[e,"square"])}return p(t,e),d(t,[{key:"start",value:function(e){I(n(t.prototype),"start",this).call(this,e),Object.assign(this.currentFakeAnnot.annotationInfo,{borderInfo:{width:0,style:1},color:9224925,fillColor:13426668,opacity:.5})}},{key:"end",value:function(){var e=this.currentFakeAnnot;S(e.page.getIndex(),e.pdfRect,e),this.currentFakeAnnot=null}},{key:"destroyPageHandler",value:function(){I(n(t.prototype),"destroyPageHandler",this).call(this),this.currentFakeAnnot&&this.currentFakeAnnot.destroy()}}],[{key:"getStateName",value:function(){return"createRect"}},{key:"getSubtype",value:function(){return w}},{key:"setParams",value:function(e){var t=e.callback,n=e.type;S=t,w=n}}]),t}(e.simpleShapeHandler)}var _=i(963),P=i.n(_),j=i(182),F=i.n(j),R=D.vendors.jQuery,O=function(e){function t(){return l(this,t),c(this,t,arguments)}return p(t,e),d(t,[{key:"show",value:function(e,i,r){I(n(t.prototype),"show",this).call(this,e),this.updateCert=r,this.cert=i;var o=i.usage,a=i.isCertTrustedRoot;this.certDate={usage:o,isCertTrustedRoot:a};var c=R(this.element);c.find("#trustRoot")[0].checked=a,["subjectName","issuerName","keyUsageStr","validPeriodTo"].map(function(e){c.find("."+e+" div").html(i[e])}),c.find("#valid").addClass("disabled")[0].checked=1,c.find("#validCert")[0].checked=2&o}},{key:"onOk",value:function(){this.updateCert(Object.assign({},this.cert,this.certDate)),this.hide()}},{key:"mounted",value:function(){var e=this;I(n(t.prototype),"mounted",this).call(this),R(this.element).find("input").on("change",function(t){switch(t.target.id){case"trustRoot":e.certDate.isCertTrustedRoot=t.target.checked;break;case"valid":t.target.checked?e.certDate.usage|=1:e.certDate.usage&=2;break;case"validCert":t.target.checked?e.certDate.usage|=2:e.certDate.usage&=1}})}}],[{key:"getName",value:function(){return"ViewTrustCertsDialog"}}]),t}(D.SeniorComponentFactory.createSuperClass({template:F()()})),U=i(254),A=i.n(U),B=D.vendors.jQuery,E=(D.toolkit.CertUtil,function(e){function t(){return l(this,t),c(this,t,arguments)}return p(t,e),d(t,[{key:"show",value:function(e,i){I(n(t.prototype),"show",this).call(this,e),this.cert=i;var r=B(this.element).prev();r.length&&r.hasClass("fv__ui-layer-modal")&&r.css("zIndex",B(this.element).css("zIndex"))}},{key:"onOk",value:function(){(0,D.vendors.saveAs)(this.cert.cerFile,this.cert.subjectName+".cer"),this.hide()}}],[{key:"getName",value:function(){return"ExportCertDialog"}}]),t}(D.SeniorComponentFactory.createSuperClass({template:A()()}))),V=D.vendors.jQuery,M=D.toolkit.CertUtil,H=function(e){function t(){return l(this,t),c(this,t,arguments)}return p(t,e),d(t,[{key:"mounted",value:function(){var e=this;I(n(t.prototype),"mounted",this).call(this),V(this.element).find(".addCert input").on("change",function(t){var n=t.target.files[0],i=e.pdfUI;i.getCurrentPDFDoc().then(function(e){return e.engine.getCertificateInfo(n,"")}).then(function(t){t.serial?M.addTrustedCertToCertificateList(t,!1).then(function(n){n.serialNumber=t.serial;var r=V('<div class="cert selected" id="'.concat(n.uniqueSerialNumber,'">\n                    <div class="w30p" title="').concat(n.subjectName,'">').concat(n.subjectName,'</div>\n                <div class="w30p" title="').concat(n.issuerName,'">').concat(n.issuerName,'</div>\n                    <div class="w20p trustRoot">').concat(n.isCertTrustedRoot?i.i18n.t("SignDoc:trustedRoot"):i.i18n.t("SignDoc:nonTrustedRoot"),"</div>\n                    <div>").concat(n.validPeriodTo,"</div></div>"));V(e.element).find(".cert-list .body .selected").removeClass("selected"),V(e.element).find(".cert-list .body").prepend(r),r[0].scrollIntoView(),e.onSelectCert(n.uniqueSerialNumber)}):i.alert({message:"SignDoc:certify.notCert",level:"warning"})}),t.target.value=""}),V(this.element).find(".cert-list .body").on("click",function(t){V(e.element).find(".cert-list .body .selected").removeClass("selected");var n=t.target,i=n.id;i.length||(i=(n=n.parentElement).id),V(n).addClass("selected"),e.onSelectCert(i)})}},{key:"show",value:function(e){var i=this;I(n(t.prototype),"show",this).call(this,e);var r=this.pdfUI;M.getTrustedCertificateList(this.pdfUI).then(function(e){var t="",n=0;e.map(function(e,i){e.subjectName&&(t+='<div class="cert '.concat(n?"":"selected",'" id="').concat(e.uniqueSerialNumber,'">\n                    <div class="w30p" title="').concat(e.subjectName,'">').concat(e.subjectName,'</div>\n                <div class="w30p" title="').concat(e.issuerName,'">').concat(e.issuerName,'</div>\n                <div class="w20p trustRoot">').concat(e.isCertTrustedRoot?r.i18n.t("SignDoc:trustedRoot"):r.i18n.t("SignDoc:nonTrustedRoot"),"</div>\n                <div>").concat(e.validPeriodTo,"</div></div>"),n=i+1)}),V(i.element).find(".cert-list .body").empty().append(t),["subjectName","issuerName","validPeriodFrom","validPeriodTo","keyUsageStr"].map(function(t){V(i.element).find(".cert-info ."+t+" div").html(e[n-1][t])});var o=V(i.element).prev();o.length&&o.hasClass("fv__ui-layer-modal")&&o.css("zIndex",V(i.element).css("zIndex"))})}},{key:"onEditCertView",value:function(){var e=this,t=this.pdfUI,n=function(n){M.addTrustedCert(n),V(e.element).find(".body .selected .trustRoot").html(n.isCertTrustedRoot?t.i18n.t("SignDoc:trustedRoot"):t.i18n.t("SignDoc:nonTrustedRoot"))};this.getSelectedCert().then(function(i){if(e.viewTrustCertsDialog)e.viewTrustCertsDialog.show(document.body,i,n);else{var r="viewTrustCertsDialog";D.modular.module("certify").registerComponent(O),t.registerDialog(r,function(){return t.getComponentByName("template-container").then(function(t){t.append('<certify:ViewTrustCertsDialog name="'.concat(r,'"></certify:ViewTrustCertsDialog>'));var o=e.viewTrustCertsDialog=t.getComponentByName(r);return o.show(document.body,i,n),o})}),t.openDialog(r)}})}},{key:"onAddTrustCert",value:function(){}},{key:"onViewTrustCert",value:function(){var e=this;this.getSelectedCert().then(function(t){if(e.certViewerDialog)return e.certViewerDialog.show({certificateInfo:t,fromTrustMgr:1},!0),Promise.resolve(e.certViewerDialog);e.certViewerDialog=new D.CertificateViewerComponent(e.pdfUI),e.certViewerDialog.show({certificateInfo:t,fromTrustMgr:1},!0)})}},{key:"onExportTrustCert",value:function(){this.pdfUI;this.getSelectedCert().then(function(e){saveAs(e.cerFile,e.subjectName+".cer")})}},{key:"onDeleteTrustCert",value:function(){var e=this;this.getSelectedCert().then(function(t){var n=function(){M.removeTrustedCert(t.uniqueSerialNumber),V(e.element).find(".body .selected").remove();var n=V(e.element).find(".body>div:first-child").addClass("selected");e.onSelectCert(n[0].id)};e.pdfUI.confirm({again:!0,message:"SignDoc:certify.deleteConfirm",level:"prompt",id:"SignDocCertifyDeleteConfirm"}).then(n,n)})}},{key:"onSelectCert",value:function(e){var t=this;M.getTrustedCertificateList(this.pdfUI).then(function(n){var i=n.find(function(t){return t.uniqueSerialNumber==e});["subjectName","issuerName","validPeriodFrom","validPeriodTo","keyUsageStr"].map(function(e){V(t.element).find(".cert-info ."+e+" div").html(i[e])})})}},{key:"getSelectedCert",value:function(){var e=V(this.element).find(".body .selected")[0].id;return M.getTrustedCertificateList(this.pdfUI).then(function(t){return t.find(function(t){return t.uniqueSerialNumber==e})})}}],[{key:"getName",value:function(){return"TrustCertsDialog"}}]),t}(D.SeniorComponentFactory.createSuperClass({template:P()()})),L=UIExtension.PDFViewCtrl.shared.download;function W(e,n,i,r){return t(function(){var r,o,a,c,s,l,u;function d(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t(function(){var t;return b(this,function(r){return n?(t="",e.getCurrentPDFDoc().then(function(e){(t=e.getFileName()||"").length<1&&(t="untitled.pdf");var r=JSON.parse(JSON.stringify(n));return e.sign(r,n.sign,i)}).then(function(n){var i=e.customs,r=i.autoDownloadAfterSign,o=i.getSignedDocument;return(void 0===r||r)&&L(new Blob([n],{type:"application/octet-stream"}),t.replace(".pdf","_signed.pdf")),"function"==typeof o&&o(n),e.openPDFByFile(n,{fileName:t})}),[2]):[2]})})()}return b(this,function(t){switch(t.label){case 0:return[4,e.pdfViewer.viewerUI.getSignatureUI()];case 1:return r=t.sent(),[4,n.getPDFForm().getField(i)];case 2:if(o=t.sent(),a=e.getSignatureWorkflowService(),c=a.getSigningSettingsList(),s=e.signatureFlowHandler&&e.signatureFlowHandler.sign,c.length<1&&!s)throw new Error("No signature sign Handler");return 4===o.signatureType?[2,e.alert({message:"signDocument.notSupportPagingSeal",level:"warning"})]:s?[2,s(o).then(function(e){return e.fieldName=i,e.hashAlgorithm=0,d(e)})]:(l=e.pdfViewer.getDeprecatedStorage().getItem("SignSetting")||{},(u=l[n.id]&&l[n.id][i])?[2,d(u[0],u[1])]:[4,r.getSignDocumentDialog()]);case 3:return[4,t.sent().openWith(o,function(e,t){return e&&d(e,t)})];case 4:return t.sent(),[2]}})})()}var q=function(e){function n(){return l(this,n),c(this,n,arguments)}return p(n,e),d(n,[{key:"signDocWithoutAnnot",value:function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"placeSig";return t(function(){var t;return b(this,function(o){switch(o.label){case 0:return t=this.pdfUI,this.lastMark&&this.lastMark.destroy(),this.lastMark=i,[4,t.getViewerUI()];case 1:return[4,o.sent().getSignatureUI()];case 2:return[4,o.sent().getSignDocumentDialog()];case 3:return o.sent().openWith(null,function(o,a){if(o){var c,s="";if("true"==window.localStorage.getItem("SignLater")&&"certifyInvisibleSig"!=r)return t.$confirm({message:"SignDoc:signLater",level:"prompt",title:"sidebar.signature.dialog.title",id:"signLater",again:!0,customBtns:[{id:"yes",text:"dialog.ok"}]}),t.getStateHandlerManager().then(function(e){return c=e,t.getPDFViewer()}).then(function(t){var i=t.currentPDFDoc,r=t.getPDFPageRender(e),c={mkRotate:((r.rotate/90||0)+r.page.getRotation())%4},s=function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;n=e.i18n.t("form-designer:prefix."+i);var r="",o=t.countField(i,!1,!1),a="";do{a=n+o,r=t.fieldsNameMap[a],o+=1}while(r);return a}(t,i.form);o.fieldName=s,delete o.pageIndex;var l=t.getStorage().getItem("SignSetting")||{};return l[i.id]=f({},s,[o,a]),t.getStorage().setItem("SignSetting",l),i.form.addSignature(e,n,s,c)}).then(function(e){return c.switchTo("select-annotation")});var l=null;t.getCurrentPDFDoc().then(function(e){l=e,(s=e.getFileName()||"").length<1&&(s="untitled.pdf");var t=JSON.parse(JSON.stringify(o));return t.noCheckRect="certifyInvisibleSig"==r,e.sign(t,o.sign,a)}).then(function(e){var n=t.customs,r=n.autoDownloadAfterSign,o=n.getSignedDocument;return(void 0===r||r)&&saveAs(e,s.replace(".pdf","_signed.pdf")),"function"==typeof o&&o(e),l.docModified=!1,l.otherOptions.disableSavePrompt=!0,i.destroy(),t.openPDFByFile(e,{fileName:s,isOpenNewFileAfterClose:1})})}else i.destroy()},e,n,r),[2]}})}).call(this)}},{key:"updateButton",value:function(e){return t(function(){return b(this,function(e){return[2]})})()}},{key:"initOnload",value:function(e){var t=this,n="exportCertDialog";D.modular.module("certify",[]).registerComponent(E),e.registerDialog(n,function(i,r){return e.getComponentByName("template-container").then(function(e){t.exportCertDialog&&t.exportCertDialog.show(document.body,r),e.append('<certify:ExportCertDialog name="'.concat(n,'"></certify:ExportCertDialog>'));var i=t.exportCertDialog=e.getComponentByName(n);return i.show(document.body,r),i})})}},{key:"registerPlaceSigStateHandler",value:function(e){e.getStateHandlerManager().register(T(e))}},{key:"init",value:function(e){var n=this;this.pdfUI=e;var i=function(r){return t(function(){var n;return b(this,function(o){return n=this,"fv--protect-tab-paddle"==r.name&&(e.waitComponent("sign-group").then(function(o){return t(function(){var n;return b(this,function(a){return n=this,o.insertTemplate?(o.insertTemplate(N()(),1,[{target:"sign-document",config:{callback:function(){return t(function(){var t,n;return b(this,function(i){switch(i.label){case 0:return e.customs.sendGAEvent({eventKey:"sign_document",label:"protect_tab"}),[4,e.getCurrentPDFDoc()];case 1:return[4,(t=i.sent()).getSignaturesInfo()];case 2:return(n=i.sent()).unsignCount?pdfui.confirm({message:"SignDoc:moreSigns",level:"prompt"}).then(function(i){W(e,t,n.firstUnsignedName)}):W(e,t,n.firstUnsignedName),[2]}})})()}}},{target:"place-signature",config:{callback:function(){e.customs.sendGAEvent({eventKey:"place_signature",label:"protect_tab"}),e.getStateHandlerManager().then(function(e){var t=n;"hand"===e.get("createRect").getStateName()&&e.register(T(e.pdfViewer)),e.switchTo("createRect",{callback:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.signDocWithoutAnnot.apply(t,m(n))},type:"place-signature"})})}}},{target:"certify-with-sig",config:{callback:function(){return n.onCertifyWithSig()}}},{target:"certify-without-sig",config:{callback:function(){return n.onCertifyWithoutSig()}}},{target:"trust-certs",config:{callback:function(){return n.onShowTrusts()}}}]),e.getCurrentPDFDoc().then(function(t){if(t){n.signDocBtn=o.getComponentByName("sign-document"),n.placeSigBtn=o.getComponentByName("place-signature");n.certifyVisibleSig=o.getComponentByName("certify-with-sig"),n.certifyInvisibleSig=o.getComponentByName("certify-without-sig"),e.customs.proxyComponent(o.getComponentByName("digital-ids-btn")),n.updateButton(t)}}),[2]):[2,setTimeout(function(){return i(r)},300)]})}).call(n)}),e.addViewerEventListener(f({},D.UIEvents.willCloseDocument,function(){e.pdfViewer.getDeprecatedStorage().setItem("SignSetting",{})}))),[2]})}).call(n)};e.getRootComponent().then(function(e){e.getComponentByName("sign-group")?i(e.getComponentByName("fv--protect-tab-paddle")):e.on("lazy-content",i)})}},{key:"receiveAction",value:function(e,t){switch(e){case"signMultipleFiles":var n=h(t,5),i=n[0],r=n[1],o=n[2],a=n[3],c=n[4];return Promise.all(o.map(function(e){var t=e.pdfDoc;return t.loadPDFForm().then(function(){var n=i.fieldName;return n&&!t.form.getField(n)?{msg:"NoSignature",error:1,name:e.file.name}:i.pageIndex<0||i.pageIndex>=t.getPageCount()?{msg:"NoPage",error:1,name:e.file.name}:("certifyInvisibleSig"==c&&(i.rect={left:0,right:0,top:0,bottom:0},i.noCheckRect=1),t.sign(i,i.sign,r).then(function(e){var n=t.getFileName()||"";return n.length<1&&(n="untitled.pdf"),n=n.toLowerCase(),"string"==typeof e?{msg:e,error:1,name:n}:(2==a.namingType&&(n=a.insertBefore+n.replace(".pdf",a.insertAfter+".pdf")),{file:e,name:n,error:0})}))})})).then(function(e){return o.map(function(e){return e.pdfDoc.destroy()}),e});case"signDoc":return W.apply(void 0,m(t))}}},{key:"fragments",value:function(){return[]}},{key:"onCertifyWithSig",value:function(){var e=this;this.pdfUI.getStateHandlerManager().then(function(t){var n=e;"hand"===t.get("createRect").getStateName()&&t.register(T(t.pdfViewer)),t.switchTo("createRect",{callback:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.signDocWithoutAnnot.apply(n,m(t).concat(["certifyVisibleSig"]))},type:"certify-with-signature"})})}},{key:"onCertifyWithoutSig",value:function(){var e=this;this.pdfUI.getPDFDocRender().then(function(t){e.signDocWithoutAnnot(t.getCurrentPageIndex(),{left:0,right:0,top:0,bottom:0},{destroy:function(){}},"certifyInvisibleSig")})}},{key:"onShowTrusts",value:function(e){var t,n=this,i=this.pdfUI,r=D.toolkit.CertUtil;if(this.trustCertsDialog)return this.trustCertsDialog.show(document.body),e&&e(),Promise.resolve(this.trustCertsDialog);i.loading().then(function(e){return t=e,r.getTrustedCertificateList(n.pdfUI)}).then(function(){t.hide();var r="trustCertsDialog";D.modular.module("certify").registerComponent(H),i.registerDialog(r,function(){return i.getComponentByName("template-container").then(function(e){e.append('<certify:TrustCertsDialog name="'.concat(r,'"></certify:TrustCertsDialog>'));var t=n.trustCertsDialog=e.getComponentByName(r);return t.open(document.body),t})}),i.openDialog(r),e&&e()})}}],[{key:"getName",value:function(){return"SignDoc"}},{key:"getLoader",value:function(){return k()}}]),n}(D.UIXAddon)})(),r=r.default})());
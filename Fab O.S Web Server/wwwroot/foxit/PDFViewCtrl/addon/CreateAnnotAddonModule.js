!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):"function"==typeof define&&define.amd?define(["PDFViewCtrl","jquery",["PDFViewCtrl","PDFViewer"],["PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.PDFViewCtrl_CreateAnnotAddonModule=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):e.PDFViewCtrl_CreateAnnotAddonModule=t(e.PDFViewCtrl,e.jQuery,e.PDFViewCtrl.PDFViewer,e.PDFViewCtrl.commons)}(self,(e,t,n,i)=>(()=>{var a={425:(e,t,n)=>{var i=n(118),a=n(435);function r(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},548:(e,t,n)=>{var i=n(118),a=n(435);function r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},118:(e,t,n)=>{var i=n(218),a=Object.create,r=function(){function e(){}return function(t){if(!i(t))return{};if(a)return a(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=r},435:e=>{e.exports=function(){}},278:e=>{e.exports=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}},913:(e,t,n)=>{var i=n(425),a=n(548),r=n(278);e.exports=function(e){if(e instanceof i)return e.clone();var t=new a(e.__wrapped__,e.__chain__);return t.__actions__=r(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},263:(e,t,n)=>{var i=n(111);e.exports=function(e){var t=i(e);return t.__chain__=!0,t}},469:e=>{var t=Array.isArray;e.exports=t},218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},5:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},111:(e,t,n)=>{var i=n(425),a=n(548),r=n(435),o=n(469),s=n(5),c=n(913),l=Object.prototype.hasOwnProperty;function u(e){if(s(e)&&!o(e)&&!(e instanceof i)){if(e instanceof a)return e;if(l.call(e,"__wrapped__"))return c(e)}return new a(e)}u.prototype=r.prototype,u.prototype.constructor=u,e.exports=u},778:t=>{"use strict";t.exports=e},47:e=>{"use strict";e.exports=t},602:e=>{"use strict";e.exports=n},457:e=>{"use strict";e.exports=i}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function n(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(n,a,r){return a=e(a),i(n,t()?Reflect.construct(a,r||[],e(n).constructor):a.apply(n,r))}function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):r(e,t)}function c(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function d(t,n,i){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,i){var a=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=e(t)););return t}(t,n);if(a){var r=Object.getOwnPropertyDescriptor(a,n);return r.get?r.get.call(i||t):r.value}},d(t,n,i||t)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function g(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function m(e){return function(e){if(Array.isArray(e))return p(e)}(e)||v(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if(Array.isArray(e))return e}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return r}}(e,t)||g(e,t)||S()}o.r(s),o.d(s,{CreateAnnotAddon:()=>Qo,CreateStampService:()=>Nr});var A=o(778),b=A.stateHandler,E=b.IStateHandler,k=b.HandStateHandler,R=A.vendors.Hammer,x=b.StateHandlerConsts.STATE_HANDLER_CREATE_TEXT,C=A.ViewerEvents,T=A.shared,P=T.getClientX,I=T.getClientY,_=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-note",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o=i[0],s=this.hammer=new R.Manager(o,{recognizers:[[R.Tap]]}),c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan,u=c.otelService;s.on("tap",function(t){var i=o.getBoundingClientRect(),s=t.srcEvent,c=P(s),d=I(s),h=[c-i.left,d-i.top],f=h[0],p=h[1];return l&&l(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;a=t,r=n}),e.getPDFPage().then(function(t){var i=w(t.reverseDevicePoint([f,p],e.scale,e.getRotation()),2),a=i[0],r=i[1],o=n.pdfViewer.getDefaultAnnotConfig()("text"),s=Object.assign({flags:28,type:"text",rect:{left:a,right:a+20,top:r,bottom:r-20},subject:n.pdfViewer.i18n.t("viewer_:annotSubjects.Note")},o);return t.addAnnot(s).then(function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;e.pdfViewer.eventEmitter.emit(C.addAnnotSuccess,i.annot),e.pdfViewer.getStateHandlerManager().switchTo(k.getStateName()),setTimeout(function(){e.annotsRender.doubleTapAnnot(n.getId())},500)})}).catch(function(e){throw null==u||u.setSpanException(r,e),e}).finally(function(){null==a||a()})})}},{key:"getNoteRightPanelData",value:function(){var e=localStorage.getItem("NOTE-STORAGE-KEY");return e?JSON.parse(e):e||{}}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle)}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return x}}]),t}(E),D=A.stateHandler,M=D.IStateHandler,V=(D.HandStateHandler,A.vendors.Hammer),L=A.shared.DebouncePromiseQueue,N=D.StateHandlerUtils,H=N.getDevicePagePoint,O=N.deltaDeviceRect,F=N.appendSelectMark,U=N.removeSelectMark,j=N.removeTextSelectedRangeMark,B=N.showTextSelectedRangeMark,X=A.ViewerEvents,Y=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="",n}return f(t,e),u(t,[{key:"getDefaultProps",value:function(e){return this.pdfViewer.getDefaultAnnotConfig()(e)}},{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o,s,c,l=i[0],u=this.hammer=new V.Manager(l,{recognizers:[[V.Pan,{direction:V.DIRECTION_ALL}],[V.Tap]]}),d=-1,h=-1,f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;u.on("tap",function(t){n.pageRender.pdfViewer.activeElement();var i=n.pageRender.pdfViewer,a=t.srcEvent,r=w(e.getPDFPointFromClientPoint(a.clientX,a.clientY,!0),2),o=r[0],s=r[1],c=i.getEventEmitter();e.getPDFPage().then(function(t){var n=e.scale,i=e.rotate,a=t.getDeviceMatrix();return a.scale(n,n),a.rotate(i),t.getAnnotObjectNumAtDevicePoint([o,s],1,[a.a,a.b,a.c,a.d,a.e,a.f])}).then(function(n){var i=e.getAnnotRender(n);if(i){var a=i.component;c.emit(X.tapAnnotation,i,t),a.tapAnnot(t)}})}),u.on("panstart",function(t){if(!1!==n.panStart(t,n)){d=-1,h=-1;var i=H(l,t);a=[i.x,i.y],n.hideSelectMark(),r=new L,n.shouldDrawRange=!1,e.getTextContinueRectAtDevicePoints([i.x,i.y],[i.x+5,i.y+5],-1,-1).then(function(e){n.shouldDrawRange=!(e||[])[0]}),p&&p(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;o=t})}}),u.on("panmove",function(e){!1!==n.panMove(e,n)&&r&&r.push(function(){var t,i=n.pageRender,r=[a[0]+e.deltaX,a[1]+e.deltaY];if(n.shouldDrawRange){B(i,a,r);var o=O(a,e.deltaX,e.deltaY);t=i.getTextRectsAtRect(o)}else t=n.getTextRect(a,r,d,h);t.then(function(e){var t;return(t=e[0])&&"string"==typeof t.text&&(d=t.start,h=t.end),Promise.all([i.getPDFPage(),e])}).then(function(e){var t=w(e,2),a=t[0],r=t[1];n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"textMarkup",rects:r,page:a.getIndex()});var o=i.transformRectArray(a,r);n.showSelectMark(o)})})}),u.on("panend",function(t){if(!1!==n.panEnd(t,n)&&r){r.end(),r=null;var i,l=[a[0]+t.deltaX,a[1]+t.deltaY];if(n.shouldDrawRange){n.shouldDrawRange=!1,j(e,e.$handler);var u=O(a,t.deltaX,t.deltaY);i=e.getTextRectsAtRect(u)}else i=n.getTextRect(a,l,d,h);if(v){var f=v.startChildSpan(n.constructor.getStateName()+"End"),p=f.end,g=f.span;s=p,c=g}i.then(function(t){var i;return(i=t[0])&&"string"==typeof i.text&&(d=i.start,h=i.end),n.hideSelectMark(),Promise.all([e.getPDFPage(),t])}).then(function(e){var t=w(e,2),i=t[0],a=t[1];return a.length<1?Promise.resolve():n.addAnnot(i,a).then(function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(i),n.pageRender.annotsRender.activeAnnot(t.getId()),e}).then(function(e){if(n.pdfViewer.config.showCommentList){var t=e[e.length-2];n.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}}).then(function(){0})}).catch(function(e){throw null==v||v.setSpanException(c,e),e}).finally(function(){null==s||s(),null==o||o()})}})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark(),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"showSelectMark",value:function(e){F(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){U(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}},{key:"addAnnot",value:function(e,t){}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit(X.addAnnotSuccess,e.annot)}}]),t}(M),$=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_HIGHLIGHT,G=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-highlight",n}return f(t,e),u(t,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"highlight",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("highlight")))}}],[{key:"getStateName",value:function(){return $}}]),t}(Y),z=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_STRIKE_OUT,W=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-strikeout",n}return f(t,e),u(t,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"strikeout",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Strikeout"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("strikeout")))}}],[{key:"getStateName",value:function(){return z}}]),t}(Y),q=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_UNDERLINE,K=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-underline",n}return f(t,e),u(t,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"underline",rect:{left:0,right:0,top:0,bottom:0},coords:t,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Underline")},this.getDefaultProps("underline")))}}],[{key:"getStateName",value:function(){return q}}]),t}(Y),J=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUIGGLY,Z=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-s-underline",n}return f(t,e),u(t,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"squiggly",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Squiggly"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("squiggly")))}}],[{key:"getStateName",value:function(){return J}}]),t}(Y),Q=A.stateHandler,ee=Q.StateHandlerConsts.STATE_HANDLER_CREATE_REPLACE,te=Q.StateHandlerUtils.getCaretRectAndRotate,ne=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-replace-text",n}return f(t,e),u(t,[{key:"addAnnot",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("replace"),i=te(t),a=i.rect,r=i.rotate;return e.addAnnotGroup([{flags:4,type:"strikeout",rect:{left:0,right:0,top:0,bottom:0},coords:t,noPopup:!0,typeAlias:"Replace",intent:"StrikeOutTextEdit",color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")},{type:"caret",flags:4,rect:a,typeAlias:"Replace",intent:"Replace",rotation:r,color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")}],1)}}],[{key:"getStateName",value:function(){return ee}}]),t}(Y),ie=A.stateHandler,ae=A.Matrix,re=ie.IStateHandler,oe=(ie.HandStateHandler,A.vendors.Hammer),se=A.shared,ce=se.DebouncePromiseQueue,le=se.getClientX,ue=se.getClientY,de=ie.StateHandlerUtils,he=de.getDevicePagePoint,fe=(de.deltaDeviceRect,de.appendSelectMark),pe=de.removeSelectMark,ve=de.getCaretRectAndRotate,ge=A.ViewerEvents,me=ie.StateHandlerConsts.STATE_HANDLER_CREATE_CARET,ye=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-insert-text",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a,r,o,s,c,l=i[0],u=this.hammer=new oe.Manager(l,{recognizers:[[oe.Pan,{direction:oe.DIRECTION_ALL}],[oe.Tap]]}),d=-1,h=-1,f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;u.on("panstart",function(e){if(!1!==n.panStart(e,n)){d=-1,h=-1;var t=he(l,e);a=[t.x,t.y],n.hideSelectMark(),r=new ce,p&&p(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;o=t})}}),u.on("panmove",function(e){!1!==n.panMove(e,n)&&r.push(function(){var t=n.pageRender,i=[a[0]+e.deltaX,a[1]+e.deltaY];return n.getTextRect(a,i,d,h).then(function(e){var n;return(n=e[0])&&"string"==typeof n.text&&(d=n.start,h=n.end),Promise.all([t.getPDFPage(),e])}).then(function(e){var n=w(e,2),i=n[0],a=n[1];return t.transformRectArray(i,a)}).then(function(e){n.showSelectMark(e)})})}),u.on("panend",function(t){if(!1!==n.panEnd(t,n)){r.end(),r=null;var i=[a[0]+t.deltaX,a[1]+t.deltaY];if(v){var l=v.startChildSpan(n.constructor.getStateName()+"End"),u=l.end,f=l.span;s=u,c=f}return n.getTextRect(a,i,d,h).then(function(t){var i;return(i=t[0])&&"string"==typeof i.text&&(d=i.start,h=i.end),n.hideSelectMark(),Promise.all([e.getPDFPage(),t])}).then(function(e){var t=w(e,2),i=t[0],a=t[1];if(a.length<1)return Promise.resolve();var r=ve(a),o=r.rect,s=r.rotate;return i.addAnnot({type:"caret",flags:4,rect:o,rotation:s,subject:n.pdfViewer.i18n.t("viewer_:annotSubjects.Insert")}).then(function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;n.pdfViewer.eventEmitter.emit(ge.addAnnotSuccess,i.annot),n.pageRender.annotsRender.activeAnnot(t.getId()),n.pdfViewer.config.showCommentList&&i.showReplyDialog()}).then(function(){0})}).catch(function(e){throw null==v||v.setSpanException(c,e),e}).finally(function(){null==s||s(),null==o||o()})}}),u.on("tap",function(t){if(!1!==n.tap(t,n)){var i=l.getBoundingClientRect(),a=t.srcEvent,r=le(a),o=ue(a),s=[r-i.left,o-i.top];return e.getPDFPage().then(function(t){var i=t.reverseDevicePoint([s[0],s[1]],e.scale,e.getRotation());return t.getCharInfoAtPoint(i,0,!0).then(function(e){var i,a;if(e){var r=e.top-e.bottom,o=e.bottom+r/2,s=(e.right+e.left)/2,c=new ae;c.e=-s,c.f=-o;var l=(e.bottom+e.top)/2,u=l-r,d=e.right-3*r/8,h=e.right+3*r/8,f=c.transformRect(d,l,h,u),g=e.rotation*Math.PI/2;return c.reset(),c.rotate(-g),f=(i=c).transformRect.apply(i,m(f)),c.reset(),c.e=s,c.f=o,f=(a=c).transformRect.apply(a,m(f)),(p?p(n.constructor.getStateName()):Promise.resolve({end:null,span:null})).then(function(e){var i=e.end,a=e.span;return t.addAnnot({type:"caret",rect:{left:f[0],bottom:f[1],right:f[2],top:f[3]},rotation:g}).then(function(e){var t=e[0],i=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;n.pdfViewer.eventEmitter.emit(ge.addAnnotSuccess,i.annot),n.pageRender.annotsRender.activeAnnot(t.getId()),n.pdfViewer.config.showCommentList&&i.showReplyDialog()}).then(function(){0}).catch(function(e){throw null==v||v.setSpanException(a,e),e}).finally(function(){null==i||i()})})}})})}})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"tap",value:function(){var e=Date.now(),t=!0;return this.timer&&(t=e-this.timer>=1e3),this.timer=e,t}},{key:"showSelectMark",value:function(e){fe(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){pe(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}}],[{key:"getStateName",value:function(){return me}}]),t}(re);function Se(e,t,n,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function we(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var r=e.apply(t,n);function o(e){Se(r,i,a,o,s,"next",e)}function s(e){Se(r,i,a,o,s,"throw",e)}o(void 0)})}}function Ae(e,t){var n,i,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var be=A.stateHandler.IStateHandler,Ee=A.vendors,ke=(Ee.Hammer,Ee.jQuery,function(e){function t(e){return c(this,t),a(this,t,[e])}return f(t,e),u(t,[{key:"pageHandler",value:function(e){}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler")}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"textboxWidth",value:function(){return 100}},{key:"textboxHeight",value:function(){return 20}},{key:"calloutKneeLength",value:function(){return 20}},{key:"getStateName",value:function(){return"createFreetext"}},{key:"edit",value:function(e,t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;n.active(!0),setTimeout(function(){n.showReplyDialog("comment")},0)}}]),t}(be)),Re=o(457);Object.values({ANNOT_CURSOR_ENTER:11,ANNOT_CURSOR_EXIT:12,ANNOT_MOUSE_BUTTON_PRESSED:13,ANNOT_MOUSE_BUTTON_RELEASED:14,ANNOT_RECEIVE_INPUT_FOCUS:15,ANNOT_LOSE_INPUT_FOCUS:16,ANNOT_PAGE_OPENED:17,ANNOT_PAGE_CLOSED:18,ANNOT_PAGE_VISIBLE:19,ANNOT_PAGE_INVISIBLE:20}),Object.values({FIELD_KEY_STROKE:7,FIELD_WILL_FORMAT:8,FIELD_VALUE_CHANGED:9,FIELD_RECALCULATE_VALUE:10}),Object.values({PAGE_OPENED:0,PAGE_CLOSED:1}),Object.values({DOC_WILL_CLOSE:2,DOC_WILL_SAVE:3,DOC_SAVED:4,DOC_WILL_PRINT:5,DOC_PRINTED:6});var xe=5,Ce=0,Te={left:0,center:1,right:2},Pe=1,Ie=2,_e=3,De="editDiv",Me=function(){function e(){c(this,e)}return u(e,null,[{key:"formatHtmlStr",value:function(e){var t=e,n={split:"split",remove:"remove",removeSelf:"removeTag"};[{startStr:"\x3c!--StartFragment--\x3e",endStr:"\x3c!--EndFragment--\x3e",operate:n.split},{startStr:"\x3c!--[if",endStr:"<![endif]--\x3e",operate:n.remove},{startStr:"<![if",endStr:"<![endif]>",operate:n.remove},{startStr:"<o:p>",endStr:"</o:p>",operate:n.remove},{startStr:"<w:Sdt",endStr:"</w:Sdt>",operate:n.removeTag},{startStr:"<w:sdtPr>",endStr:"</w:sdtPr>",operate:n.remove}].forEach(function(e){for(var i=t.indexOf(e.startStr);i>-1;){switch(e.operate){case n.split:var a=t.indexOf(e.endStr);t=t.slice(i+e.startStr.length,a>-1?a:t.length);break;case n.remove:var r=t.indexOf(e.endStr),o=t.substring(0,i),s=t.substring(r+e.endStr.length);t=o+s;break;case n.removeTag:var c=t.substring(i),l=c.indexOf(">");t=(t=t.substring(0,i)+c.substring(l+1)).split(e.endStr).join("")}i=t.indexOf(e.startStr)}});var i=document.createElement("div");return i.contentEditable=!0,i.id=De,i.style.display="none",document.body.appendChild(i),i.innerHTML=t.replaceAll("\n","").replaceAll("\r",""),this.addTagClassName(i)}},{key:"getFont",value:function(e){var t=e[0],n=new RegExp("^\\s*".concat(t,"\\b")),i=["-apple-system","system-ui"," BlinkMacSystemFont"," Segoe UI"," Roboto"," Oxygen"," Ubuntu"," Fira Sans"," Droid Sans"," Helvetica Neue"," sans-serif"].some(function(e){return n.test(e)});return i?(Re.DeviceInfo.isWindows?t="DengXian Light":Re.DeviceInfo.isMacOS||Re.DeviceInfo.isIOS?t="PingFangSC":Re.DeviceInfo.isAndroid?t="Roboto":Re.DeviceInfo.isLinux&&(t="Noto Sans"),t):t}},{key:"formatRichText",value:function(e){var t=this,n=this.formatHtmlStr(e),i=document.getElementById("".concat(De)),a=n.map(function(e){var n,a,r,o,s=i.getElementsByClassName("".concat(e))[0],c=getComputedStyle(s),l=c.fontFamily.replaceAll('"',"").split(","),u=t.getFont(l);return{content:s.textContent,richTextStyle:{font:{name:u},textSize:parseInt(c.fontSize),textAlignment:Te[c.textAlign],textColor:(0,Re.colorConvertor)(c.color,"int"),isBold:(r=c.fontWeight,o=parseFloat(r),isNaN(o)?r.includes("bold"):o>400),isItalic:(a=c.fontStyle,a.includes("italic")||a.includes("oblique")),isUnderline:c.textDecoration.includes("underline"),isStrikethrough:c.textDecoration.includes("line-through"),cornerMarkStyle:(n=c.verticalAlign,{sub:_e,super:Ie}[n]||Pe)}}});return i.remove(),a}},{key:"addTagClassName",value:function(e){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=e.childNodes.length;(["block","flex"].includes(getComputedStyle(e).display)&&e.nextElementSibling&&(e.innerHTML+="\n"),a>0)&&Array.from(e.childNodes).forEach(function(a){if("#text"===a.nodeName){var r=document.createElement("span");r.innerText="".concat(a.textContent),r.style.textDecoration="".concat(n.underline?"underline":""," ").concat(n.lineThrough?"line-through":""),r.style.verticalAlign=n.verticalAlign;var o="foxitwebsdk-".concat(Date.now(),"-").concat(parseInt(1e3*Math.random()));i.push(o),r.classList.add(o),e.replaceChild(r,a)}else{var s=getComputedStyle(a).textDecoration,c={};s.includes("underline")&&(c.underline=!0),s.includes("line-through")&&(c.lineThrough=!0);var l=getComputedStyle(a).verticalAlign;["sub","super"].includes(l)&&(c.verticalAlign=l),t.addTagClassName(a,i,Object.assign({},n,c))}});return i}}]),e}(),Ve=function(e){return e.viewport="viewport",e.page="offset-page",e.scroll="scroll",e.pdf="pdf",e}({}),Le=A.stateHandler,Ne=A.ViewerEvents,He=Le.StateHandlerUtils.getDevicePagePoint,Oe=A.vendors.Hammer,Fe=A.shared,Ue=Fe.extendOptions,je=Fe.convertFromNumberToHex,Be=Le.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER,Xe=A.BrowserInfo.isFirefox,Ye=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).cursorStyle="fv__cursor-typewriter",t}return f(n,t),u(n,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e,this.jqEventNamespace=(Date.now()*Math.random()).toString(34);var i=e.$handler;i.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var a,r,o=i[0],s=this.hammer=new Oe.Manager(o,{recognizers:[[Oe.Tap]]}),c=function(e){var t=n.input=document.createElement("div");t.contentEditable=!0,o.appendChild(t),t.focus({preventScroll:!0})};i.on("touchstart",c),this.removeTouchStartListener=function(){i.off("touchstart",c)};var l=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,d=l.otelService,h=new Re.QueuedAsyncTaskExecutor;s.on("tap",function(t){return we(function(){var n,s,c,l,f,p;return Ae(this,function(v){switch(v.label){case 0:return n=this,s=new Re.Defer,c=h.waitForCurrentRunningTasks(),h.exec(function(){return s.promise}),[4,c];case 1:return v.sent(),l=He(o,t),[4,e.transformPoint({point:l,srcType:Ve.page,destType:Ve.pdf})];case 2:return f=v.sent(),p=function(t){var s=new Re.Defer,c=100*e.scale*4/3,h=20*e.scale*2/3,p={left:l.x,right:l.x+c,top:l.y,bottom:l.y+2*h},v=n.input=n.input||document.createElement("div");v.dataset.initScale=e.scale;var g=(0,Re.observeResize)(i[0],function(){return we(function(){var t,n,i,a;return Ae(this,function(r){switch(r.label){case 0:return this.input?[4,e.transformPoint({point:f,srcType:Ve.pdf,destType:Ve.page})]:[2];case 1:return t=r.sent(),n=e.scale,i=this.input.dataset.initScale,a=n/i,this.input.style.cssText+="\n                        left: ".concat(t.x,"px;\n                        top: ").concat(t.y,"px;\n                        transform: scale(").concat(a,");\n                        transform-origin: left top;\n                    "),[2]}})}).call(n)});Xe?"plaintext-only"!==v.contentEditable&&(v.contentEditable=!0,v.addEventListener("keyup",function(e){e.ctrlKey&&/^v$/i.test(e.key)&&(v.innerHTML=v.innerText)})):v.contentEditable=!0;var y="",S=n.pdfViewer.getDefaultAnnotConfig(),w=Ue({defaultAppearance:{textColor:255,textSize:12,font:"Arial"}},"function"==typeof S?S("freetext","FreeTextTypewriter"):{}),A=w.defaultAppearance.textSize*e.scale*4/3,b=function(e){var t=o.getBoundingClientRect();return{maxWidth:t.right-e.left,maxHeight:t.height-e.top}}(p),E=b.maxHeight,k=b.maxWidth;v.style.cssText="\n                    position: absolute;\n                    left: ".concat(p.left,"px;\n                    top: ").concat(p.top,"px;\n                    min-width: ").concat(A+5,"px;\n                    min-height: ").concat(A,"px;\n                    font-size: ").concat(A,"px;\n                    line-height: 1;\n                    color: ").concat(je(16777215&w.defaultAppearance.textColor),";\n                    outline:1px solid #5aa;\n                    outline-offset:1px;\n                    max-width: ").concat(k,"px;\n                    max-height: ").concat(E,"px;\n                    overflow: hidden;\n                    white-space: pre-line;\n                    word-break: break-word;\n                "),v.innerText=w.contents||"",o.appendChild(v),(0,Re.moveCursorToEnd)(v),v.onmousedown=v.ontouchstart=v.onpointerdown=function(e){e.stopPropagation()};v.onkeydown=function(e){39!==e.keyCode&&37!==e.keyCode||e.stopPropagation()},v.onkeyup=function(e){y=v.innerText.trim()};var R=!1,x="";return v.onpaste=function(e){R=!0},v.oninput=function(e){if(R){var t,n=Array.from(v.childNodes).map(function(e){if(e.nodeType!==Node.TEXT_NODE){var t=e.style.fontFamily.replaceAll('"',"").split(",");return x=Me.getFont(t),new Text(e.innerText)}return e});v.innerHTML="",(t=v).append.apply(t,m(n))}R=!1},v.onblur=function(){return we(function(){var n,i,c,l,h,f,p,m,S,A,b,E,k,R,C;return Ae(this,function(T){switch(T.label){case 0:return n=this,g(),this.isCreating=1,0!==y.length?[3,1]:(o.removeChild(v),this.input=null,this.isCreating=0,this.pdfViewer.customs.isAnnotToolKept&&!this.pdfViewer.customs.isAnnotToolKept(Be)&&e.pdfViewer.getStateHandlerManager().switchTo(),s.resolve(),[3,4]);case 1:return u?[4,u(this.constructor.getStateName())]:[3,3];case 2:i=T.sent(),c=i.end,l=i.span,a=c,r=l,T.label=3;case 3:h=v.getBoundingClientRect(),f=o.getBoundingClientRect(),p=h.left-f.left,m=h.top-f.top,S=p+h.width,A=m+h.height,b={left:p,top:m,right:S,bottom:A},E=t.reverseDeviceRect(b,e.scale,e.getRotation()),k={type:"freetext",intent:"FreeTextTypewriter",rect:E,contents:y,rotation:((360-90*t.getRotation()-e.getRotation())%360+360)%360,flags:4,borderInfo:{width:0},subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Typewriter")},x.length>0&&(R=w.defaultAppearance.textColor,C=w.defaultAppearance.textSize,k.defaultAppearance={font:{name:x},textColor:R||255,textSize:C||12}),t.addAnnot(k).then(function(t){var i,a;o.removeChild(v);var r=t[0],s=null===(a=e.annotsRender)||void 0===a||null===(i=a.getAnnotRender(r.getId()))||void 0===i?void 0:i.component;s&&s.$textInput.get(0).blur(),e.pdfViewer.eventEmitter.emit(Ne.addAnnotSuccess,r),n.isCreating=0}).catch(function(e){throw null==d||d.setSpanException(r,e),e}).finally(function(){s.resolve(),null==a||a()}),T.label=4;case 4:return[2]}})}).call(n)},s.promise},e.getPDFPage().then(function(t){if(t.isVirtual())return-1;var n=e.scale,i=e.rotate,a=t.getDeviceMatrix(i);return a.scale(n,n),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([l.x,l.y],1,[a.a,a.b,a.c,a.d,a.e,a.f])])}).then(function(t){var i=w(t,2),a=i[0],r=i[1];return we(function(){return Ae(this,function(t){switch(t.label){case 0:return-1===r?[3,3]:a.annotIdMap[r]?[3,2]:[4,a.getUnloadedAnnots()];case 1:t.sent(),t.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(r).getAnnot().getType())return[2,e.annotsRender.activeAnnot(r,0,1)];t.label=3;case 3:return this.pdfViewer.killFocus(),e.page?[2,p(e.page)]:[2,e.getPDFPage().then(p)]}})}).call(n)}).finally(function(){s.resolve()}),[2]}})}).call(n)})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.removeTouchStartListener(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.input&&this.input.blur()}},{key:"out",value:function(){d(e(n.prototype),"out",this).call(this)}}],[{key:"getStateName",value:function(){return Be}}]),n}(ke);function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ge=A.creation.CreateFreeTextCalloutService,ze=A.stateHandler,We=A.ViewerEvents,qe=(A.CalloutShape,ze.IStateHandler,ze.StateHandlerUtils.getDevicePagePoint),Ke=A.vendors,Je=Ke.Hammer,Ze=(Ke.jQuery,A.shared),Qe=Ze.getClientX,et=Ze.getClientY,tt=(Ze.CalloutPointsReviser,ze.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_CALLOUT),nt=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-typewriter",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass("fv__create-callout-state-handler "+this.cursorStyle),i.on("mousemove",function(e){if(n.startAdding){var t=o.getBoundingClientRect(),i=Qe(e)-t.left,a=et(e)-t.top;n.service.update({x:i,y:a})}});var a,r,o=i[0],s=this.hammer=new Je.Manager(o,{recognizers:[[Je.Pan,{direction:Je.DIRECTION_ALL}],[Je.Tap]]}),c=function(t){n.service.complete().then(function(t){return n.startAdding=0,ke.edit(e,t)}).then(function(e){n.pdfViewer.eventEmitter.once("editingFreeText",function(){!function(e){document.body.removeChild(e)}(t)})}).catch(function(e){null==h||h.setSpanException(r,e)}).finally(function(){null==a||a()})},l=function(t){var n=qe(o,t);return e.getPDFPage().then(function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])])}).then(function(t){var n=w(t,2),i=n[0],a=n[1];return we(function(){return Ae(this,function(t){switch(t.label){case 0:return-1===a?[3,3]:i.annotIdMap[a]?[3,2]:[4,i.getUnloadedAnnots()];case 1:t.sent(),t.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(a).getAnnot().getType())return[2,e.annotsRender.activeAnnot(a,0,1)];t.label=3;case 3:return[2,a]}})})()})},u=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,d=u.startSDKSpan,h=u.otelService;s.on("tap",function(t){return we(function(){var n,i;return Ae(this,function(s){switch(s.label){case 0:return this.startAdding?[3,2]:[4,l(t)];case 1:return-1!==s.sent()?[2]:(this.service||(this.service=new Ge,this.service.prepare(e)),n=qe(o,t),this.service.start(n),this.service.update(n),this.startAdding=1,d&&d(this.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;a=t,r=n}),[3,3]);case 2:this.pdfViewer.killFocus(),i=it(),setTimeout(function(){c(i)},100),s.label=3;case 3:return[2]}})}).call(n)}).on("panstart",function(t){n.service||(n.service=new Ge,n.service.prepare(e));var i=qe(o,t);n.service.start(i),d&&d(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;a=t,r=n})}).on("panend",function(e){c(it())}).on("panmove",function(t){var i=o.getBoundingClientRect(),a=t.srcEvent,r=Qe(a)-i.left,s=et(a)-i.top;n.service.update({x:r,y:s}),n.service.annotInfo&&n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"freetext",page:e.index,points:n.service.annotInfo.calloutLinePoints,innerRect:n.service.annotInfo.innerRect,rect:n.service.annotInfo.rect})})}},{key:"destroyPageHandler",value:function(){var e,t;null===(t=this.service)||void 0===t||null===(e=t.calloutShape)||void 0===e||e.hide(),this.startAdding=0,this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-callout-state-handler "+this.cursorStyle),this.service&&(this.service.calloutShape.hide(),this.startAdding=0,this.service.destroy()),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addAnnot",value:function(e){var t=this,n=this.pageRender,i=n.pdfViewer;return n.getPDFPage().then(function(i){var a=t.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),r=Object.assign({},$e({type:"freetext",intent:"FreeTextCallout",subject:"FreeTextCallout","interior-color":16777215,rotation:((360-90*i.getRotation()-n.getRotation())%360+360)%360,flags:4},"subject",t.pdfViewer.i18n.t("viewer_:annotSubjects.Callout")),e,a);return i.addAnnot(r)}).then(function(e){var t=e[0],a=n.annotsRender.getAnnotRender(t.getId()).component;return i.eventEmitter.emit(We.addAnnotSuccess,a.annot),ke.edit(n,e)})}}],[{key:"getStateName",value:function(){return tt}}]),t}(ke);function it(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}var at=A.stateHandler,rt=A.ViewerEvents,ot=(at.IStateHandler,at.StateHandlerUtils.getDevicePagePoint),st=A.vendors.Hammer,ct=at.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_BOX,lt=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-typewriter",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var a,r,o=i[0],s=this.hammer=new st.Manager(o,{recognizers:[[st.Tap]]}),c=function(t){var n=ot(o,t);return e.getPDFPage().then(function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),Promise.all([t,t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])])}).then(function(t){var n=w(t,2),i=n[0],a=n[1];return we(function(){return Ae(this,function(t){switch(t.label){case 0:return-1===a?[3,3]:i.annotIdMap[a]?[3,2]:[4,i.getUnloadedAnnots()];case 1:t.sent(),t.label=2;case 2:if("freetext"==e.annotsRender.getAnnotRender(a).getAnnot().getType())return[2,e.annotsRender.activeAnnot(a,0,1)];t.label=3;case 3:return[2,-1]}})})()})},l=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,d=l.otelService;s.on("tap",function(t){return we(function(){var n,i,s,l;return Ae(this,function(h){switch(h.label){case 0:return n=this,i=function(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}(),s=ot(o,t),l=e.pdfViewer,[4,c(t)];case 1:return-1!==h.sent()?[2]:(u&&u(this.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;a=t,r=n}),[2,e.getPDFPage().then(function(t){var i=e.getScale(),a=e.getRotation(),r=100*i*4/3,o=20*i*2/3,c={left:s.x,right:s.x+r,top:s.y-o,bottom:s.y+o},l=n.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),u=16777215;void 0!==l.fillColor&&(u=l.fillColor);var d=t.reverseDeviceRect(c,i,a),h=l.borderInfo;if(h&&h.style===xe){var f=2===h.cloudIntensity?14.25:6;d={left:d.left-f,right:d.right+f,top:d.top+f,bottom:d.bottom-f}}var p=Object.assign({type:"freetext",rect:d,"interior-color":u,rotation:((360-90*t.getRotation()-a)%360+360)%360,flags:4,subject:n.pdfViewer.i18n.t("viewer_:annotSubjects.Textbox")},l);return t.addAnnot(p)}).then(function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;return l.eventEmitter.emit(rt.addAnnotSuccess,i.annot),ke.edit(e,t)}).then(function(e){n.pdfViewer.eventEmitter.once("editingFreeText",function(){!function(e){document.body.removeChild(e)}(i)}),l.getStateHandlerManager().switchTo()}).catch(function(e){throw null==d||d.setSpanException(r,e),e}).finally(function(){null==a||a()})])}})}).call(n)})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.__removeHandlerMouseEvent__&&this.__removeHandlerMouseEvent__()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return ct}}]),t}(ke);var ut=function(){function e(t){c(this,e),this.component=t,this.prepared=!1}return u(e,[{key:"prepare",value:function(){this.prepared||(this.prepared=!0,this.doPrepare())}},{key:"doPrepare",value:function(){}},{key:"show",value:function(){this.prepared&&this.doShow()}},{key:"doShow",value:function(){}},{key:"hide",value:function(){this.prepared&&this.doHide()}},{key:"doHide",value:function(){}},{key:"destroy",value:function(){this.component=null,this.prepared=!1}},{key:"willRender",value:function(){}},{key:"afterRender",value:function(){}},{key:"render",value:function(e,t,n){return this.prepared||this.prepare(),this.doRender(e,t,n)}},{key:"doRender",value:function(e,t){return Promise.resolve()}},{key:"numberToRGBAString",value:function(e){var t=(0,Re.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"invisibleRender",value:function(){}}]),e}(),dt="vertical",ht="horizontal",ft=function(){function e(t,n){c(this,e),this.fromInchRate=t,this.name=n,Object.defineProperties(this,{fromInchRate:{value:t,enumerable:!0,writable:!1,configurable:!0},name:{value:n,enumerable:!0,writable:!1,configurable:!0}})}return u(e,[{key:"isPixel",get:function(){return!1}},{key:"convertTo",value:function(e,t){return e/this.fromInchRate*t.fromInchRate}},{key:"convertAreaTo",value:function(e,t){return e/Math.pow(this.fromInchRate,2)*Math.pow(t.fromInchRate,2)}}]),e}(),pt=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[0,"px"])).orientation=e,Object.defineProperty(n,"fromInchRate",{get:function(){var t=(0,Re.getDPI)();switch(e){case ht:return t.x;case dt:return t.y;default:return t.x}}}),n}return f(t,e),u(t,[{key:"isPixel",get:function(){return!0}}]),t}(ft);const vt={inch:"inch",custom:"custom",mi:"mi",pt:"pt",ft:"ft",yd:"yd",km:"km",m:"m",cm:"cm",mm:"mm",pica:"pica"};var gt,mt=new ft(1,vt.inch),yt=new ft(1,vt.custom),St=new ft(1/63360,vt.mi),wt=new ft(72,vt.pt),At=new ft(1/12,vt.ft),bt=new ft(1/36,vt.yd),Et=new ft(.0254/1e3,vt.km),kt=new ft(.0254,vt.m),Rt=new ft(2.54,vt.cm),xt=new ft(25.4,vt.mm),Ct=new ft(6,vt.pica),Tt=new pt(ht),Pt=(new pt(dt),$e(gt={},mt.name,mt),$e(gt,yt.name,yt),$e(gt,St.name,St),$e(gt,wt.name,wt),$e(gt,At.name,At),$e(gt,bt.name,bt),$e(gt,Et.name,Et),$e(gt,kt.name,kt),$e(gt,Rt.name,Rt),$e(gt,xt.name,xt),$e(gt,Ct.name,Ct),$e(gt,Tt.name,Tt),gt);function It(e){switch(e=(e=e.toLowerCase()).replace(/[^a-z]/g,"")){case"in":e="inch";break;case"p":e="pica"}return Pt[e]}var _t=function(t){function n(e){return c(this,n),a(this,n,[e])}return f(n,t),u(n,[{key:"prepare",value:function(){this.prepared||(this.canvas=document.createElement("canvas"),this.container=this.component.getContainerElement(),this.container.appendChild(this.canvas),d(e(n.prototype),"prepare",this).call(this))}},{key:"destroy",value:function(){d(e(n.prototype),"destroy",this).call(this),this.prepared&&this.canvas.remove()}},{key:"doShow",value:function(){this.canvas.classList.remove("fv__ui-hide")}},{key:"doHide",value:function(){this.canvas.classList.add("fv__ui-hide")}},{key:"convertPointToPixel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return wt.convertTo(e,Tt)*t}},{key:"willRender",value:function(){this.canvas.style.willChange="left, top, width, height",this.container.style.willChange="left; top"}},{key:"afterRender",value:function(){this.canvas.style.willChange="auto",this.container.style.willChange="auto"}},{key:"render",value:function(e,t){this.prepared||this.prepare();var n=this.component.getRenderingData(e,t);if(!n)return Promise.resolve();var i=n.annotInfo,a=i.borderInfo||{},r=this.convertPointToPixel(a.width,e),o=n.smartScale;!n.annotFlag.checkNoZoom()||(e=1);var s=n.rect,c=n.outerDeviceRect,l=n.innerDeviceRect;Object.assign(l,{width:l.right-l.left,height:l.bottom-l.top}),Object.assign(c,{width:c.right-c.left,height:c.bottom-c.top}),this.resetCanvasSize(c.width,c.height),this.container.style.cssText+="\n            left: ".concat(s.left,"px;\n            top: ").concat(s.top,"px;\n        ");var u=this.canvas.style;if(0===r&&0===i.borderColor&&!i.fillColor)return u.visibility="hidden",Promise.resolve();if(0===i.opacity)return u.visibility="hidden",Promise.resolve();u.visibility="unset";try{return Promise.resolve(this.doRender({outerRect:c,innerRect:l,deviceRect:s,scale:e,smartScale:o,rotate:t,renderingData:n}))}catch(e){return console.error(e),Promise.resolve()}}},{key:"doRender",value:function(e){e.outerRect,e.innerRect,e.deviceRect,e.scale,e.rotate}},{key:"resetCanvasSize",value:function(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.canvas.style.width=null,this.canvas.style.height=null}},{key:"invisibleRender",value:function(){this.canvas&&(this.canvas.width=0)}}]),n}(ut);var Dt=0,Mt=1,Vt=2,Lt=3,Nt=5,Ht="LineArrow",Ot="LineDimension",Ft="PolygonDimension",Ut="PolyLineDimension",jt="CircleDimension",Bt={0:"None",1:"Square",2:"Circle",3:"Diamond",4:"OpenArrow",5:"ClosedArrow",6:"Butt",7:"ROpenArrow",8:"RClosedArrow",9:"Slash"},Xt=Object.keys(Bt).reduce(function(e,t){return e[Bt[t]]=Number(t),e},{}),Yt=0,$t=1,Gt=(Promise.resolve(),function(){function e(t,n){c(this,e),this.x=t,this.y=n}return u(e,[{key:"add",value:function(t,n){return new e(this.x+t,this.y+n)}},{key:"addp",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"subtractp",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"subtract",value:function(t,n){return new e(this.x-t,this.y-n)}},{key:"move",value:function(t,n){var i=n.x-this.x,a=n.y-this.y,r=t/Math.sqrt(i*i+a*a);return new e(this.x+i*r,this.y+a*r)}},{key:"rotate",value:function(t,n){var i=this.x-n.x,a=this.y-n.y,r=Math.sqrt(i*i+a*a),o=Math.atan2(a,i)-t,s=r*Math.cos(o),c=r*Math.sin(o);return new e(n.x+s,n.y+c)}},{key:"distanceTo",value:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)}},{key:"slope",value:function(e){var t=this._dot(e);return Math.acos(t/(this._disp()*e._disp()))}},{key:"_dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"_disp",value:function(){return Math.sqrt(this._dot(this))}},{key:"equalTo",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return n=Math.abs(n),r(t,e)&&Math.abs(this.x-t.x)<=n&&Math.abs(this.y-t.y)<=n}},{key:"clone",value:function(){return new e(this.x,this.y)}}]),e}()),zt=function(){function e(){c(this,e),this.segments=[]}return u(e,[{key:"addSegment",value:function(e){r(e,Wt)&&this.segments.push(e)}},{key:"render",value:function(e){e.beginPath(),this.segments.forEach(function(t){t.render(e)}),e.closePath()}}]),e}(),Wt=function(){function e(t,n){c(this,e),this.from=t,this.to=n}return u(e,[{key:"render",value:function(e){(0,Re.notImplemented)()}},{key:"isJoinedBefore",value:function(e){return this.to.equalTo(e.from)}},{key:"isJoinedAfter",value:function(e){return e.to.equalTo(this.from)}},{key:"isJoinedWith",value:function(e){return this.isJoinedBefore(e)||this.isJoinedAfter(e)}}]),e}(),qt=function(){function e(){c(this,e)}return u(e,[{key:"generate",value:function(){(0,Re.notImplemented)()}}]),e}(),Kt=function(e){function t(e,n,i){var r;return c(this,t),(r=a(this,t,[null,i])).controlPoint1=e,r.controlPoint2=n,r}return f(t,e),u(t,[{key:"render",value:function(e){e.bezierCurveTo(this.controlPoint1.x,this.controlPoint1.y,this.controlPoint2.x,this.controlPoint2.y,this.to.x,this.to.y)}}]),t}(Wt),Jt=function(e){function t(e){return c(this,t),a(this,t,[e])}return f(t,e),u(t,[{key:"render",value:function(e){e.moveTo(this.from.x,this.from.y)}}]),t}(Wt),Zt=.5522847498308,Qt=3.14159265358979,en=function(e){function t(e,n,i){var r;return c(this,t),(r=a(this,t)).points=e,r.innerRect=n,r.outerRect=i,r}return f(t,e),u(t,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,n=arguments.length>2?arguments[2]:void 0,i=new zt,a=this.points.map(function(t){var n=e.innerRect.height-t.y;return new Gt(t.x,n)}),r=a.length;n||(n=r*t);var o=a.map(function(e,t){return e.distanceTo(a[(t+1)%r])}).reduce(function(e,t){return e+t}),s={left:a[0].x,right:a[0].x,top:a[0].y,bottom:a[0].y},c=o/n;if(0==c)return i;for(var l=[],u=0,d=a[0],h=a[1],f=d.distanceTo(h),p=0,v=1;p<n;p++){for(;u>f;)u-=f,v++,d=h,h=a[v%r],f=d.distanceTo(h);l.push(d.move(u,h)),u+=c}var g=l.length,y=!0,S=5*c/8;return l.forEach(function(t,n){var a=function(e,t,n){var i,a,r=e.subtractp(t),o=n.subtractp(t),s=[],c=Math.atan2(r.y,r.x),l=Math.atan2(o.y,o.x);c+=Math.acos(e.distanceTo(t)/(2*S))-Qt/9,l-=Math.acos(n.distanceTo(t)/(2*S)),l<c&&(l+=2*Qt);var u={left:t.x-S,right:t.x+S,bottom:t.y-S,top:t.y+S},d=tn(u,c,l,y);(i=s).push.apply(i,m(d.arrAp)),y=!1;var h=t.subtractp(n);return c=Math.atan2(h.y,h.x),c+=Math.acos(n.distanceTo(t)/(2*S)),l=c-Qt/9,u={left:n.x-S,right:n.x+S,bottom:n.y-S,top:n.y+S},d=tn(u,c,l,y),(a=s).push.apply(a,m(d.arrAp)),s}(l[0==n?g-1:n-1],t,l[(n+1)%g]);a.forEach(function(t){var n=function(t){if(t)return new Gt(t.x+e.innerRect.left-e.outerRect.left,e.innerRect.height-t.y+(e.innerRect.top-e.outerRect.top))};t.from=n(t.from),t.to=n(t.to),t.controlPoint1=n(t.controlPoint1),t.controlPoint2=n(t.controlPoint2),i.addSegment(t)})}),i.rect=s,i}}]),t}(qt);function tn(e,t,n,i){var a,r,o,s,c,l,u,d,h,f,p,v,g,m,y,S,w,A,b,E,k,R,x,C,T={};if(e.left>=e.right||e.bottom>=e.top)return{arrAp:[],pdfRect:T};if(Math.abs(n-t)<=1e-4)return{arrAp:[],pdfRect:T};var P=[];a=(e.right+e.left)/2,r=(e.top+e.bottom)/2,o=Math.abs(e.right-e.left)/2,s=Math.abs(e.top-e.bottom)/2,x=t,k=a+(p=o*Math.cos(x)),R=r+(v=s*Math.sin(x)),T.left=T.right=k,T.bottom=T.top=R,i&&P.push(new Jt(new Gt(k,R)));var I=1;n<t&&(I=-1);var _=Math.floor(2*t/Qt);I>0&&(_+=1),_*=Qt/2;for(var D=!1;C=_,I>0?n<=_&&(C=n,D=!0):n>=_&&(C=n,D=!0),p=o*Math.cos(x),v=s*Math.sin(x),w=o*Math.cos(C),h=f=-o*o*s*s,g=p+(k=(b=((u=o*o*v)*f-(d=o*o*(A=s*Math.sin(C)))*h)/((c=s*s*p)*d-(l=s*s*w)*u))-p)*Zt,m=v+(R=(E=(l*h-c*f)/(c*d-l*u))-v)*Zt,y=w+(k=b-w)*Zt,S=A+(R=E-A)*Zt,g=k=a+g,m=R=r+m,T.left>g&&(T.left=g),T.bottom>m&&(T.bottom=m),T.right<g&&(T.right=g),T.top<m&&(T.top=m),y=k=a+y,S=R=r+S,T.left>y&&(T.left=y),T.bottom>S&&(T.bottom=S),T.right<y&&(T.right=y),T.top<S&&(T.top=S),w=k=a+w,A=R=r+A,T.left>w&&(T.left=w),T.bottom>A&&(T.bottom=A),T.right<w&&(T.right=w),T.top<A&&(T.top=A),P.push(new Kt(new Gt(g,m),new Gt(y,S),new Gt(w,A))),!D;)x=C,_+=I*Qt/2;return{arrAp:P,pdfRect:T}}var nn=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;c(this,e),this.top=t,this.left=n,this.bottom=i,this.right=a},an=function(){function e(t){c(this,e),this.offsetLeft=0,this.offsetTop=0,this.offsetRight=0,this.offsetBottom=0,this.target=t}return u(e,[{key:"moveLeft",value:function(e){return this.offsetLeft+=e,this.offsetRight+=e,this}},{key:"moveTop",value:function(e){return this.offsetTop+=e,this.offsetBottom+=e,this}},{key:"move",value:function(e,t){return this.moveLeft(e).moveTop(t)}},{key:"moveTo",value:function(e,t){return this.offsetLeft=this.offsetRight=this.target.left-e,this.offsetTop=this.offsetBottom=this.target.top-t,this}},{key:"shrink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new nn(e,t,-n,-i))}},{key:"expand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new nn(-e,-t,n,i))}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",i=this.target.right+this.offsetRight-(this.target.left+this.offsetLeft),a=this.target.bottom+this.offsetBottom-(this.target.top+this.offsetTop),r=i*e-i,o=a*e-a,s=0,c=0,l=0,u=0;switch(t){case"right":s=-r;break;case"center":s=-r/2,c=r/2;break;default:c=r}switch(n){case"bottom":l=-o;break;case"center":l=-o/2,u=o/2;break;default:u=o}return this.add(new nn(l,s,u,c))}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.top,n=void 0===t?0:t,i=e.left,a=void 0===i?n:i,r=e.bottom,o=void 0===r?n:r,s=e.right,c=void 0===s?a:s;return this.offsetLeft+=a,this.offsetRight+=c,this.offsetBottom+=o,this.offsetTop+=n,this}},{key:"extract",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight;return{left:e,top:this.target.top+this.offsetTop,right:t,bottom:this.target.bottom+this.offsetBottom}}},{key:"boundary",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight,n=this.target.top+this.offsetTop;return{left:e,top:n,width:t-e,height:this.target.bottom+this.offsetBottom-n}}},{key:"intersect",value:function(t){r(t,e)||(t=e.on(t));var n=this.toPlainObject(),i=t.toPlainObject(),a={left:Math.max(n.left,i.left),right:Math.min(n.right,i.right),top:Math.max(n.top,i.top),bottom:Math.min(n.bottom,i.bottom)};return e.on(a)}},{key:"toPlainObject",value:function(){return{left:this.target.left+this.offsetLeft,right:this.target.right+this.offsetRight,top:this.target.top+this.offsetTop,bottom:this.target.bottom+this.offsetBottom}}},{key:"optimize",value:function(t){var n=this.toPlainObject(),i=n.left,a=n.right,r=n.top,o=n.bottom,s=t.left,c=t.right,l=t.top,u=t.bottom,d=function(e,t,n){return Math.max(t,Math.min(e,n))},h={left:d(i,s,c),right:d(a,s,c),top:d(r,l,u),bottom:d(o,l,u)},f=h.left,p=h.right,v=h.top,g=h.bottom;return Object.assign(h,{left:Math.min(f,p),right:Math.max(f,p),top:Math.min(v,g),bottom:Math.max(v,g)}),e.on(h)}}],[{key:"isOverlap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(e.left,t.left),a=Math[n?"min":"max"](e.top,t.top),r=Math[n?"max":"min"](e.bottom,t.bottom),o=Math.min(e.right,t.right);if(i<=o)if(n){if(a>=r)return(o-i)*(a-r)}else if(a<=r)return(o-i)*(r-a);return 0}},{key:"isInRect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e>=n.left&&e<=n.right)if(i){if(t>=n.bottom&&t<=n.top)return!0}else if(t<=n.bottom&&t>=n.top)return!0;return!1}},{key:"rectInRect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(e.left>=t.left&&e.right<=t.right)&&(n?e.top<=t.top&&e.bottom>=t.bottom:e.top>=t.top&&e.bottom<=t.bottom)}},{key:"isSimilar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(e.top-t.top)<n&&Math.abs(e.bottom-t.bottom)<n&&Math.abs(e.left-t.left)<n&&Math.abs(e.right-t.right)<n}},{key:"on",value:function(t){return new e(t)}},{key:"subtract",value:function(e,t){return new nn(e.top-t.top,e.left-t.left,e.bottom-t.bottom,e.right-t.right)}},{key:"expandOffset",value:function(e,t){return new nn(e.top-t.top,e.left-t.left,t.bottom-e.bottom,t.right-e.right)}},{key:"copyTo",value:function(e,t){t.left=e.left,t.top=e.top,t.right=e.right,t.bottom=e.bottom}}]),e}(),rn=function(t){function n(){return c(this,n),a(this,n,arguments)}return f(n,t),u(n,[{key:"doPrepare",value:function(){d(e(n.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-square-canvas")}},{key:"doRender",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.renderingData.annotInfo,i=n.borderInfo||{},a=this.convertPointToPixel(i.width||1,e.scale),r=this.canvas.getContext("2d");if(r.clearRect(0,0,this.canvas.width,this.canvas.height),r.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=a,t&&(r.globalAlpha=n.opacity),0===a||!1===n.hasBorderColor?r.strokeStyle="transparent":r.strokeStyle=this.numberToRGBAString(n.color),r.lineWidth=a;try{switch(i.style){case Lt:case Vt:case Dt:this.renderSolid(r,n,e);break;case Mt:this.renderDashed(r,n,e);break;case Nt:this.renderCloud(r,n,e)}var o=n.fillColor;o&&(r.fillStyle=this.numberToRGBAString(o),r.fill()),r.stroke()}finally{r.restore()}}}},{key:"shrinkRect",value:function(e,t){var n=an.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"renderCloud",value:function(e,t,n){t.fillColor;var i=t.borderInfo.cloudIntensity,a=this.shrinkRect(n.innerRect,0),r=this.shrinkRect(n.outerRect,0),o=a.width,s=a.height;new en([new Gt(0,s),new Gt(o,s),new Gt(o,0),new Gt(0,0)],a,r).generate(32/3/i).render(e)}},{key:"renderDashed",value:function(e,t,n){var i=this,a=t.borderInfo,r=a.dashes||[],o=a.dashPhase||0,s=n.scale;e.save(),e.setLineDash&&e.setLineDash(r.map(function(e){return i.convertPointToPixel(e,s)})),e.lineDashOffset=this.convertPointToPixel(o,s),this.renderSolid(e,t,n)}},{key:"renderSolid",value:function(e,t,n){var i=n.lineWidth,a=n.innerRect,r=n.outerRect,o=a.width,s=a.height,c=.5*i,l=a.left-r.left,u=a.top-r.top;e.beginPath(),e.rect(c+l,c+u,o-i,s-i),e.closePath()}}]),n}(_t);const on={invisible:1,hidden:2,print:4,noZoom:8,noRotate:16,noView:32,readOnly:64,locked:128,toggleNoView:256,lockedContents:512};const sn=function(){function e(t){c(this,e),this.flag=t}return u(e,[{key:"getValue",value:function(){return this.flag}},{key:"checkInvisible",value:function(){return(this.flag&on.invisible)===on.invisible}},{key:"checkHidden",value:function(){return(this.flag&on.hidden)===on.hidden}},{key:"checkPrint",value:function(){return(this.flag&on.print)===on.print}},{key:"checkNoZoom",value:function(){return(this.flag&on.noZoom)===on.noZoom}},{key:"checkNoRotate",value:function(){return(this.flag&on.noRotate)===on.noRotate}},{key:"checkNoView",value:function(){return(this.flag&on.noView)===on.noView}},{key:"checkReadOnly",value:function(){return(this.flag&on.readOnly)===on.readOnly}},{key:"checkLocked",value:function(){return(this.flag&on.locked)===on.locked}},{key:"checkToggleNoView",value:function(){return(this.flag&on.toggleNoView)===on.toggleNoView}},{key:"checkLockedContents",value:function(){return(this.flag&on.lockedContents)===on.lockedContents}},{key:"check",value:function(e){return(this.flag&e)===e}},{key:"or",value:function(e){return this.flag=this.flag|e,this}}]),e}();const cn={annotationUpdated:"annotation-updated",annotationIDUpdated:"annotation-id-updated",annotationAppearanceUpdated:"annotation-appearance-updated",annotationReplyAdd:"annotation-reply-add",annotationReplyAdded:"annotation-reply-add",annotationReviewStateAnnotAdd:"annotation-review-state-annot-add",annotationReviewStateAnnotAdded:"annotation-review-state-annot-add",annotationMarkedStateAnnotAdd:"annotation-marked-state-annot-add",annotationMarkedStateAnnotAdded:"annotation-marked-state-annot-add",annotationStatesCleared:"annotation-states-cleared",annotationRemoved:"annotation-removed",annotationMovedPosition:"annotation-moved-position",annotationPositionMoved:"annotation-moved-position",annotationOrderChanged:"annotation-order-changed",annotationAdded:"annotation-add",annotationAdd:"annotation-add",moveAnnotsToPages:"moveAnnotsToPages",annotationImported:"annotation-imported",annotationImportedEx:"annotation-imported-ex",annotationLoaded:"annotation-loaded",actionUpdated:"action-updated",actionAdd:"action-add",actionAdded:"action-add",actionRemove:"action-remove",actionRemoved:"action-remove",layerVisibleChange:"layer-visible-change",layerVisibleChanged:"layer-visible-change",layerRemoved:"layer-removed",layerMerged:"layer-merged",layerAdded:"layer-added",bookmarkAdded:"bookmark-added",structureBookmarkAdded:"structure-bookmark-added",bookmarkUpdated:"bookmark-updated",bookmarkRemoved:"bookmark-removed",stateAnnotNameUpdated:"state-annot-name-updated",pageInfoChange:"page-info-change",pageInfoChanged:"page-info-change",pageRotationChange:"page-rotation-change",beforePageRotationChanged:"before-page-rotation-changed",pageRotationChanged:"page-rotation-change",imageAdded:"image-added",watermarksAdded:"watermarks-added",watermarkAdded:"watermark-added",watermarkRemoved:"watermark-removed",graphicsUpdated:"graphics-updated",permissionChanged:"permission-changed",docPasswordChanged:"doc-password-changed",drmEncryptSuccess:"drm-encrypt-success",drmEncryptSucceeded:"drm-encrypt-success",drmEncryptFailed:"drm-encrypt-failed",removePwdAndPerm:"remove-password-and-permission",pwdAndPermRemoved:"remove-password-and-permission",securityTypeChanged:"security-type-changed",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",insertPages:"import-pages",pagesInserted:"import-pages",importPages:"import-pages",documentAttachmentAdd:"document-attachment-add",docAttachmentAdded:"document-attachment-add",documentAttachmentModify:"document-attachment-modify",docAttachmentModified:"document-attachment-modify",documentAttachmentRemove:"document-attachment-remove",docAttachmentRemoved:"document-attachment-remove",applyRedaction:"apply-redaction",redactionApplied:"apply-redaction",removeReviewState:"remove-review-state",reviewStateRemoved:"remove-review-state",removeMarkedState:"remove-marked-state",markedStateRemoved:"remove-marked-state",formValueChanged:"form-value-changed",metaDataChanged:"meta-data-changed",docModified:"doc-modified",flattened:"flattened",flattenAnnotation:"flatten-annotation",headerFooterUpdated:"headerFooterUpdated",headerFooterAdded:"headerFooterAdded",calculationOrderUpdated:"calculationOrderUpdated",COChange:"COChange",COChanged:"COChange",pagesMoved:"pages-moved",pagesReverseStart:"pagesReverseStart",pagesReversed:"pagesReversed",pagesRemoved:"pages-removed",pagesRotated:"pages-rotated",pageMeasureScaleRatioChanged:" page-measure-scale-ratio-changed",obtainsPageFromEngine:"obtains-page-from-engine",pagesBoxChange:"pages-box-changed",pagesBoxChanged:"pages-box-changed",pagesLabelChange:"pages-label-change",pagesLabelChanged:"pages-label-change",pagesLabelNeedUpdate:"pages-label-need-change",pagesLabelNeedUpdated:"pages-label-need-change",pagesReplace:"pages-replace",pagesReplaced:"pages-replace",recognitionForm:"recognition-form",removeEmbeddedPageThumbnail:"remove-embedded-page-thumbnail",embeddedPageThumbnailRemoved:"remove-embedded-page-thumbnail",objectStartEdit:"object-start-edit",objectEndEdit:"object-end-edit",objectSelectionChanged:"object-selection-changed",objectAdded:"object-added",objectPropertyChanged:"object-property-changed",objectContentChanged:"object-content-changed",paragraphContentChanged:"paragraph-text-changed",paragraphTextOnActivate:"paragraph-text-on-activate",paragraphTextOnDeactivate:"paragraph-text-on-deactivate",paragraphTextEnterEdit:"paragraph-text-enter-edit",paragraphTextExitEdit:"paragraph-text-exit-edit",paragraphTextOnChar:"paragraph-text-on-char",findSuccess:"find-success",replaceSuccess:"replace-success",replaceAllSuccess:"replace-all-success",articleThreadAdded:"article-thread-added",articleThreadUpdated:"article-thread-updated",articleThreadRemoved:"article-thread-removed",articleBeadAdded:"article-bead-added",articleBeadRemoved:"article-bead-removed",articleBeadUpdated:"article-bead-updated",articleEnterReadMode:"article-enter-read-mode",articleOutReadMode:"article-out-read-mode",invalidRect:"invalidRect",xfaContentChanged:"xfa-content-changed",formReloaded:"formReloaded",formFieldImported:"form-field-imported",pagingSealUpdated:"paging-seal-updated",xfaFormImported:"xfa-form-imported",xfaFormReset:"xfa-form-reset",xfaFormRemoved:"xfa-form-removed",textSplited:"text-splited",formFieldPropertyUpdated:"form-field-property-updated",formFieldRenamed:"form-field-renamed",formFieldRemoved:"form-field-removed",formReset:"form-reset",formImported:"form-imported",tabOrderTypeUpdated:"tab-order-type-updated",pageAdditionalActionAdded:"page-additional-action-added",pageAdditionalActionUpdated:"page-additional-action-updated",pageAdditionalActionRemoved:"page-additional-action-removed",docAdditionalActionAdded:"doc-additional-action-added",docAdditionalActionUpdated:"doc-additional-action-updated",docAdditionalActionRemoved:"doc-additional-action-removed",docOpenActionUpdated:"doc-open-action-updated",docOpenActionRemoved:"doc-open-action-removed",formWidgetCreated:"form-widget-created",pdfDocCreated:"pdf-doc-created"};const ln=Object.assign({jrLicenseSuccess:"jr-license-success",srLicenseSuccess:"sr-license-success",beforeOpenFile:"before-open-file",openingFile:"opening-file",beforeLoadPDFDoc:"before-load-pdf-document",openFileSuccess:"open-file-success",openFileFailed:"open-file-failed",willCloseDocument:"will-close-document",documentClosed:"document-closed",renderFileSuccess:"render-file-success",renderFileFailed:"render-file-error",beforeRenderPage:"before-render-page",renderPageSuccess:"render-page-success",updateZoomMode:"update-zoom-mode",beforeZoomTo:"before-zoom-to",zoomToSuccess:"zoom-to-success",zoomToFailed:"zoom-to-failed",startChangeViewMode:"start-change-view-mode",changeViewModeSuccess:"change-view-mode-success",toggleFullScreen:"toggle-full-screen",changeViewModeFailed:"change-view-mode-failed",pagesLayoutRedrawBegin:"pages-layout-redraw-begin",pageLayoutRedraw:"page-layout-redraw",pagesLayoutRedrawEnd:"pages-layout-redraw-end",copyTextSuccess:"copy-text-success",copyTextFailed:"copy-text-failed",tapPage:"tap-page",tapAnnotation:"tap-annotation",pressPage:"press-page",pressAnnotation:"press-annotation",pressText:"press-text",rightClickPage:"right-click-page",rightClickAnnotation:"right-click-annotation",doubleTapPage:"double-tap-page",doubleTapAnnotation:"double-tap-annotation",activeAnnotationBefore:"active-annotation-before",activeAnnotation:"active-annotation",activeAnnotationAfter:"active-annotation-after",panActiveAnnotation:"pan-active-annotation",doubleTapActiveAnnotation:"double-tap-active-annotation",contextMenuActiveAnnotation:"contextmenu-action-annotation",activeMultipleAnnotations:"active-multiple-annotations",unActiveAnnotation:"unactive-annotation",updateActiveAnnotation:"update-action-annotation",updateActionAnnotation:"update-action-annotation",removeActiveAnnotationBefore:"remove-action-annotation-before",removeActionAnnotationBefore:"remove-action-annotation-before",removeActiveAnnotationSuccess:"remove-action-annotation-success",removeActionAnnotationSuccess:"remove-action-annotation-success",removeActiveAnnotationFailed:"remove-action-annotation-failed",removeActionAnnotationFailed:"remove-action-annotation-failed",beforeSwitchStateHandler:"before-switch-state-handler",switchStateHandler:"switch-state-handler",deactiveStateHandler:"deactive-state-handler",afterSwitchStateHandler:"after-switch-state-handler",redactAnnotAllApplyed:"applyed-all-redaction",redactAnnotApplyed:"applyed-redaction",pageNumberChange:"page-number-change",beforeDocumentRotation:"before-document-rotation",afterDocumentRotation:"after-document-rotation",snapModeChanged:"snap-mode-changed",createPageAreaRenderer:"create-page-area-renderer",destroyPageAreaRenderer:"destroy-page-area-renderer",startUpdatePageAreaRenderer:"start-update-page-area-renderer",createSnapshotArea:"create-snapshot-area",updateSnapshotArea:"update-snapshot-area",stabilizedSnapshotArea:"stabilized-snapshot-area",switchPageAreaRenderer:"switch-page-area-renderer",fitWidthResizeViewport:"fit-width-resize-viewport",signatureFieldMouseLButtonDown:"signature-field-Lbutton-down",signatureFieldMouseLButtonUp:"signature-field-LButton-up",signatureFieldMouseEnter:"signature-field-mouse-enter",signatureFieldMouseExit:"signature-field-mouse-exit",visiblePagesRenderCompleted:"completed-render-visible-pages",marqueeZoomIn:"marquee-zoom-in",marqueeZoomOut:"marquee-zoom-out",inkSignAdded:"inkSign-added",inkSignDeleted:"inkSign-deleted",changeReadSpeed:"changeReadSpeed",changeReadVolume:"changeReadVolume",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",customDataAdd:"custom-data-add",customDataImported:"custom-data-imported",customDataRemoved:"custom-data-removed",customDataUpdated:"custom-data-updated",distanceAnnotCreationStart:"distance-creation-start",perimeterAnnotCreationStart:"perimeter-creation-start",updateDistanceAnnot:"update-distance-annot",distanceAnnotCreationEnd:"distance-creation-end",distanceAnnotCreationCancel:"distance-creation-cancel",drawingAnnotCreationStart:"drawing-creation-start",drawingAnnotCreationEnd:"drawing-creation-end",drawingAnnotCreationCancel:"drawing-creation-cancel",addEditImage:"add-edit-image",InkImageSelected:"ink-image-selected",checkTheSearch:"check-the-search",activeElementChanged:"active-element-changed",cancelCreatingDistance:"cancel-creating-measurement",completeCreatingDistance:"complete-creating-measurement",eraserSuccess:"eraser-success",addAnnotSuccess:"add-annot-success",cancelAddAnnot:"cancel-add-annot",globalAnnotFlagChanged:"global-annot-flag-changed",toolbarTabsClicked:"toolbar-tabs-clicked",sideBarChanged:"sidebar-changed",showWhatsNew:"show-whats-new",disableScroll:"disable-scroll",enableScroll:"enable-scroll",updateScrollableStatus:"update-scrollable-status",selectText:"select-text",changeEnableJS:"change-enable-js",toggleEngineSr2JrSuccess:"toggle-engine-sr-to-jr-success",iconInited:"iconInited",iconAdded:"iconAdded",iconRemoved:"iconRemoved",annotationPermissionChanged:"annotation-premission-changed",startScrollingPage:"pdfui-start-scrolling-page",scrollingPage:"pdfui-scrolling-page",endScrollingPage:"pdfui-end-scrolling-page",designerAssistantStatusChanged:"form-designer-assistant-status-changed",mouseEnter:"mouse-enter",mouseLeave:"mouse-leave",setFromFieldHighlight:"set_form_field_highlight",AddFontMaps:"set_font_map",thumbnailClicked:"thumbnail-clicked",layerActionActived:"layer-action-actived",redeModeShowSidebar:"rede-mode-show-sidebar",gridToggle:"grid-toggle",snapGridToggle:"snap-grid-toggle",toggleCollaborationMode:"toggleCollaborationMode",findReplaceDialogVisibleChange:"find-replace-dialog-visible-change",showAllComments:"show-all-comments",hideAllComments:"hide-all-comments",focusOnControl:"focus-on-control",blurFromObject:"blur-from-object",documentWillPrint:"document-will-print",documentDidPrint:"document-did-print",documentWillSave:"document-will-save",documentDidSave:"document-did-save",verifyDocSignatureEvent:"verify-doc-signature",verifySignatureEvent:"verify-signature",clearSignatureEvent:"clear-signature",viewSignedVersionDocEvent:"view-signed-version",showFieldPropertiesEvent:"show-field-properties",showSignatureVerifyInfoEvent:"show-signature-tusted-info",compareSignedVersionEvent:"compare-signed-version",showCompareSignedVersionResultEvent:"show-compare-signed-version-result",eSignCnShowMultiPageStamp:"eSignCnShowMultiPageStamp",eSignCNAddDateStamp:"eSignCNAddDateStamp",eSignCNCloseStamp:"eSignCNCloseStamp",eSignCNChangePagingSeal:"eSignCNChangePagingSeal",eSignCNOpenProcessSeal:"eSignCNOpenProcessSeal",eSignCnApply:"eSignCnApply",eSignCNShowOfflineResult:"eSignCNShowOfflineResult",eSignCnExit:"eSignCnExit",tapField:"tap-field",tapGraphicsObject:"tap-graphics-object",spawnPageSuccess:" spawn-page-success",progressChanged:"progress-changed",togglePageContextMenu:"toggle-page-contextmenu",beforeRenderingVisiblePages:"before-rerendering-visible-pages",afterRenderingVisiblePages:"after-rerendering-visible-pages",localFontLoaded:"local-font-loaded",willToggleAutoScroll:"will-toggle-auto-scroll",showLoading:"show-loading",changeLanguageSuccess:"change-language-success"},cn);var un;function dn(e){return function(){if(!un){var e=(0,Re.getDPI)();un=[e.x,e.y]}return un}()[e]}function hn(e){return e*dn(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/72}var fn=function(){function e(t){c(this,e),$e(this,"pdfRect",{left:0,right:0,top:0,bottom:0}),$e(this,"deviceRect",{left:0,right:0,top:0,bottom:0}),$e(this,"pdfViewer",void 0),$e(this,"page",void 0),$e(this,"pageRender",void 0),$e(this,"scale",void 0),$e(this,"rotate",void 0),$e(this,"intent",void 0),$e(this,"annotationInfo",this.getDefaultAnnotInfo()),$e(this,"eContainer",document.createElement("div")),$e(this,"renderer",void 0),this.eContainer.classList.add("fv__viewer-fake-annot-container"),this.pdfViewer=t.pdfViewer,this.pageRender=t.pageRender,this.intent=t.info.intent,(0,Re.extendOptions)(this.annotationInfo,t.info,this.getDefaultAnnotConfig()),this.annotationInfo.type=this.getType(),this.page=t.pageRender.page,this.scale=t.pageRender.scale,this.rotate=t.pageRender.rotate,this.pageRender.$annotsContainer.append(this.eContainer)}return u(e,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top),i=hn(this.annotationInfo.borderInfo.width)*this.scale*2;if(t<i){var a=.5*(i-t)*(e.right-e.left>0?1:-1);e.right+=a,e.left-=a}if(n<i){var r=.5*(i-n)*(e.bottom-e.top>0?1:-1);e.top-=r,e.bottom+=r}t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var o=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,o),(0,Re.cssText)(this.eContainer,{left:e.left+"px",top:e.left+"px",width:t+"px",height:n+"px"})}},{key:"setContent",value:function(e){this.annotationInfo.content=e,this.annotationInfo.contents=e}},{key:"zoomTo",value:function(e){this.scale=e}},{key:"draw",value:function(){this.renderer||(this.renderer=this.generateApRenderer(),this.renderer.prepare(),this.renderer.willRender()),this.renderer.component&&this.renderer.render(this.scale,this.rotate)}},{key:"getContainerElement",value:function(){return this.eContainer}},{key:"getRenderingData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.getDeviceRect(e,t),a=this.getOuterDeviceRect(e,t),r=this.getDeviceRect(n,t);return{annotInfo:this.annotationInfo,annotFlag:new sn(this.annotationInfo.flags),smartScale:n,rect:a,outerDeviceRect:a,innerDeviceRect:i,engineRenderingRect:r,scale:e,rotate:t,page:this.page}}},{key:"getDeviceRect",value:function(e,t){return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.borderInfo;if(n&&5===n.style){var i=this.pageRender.getContainerVisibleRect(),a=i.right-i.left,r=i.bottom-i.top,o=this.page.getDeviceRect(this.pdfRect,e,t),s=(a-(o.right-o.left))/2,c=(r-(o.bottom-o.top))/2;return{left:o.left-s,right:o.right+s,top:o.top-c,bottom:o.bottom+c}}return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"apply",value:function(){return we(function(){var e,t,n;return Ae(this,function(i){switch(i.label){case 0:return e=this,null===(t=this.renderer)||void 0===t||t.afterRender(),[4,this.getCreationJSON()];case 1:return(n=i.sent()).endingStyle&&(n.endStyle=n.endingStyle,delete n.endingStyle),n.rect=this.pdfRect,[2,this.page.addAnnot(n).then(function(t){var n=e.pdfViewer.addEventListener("renderAnnotSuccess",function(){e.destroy(),n()}),i=t[0];return e.pageRender.annotsRender.activeAnnot(i.getId()),e.pdfViewer.eventEmitter.emit(ln.addAnnotSuccess,i),t})]}})}).call(this)}},{key:"destroy",value:function(){var e;null===(e=this.renderer)||void 0===e||e.destroy(),this.getContainerElement().remove()}},{key:"getCreationJSON",value:function(){return this.annotationInfo}},{key:"getDefaultAnnotInfo",value:function(){return{borderInfo:{width:2,style:Dt},color:16711680,opacity:1,flags:4,date:new Date}}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),this.getIntent()):{}}},{key:"getIntent",value:function(){return this.intent}}]),e}(),pn=function(t){function n(){return c(this,n),a(this,n,arguments)}return f(n,t),u(n,[{key:"getTileConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.pdfViewer.config.tileSize,a=this.page.getDeviceRect(this.pdfRect,1,t),r=this.page.getDeviceRect(this.pdfRect,n,t),o=r.right-r.left,s=r.bottom-r.bottom;return[Math.ceil(s/i),Math.ceil(o/i),o,s,i,n,e,t,a.left,a.top]}},{key:"getRenderingData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,a=d(e(n.prototype),"getRenderingData",this).call(this,t,i);return Object.assign(a,{opacity:this.annotationInfo.opacity,tileConfig:this.getTileConfig(t,i)})}}]),n}(fn),vn=function(e){function t(){return c(this,t),a(this,t,arguments)}return f(t,e),u(t,[{key:"getType",value:function(){return"square"}},{key:"generateApRenderer",value:function(){return new rn(this)}}]),t}(pn),gn=function(e){function t(){return c(this,t),a(this,t,arguments)}return f(t,e),u(t,[{key:"doRender",value:function(e){var t=e.renderingData.annotInfo,n=t.borderInfo||{},i=this.convertPointToPixel(n.width||1,e.scale);if(0!=i||-1!=t.borderColor||t.fillColor){var a=this.canvas.getContext("2d");if(a.clearRect(0,0,this.canvas.width,this.canvas.height),a.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=i,a.globalAlpha=t.opacity,0===i||!1===t.hasBorderColor?a.strokeStyle="transparent":a.strokeStyle=this.numberToRGBAString(t.color),a.lineWidth=i;try{switch(n.style){case Dt:this.renderSolid(a,t,e);break;case Lt:break;case Mt:this.renderDashed(a,t,e);break;case Nt:0==n.cloudIntensity?this.renderSolid(a,t,e):this.renderCloud(a,t,e)}var r=t.fillColor;r&&(a.fillStyle=this.numberToRGBAString(r),a.fill()),a.stroke(),this.setContents(a,t.contents,e)}finally{a.restore()}}}}},{key:"renderSolid",value:function(e,t,n){this.renderDashed(e,t,n)}},{key:"renderDashed",value:function(e,t,n){var i=t.borderInfo,a=n.lineWidth,r=n.innerRect,o=n.outerRect,s=i.dashes||[],c=i.dashPhase||0,l=.5*a,u=new Gt(.5*(r.left+r.right)-o.left,.5*(r.top+r.bottom)-o.top),d=Math.abs(.5*r.height-l),h=Math.abs(.5*r.width-l);e.lineDashOffset=c,e.setLineDash&&e.setLineDash(s),e.beginPath(),function(e,t,n,i,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];e.ellipse?e.ellipse(t,n,i,a,r,o,s,c):(e.save(),e.translate(t,n),e.rotate(r),e.scale(i,a),e.arc(0,0,1,o,s,c),e.restore())}(e,u.x,u.y,h,d),e.closePath()}},{key:"renderCloud",value:function(e,t,n){var i=t.borderInfo.cloudIntensity,a=.5*n.lineWidth,r=this.shrinkRect(n.innerRect,a),o=this.shrinkRect(n.outerRect,a),s=new Gt(.5*(o.right-o.left)-(r.left-o.left),.5*(o.bottom-o.top)-(r.top-o.top)),c=.5*r.height-a,l=.5*r.width-a,u=16/i,d=Math.PI/u,h=2*Math.PI,f=Array(Math.floor(h/d)-1).fill(0).map(function(e,t){return t*d%h}).map(function(e){var t=l*Math.cos(h-e),n=c*Math.sin(h-e);return s.add(t,n)});new en(f,r,o).generate(1,e).render(e)}},{key:"shrinkRect",value:function(e,t){var n=an.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"setContents",value:function(e,t,n){if(void 0!==t){var i=n.innerRect,a=n.outerRect,r=.5*(i.left+i.right)-a.left,o=.5*(i.top+i.bottom)-a.top,s=e;s.beginPath(),s.font="14px Verdana",s.textAlign="left",s.textBaseline="top",s.direction="ltr";var c=s.measureText(t).width;s.fillStyle="#AF6B6B",s.fillText(t,r-c/2,o-7,c),s.closePath()}}}]),t}(_t);function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){$e(e,t,n[t])})}return e}var yn=o(602),Sn=o.n(yn),wn=function(e){return e.MEASUREMENT="measurement",e.COMPARISON="comparison",e.STAMP="stamp",e.SIGN_CERTIFY="sign-certify",e.SIGNATURE="signature",e}({});function An(){}var bn="measurement-info",En={userSpaceUnit:mt,userSpaceScaleValue:1,realUnit:mt,realScaleValue:1,caption:"",markup:!0},kn="measurementInfo",Rn=function(e){function t(){var e;return c(this,t),$e(e=a(this,t,arguments),"pdfViewer",void 0),e}return f(t,e),u(t,[{key:"allInjected",value:function(){var e=this;this.pdfViewer.store.dispatch(kn,En),this.getStorage().get(wn.MEASUREMENT,bn).then(function(t){e.isDestroyed||t&&(e.pdfViewer.getStore().dispatch(kn,mn({},e.convertFromRaw(t))),e.addDestroyHook(e.pdfViewer.store.subscribe(kn,function(t){if(!e.isDestroyed)return e.updateMeasurementInfo(t)})))}),this.addDestroyHook(this.getStorage().onChange(function(t){t.context.feature===wn.MEASUREMENT&&e.pdfViewer.store.dispatch(kn,e.convertFromRaw(t.newValue))}),this.pdfViewer.addEventListener(ln.pageNumberChange,function(){return we(function(){var e,t;return Ae(this,function(n){switch(n.label){case 0:return this.isDestroyed?[2]:[4,(e=this.getStorage()).get(wn.MEASUREMENT,bn)];case 1:return t=n.sent(),[4,e.set(wn.MEASUREMENT,bn,t)];case 2:return n.sent(),[2]}})}).call(e)}))}},{key:"updateMeasurementInfo",value:function(e){return we(function(){var t,n,i;return Ae(this,function(a){switch(a.label){case 0:return[4,this.getMeasurementInfo()];case 1:return t=a.sent(),n=mn({},t,e),i=this.convertToRaw(n),[4,this.getStorage().set(wn.MEASUREMENT,bn,i)];case 2:return a.sent(),[2]}})}).call(this)}},{key:"getMeasurementInfo",value:function(){return this.pdfViewer.store.getCurrentValue(kn)}},{key:"onMeasurementInfoChange",value:function(e){return this.pdfViewer.store.subscribe(kn,e)||An}},{key:"getStorage",value:function(){return this.pdfViewer.getStorage()}},{key:"convertFromRaw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"object"!==(void 0===e?"undefined":n(e))?Object.assign({},En):{userSpaceUnit:e.userSpaceUnit?new ft(e.userSpaceUnit.fromInchRate,e.userSpaceUnit.name):mt,userSpaceScaleValue:null==e.userSpaceScaleValue?1:e.userSpaceScaleValue,realUnit:e.realUnit?new ft(e.realUnit.fromInchRate,e.realUnit.name):mt,realScaleValue:null==e.realScaleValue?1:e.realScaleValue,caption:e.caption||"",markup:!1!==e.markup}}},{key:"convertToRaw",value:function(e){return{userSpaceUnit:e.userSpaceUnit?{fromInchRate:e.userSpaceUnit.fromInchRate,name:e.userSpaceUnit.name}:En.userSpaceUnit,userSpaceScaleValue:e.userSpaceScaleValue||En.userSpaceScaleValue,realUnit:e.realUnit?{fromInchRate:e.realUnit.fromInchRate,name:e.realUnit.name}:En.realUnit,realScaleValue:e.realScaleValue||En.realScaleValue,caption:e.caption||En.caption,markup:void 0===e.markup?En.markup:e.markup}}},{key:"isSame",value:function(e,t){return JSON.stringify(this.convertToRaw(e))===JSON.stringify(this.convertToRaw(t))}}],[{key:"inject",value:function(){return{pdfViewer:Sn()}}}]),t}(Re.Disposable),xn=function(e){var t=e.getIoC().getInstanceByClass(Rn).getMeasurementInfo();return t.markup&&t.caption?t.caption+"\n":""},Cn=function(e){return{markup:e.getIoC().getInstanceByClass(Rn).getMeasurementInfo().markup}},Tn=function(e){for(var t=e.length-1;t>=0;t--){e[t].destroy(),e.splice(t,1)}return[]},Pn=function(e,t,n){var i=e.getRenderingData(t,n);!i.annotFlag.checkNoZoom()||(t=1);var a=i.outerDeviceRect,r=i.innerDeviceRect;return Object.assign(r,{width:r.right-r.left,height:r.bottom-r.top}),Object.assign(a,{width:a.right-a.left,height:a.bottom-a.top}),{renderingData:i,innerRect:r,outerRect:a,scale:t,rotate:n}},In=function(e,t){var n=e.canvas,i=n.width,a=n.height,r=t.x,o=t.y;r-=4,o-=4,(r=Math.max(r,2))+8>i&&(r=i-8-2),(o=Math.max(o,2))+8>a&&(o=a-8-2),e.rotate(0),e.fillStyle="#ffffff",e.rect(r,o,8,8),e.stroke(),e.fill()},_n=function(t){function n(){return c(this,n),a(this,n,arguments)}return f(n,t),u(n,[{key:"getType",value:function(){return"circle"}},{key:"generateApRenderer",value:function(){return new gn(this)}},{key:"getCreationJSON",value:function(){var t=this,i=d(e(n.prototype),"getCreationJSON",this).call(this);return"CircleDimension"===this.annotationInfo.intent?this.page.getMeasureScaleRatio().then(function(e){if(e&&e.scale){var n=t.pdfViewer.getStore().getCurrentValue("measurementData"),a=xn(t.pdfViewer),r=It(n.displayUnit.name)?t.pdfViewer.i18n.t("measurement.units.".concat(n.displayUnit.name)):n.displayUnit.name;i.contents=a+parseFloat(n.area).toFixed(2)+" sq "+r}return i}):i}}]),n}(pn),Dn=A.stateHandler,Mn=A.ViewerEvents,Vn=Dn.IStateHandler,Ln=Dn.StateHandlerUtils.getDevicePagePoint,Nn=A.shared.keyboardStatus,Hn=A.keyboard,On=Hn.BuiltinCommand,Fn=Hn.BuiltinShortcutContext,Un=function(e){function t(e,n){var i;return c(this,t),(i=a(this,t,[e])).type=n,i.cursorStyle="fv__cursor-crosshair",i}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=i.get(0),r=this.hammer=new Hammer.Manager(a);r.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var o,s,c,l,u=!1,d=this.pdfViewer.getKeyboard(),h=function(){};d.withContext(Fn.CREATING_ANNOTATION,function(e){e.keyup(On.CANCEL_CREATING_ANNOTATION_OPERATION,function(){n.cancel(),u=!0,h()},{interceptors:[function(e,t){u||t(e)}]})});var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;r.on("panstart",function(e){if(h=d.activeContext(Fn.CREATING_ANNOTATION),u=!1,o=a.getBoundingClientRect(),n.startPoint=Ln(a,e),n.start({left:n.startPoint.x,top:n.startPoint.y}),p&&p(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;s=t}),v){var t=v.startChildSpan(n.constructor.getStateName()+"Start"),i=t.end,r=t.span;c=i}}),r.on("panmove",function(e){if(!u){var t=a.getBoundingClientRect(),i=t.left-o.left,r=t.top-o.top,s=n.correctPosition({x:n.startPoint.x+e.deltaX-i,y:n.startPoint.y+e.deltaY-r});return n.currentPoint=s,n.adjust(n.currentFakeAnnot,n.startPoint,s)}}),r.on("panend",function(e){if(h(),!u){var t=a.getBoundingClientRect(),i=t.left-o.left,r=t.top-o.top,d=n.correctPosition({x:n.startPoint.x+e.deltaX-i,y:n.startPoint.y+e.deltaY-r});if(n.currentPoint=d,n.end(n.currentFakeAnnot,n.startPoint,d),o=null,v){var f=v.startChildSpan(n.constructor.getStateName()+"End"),p=f.end,g=f.span;l=p}null==l||l(),null==c||c(),null==s||s()}}),r.on("pancancel",function(e){if(h(),!u)return o=null,n.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:n.pageRender.index}),n.end(n.currentFakeAnnot,n.startPoint,n.currentPoint)}),this.removeZoomToSuccessEvent=this.pdfViewer.addEventListener(Mn.zoomToSuccess,function(e){!u&&n.currentFakeAnnot&&(n.currentFakeAnnot.zoomTo(e),n.currentFakeAnnot.draw())})}},{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(n,e.y))}}},{key:"getSubject",value:function(){switch(this.type){case"circle":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Oval");case"square":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Rectangle")}return""}},{key:"start",value:function(e){var t=e.left,n=e.top,i={flags:4,subject:this.getSubject()};switch(this.type){case"circle":this.currentFakeAnnot=new _n({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square":this.currentFakeAnnot=new vn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square-crop":this.currentFakeAnnot=new vn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.getSubject(),borderInfo:{width:1},color:255}});break;default:throw new Error("Will never happen")}this.currentFakeAnnot.setRect({left:t,top:n,right:t+10,bottom:n-10})}},{key:"adjust",value:function(e,t,n){var i,a,r=t.x,o=t.y,s=n.x,c=n.y,l=Math.abs(r-s),u=Math.abs(o-c);Nn.isShift?(l=u=Math.min(l,u),i=s<r?r-l:r,a=c<o?o-u:o):(i=Math.min(r,s),a=Math.min(o,c)),l=Math.max(l,1),u=Math.max(u,1),e.setRect({left:i,top:a,right:i+l,bottom:a+u}),e.draw()}},{key:"end",value:function(e,t,n){var i=this;return this.currentFakeAnnot.apply().then(function(e){if(i.pdfViewer.config.showCommentList){var t=e[0];i.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}}).finally(function(){i.currentFakeAnnot=null})}},{key:"cancel",value:function(){this.currentFakeAnnot&&(this.currentFakeAnnot.destroy(),this.currentFakeAnnot=null),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"currentPointDirection",value:function(){var e=this.startPoint.x,t=this.startPoint.y,n=this.currentPoint.x,i=this.currentPoint.y;return n<=e?i<t?"north-west":"south-west":i<t?"north-east":"south-east"}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.removeZoomToSuccessEvent&&this.removeZoomToSuccessEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),t}(Vn),jn=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUARE,Bn=function(e){function t(e){return c(this,t),a(this,t,[e,"square"])}return f(t,e),u(t,null,[{key:"getStateName",value:function(){return jn}}]),t}(Un),Xn=A.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_CIRCLE,Yn=function(e){function t(e){return c(this,t),a(this,t,[e,"circle"])}return f(t,e),u(t,null,[{key:"getStateName",value:function(){return Xn}}]),t}(Un),$n=A.vendors.EventEmitter,Gn=function(e){function t(e){var n;return c(this,t),(n=a(this,t)).pdfViewer=e,n.eventEmitter=new $n,n.addDestroyHook(function(){n.eventEmitter.removeAllListeners()}),n.isLocked=!1,n.isStarted=!1,n}return f(t,e),u(t,[{key:"init",value:function(){}},{key:"start",value:function(){this.isStarted=!0}},{key:"cancel",value:function(){this.isStarted=!1}},{key:"emit",value:function(e,t){this.isLocked||this.eventEmitter.emit(e,t)}},{key:"on",value:function(e,t){var n=this;return this.eventEmitter.on(e,t),function(){n.eventEmitter.off(e,t)}}},{key:"lock",value:function(){this.isLocked=!0}},{key:"unlock",value:function(){this.isLocked=!1}}]),t}(Re.Disposable),zn=function(e){function t(e,n,i){var r;return c(this,t),(r=a(this,t,[e])).target=n,r.hammer=new Hammer.Manager(n),r.hammer.add(new Hammer.Pan(i)),r.addDestroyHook(function(){r.hammer.destroy()}),r}return f(t,e),u(t,[{key:"init",value:function(){var e,t,n=this,i=0,a=0,r=function(r){return function(o){if("start"===r){var s=(t=o.target).getBoundingClientRect();e={left:s.left,top:s.top}}n.eventEmitter.emit(r,{deltaX:o.deltaX-i,deltaY:o.deltaY-a,srcEvent:o.srcEvent}),"end"!==r&&"cancel"!==r||(t=null,i=0,a=0)}};this.hammer.on("panstart",r("start")),this.hammer.on("panmove",r("move")),this.hammer.on("panend",r("end")),this.hammer.on("pancancel",r("cancel"));var o=function(n){if(t){var r=t.getBoundingClientRect();i=r.left-e.left,a=r.top-e.top}};window.addEventListener("scroll",o,!0),this.addDestroyHook(function(){window.removeEventListener("scroll",o,!0)});var s=function(e){var t=n.target.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;n.eventEmitter.emit("mousemove",{x:i,y:a})};this.target.addEventListener("mousemove",s,!0),this.addDestroyHook(function(){n.target.removeEventListener("mousemove",s,!0)})}}]),t}(Gn);function Wn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}var qn=4.396,Kn=function(){function e(t){c(this,e),this.component=t}return u(e,[{key:"numberToRGBAString",value:function(e){if("string"==typeof e)return e;var t=(0,Re.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"renderLineEnd",value:function(e,t,n,i,a,r){if(0!==i){var o=n.renderingData,s=o.fillColor;"line"===o.annotInfo.type&&(s=o.annotInfo.styleFillColor);var c=n.scale,l=Math.atan2(r.y-a.y,r.x-a.x);switch(e.save(),e.lineJoin="miter",e.beginPath(),i){case Xt.Square:this.renderSquareEnding(e,r,l,c,t);break;case Xt.Circle:this.renderCircleEnding(e,r,l,c,t);break;case Xt.Diamond:this.renderDiamondEnding(e,r,l,c,t);break;case Xt.OpenArrow:r=r.move(t/2,a),this.renderOpenArrowEnding(e,r,l,c,t);break;case Xt.ClosedArrow:r=r.move(t/2,a),this.renderClosedArrowEnding(e,r,l,c,t);break;case Xt.Butt:this.renderButtEnding(e,r,l,c,t);break;case Xt.ROpenArrow:this.renderROpenArrowEnding(e,r,l,c,t);break;case Xt.RClosedArrow:this.renderRClosedArrowEnding(e,r,l,c,t);break;case Xt.Slash:this.renderSlashEnding(e,r,l,c,t)}switch(i){case Xt.ClosedArrow:case Xt.RClosedArrow:case Xt.Diamond:case Xt.Square:case Xt.Circle:s&&(e.fillStyle=this.numberToRGBAString(s),e.fill())}e.stroke(),e.restore()}}},{key:"renderSquareEnding",value:function(e,t,n,i,a){var r=qn*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderCircleEnding",value:function(e,t,n,i,a){var r=1.75862*i+2*a;e.translate(t.x,t.y),e.rotate(n),e.moveTo(r,0),e.arc(0,0,r,0,2*Math.PI)}},{key:"renderDiamondEnding",value:function(e,t,n,i,a){var r=qn*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n+Math.PI/4),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderOpenArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderClosedArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderButtEnding",value:function(e,t,n,i,a){var r=Math.PI/2,o=qn*i+3.1*a,s=new Gt(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}},{key:"renderROpenArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderRClosedArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderArrow",value:function(e,t,n,i,a,r){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=qn*i+3.1*a,c=new Gt(t.x+s,t.y),l=c.rotate(Math.PI-n+r,t),u=c.rotate(Math.PI-n-r,t);e.moveTo(l.x,l.y),e.lineTo(t.x,t.y),e.lineTo(u.x,u.y),o&&e.closePath()}},{key:"renderSlashEnding",value:function(e,t,n,i,a){var r=60/180*Math.PI,o=qn*i+3.1*a,s=new Gt(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}}]),e}(),Jn=Math.log(2),Zn=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).helper=new Kn(e),n}return f(t,e),u(t,[{key:"doRender",value:function(e){var t=this,n=e.renderingData,i=n.page,a=n.annotInfo,r=a.borderInfo||{},o=e.scale,s=e.rotate,c=this.convertPointToPixel(r.width,o);if(0!=c||-1!=a.borderColor||a.fillColor){var l=this.canvas.getContext("2d");if(l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=c,l.globalAlpha=a.opacity,l.lineWidth=c,0===c||!1===a.hasBorderColor?l.strokeStyle="transparent":l.strokeStyle=this.numberToRGBAString(a.color);var u=e.outerRect,d=this.convertToPathPoint(n.startPoint,o,u,i,s),h=this.convertToPathPoint(n.endPoint,o,u,i,s),f=n.leaderLinePoints,p=this.convertToPathPoint(f.start,o,u,i,s),v=this.convertToPathPoint(f.end,o,u,i,s);if(n.leaderLineOffset>0){var g=n.annotInfo.leaderLineLength>0?1:-1,m=this.convertPointToPixel(n.leaderLineOffset,o),y=d.move(m,h).rotate(g*Math.PI/2,d);h=h.move(m,d).rotate(g*-Math.PI/2,h),d=y,y=p.move(m,v).rotate(g*Math.PI/2,p),v=v.move(m,p).rotate(g*-Math.PI/2,v),p=y}var S=n.captionOffset,w=new Gt(this.convertPointToPixel(S.x,o),-this.convertPointToPixel(S.y,o)),A=this.convertPointToPixel(n.leaderLineExtend,o);try{if(r.style===Mt){var b=r.dashes||[],E=r.dashPhase||0;l.setLineDash&&l.setLineDash(b.map(function(e){return t.convertPointToPixel(e,o)})),l.lineDashOffset=this.convertPointToPixel(E,o)}l.beginPath(),this.renderLine(l,d,h,p,v,A),l.closePath(),l.stroke(),this.helper.renderLineEnd(l,c,e,n.startStyle,v,p),this.helper.renderLineEnd(l,c,e,n.endingStyle,p,v),this.renderLineCaption(l,e,c,p,v,w)}finally{l.restore()}}}}},{key:"convertToPathPoint",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=w(i.getDevicePoint([e.x,e.y],t,a),2),o=r[0],s=r[1];return new Gt(o-n.left,s-n.top)}},{key:"renderLine",value:function(e,t,n,i,a,r){if(e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),r>0){var o=i.move(-r,t),s=a.move(-r,n);e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.moveTo(s.x,s.y)}}},{key:"renderLineCaption",value:function(e,t,n,i,a,r){var o=t.renderingData,s=t.scale,c=o.annotInfo,l=c.content;if("string"==typeof l&&!((l=l.trim()).length<1)){if(a.x<i.x){var u=i;i=a,a=u}var d,h,f=Math.atan2(a.y-i.y,a.x-i.x),p=i.distanceTo(a),v=i.move(.5*p,a),g=16*(d=s+1,Math.log(d)/Jn),m=16777215-(16777215&c.borderColor^10855845);e.save(),e.fillStyle=this.numberToRGBAString(m),e.font=g+"px bold Arial",e.textBaseline="middle",e.textAlign="center";var y=e.measureText(l),S=y.actualBoundingBoxAscent+y.actualBoundingBoxDescent,w=v.move(r.y,i).rotate(Math.PI/2,v),A=Math.PI/2;switch(A=r.y>0?-Math.PI/2:Math.PI/2,o.captionPos){case Yt:if(0!=r.y&&0!=r.x){h=w.move(r.x,v).rotate(A,w);break}h=w;break;case $t:var b=v.move(.5*(n+S)-r.y,a).rotate(Math.PI/2,v);h=0!=r.x?b.move(r.x,v).rotate(A,w):b}if(o.hasCaption&&(e.translate(h.x,h.y),e.rotate(f),e.fillText(l,0,0),e.restore()),e.beginPath(),!(Math.abs(r.x)<p/2+y.width/2&&Math.abs(r.y)<S)){var E=r.x>0?-1:1,k=r.x+E*y.width/2;if(Math.abs(r.x)<=y.width/2){k=0;var R=S/2+4,x=r.y>0?1:-1,C=0;Math.abs(r.y)>S&&(C=r.y-x*R),w=v.move(C,i).rotate(Math.PI/2,v)}var T=w.move(k,v).rotate(A,w),P=T.move(Math.abs(k)+n/2,w);e.moveTo(v.x,v.y),e.lineTo(w.x,w.y),e.moveTo(P.x,P.y),e.lineTo(T.x,T.y),e.moveTo(T.x,T.y),e.closePath(),e.stroke()}}}},{key:"setMarkUp",value:function(e,t){var n=Pn(this.component,e,t),i=n.renderingData,a=n.outerRect;e=n.scale,t=n.rotate;var r=i.page,o=i.annotInfo,s=o.borderInfo||{},c=this.convertPointToPixel(s.width,e),l=this.canvas.getContext("2d");l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),l.lineWidth=c,l.strokeStyle=this.numberToRGBAString(o.color);var u=this.convertToPathPoint(i.startPoint,e,a,r,t),d=this.convertToPathPoint(i.endPoint,e,a,r,t),h=i.leaderLinePoints,f=this.convertToPathPoint(h.start,e,a,r,t),p=this.convertToPathPoint(h.end,e,a,r,t);if(i.leaderLineOffset>0){var v=i.annotInfo.leaderLineLength>0?1:-1,g=this.convertPointToPixel(i.leaderLineOffset,e),m=u.move(g,d).rotate(v*Math.PI/2,u);d=d.move(g,u).rotate(v*-Math.PI/2,d),u=m,m=f.move(g,p).rotate(v*Math.PI/2,f),p=p.move(g,f).rotate(v*-Math.PI/2,p),f=m}var y=this.convertPointToPixel(i.leaderLineExtend,e);l.beginPath(),this.renderLine(l,u,d,f,p,y),l.closePath(),In(l,u),In(l,d)}}]),t}(_t),Qn=Xt,ei=function(t){function n(e){var t;c(this,n);var i=(t=a(this,n,[e])).annotationInfo;switch(t.annotationInfo.endStyle&&(i.endingStyle=t.annotationInfo.endStyle),i.intent){case Ht:i.endingStyle===Qn.None&&(i.endingStyle=Qn.OpenArrow);break;case Ot:i.startStyle===Qn.None&&(i.startStyle=Qn.OpenArrow),i.endingStyle===Qn.None&&(i.endingStyle=Qn.OpenArrow)}return i.hasCaption=i.enableCaption,i.leaderLinePoints.start=i.startPoint,t}return f(n,t),u(n,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var i=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,i),this.eContainer.style.cssText+="\n            width: ".concat(t,"px;\n            height: ").concat(n,"px;\n        ")}},{key:"generateApRenderer",value:function(){return new Zn(this)}},{key:"getType",value:function(){return"line"}},{key:"getStartPoint",value:function(){return this.annotationInfo.startPoint}},{key:"getEndPoint",value:function(){return this.annotationInfo.endPoint}},{key:"setEndPoint",value:function(e){var t=w(this.page.reverseDevicePoint([e.x,e.y],this.scale,this.rotate),2),n=t[0],i=t[1];this.annotationInfo.endPoint={x:n,y:i},this.annotationInfo.leaderLinePoints.end=this.annotationInfo.endPoint;var a=this.annotationInfo.startPoint,r=a.x,o=a.y,s=w(this.page.getDevicePoint([r,o],this.scale,this.rotate),2),c=s[0],l=s[1];this.setRect({left:c,top:l,right:e.x,bottom:e.y}),this.annotationInfo.intent==Ot&&this.calculateLeaderLinePoints()}},{key:"calculateLeaderLinePoints",value:function(){var e=this.getStartPoint(),t=this.getEndPoint(),n=t.y-e.y,i=t.x-e.x,a=-1/(n/i),r=Math.atan(a),o=1,s=(this.page.getRotationAngle()+this.rotate)%360;if(t.x<e.x&&t.y<e.y||t.x>e.x&&t.y>e.y)switch(s){case 180:case 270:o=-1;break;default:o=1}else switch(s){case 90:case 180:o=1;break;default:o=-1}var c=this.annotationInfo.leaderLineLength,l=o*Math.cos(r)*c,u=o*Math.sin(r)*c,d={x:e.x+l,y:e.y+u},h=t,f=this.pdfRect;f.left<d.x&&d.x<f.right&&f.bottom<d.y&&d.y<f.top?h={x:t.x+l,y:t.y+u}:(d={x:e.x-l,y:e.y-u},h={x:t.x-l,y:t.y-u}),this.annotationInfo.leaderLinePoints.start=d,this.annotationInfo.leaderLinePoints.end=h}},{key:"getRenderingData",value:function(){return mn({},d(e(n.prototype),"getRenderingData",this).call(this),this.annotationInfo)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.leaderLinePoints.start,i=this.annotationInfo.startPoint,a=this.annotationInfo.leaderLineExtend,r=this.annotationInfo.borderInfo.width,o=wt.convertTo(r,Tt)*this.scale,s=Math.max(Math.abs(n.x-i.x),Math.abs(n.y-i.y))+a,c=wt.convertTo(s,Tt)*this.scale;return an.on(this.getDeviceRect(e,t)).expand(c+o).extract()}},{key:"getDefaultAnnotInfo",value:function(){var t={x:0,y:0},i={x:0,y:0};return Wn(mn({},d(e(n.prototype),"getDefaultAnnotInfo",this).call(this)),{startPoint:t,endPoint:i,leaderLineLength:15,leaderLineExtend:5,captionOffset:{x:0,y:0},enableCaption:!1,leaderLinePoints:{start:t,end:i},leaderLineOffset:0,captionPos:Yt,content:"",startStyle:Ce,endingStyle:Ce})}},{key:"apply",value:function(){var t=this;return d(e(n.prototype),"apply",this).call(this).then(function(e){return"LineDimension"===t.annotationInfo.intent?t.page.getMeasureScaleRatio().then(function(n){if(n&&n.scale){var i=t.pdfViewer.getStore().getCurrentValue("measurementData"),a=xn(t.pdfViewer),r=It(i.displayUnit.name)?t.pdfViewer.i18n.t("measurement.units.".concat(i.displayUnit.name)):i.displayUnit.name;return e[0].setContent(a+parseFloat(i.distance).toFixed(2)+" "+r).then(function(t){return e})}return e}):e})}}]),n}(pn),ti=function(e){return e.EndPoint="end-point",e.MidPoint="mid-point",e.IntersectionPoint="intersection-point",e.NearestPoint="nearest-point",e}({}),ni=function(){function e(){c(this,e)}return u(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.arc(n/2,n/2,2*Math.PI,0,360),e.stroke()}}]),e}(),ii=function(){function e(){c(this,e)}return u(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(n/2,0),e.lineTo(0,n),e.lineTo(n,n),e.closePath(),e.stroke()}}]),e}(),ai=function(){function e(){c(this,e)}return u(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.rect(0,0,n,n),e.stroke()}}]),e}(),ri=function(){function e(){c(this,e)}return u(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(0,0),e.lineTo(n,n),e.moveTo(0,n),e.lineTo(n,0),e.stroke()}}]),e}(),oi=function(e){function t(e){var n;return c(this,t),$e(n=a(this,t),"container",void 0),$e(n,"canvas",void 0),$e(n,"size",void 0),$e(n,"renderer",void 0),n.container=e,n.size=16,n.renderer=new ni,n.canvas=document.createElement("canvas"),n.canvas.classList.add("fv__viewer-snapped-point"),n.addDestroyHook(function(){n.canvas.parentElement===n.container&&n.container.removeChild(n.canvas)}),n.canvas.width=n.size,n.canvas.height=n.size,n}return f(t,e),u(t,[{key:"setRenderer",value:function(e){this.renderer=new e,this.redraw()}},{key:"setSize",value:function(e){this.size=e,this.canvas.width=e,this.canvas.height=e,this.redraw()}},{key:"setPosition",value:function(e,t){(0,Re.cssText)(this.canvas,{left:e+"px",top:t+"px",margin:"".concat(.5*-this.size,"px ").concat(.5*-this.size,"px")})}},{key:"show",value:function(e){switch(this.container.appendChild(this.canvas),e){case ti.MidPoint:this.setRenderer(ii);break;case ti.IntersectionPoint:this.setRenderer(ri);break;case ti.NearestPoint:this.setRenderer(ai);break;default:this.setRenderer(ni)}}},{key:"hide",value:function(){this.canvas.parentElement===this.container&&this.container.removeChild(this.canvas)}},{key:"redraw",value:function(){if(this.renderer){var e=this.canvas.getContext("2d");e&&this.renderer.render(e)}}}]),t}(Re.Disposable),si=A.stateHandler,ci=A.ViewerEvents,li=si.IStateHandler,ui=A.shared,di=(ui.DebouncePromiseQueue,ui.keyboardStatus),hi=ui.ThrottleAsyncTaskExecutor,fi=(A.Consts.LineEndingStyle,si.StateHandlerConsts.STATE_HANDLER_CREATE_LINE),pi=si.StateHandlerUtils.getDevicePagePoint,vi=A.commons.isSamePoint,gi=A.keyboard,mi=gi.BuiltinCommand,yi=gi.BuiltinShortcutContext,Si=function(e){function t(e,n,i){var r;return c(this,t),(r=a(this,t,[e])).startStyle=n,r.endStyle=i,r.cursorStyle="fv__cursor-crosshair",r.executor=new hi(20),r}return f(t,e),u(t,[{key:"createInteractionTool",value:function(e,t){return new zn(this.pdfViewer,e,t)}},{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=i.get(0);this.snappedPointAssistant=new oi(a);var r,o=this.interaction=this.createInteractionTool(a,{direction:Hammer.DIRECTION_ALL});o.init();var s,c=function(){return o.on("mousemove",function(e){n.executor.exec(function(){return n.getSnappedPoint(e).then(function(t){vi(e,t)?(n.snappedPointAssistant.hide(),r=null):(n.snappedPointAssistant.show(t.type),n.snappedPointAssistant.setPosition(t.x,t.y),r=t)})})})};this.offMouseMoveEvent=c();var l,u=!1,d=this.pdfViewer.getKeyboard(),h=function(){};d.withContext(yi.CREATING_ANNOTATION,function(e){n.offCancelEvent=e.keyup(mi.CANCEL_CREATING_ANNOTATION_OPERATION,function(){h(),n.cancel(),n.interaction.cancel(),u=!0},{interceptors:[function(e,t){u||t(e)}]})});var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs;f.startSDKSpan,f.otelService;o.on("start",function(e){var t;n.offMouseMoveEvent(),h=d.activeContext(yi.CREATING_ANNOTATION),u=!1;var i=[0,0],o=pi(a,e);r?(t=[r.x,r.y],i=[o.x-r.x,o.y-r.y]):t=[o.x,o.y],s=n.pageRender.page.reverseDevicePoint(t,n.pageRender.scale,n.pageRender.getRotation()),l=n.pageRender.page.reverseDevicePoint(i,n.pageRender.scale,n.pageRender.getRotation()),n.start(s[0],s[1])}),o.on("move",function(e){if(!u){var t=w(function(e,t){if(di.isShift){var n=Math.sqrt(e*e+t*t),i=Math.atan2(t,e),a=.25*Math.PI,r=Math.round(i/a)*a;e=n*Math.cos(r),t=n*Math.sin(r)}return[e,t]}(e.deltaX,e.deltaY),2),i=t[0],a=t[1],r=n.pageRender.page.getDevicePoint(s,n.pageRender.scale,n.pageRender.getRotation()),o=n.pageRender.page.getDevicePoint(l,n.pageRender.scale,n.pageRender.getRotation()),c=n.correctPosition({x:r[0]+i+o[0],y:r[1]+a+o[1]});n.adjust(n.fakeAnnotation,{x:c[0],y:c[1]}),n.pageRender.page.reverseDevicePoint(c,n.pageRender.scale,n.pageRender.getRotation());var d=n.fakeAnnotation.pdfRect,h=n.fakeAnnotation.annotationInfo,f=h.startPoint,p=h.endPoint;n.pdfViewer.eventEmitter.emit("collab-creating-op",{type:n.type,page:n.pageRender.page.getIndex(),rect:d,points:[f,p]})}}),o.on("end",function(e){if(!u)return h(),n.offMouseMoveEvent=c(),n.end()}),o.on("cancel",function(e){u||(n.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:n.pageRender.index}),h(),n.cancel(),n.offMouseMoveEvent=c())}),this.__removeZoomToSuccessEventListener=this.pdfViewer.addEventListener(ci.zoomToSuccess,function(){if(!u&&n.fakeAnnotation){var e=n.pageRender.scale;n.fakeAnnotation.zoomTo(e),n.fakeAnnotation.draw()}})}},{key:"correctCoord",value:function(e,t){var n=this.pageRender.getScale(),i=e.getPxWidth()*n,a=e.getPxHeight()*n;return[Math.max(0,Math.min(i,t[0])),Math.max(0,Math.min(a,t[1]))]}},{key:"start",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Line",a=!0,r="";if(n=this.pdfViewer.customs.getMeasuringConfig){var o=n();o.hasOwnProperty("defaultLeader")&&(a=o.defaultLeader),"custom"==o.labelType&&(r=o.label)}var s=this.pdfViewer.getIoC().getInstanceByClass(Rn).getMeasurementInfo();return s.showCustomLabel&&(r=s.caption),this.fakeAnnotation=new ei({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({flags:4,label:r,startPoint:{x:e,y:t},endPoint:{x:e+1,y:t+1},startStyle:this.startStyle,endingStyle:this.endStyle,leaderLineLength:a?15:0,leaderLineExtend:a?5:0,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects."+i)})})}},{key:"createAnnotJson",value:function(e){return Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line")),e}},{key:"getSnappedPoint",value:function(e){var t=this;return this.pageRender.getPDFPage().then(function(n){if(!n)return e;var i=t.pdfViewer.getSnapMode(t.constructor.getStateName());if(i&&i.length>0){var a=w(n.reverseDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2),r=a[0],o=a[1];return n.getSnappedPoint({x:r,y:o},i).then(function(e){var i=w(n.getDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2);return{x:i[0],y:i[1],type:e.type}})}return e})}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec(function(){return n.getSnappedPoint(t).then(function(i){vi(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),e.setEndPoint(i),e.draw()})})}},{key:"end",value:function(){var e=this;if(this.fakeAnnotation)return this.executor.waitForLastTask().then(function(){e.snappedPointAssistant.hide();var t=e.fakeAnnotation.apply().then(function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}});return e.fakeAnnotation=null,t})}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index}),this.snappedPointAssistant.hide(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(ci.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"destroyPageHandler",value:function(){this.offMouseMoveEvent(),this.snappedPointAssistant.destroy(),this.executor.cancel(),this.interaction&&this.interaction.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.__removeZoomToSuccessEventListener&&this.__removeZoomToSuccessEventListener()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return[Math.max(0,Math.min(t,e.x)),Math.max(0,Math.min(n,e.y))]}}],[{key:"getStateName",value:function(){return fi}}]),t}(li),wi=A.stateHandler,Ai=(A.ViewerEvents,wi.StateHandlerConsts.STATE_HANDLER_CREATE_ARROW),bi=A.Consts.LineEndingStyle,Ei=function(e){function t(e){return c(this,t),a(this,t,[e,bi.None,bi.OpenArrow])}return f(t,e),u(t,[{key:"createAnnotJson",value:function(e){return e.intent="LineArrow",e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Arrow"),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineArrow")),e}}],[{key:"getStateName",value:function(){return Ai}}]),t}(Si);function ki(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}}function Ri(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}const xi="idle",Ci="construct",Ti="creating";var Pi,Ii,_i,Di,Mi,Vi=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.MOVE=2]="MOVE",e}({}),Li=($e(Pi={},0,["MSPointerDown"]),$e(Pi,2,["MSPointerMove"]),$e(Pi,1,["MSPointerUp"]),Pi),Ni=($e(Ii={},0,["pointerdown"]),$e(Ii,2,["pointermove"]),$e(Ii,1,["pointerup"]),Ii),Hi=($e(_i={},0,["pointerdown","mousedown"]),$e(_i,2,["pointermove","mousemove"]),$e(_i,1,["pointerup","mouseup"]),_i),Oi=($e(Di={},0,["pointerdown","touchstart"]),$e(Di,2,["pointermove","touchmove"]),$e(Di,1,["pointerup","touchend"]),Di),Fi=($e(Mi={},0,["mousedown","touchstart"]),$e(Mi,2,["mousemove","touchmove"]),$e(Mi,1,["mouseup","touchend"]),Mi),Ui={};function ji(e,t,n,i){var a,o=0,s=Ui[t].map(function(t){var c,l=function(t){a!==t.type&&Date.now()-o<160?c():(a=t.type,i&&i.once&&c(),n.call(e,function(e){var t={native:e,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,target:e.target,preventDefault:function(){return e.preventDefault()},stopPropagation:function(){return e.stopPropagation()}};if(window.TouchEvent&&r(e,window.TouchEvent)){var n="touchend"===e.type||"touchcancel"===e.type?e.changedTouches[0]:e.touches[0];t.clientX=n.clientX,t.clientY=n.clientY,t.pageX=n.pageX,t.pageY=n.pageY,t.screenX=n.screenX,t.screenY=n.screenY,t.x=n.clientX,t.y=n.clientY,t.bubbles=e.bubbles,t.relatedTarget=n.target}else(r(e,MouseEvent)||r(e,PointerEvent))&&(t.clientX=e.clientX,t.clientY=e.clientY,t.pageX=e.pageX,t.pageY=e.pageY,t.screenX=e.screenX,t.screenY=e.screenY,t.x=e.x||e.clientX,t.y=e.y||e.clientY,t.relatedTarget=e.relatedTarget,t.button=e.button,t.buttons=e.buttons,t.bubbles=e.bubbles);return t}(t)),o=Date.now())};return c=function(){var n=s.indexOf(c);-1!==n&&(e.removeEventListener(t,l,i),s.splice(n,1))},e.addEventListener(t,l,i),c});return function(){s.forEach(function(e){return e()})}}function Bi(e){if(Re.isIE){if(!Re.isIEAtLeast11)return Li[e]}else{if(Re.isSafari)return Hi[e];if(Re.isAndroid)return Re.isTouchDevice?Oi[e]:Fi[e]}return Ni[e]}Re.Lazy.property(Ui,0,function(){return Bi(0)}),Re.Lazy.property(Ui,2,function(){return Bi(2)}),Re.Lazy.property(Ui,1,function(){return Bi(1)});var Xi=function(e){function t(e,n,i){var r;return c(this,t),(r=a(this,t,[e])).actionName=i,r.targetElement=n,r.pdfViewerElement=e.$ui[0],r.status=xi,r.lastMoveData={},r}return f(t,e),u(t,[{key:"startCreating",value:function(){this.status=Ti}},{key:"cancel",value:function(){this.status=xi}},{key:"_addEventListener",value:function(e,t,n,i){return e.addEventListener(t,n,i),function(){e.removeEventListener(t,n,i)}}},{key:"init",value:function(){var e=this,t=new Hammer.Manager(this.targetElement);t.add(new Hammer.Tap({event:"doubletap",taps:2,posThreshold:100,time:296}),new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var n=!0,i=null,a=An,r=ji(this.pdfViewerElement,Vi.DOWN,function(t){if(e.status!==xi){var i=e.targetElement.getBoundingClientRect(),r=i.left,o=i.right,s=i.top,c=i.bottom,l=Math.max(Math.min(o,t.clientX),r),u=Math.max(Math.min(c,t.clientY),s);if(e.status===Ti){a(),n=!1;var d=setTimeout(function(){e.emit("add-point",{clientX:l,clientY:u,srcEvent:t.native}),n=!0},300);a=function(){clearTimeout(d)}}}}),o=ji(this.pdfViewerElement,Vi.MOVE,function(t){if(e.status!==xi&&(Re.isTouchDevice&&i&&(Math.abs(t.clientX-i.x)>25||Math.abs(t.clientY-i.y)>25)&&a(),!e.isLocked&&n)){var r=e.targetElement.getBoundingClientRect(),o=r.left,s=r.right,c=r.top,l=r.bottom,u=Math.max(Math.min(s,t.clientX),o),d=Math.max(Math.min(l,t.clientY),c);e.emit("move",e.lastMoveData={clientX:u,clientY:d,srcEvent:t.native})}}),s=ji(this.targetElement,Vi.DOWN,function(t){if(0===t.button){var r=t.clientX,o=t.clientY;if(i={x:t.clientX,y:t.clientY},e.status===xi){a();var s=setTimeout(function(){e.status=Ci,e.emit("start",{clientX:r,clientY:o,srcEvent:t.native})},300);a=function(){clearTimeout(s)}}else if(e.status===Ti){a(),n=!1;var c=setTimeout(function(){e.emit("add-point",{clientX:r,clientY:o,srcEvent:t.native}),n=!0},300);a=function(){clearTimeout(c)}}t.stopPropagation()}}),c=An;Re.isTouchDevice&&(c=this._addEventListener(this.targetElement,"touchstart",function(e){e.touches.length>1&&a(),Re.isIOSChrome&&e.preventDefault()}));var l=ji(this.targetElement,Vi.MOVE,function(t){if(Re.isTouchDevice&&i&&(Math.abs(t.clientX-i.x)>25||Math.abs(t.clientY-i.y)>25)&&a(),!e.isLocked&&n){if(e.status===xi){var r=e.targetElement.getBoundingClientRect(),o=t.clientX-r.left,s=t.clientY-r.top;e.emit("mousemove",{x:o,y:s})}if(e.status===Ti&&!Re.isTouchDevice){var c=t.clientX,l=t.clientY;e.emit("move",e.lastMoveData={clientX:c,clientY:l,srcEvent:t.native}),t.stopPropagation()}}});t.on("doubletap",function(t){n=!0;var i=t.srcEvent;a(),e.lastMoveData={clientX:ki(i),clientY:Ri(i),srcEvent:t},u()});var u=function(){e.status===Ti&&(e.status=xi,e.unlock(),e.emit("end",e.lastMoveData),e.lastMoveData=null)},d=this.pdfViewer.getStore().subscribe(this.actionName,function(t){switch(t){case"complete":u();break;case"cancel":e.status===Ti&&(e.status=xi,e.unlock(),e.emit("cancel"));break;case"continue":e.startCreating()}});this.addDestroyHook(function(){c(),t.destroy(),d(),s(),l(),r(),o()})}}]),t}(Gn),Yi=function(){function e(){c(this,e),$e(this,"isCreating",!1),$e(this,"handlingPage",-1)}return u(e,[{key:"setCreating",value:function(e){this.isCreating=!0,this.handlingPage=e}},{key:"creatingEnd",value:function(){this.isCreating=!1,this.handlingPage=-1}}]),e}(),$i=A.stateHandler,Gi=A.Log,zi=A.ViewerEvents,Wi=$i.IStateHandler,qi=Gi.LoggerFactory,Ki=A.shared,Ji=Ki.DebouncePromiseQueue,Zi=(Ki.getClientX,Ki.getClientY,Ki.keyboardStatus),Qi=Ki.ThrottleAsyncTaskExecutor,ea=A.DeviceInfo.isTouchDevice,ta=A.commons.isSamePoint,na=A.keyboard,ia=na.BuiltinCommand,aa=na.BuiltinShortcutContext,ra=(qi.getLogger("creation/complexshape/state"),function(e){function t(e,n){var i;return c(this,t),(i=a(this,t,[e])).type=n,i.cursorStyle="fv__cursor-crosshair",i.executor=new Qi(20,!0),i}return f(t,e),u(t,[{key:"createInteractionTool",value:function(e){return new Xi(this.pdfViewer,e,"create-complex-shape")}},{key:"syncAddingAnnot",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)e={cancle:t,page:this.pageRender.index};else{var n=this.fakeAnnotation||{},i=n.pdfRect,a=n.vertexes,r=n.lastPoint;e={type:this.type,page:this.pageRender.page.getIndex(),rect:i,points:m(a).concat([r]),closePath:"polygon"==this.type}}this.pdfViewer.eventEmitter.emit("collab-creating-op",e)}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e,this.destroyPageHooks=[];var n=e.$handler;n.addClass(this.cursorStyle);var i=n.get(0);this.snappedPointAssistant=new oi(i),this.interaction=this.createInteractionTool(i),this.interaction.init();var a=new Ji,r=this.pdfViewer.getKeyboard(),o=this.pdfViewer.getIoC().getInstanceByClass(Yi),s=function(){},c=function(){s=r.activeContext(aa.CREATING_ANNOTATION)};function l(e,t,n){if(Zi.isShift){var i=e.getDeviceVertexes();if(i.length>=1){var a=i[i.length-1],r=t-a.x,o=n-a.y,s=Math.sqrt(r*r+o*o),c=Math.atan2(o,r),l=.25*Math.PI,u=Math.round(c/l)*l;return r=s*Math.cos(u),o=s*Math.sin(u),{deviceX:a.x+r,deviceY:a.y+o}}}return{deviceX:t,deviceY:n}}r.withContext(aa.CREATING_ANNOTATION,function(e){e.keyup(ia.CANCEL_CREATING_ANNOTATION_OPERATION,function(){s(),t.interaction.unlock(),t.interaction.cancel(),t.cancel()})}),this.pdfViewer.getStore().subscribe("forbidMeasureRatio",function(e){t.isUsePageMeasure=e}),"polygon"==this.type||"polyline"==this.type||this.pdfViewer.eventEmitter.addListener(zi.toolbarTabsClicked,function(){t.out()}),this.interaction.on("start",function(e){var n=e.clientX,a=e.clientY;if(o.isCreating)t.interaction.cancel();else{o.setCreating(t.pageRender.index),t.pageRender.annotsRender.unActiveAnnot();var r=i.getBoundingClientRect(),l=n-r.left,u=a-r.top;s(),c();var d=[Ot,jt,Ft,Ut];t.getSnappedPoint(l,u).then(function(e){t.fakeAnnotation=t.create(e.deviceX,e.deviceY),t.interaction.startCreating(),t.unsubscribeMeasurementData=t.pdfViewer.getStore().subscribe("measurementData",function(e){if(t.fakeAnnotation){var n=t.fakeAnnotation.intent;if(n&&d.includes(n)){var i=xn(t.pdfViewer),a=e.displayUnit,r=e.area,o=e.embeddedScale,s=a&&It(a.name)?t.pdfViewer.i18n.t("measurement.units.".concat(a.name)):a.name;r&&t.fakeAnnotation.setContent(i+r.toFixed(2)+" sq "+s),o&&(t.pageMeasureRatio=o)}t.fakeAnnotation.draw&&t.fakeAnnotation.draw()}}),t.pdfViewer.eventEmitter.emit(zi.distanceAnnotCreationStart,t.fakeAnnotation)})}}),this.interaction.on("add-point",function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top,c=l(t.fakeAnnotation,o,s);t.getSnappedPoint(c.deviceX,c.deviceY).then(function(e){t.addPoint(t.fakeAnnotation,e)})}),this.interaction.on("move",function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top;t.executor.exec(function(){var e=l(t.fakeAnnotation,o,s);return t.getSnappedPoint(e.deviceX,e.deviceY).then(function(n){ta({x:e.deviceX,y:e.deviceY},{x:n.deviceX,y:n.deviceY})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.show(n.type),t.snappedPointAssistant.setPosition(n.deviceX,n.deviceY)),t.adjust(t.fakeAnnotation,n),t.syncAddingAnnot()})})}),this.interaction.on("mousemove",function(e){t.mousemove(e)}),this.interaction.on("end",function(e){if(t.canBeCompleted(t.fakeAnnotation)){o.creatingEnd(),s();var n=i.getBoundingClientRect(),a=l(t.fakeAnnotation,e.clientX-n.left,e.clientY-n.top);t.executor.waitForLastTask().finally(function(){t.getSnappedPoint(a.deviceX,a.deviceY).then(function(e){-1==t.end(t.fakeAnnotation,e)&&(c(),t.interaction.startCreating())}),t.pdfViewer.eventEmitter.emit(zi.distanceAnnotCreationEnd,t.fakeAnnotation)})}else t.interaction.startCreating()}),this.interaction.on("cancel",function(){o.creatingEnd(),s(),t.cancel(),t.syncAddingAnnot(!0)});var u=function(e){t.fakeAnnotation&&(t.fakeAnnotation.zoomTo(e),t.fakeAnnotation.draw())};this.destroyPageHooks.push(function(){return a.end()},this.pdfViewer.addEventListener(zi.zoomToSuccess,function(){u(t.pageRender.scale)}),this.pdfViewer.addEventListener(zi.changeViewModeSuccess,function(e,n){u(t.pageRender.scale)}),this.pdfViewer.addEventListener(zi.fitWidthResizeViewport,function(){u(t.pageRender.scale)}))}},{key:"getSnappedPoint",value:function(e,t){var n=this;return this.pageRender.getPDFPage().then(function(i){var a=n.pdfViewer.getSnapMode(n.constructor.getStateName());if(a&&a.length>0){var r=w(i.reverseDevicePoint([e,t],n.pageRender.scale,n.pageRender.rotate),2),o=r[0],s=r[1];return i.getSnappedPoint({x:o,y:s},a).then(function(e){var t=w(i.getDevicePoint([e.x,e.y],n.pageRender.scale,n.pageRender.rotate),2);return{deviceX:t[0],deviceY:t[1],type:e.type}})}return{deviceX:e,deviceY:t}})}},{key:"create",value:function(e,t){throw new Error("not implemented!")}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.addPoint(n,i),e.draw()}},{key:"mousemove",value:function(e){var t=this;this.executor.exec(function(){return t.getSnappedPoint(e.x,e.y).then(function(n){var i=n.deviceX,a=n.deviceY,r=n.type;ta(e,{x:i,y:a})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.setPosition(i,a),t.snappedPointAssistant.show(r))})})}},{key:"adjust",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.setLastPoint(n,i),e.draw()}},{key:"end",value:function(e,t){var n=this;if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.creatingState=0,t&&!ea&&(e.addPoint(t.deviceX,t.deviceY),e.draw()),this.isUsePageMeasure&&this.pageMeasureRatio){var i=this.pageMeasureRatio.split(" = ").map(function(e){var t=e.split(" ");return{value:t[0],unit:t[1]}});i.length<2||(e.annotationInfo.measure=Object.assign({},e.annotationInfo.measure,{ratio:{userSpaceValue:Number(i[0].value),realValue:Number(i[1].value),userSpaceUnit:i[0].unit,realUnit:i[1].unit}}))}e.apply().then(function(e){if(n.pdfViewer.config.showCommentList){var t=e[e.length-2];n.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}}),this.fakeAnnotation=null}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(Yi).creatingEnd(),this.syncAddingAnnot(!0),this.executor.cancel(),this.interaction.cancel(),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"canBeCompleted",value:function(){return!0}},{key:"createAnnotJson",value:function(e,t){return e}},{key:"docHandler",value:function(e){ea?e.enableDragToScroll():e.disableDragToScroll()}},{key:"destroyPageHandler",value:function(){(this.snappedPointAssistant.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach(function(e){return e()}),this.pageRender.$handler.removeClass(this.cursorStyle),this.fakeAnnotation)&&(this.interaction.status!==xi&&this.pdfViewer.eventEmitter.emit(zi.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null,this.pdfViewer.getIoC().getInstanceByClass(Yi).creatingEnd());this.interaction.destroy(),this.offCancelEvent&&this.offCancelEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),t}(Wi));function oa(e){return y(e)||v(e)||g(e)||S()}var sa=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(this,t),(n=a(this,t)).closing=i,e.length>1&&e.reduce(function(e,t,i){return n.addSegment(new ca(e,t,1===i)),t}),n}return f(t,e),u(t,[{key:"render",value:function(e){e.beginPath(),this.segments.forEach(function(t){t.render(e)}),this.closing&&e.closePath()}}]),t}(zt),ca=function(e){function t(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return c(this,t),(i=a(this,t,[e,n])).atTheStart=r,i}return f(t,e),u(t,[{key:"render",value:function(e){this.atTheStart&&e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y)}}]),t}(Wt);function la(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;e.fillStyle="#fff",t.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,n,0,360),e.stroke(),e.fill()})}var ua=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).helper=new Kn(e),t}return f(n,t),u(n,[{key:"doPrepare",value:function(){d(e(n.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polyline")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.canvas.getContext("2d"),s=this.convertPointToPixel(0==i.width?.5:i.width,a);if((0!=s||-1!=n.borderColor||n.fillColor)&&(o.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent())){var c=t.page,l=e.innerRect,u=t.vertexes.map(function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Gt(n-l.left,i-l.top)});e.vertexes=u,o.save(),e.lineWidth=s,o.globalAlpha=n.opacity,o.lineWidth=s,0===s||!1===n.hasBorderColor?o.strokeStyle="transparent":o.strokeStyle=this.numberToRGBAString(n.color);try{switch(i.style){case Mt:case Dt:this.renderSolid(o,n,e)}var d=u[u.length-1],h=u[u.length-2],f=u[0],p=u[1];this.helper.renderLineEnd(o,s,e,t.startStyle,p,f),this.helper.renderLineEnd(o,s,e,t.endingStyle,h,d),this.setContents(o,n.contents,u)}finally{o.restore()}}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0;r.style===Mt&&(e.setLineDash&&e.setLineDash(o.map(function(e){return i.convertPointToPixel(e,a)})),e.lineDashOffset=this.convertPointToPixel(s,a)),new sa(n.vertexes,!1,5).render(e),e.stroke();try{if(!Re.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&la(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=Pn(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=this.canvas.getContext("2d"),s=i.page;o.strokeStyle=this.numberToRGBAString(r.color),i.vertexes.map(function(n){var i=w(s.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new Gt(r-a.left,o-a.top)}).forEach(function(e){return In(o,e)}),o.restore()}},{key:"setContents",value:function(e,t,n){var i,a;if(void 0!==t&&n&&!(n.length<3)){var r=n[n.length-1],o=e;o.beginPath(),o.font="14px Verdana",o.textAlign="left",o.textBaseline="top",o.direction="ltr";var s=o.measureText(t).width;o.fillStyle="#AF6B6B";var c=n.map(function(e){return e.x}),l=(i=Math).min.apply(i,m(c));(a=Math).max.apply(a,m(c));Math.abs(r.x-l)>=s&&r.x>l?o.fillText(t,r.x-s,r.y,s):o.fillText(t,r.x,r.y,s),o.closePath()}}}]),n}(_t),da=function(t){function n(e){var t,i;(c(this,n),$e(t=a(this,n,[e]),"vertexes",[]),$e(t,"deviceVertexes",[]),$e(t,"lastPoint",{x:0,y:0}),t.annotationInfo.vertexes)&&(i=t.vertexes).push.apply(i,m(t.annotationInfo.vertexes));return t.annotationInfo.vertexes=t.vertexes,t}return f(n,t),u(n,[{key:"getVertexes",value:function(){return this.vertexes}},{key:"getDeviceVertexes",value:function(){return this.deviceVertexes}},{key:"addPoint",value:function(e,t){var n=w(this.page.reverseDevicePoint([e,t],this.scale,this.rotate),2),i=n[0],a=n[1];this.vertexes.push({x:i,y:a}),this.lastPoint={x:i,y:a},this.deviceVertexes.push({x:e,y:t}),this.updateRect()}},{key:"setLastPoint",value:function(e,t){var n=this.deviceVertexes[this.deviceVertexes.length-1],i="number"==typeof e?e:n.x,a="number"==typeof t?t:n.y,r=w(this.page.reverseDevicePoint([i,a],this.scale,this.rotate),2),o=r[0],s=r[1];this.lastPoint={x:o,y:s},this.updateRect()}},{key:"getLastPoint",value:function(){return this.lastPoint}},{key:"zoomTo",value:function(t){var i=this;this.scale!==t&&(d(e(n.prototype),"zoomTo",this).call(this,t),this.deviceVertexes=this.vertexes.map(function(e){var n=w(i.page.getDevicePoint([e.x,e.y],t,i.rotate),2);return{x:n[0],y:n[1]}}),this.updateRect())}},{key:"removeLastPoint",value:function(){}},{key:"getRenderingData",value:function(t,i){var a=d(e(n.prototype),"getRenderingData",this).call(this,t,i),r=oa(this.vertexes).slice(0);return r.push(this.lastPoint),Wn(mn({},a),{vertexes:r})}},{key:"generateApRenderer",value:function(){return new ua(this)}},{key:"getType",value:function(){return"polyline"}},{key:"getOuterDeviceRect",value:function(t,i){return d(e(n.prototype),"getDeviceRect",this).call(this,t,i)}},{key:"updateRect",value:function(){if(0!==this.deviceVertexes.length){var e=w(this.page.getDevicePoint([this.lastPoint.x,this.lastPoint.y],this.scale,this.rotate),2),t={x:e[0],y:e[1]},n=t.x,i=t.y,a=t.x,r=t.y;this.deviceVertexes.forEach(function(e){n=Math.min(n,e.x),a=Math.max(a,e.x),i=Math.min(i,e.y),r=Math.max(r,e.y)});var o=hn(this.annotationInfo.borderInfo.width)*this.scale*2+20;n-=o/2,i-=o/2,a+=o/2,r+=o/2,this.setRect({left:n,top:i,right:a,bottom:r})}}},{key:"apply",value:function(){var t=this;return d(e(n.prototype),"apply",this).call(this).then(function(e){var n=t.annotationInfo.intent;return"PolygonDimension"===n||"PolyLineDimension"===n?t.page.getMeasureScaleRatio().then(function(i){if(i&&i.scale){var a=t.pdfViewer.getStore().getCurrentValue("measurementData"),r=xn(t.pdfViewer),o=It(a.displayUnit.name)?t.pdfViewer.i18n.t("measurement.units.".concat(a.displayUnit.name)):a.displayUnit.name;return e[0].setContent(r+parseFloat("PolyLineDimension"===n?a.perimeter:a.area).toFixed(2)+" "+o).then(function(t){return e})}return e}):e})}}]),n}(pn),ha=function(t){function n(e){var t,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c(this,n),(t=a(this,n,[e])).closing=i,t.showText=!0,t}return f(n,t),u(n,[{key:"setFlag",value:function(e,t){this.closing=e,this.showText=t}},{key:"doPrepare",value:function(){d(e(n.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polygon")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.convertPointToPixel(0==i.width?.5:i.width,a);if(0!=o||-1!=n.borderColor||n.fillColor){var s=this.canvas.getContext("2d");if(s.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){var c=t.page,l=e.innerRect,u=e.outerRect,d=t.vertexes.map(function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Gt(n-l.left,i-l.top)}),h=t.vertexes.map(function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Gt(n-u.left,i-u.top)});e.vertexes=d,s.save(),e.lineWidth=o,s.globalAlpha=n.opacity,0===o||!1===n.hasBorderColor?s.strokeStyle="transparent":s.strokeStyle=this.numberToRGBAString(n.color),s.lineWidth=o;try{switch(i.style){case Mt:case Dt:case Vt:case Lt:this.renderSolid(s,n,e),this.setContents(s,n.contents,d);break;case Nt:0==o?this.renderSolid(s,n,e):this.renderCloud(s,n,e),this.setContents(s,n.contents,h)}}finally{s.restore()}}}}},{key:"renderCloud",value:function(e,t,n){var i=t.fillColor,a=t.borderInfo.cloudIntensity,r=n.innerRect,o=n.outerRect,s=new en(n.vertexes,r,o),c=n.renderingData.vertexes,l=c.length;(l=l*=2==a?8:16,c.length>=2)&&(l=function(e,t){var n=2,i=Math.abs(e.right-e.left),a=Math.abs(e.bottom-e.top);n=1===t?parseInt((i+a)/4):parseInt((i+a)/6);return n<2&&(n=2),n%2!=0&&(n+=1),n}(this.calculateRect(c),a));s.generate(16/a,e,l).render(e),i&&(e.fillStyle=this.numberToRGBAString(i),e.fill()),e.stroke();try{if(!Re.isTouchDevice)return;var u=r.left-o.left,d=r.top-o.top,h=n.vertexes.map(function(e){return{x:e.x+u,y:e.y+d}});void 0===n.renderingData.annotInfo.id&&la(e,h)}catch(e){}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0,c=t.fillColor;r.style===Mt&&(e.setLineDash&&e.setLineDash(o.map(function(e){return i.convertPointToPixel(e,a)})),e.lineDashOffset=this.convertPointToPixel(s,a)),new sa(n.vertexes,this.closing).render(e),c&&(e.fillStyle=this.numberToRGBAString(c),e.fill()),e.stroke();try{if(!Re.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&la(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=Pn(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=r.borderInfo||{},s=this.convertPointToPixel(o.width,e),c=this.canvas.getContext("2d");c.clearRect(0,0,this.canvas.width,this.canvas.height);var l=i.page,u=i.vertexes.map(function(n){var i=w(l.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new Gt(r-a.left,o-a.top)});c.save(),c.strokeStyle=this.numberToRGBAString(r.color),c.lineWidth=s;var d=this.closing;this.closing=!0,this.renderSolid(c,r,{vertexes:u}),c.beginPath(),u.forEach(function(e){return In(c,e)}),this.closing=d}},{key:"setContents",value:function(e,t,n){var i;if(void 0!==t&&n&&!(n.length<3)&&this.showText){var a=n[n.length-1],r=e;r.beginPath(),r.font="14px Verdana",r.textAlign="left",r.textBaseline="top",r.direction="ltr";var o=r.measureText(t).width;r.fillStyle="#AF6B6B";var s=n.map(function(e){return e.x}),c=(i=Math).min.apply(i,m(s));Math.abs(a.x-c)>=o&&a.x>c?r.fillText(t,a.x-o,a.y,o):r.fillText(t,a.x,a.y,o),r.closePath()}}},{key:"calculateRect",value:function(e){var t={},n={x:0,y:0};t.left=t.right=e[0].x,t.bottom=t.top=e[0].y;for(var i=e.length,a=1;a<=i;a++)n=e[a%i],t.left>n.x&&(t.left=n.x),t.bottom>n.y&&(t.bottom=n.y),t.right<n.x&&(t.right=n.x),t.top<n.y&&(t.top=n.y);return t}}]),n}(_t),fa=function(t){function n(e){var t;c(this,n),$e(t=a(this,n,[e]),"isCloudy",!1);var i=t.annotationInfo;if(i.borderStyle)switch(i.borderInfo.style=i.borderStyle,i.borderStyle){case Nt:t.annotationInfo.borderInfo.cloudIntensity=i.borderStyleParam,t.isCloudy=!0;break;case Mt:t.annotationInfo.borderInfo.dashes=i.borderStyleParam}return i.borderInfo.style===Nt?t.isCloudy=!0:t.isCloudy=!1,t}return f(n,t),u(n,[{key:"setFlag",value:function(e,t){this.renderer.setFlag(e,t)}},{key:"generateApRenderer",value:function(){var e=this.isCloudy;return new ha(this,e)}},{key:"getOuterDeviceRect",value:function(t,i){return this.isCloudy?an.on(this.getDeviceRect(t,i)).expand(100*t).extract():d(e(n.prototype),"getDeviceRect",this).call(this,t,i)}},{key:"getType",value:function(){return"polygon"}}]),n}(da),pa=function(e){function t(e,n){var i;return c(this,t),$e(i=a(this,t,[e,n,"create-drawing-status"]),"target",void 0),i.target=n,i}return f(t,e),t}(Xi),va=A.stateHandler,ga=A.Log,ma=A.DeviceInfo,ya=A.ViewerEvents,Sa=A.Consts.CREATING_DRAWING_CONTEXTMENU,wa=ga.LoggerFactory,Aa=va.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON,ba=wa.getLogger("CreatePolygonStateHandler"),Ea=function(t){function n(e){return c(this,n),a(this,n,[e,"polygon"])}return f(n,t),u(n,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===n.getStateName()}},{key:"create",value:function(e,t){var n=new fa({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polygon",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polygon")})});return n.addPoint(e,t),ma&&ma.isTouchDevice&&n.draw(),this.pdfViewer.eventEmitter.emit(ya.perimeterAnnotCreationStart,n),n}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&ba.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(t){var i,a=this;if(d(e(n.prototype),"pageHandler",this).call(this,t),this.isCurrentStateHandler()){var r,o;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Sa,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){a.interaction.unlock(),a.interaction.emit("end",r)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){a.interaction.unlock(),a.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var s=((null===(i=this.pdfViewer.viewerUI.rootComponent)||void 0===i?void 0:i.pdfUI)||{customs:{}}).customs,c=s.startSDKSpan;s.otelService;this.interaction.on("start",function(){a.contextmenu.enable(),a.completeMenuItem.disable(),a.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationStart,a.fakeAnnotation),c&&c(a.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;o=t})}),this.interaction.on("end",function(){null==o||o()}),this.interaction.on("cancel",function(){a.contextmenu.disable(),a.cancel()}),this.interaction.on("move",function(e){r=e}),this.contextmenu.onHidden(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.unlock()}),this.contextmenu.onShown(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.lock(),a.fakeAnnotation.getVertexes().length>=3?a.completeMenuItem.enable():a.completeMenuItem.disable()})}}},{key:"end",value:function(t,i){if(!this.isCurrentStateHandler())return d(e(n.prototype),"end",this).call(this,t,i);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationEnd,this.fakeAnnotation),d(e(n.prototype),"end",this).call(this,t,i))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return d(e(n.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Aa}}]),n}(ra),ka=A.stateHandler,Ra=A.Log,xa=A.DeviceInfo,Ca=A.ViewerEvents,Ta=A.Consts.CREATING_DRAWING_CONTEXTMENU,Pa=Ra.LoggerFactory,Ia=ka.StateHandlerConsts.STATE_HANDLER_CREATE_POLYLINE,_a=(Pa.getLogger("creation/polyline/state"),function(t){function n(e){return c(this,n),a(this,n,[e,"polyline"])}return f(n,t),u(n,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===n.getStateName()}},{key:"pageHandler",value:function(t){var i,a=this;if(d(e(n.prototype),"pageHandler",this).call(this,t),this.isCurrentStateHandler()){var r,o;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Ta,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){a.interaction.unlock(),a.interaction.emit("end",r)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){a.interaction.unlock(),a.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var s=((null===(i=this.pdfViewer.viewerUI.rootComponent)||void 0===i?void 0:i.pdfUI)||{customs:{}}).customs,c=s.startSDKSpan;s.otelService;this.interaction.on("start",function(){a.contextmenu.enable(),a.completeMenuItem.disable(),a.pdfViewer.eventEmitter.emit(Ca.drawingAnnotCreationStart,a.fakeAnnotation),c&&c(a.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;o=t})}),this.interaction.on("end",function(){null==o||o()}),this.interaction.on("cancel",function(){a.contextmenu.disable(),a.cancel()}),this.interaction.on("move",function(e){r=e}),this.contextmenu.onHidden(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.unlock()}),this.contextmenu.onShown(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.lock(),a.fakeAnnotation.getVertexes().length>=3?a.completeMenuItem.enable():a.completeMenuItem.disable()})}}},{key:"create",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("polyline"),i=new da(Object.assign({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polyline",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polyline")})},n));return i.addPoint(e,t),xa&&xa.isTouchDevice&&i.draw(),i}},{key:"end",value:function(t,i){if(!this.isCurrentStateHandler())return d(e(n.prototype),"end",this).call(this,t,i);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(Ca.drawingAnnotCreationEnd,this.fakeAnnotation),d(e(n.prototype),"end",this).call(this,t,i))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return d(e(n.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(Ca.drawingAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Ia}}]),n}(ra)),Da=A.stateHandler,Ma=A.Log,Va=A.DeviceInfo,La=A.ViewerEvents,Na=A.Consts.CREATING_DRAWING_CONTEXTMENU,Ha=A.Consts.BORDER_STYLE,Oa=Ma.LoggerFactory,Fa=Da.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON_CLOUD,Ua=Object.values(Ha),ja=Oa.getLogger("CreatePolygonCloudStateHandler"),Ba=function(t){function n(e){return c(this,n),a(this,n,[e,"polygon"])}return f(n,t),u(n,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===n.getStateName()}},{key:"create",value:function(e,t){var n,i=this.pdfViewer.getDefaultAnnotConfig()("polygon","PolygonCloud"),a=Object.assign({type:"polygon",flags:4,date:new Date,borderStyle:Ha.CLOUDY,borderStyleParam:2,intent:"PolygonCloud",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Cloud")},i);if(n=i.borderInfo){Ua.indexOf(n.style)>-1&&(a.borderStyle=n.style);var r=n.dashes;Array.isArray(r)&&r.length>0?a.borderStyleParam=r:"number"==typeof n.cloudIntensity&&(a.borderStyleParam=n.cloudIntensity)}var o=new fa({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:a});return o.addPoint(e,t),Va&&Va.isTouchDevice&&o.draw(),o}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&ja.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(t){var i,a=this;if(d(e(n.prototype),"pageHandler",this).call(this,t),this.isCurrentStateHandler()){var r,o;this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Na,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){a.interaction.unlock(),a.interaction.emit("end",r)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){a.interaction.unlock(),a.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var s=((null===(i=this.pdfViewer.viewerUI.rootComponent)||void 0===i?void 0:i.pdfUI)||{customs:{}}).customs,c=s.startSDKSpan;s.otelService;this.interaction.on("start",function(){a.contextmenu.enable(),a.completeMenuItem.disable(),a.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationStart,a.fakeAnnotation),c&&c(a.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;o=t})}),this.interaction.on("end",function(){null==o||o()}),this.interaction.on("cancel",function(){a.contextmenu.disable(),a.cancel()}),this.interaction.on("move",function(e){r=e}),this.contextmenu.onHidden(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.unlock()}),this.contextmenu.onShown(function(){if(!a.fakeAnnotation)return a.contextmenu.disable();a.interaction.lock(),a.fakeAnnotation.getVertexes().length>=3?a.completeMenuItem.enable():a.completeMenuItem.disable()})}}},{key:"end",value:function(t,i){this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationEnd,this.fakeAnnotation),d(e(n.prototype),"end",this).call(this,t,i))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Fa}}]),n}(ra),Xa=function(e){function t(){return c(this,t),a(this,t,arguments)}return f(t,e),u(t,[{key:"convertToCanvasBasedPoint",value:function(e,t,n,i,a,r){var o=w(a.getDevicePoint([e,t],i,r),2),s=o[0],c=o[1];return{x:s-n.left,y:c-n.top}}},{key:"doRender",value:function(e){var t=this,n=e.scale,i=e.renderingData,a=e.rotate,r=i.page,o=i.annotInfo,s=o.startCharInfo,c=o.endCharInfo,l=i.quadPoints,u=i.outerDeviceRect;if(!s){var d=l[0];s={left:d[0].x,top:d[0].y,right:d[1].x,bottom:d[2].y}}if(!c){var h=l[l.length-1];c={left:h[0].x,top:h[0].y,right:h[1].x,bottom:h[2].y}}var f=l.map(function(e,i){var o,s,c,l,d=e.map(function(e){return t.convertToCanvasBasedPoint(e.x,e.y,u,n,r,a)}),h=d.map(function(e){return e.x}),f=d.map(function(e){return e.y}),p=(o=Math).min.apply(o,m(h)),v=(s=Math).max.apply(s,m(h)),g=(c=Math).max.apply(c,m(f)),y=(l=Math).min.apply(l,m(f));return{left:p,right:v,bottom:g,top:y,width:v-p,height:g-y,textBlockHeight:g-y}});e.quadRects=f}}]),t}(_t),Ya=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).lastX=0,t.lastY=0,t}return f(n,t),u(n,[{key:"prepare",value:function(){d(e(n.prototype),"prepare",this).call(this),Re.isChrome||Re.isFirefox||Re.isSafari||Re.isChromiumEdge||(this.canvas.style.cssText+='\n            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";\n            -ms-filter: alpha(opacity=50);\n            filter: alpha(opacity=50);\n            -moz-opacity: 0.5;\n            -khtml-opacity: 0.5;\n            opacity: 0.5;\n        ')}},{key:"doRender",value:function(t){t.smartScale,t.scale,this.component;var i=t.renderingData,a=i.annotInfo;if(this.component.needToggleView&&this.component.needToggleView()&&!this.component.shouldRenderByMouseEvent()){var r=this.canvas.getContext("2d");return r.clearRect(0,0,this.canvas.width,this.canvas.height),void r.save()}if(0!=a.hasBorderColor){var o=this.canvas.getContext("2d"),s=i.outerDeviceRect,c=s.right-s.left,l=s.bottom-s.top;if(this.container.style.cssText+="\n                left: ".concat(s.left,"px;\n                top: ").concat(s.top,"px;\n            "),this.canvas.style.cssText+="width: ".concat(c,"px;height: ").concat(l,"px;"),o.save(),o.fillStyle=this.numberToRGBAString(a.color),o.globalAlpha=i.opacity,i.isArea)o.fillRect(0,0,this.canvas.width,this.canvas.height);else d(e(n.prototype),"doRender",this).call(this,t),t.quadRects.forEach(function(e){o.fillRect(e.left,e.top,e.width,e.textBlockHeight)});o.restore()}}}]),n}(Xa),$a=function(t){function n(e){var t;c(this,n);return(t=a(this,n,[e])).annotationInfo.dicts=Object.assign({AreaHi:"AreaHi"},t.annotationInfo.dicts||{}),t.eContainer.classList.add("fv__viewer-fake-highlight-area-annot"),t}return f(n,t),u(n,[{key:"setRect",value:function(t){d(e(n.prototype),"setRect",this).call(this,t),this.annotationInfo.coords=[this.pdfRect],this.annotationInfo.quadPoints=[{x:this.pdfRect.left,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.bottom},{x:this.pdfRect.left,y:this.pdfRect.bottom}]}},{key:"getDefaultAnnotInfo",value:function(){var t=d(e(n.prototype),"getDefaultAnnotInfo",this).call(this);return t.color=16776960,t}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),"Area"):{}}},{key:"generateApRenderer",value:function(){return new Ya(this)}},{key:"getType",value:function(){return"highlight"}},{key:"getCreationJSON",value:function(){return Wn(mn({},d(e(n.prototype),"getCreationJSON",this).call(this)),{color:this.annotationInfo.color})}},{key:"getRenderingData",value:function(t,i){var a=d(e(n.prototype),"getRenderingData",this).call(this,t,i);return Wn(mn({},a),{coords:[a.outerDeviceRect],isArea:!0})}}]),n}(pn),Ga=A.stateHandler,za=Ga.IStateHandler,Wa=Ga.StateHandlerUtils.getDevicePagePoint,qa=Ga.StateHandlerConsts.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT,Ka=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-crosshair",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e,this.pageDestroyHooks=[];var i=e.$handler.get(0);e.$handler.addClass(this.cursorStyle);var a,r,o,s=this.hammer=new Hammer.Manager(i);s.add(new Hammer.Pan);var c=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,l=c.startSDKSpan,u=c.otelService;s.on("panstart",function(e){if(n.startPoint=Wa(i,e),n.start(n.startPoint),l&&l(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;a=t}),u){var t=u.startChildSpan(n.constructor.getStateName()+"Start"),o=t.end,s=t.span;r=o}}),s.on("panmove",function(e){return n.currentPoint={x:n.startPoint.x+e.deltaX,y:n.startPoint.y+e.deltaY},n.adjust(n.fakeAnnotation,n.startPoint,n.currentPoint)}),s.on("panend",function(e){if(n.end(n.fakeAnnotation),u){var t=u.startChildSpan(n.constructor.getStateName()+"End"),i=t.end,s=t.span;o=i}null==o||o(),null==r||r(),null==a||a()}),s.on("pancancel",function(e){return n.end(n.fakeAnnotation)}),this.pageDestroyHooks.push(function(){return s.destroy()})}},{key:"start",value:function(e){var t=e.x,n=e.y;return this.fakeAnnotation=new $a({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight")}}),this.fakeAnnotation.setRect({left:t,right:t+1,top:n,bottom:n+1}),this.fakeAnnotation}},{key:"adjust",value:function(e,t,n){var i=t.x,a=t.y,r=n.x,o=n.y,s=Math.min(i,r),c=Math.min(a,o),l=Math.max(i,r),u=Math.max(a,o);e.setRect({left:s,top:c,right:l,bottom:u}),e.draw()}},{key:"end",value:function(e){var t=this;e.apply().then(function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}).then(function(){0})}},{key:"destroyPageHandler",value:function(){this.fakeAnnotation&&this.fakeAnnotation.destroy(),this.pageDestroyHooks&&this.pageDestroyHooks.forEach(function(e){return e()}),this.pageRender.$handler.removeClass(this.cursorStyle)}}],[{key:"getStateName",value:function(){return qa}}]),t}(za),Ja=function(){function e(){c(this,e),$e(this,"store",new Re.ValueStore(!0))}return u(e,[{key:"start",value:function(){this.store.dispatch(!1)}},{key:"complete",value:function(){this.store.dispatch(!0)}},{key:"waitForCreationComplete",value:function(){return this.store.takeUntil(Boolean)}}]),e}(),Za=A.stateHandler,Qa=A.ViewerEvents,er=A.shared,tr=A.DeviceInfo,nr=A.vendors,ir=nr.jQuery,ar=nr.EventEmitter,rr=Za.IStateHandler,or=Za.StateHandlerConsts.STATE_HANDLER_CREATE_PENCIL,sr=A.shared,cr=sr.getClientX,lr=sr.getClientY,ur=sr.colorConvertor,dr=er.browser.dpr,hr=function(){function e(){c(this,e),this.isZoom=!1,this.eventEmitter=new ar}return u(e,[{key:"allInjected",value:function(){var e=this,t=new Hammer.Manager(this.pdfViewer.element,{recognizers:[[Hammer.Pinch]]});t.on("pinchstart",function(t){e.isZoom=!0,e.eventEmitter.emit("pinchstart",t)}),t.on("pinchend",function(t){Promise.resolve().then(function(){e.isZoom=!1}),e.eventEmitter.emit("pinchend",t)}),t.on("pinchmove",function(t){e.eventEmitter.emit("pinchmove",t)})}},{key:"onPinchstart",value:function(e){var t=this;return this.eventEmitter.on("pinchstart",e),function(){t.eventEmitter.off("pinchstart",e)}}},{key:"onPinchmove",value:function(e){var t=this;return this.eventEmitter.on("pinchmove",e),function(){t.eventEmitter.off("pinchmove",e)}}},{key:"onPinchend",value:function(e){var t=this;return this.eventEmitter.on("pinchend",e),function(){t.eventEmitter.off("pinchend",e)}}}],[{key:"inject",value:function(){return{pdfViewer:A.PDFViewer}}}]),e}(),fr=function(e){function t(){var e;return c(this,t),(e=a(this,t,arguments)).cursorStyle="fv__cursor-pencil",e.isMovingPencil=!1,e.destroyHooks=[],e.createInkService=e.pdfViewer.getIoC().getInstanceByClass(Ja),e}return f(t,e),u(t,[{key:"initTimeout",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.timeout;clearTimeout(i),n&&(this.timeout=setTimeout(function(){if(t.isMovingPencil)return t.isMovingPencil=!1,t.initTimeout(e,n);t.addAnnot().then(function(e){t.isMovingPencil=!1})},e))}},{key:"pageHandler",value:function(e){var t,n=this,i=this,a=this;this.pageRender=e;var r=this.pdfViewer,o=r.getIoC().getInstanceByClass(hr),s=e.viewerRender,c=s.scrollWrap,l=e.$handler;l.addClass(this.cursorStyle);var u=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i.pdfPointList&&!(i.pdfPointList.length<1)){if(t&&i.$canvas)return R(),void function(t,n){if(!t||t.length<1)return;var i={left:1e4,right:0,top:0,bottom:1e4},a=e.scale;Re.isTouchDevice&&(a=e.scale*n);var r=function(e,t,n,i,a,r){return a.forEach(function(a){var o=w(e.getDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})}),i}(e.page,a,e.rotate,[],t,i),o=d[0].getBoundingClientRect(),s=v.getBoundingClientRect();r.slice(0).map(function(e){return Wn(mn({},e),{x:e.x-(o.left-s.left),y:e.y-(o.top-s.top)})}).forEach(function(e){1==e.type?p.moveTo(e.x*dr,e.y*dr):p.lineTo(e.x*dr,e.y*dr)}),p.stroke()}(i.pdfPointList,n);clearTimeout(i.timeout),i.addAnnot()}};this.destroyHooks.push((0,Re.observeResize)(e.viewerRender.scrollWrap.getScrollHost(),function(){n.isPaintingPencil||x()}));var d=this.$canvas=ir('<canvas style="position: fixed;pointer-events: none;z-index: 1024;">');x(),l.append(this.$canvas.get(0));var h,f,p=this.$canvas[0].getContext("2d"),v=l[0],g=this.hammer=new Hammer.Manager(v,{recognizers:[[Hammer.Tap]]});if(this.pencilLists=[],this.isMovingPencil=!1,this.pdfPointList=[],this.isPaintingPencil=!1,this.startScale=e.scale,Re.isTouchDevice){var m=r.addEventListener(Qa.zoomToSuccess,function(){n.transferPencilListsToPDFPointsLists(),u(!0,1)});this.destroyHooks.push(m)}var y=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,S=y.startSDKSpan,A=(y.otelService,!1);g.on("tap",function(t){if(n.isPaintingPencil=!0,0==n.pdfPointList.length&&(n.startScale=e.scale,R()),!(t.pointers.length>1||o.isZoom)){p.closePath();var i=pr(v,t,d[0]);p.beginPath(),p.moveTo(i.x*dr,i.y*dr),p.arc(i.x*dr,i.y*dr,n.lineWidth,0,2*Math.PI),p.fillStyle=n.lineColor,p.fill(),p.closePath(),n.pencilLists.push([{x:i.x,y:i.y,type:3}]),n.isMovingPencil=!0,n.startAddAnnot()}});var b=!1;function E(e){var t=r.element.parentElement.getBoundingClientRect(),n=l[0].getBoundingClientRect(),i=n.x-t.x,a=n.y-t.y;d.css({position:"absolute",left:-i/e,top:-a/e})}function k(){var e=r.element.parentElement;if(!e)return 1;var t=e.style.transform,n=w(/scale\((\d+(\.\d+)?)\)/.exec(t)||[],2)[1];return void 0===n?1:parseFloat(n)}function R(){var t=Object.assign({borderInfo:{width:2},color:16711680},a.pdfViewer.getDefaultAnnotConfig()("ink"));t.color=16777215&t.color,x(),a.$canvas.css("opacity",Number(t.opacity));var n=t.borderInfo.width*e.getScale()*dr*4/3;a.lineWidth=n,p.lineWidth=n,a.lineColor=ur(t.color,"HTML"),p.strokeStyle=ur(t.color,"HTML"),p.lineJoin="round",p.lineCap="round"}function x(){var t=e.viewerRender.getViewBoxRect(),n=t.right-t.left,i=t.bottom-t.top;d[0].width=n*dr,d[0].height=i*dr,d.css({width:n,height:i,position:"fixed",left:t.left,top:t.top})}if(g.on("hammer.input",function(t){t.pointers.length>1?A=!0:A?"pointerup"==t.srcEvent.type&&(A=!1):"pointermove"==t.srcEvent.type?(b||(!function(t){if(s.setAllowScrollOnMouseWheel(!1),0==n.pdfPointList.length&&(n.startScale=e.scale,R()),!o.isZoom){n.isPaintingPencil=!0;var i=n.pencilLists;h=[],i.push(h);var a=pr(v,t,d[0]);p.closePath(),p.beginPath(),p.moveTo(a.x*dr,a.y*dr),h.push({x:a.x,y:a.y,type:1}),S&&S(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;f=t})}}(t),b=!0),function(e){if(!o.isZoom){n.isMovingPencil=!0;var t=pr(v,e,d[0]);h.push({x:t.x,y:t.y,type:2}),p.lineTo(t.x*dr,t.y*dr),p.strokeStyle=n.lineColor,p.stroke(),p.closePath(),p.beginPath(),p.moveTo(t.x*dr,t.y*dr),n.pageRender.page}}(t)):"pointerup"==t.srcEvent.type&&(!function(e){s.setAllowScrollOnMouseWheel(!0);var t=n.pencilLists;if(n.isPaintingPencil&&t&&!(t.length<1)&&n.isMovingPencil&&!o.isZoom){n.isMovingPencil=!1;var i=pr(v,e,d[0]);p.lineTo(i.x*dr,i.y*dr),p.stroke(),n.startAddAnnot(),null==f||f()}}(t),b=!1)}),o.onPinchstart(function(e){E(k())}),o.onPinchmove(function(e){E(k())}),o.onPinchend(function(t){var n;n=e.viewerRender.getViewBoxRect(),d.css({position:"fixed",left:n.left,top:n.top}),Promise.resolve().then(function(){u(!1,t.scale)})}),tr.isTouchDevice){var C=function(e){e.preventDefault()};l.on("touchstart",C),this.__off_touch_event=function(){l.off("touchstart",C)}}else this.__off_touch_event=function(){};var T=c.getScrollHost(),P=function(e){if(n.isPaintingPencil&&!n.isMovingPencil){var t=!1;(e.ctrlKey||Re.isMac&&e.metaKey)&&(t=!0),u(t)}};T.addEventListener("wheel",P);var I=function(e){n.isPaintingPencil&&!n.isMovingPencil&&u()};e.$element.on("blur",I),this.destroyHooks.push(function(){e.$element.off("blur",I),T.removeEventListener("wheel",P)})}},{key:"changeToPageDevicePoints",value:function(e,t){var n,i=[];(n=i).push.apply(n,m(e.reduce(function(e,t){return e.concat(t)},[])));var a=this.$canvas[0].getBoundingClientRect(),r=t.getBoundingClientRect();return i.slice(0).map(function(e){return Wn(mn({},e),{x:e.x+a.left-r.left,y:e.y+a.top-r.top})})}},{key:"transferPencilListsToPDFPointsLists",value:function(){var e,t=this.pencilLists;if(t&&!(t.length<1)){var n=this.pageRender,i=n.$handler[0],a=n.page,r=this.changeToPageDevicePoints(t,i),o=function(e,t,n,i,a,r){return a.forEach(function(a){var o=w(e.reverseDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})}),i}(a,n.scale,n.rotate,[],r,{left:1e4,right:0,top:0,bottom:1e4});(e=this.pdfPointList).push.apply(e,m(o)),this.pencilLists=[]}}},{key:"startAddAnnot",value:function(){var e=this.pencilLists;if(!e||e.length<1)return Promise.resolve();var t=this.pageRender;if(this.transferPencilListsToPDFPointsLists(),!t.pdfViewer.continuousAddPencil){var n=t.pdfViewer.getStateHandlerManager().getStateHandlerConfig(this.constructor.getStateHandlerName()),i=n?n.pencilTimeout:null;return i=null!=i?i:3e3,this.createInkService.start(),this.initTimeout(i)}this.addAnnot()}},{key:"addAnnot",value:function(){var e=this;if(!this.pdfPointList||this.pdfPointList.length<1)return Promise.resolve();var t=this.pdfPointList.slice(0);this.pdfPointList=[];var n=this.pageRender;return this.createInkService.start(),n.getPDFPage().then(function(i){var a=n.index,r=function(t){t.index===a&&(e.$canvas[0]&&(e.$canvas[0].width=0),t.pdfViewer.eventEmitter.off("renderAnnotSuccess",r),e.isPaintingPencil=!1)};return i.addAnnot({type:"ink",flags:4,rect:{left:1e4,right:0,top:0,bottom:1e4},inkList:t,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Pencil")}).then(function(t){return n.pdfViewer.eventEmitter.emit(Qa.addAnnotSuccess,t[0]),n.pdfViewer.eventEmitter.on("renderAnnotSuccess",r),e.pencilLists=[],t}).then(function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}})}).finally(function(){e.createInkService.complete()})}},{key:"destroyPageHandler",value:function(){var e=this;this.__off_touch_event(),this.initTimeout(0,!1),this.addAnnot().then(function(t){e.$canvas.remove(),e.hammer&&e.hammer.destroy(),e.pageRender.$handler.removeClass(e.cursorStyle),e.pencilLists=null}),this.destroyHooks.forEach(function(e){return e()})}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return or}},{key:"getStateHandlerName",value:function(){return"pencilStateHandler"}}]),t}(rr);function pr(e,t,n){var i=e.getBoundingClientRect(),a=t.srcEvent,r=cr(a),o=lr(a),s=n.getBoundingClientRect();return{x:Math.max(i.left,Math.min(i.right,r))-s.left,y:Math.max(i.top,Math.min(i.bottom,o))-s.top}}var vr=function(e){return e.CREATE_ANNOT="create-annots",e.REMOVE_ANNOT="remove-annots",e.UPDATE_ANNOT="update-annots",e.ADD_REPLY="add-reply",e.REMOVE_REPLY="remove-reply",e.ADD_REVIEW_STATE="add-review-state",e.ADD_MARKED_STATE="add-marked-state",e.UPDATE_ANNOT_CONTENT="update-comment-content",e.PPO_REMOVE_PAGE="ppo-remove-page",e.PPO_REMOVE_PAGES="ppo-remove-pages",e.PPO_INSERT_PAGE="ppo-insert-page",e.PPO_ROTATE_PAGE="ppo-rotate-page",e.PPO_MOVE_PAGE="ppo-move-page",e.MOVE_ANNOTS_BETWEEN_PAGES="move-annotations-between-pages",e.IMPORT_ANNOTATIONS_FILE="import-annotations-file",e}({}),gr=o(47),mr=o.n(gr),yr=(o(263),A.DeviceInfo.isDesktop?8:20),Sr=function(){function e(t,n){c(this,e),this.pageRender=t,this.circle=document.createElement("div"),this.circle.classList.add("eraserCircle"),this.circle.style="position:absolute; border:1px solid #000000;display:block;border-radius:50%;",this.wrapCircle=n,this.$eraserCircle=null,this.clientY,this.clientX,this.$pdfViewerElement=mr()(this.pageRender.pdfViewer.element)}return u(e,[{key:"init",value:function(){var e=this;this.$pdfViewerElement.on("scroll",function(t){e.$eraserCircle&&e.eraserMove(t)}),this.wrapCircle.on("mouseenter",function(){e.wrapCircle.append(e.circle),e.$eraserCircle=mr()(e.circle),e.$eraserCircle.css("display","block")}),this.wrapCircle.on("mousemove",function(t){e.eraserMove(t)}),this.wrapCircle.on("mouseleave",function(t){e.$eraserCircle&&e.$eraserCircle.remove()})}},{key:"eraserMove",value:function(e){var t=e||window.event,n=this.getEraseWidth()*this.pageRender.getScale(),i=this.$eraserCircle?this.$eraserCircle:mr()(this.circle);t.clientY&&(this.clientY=t.clientY),t.clientX&&(this.clientX=t.clientX);var a=i[0].getBoundingClientRect();i.width(n),i.height(n);var r=mr()(this.wrapCircle).offset().top,o=mr()(this.wrapCircle).offset().left,s=mr()("html").scrollLeft(),c=this.clientY-a.height/2-r,l=this.clientX-a.width/2-o+s;i.css({top:c,left:l})}},{key:"destroy",value:function(){this.$eraserCircle&&this.$eraserCircle.remove(),this.wrapCircle.off(),this.$pdfViewerElement.off("scroll")}},{key:"getEraseWidth",value:function(){var e=this.pageRender.pdfViewer.getStateHandlerManager().getStateHandlerConfig("eraserStateHandler");return e?e.width:yr}}]),e}(),wr=A.stateHandler,Ar=A.Log,br=A.ViewerEvents,Er=A.shared.eraser,kr=Er.Eraser,Rr=Er.Point,xr=wr.IStateHandler,Cr=A.Consts.POINT_TYPE,Tr=wr.StateHandlerUtils.getDevicePagePoint,Pr=Ar.LoggerFactory.getLogger("EraserStateHandler"),Ir=function(e){function t(){var e;return c(this,t),(e=a(this,t,arguments)).cursorStyle="fv__cursor-eraser fv__cursor-none",e.eraserCircle=null,e.createInkService=e.pdfViewer.getIoC().getInstanceByClass(Ja),e}return f(t,e),u(t,[{key:"pageHandler",value:function(e){return we(function(){var t,n,i,a,r,o,s,c,l,u,d,h,f,p,v;return Ae(this,function(g){return t=this,this.pageRender=e,i=e.$handler,(a=new Sr(e,i)).init(),this.eraserCircle=a,this.allInkList={},this.eraseInkList={},i.addClass(this.cursorStyle),r=i[0],o=this.hammer=new Hammer.Manager(r,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),s=this.createInkService.waitForCreationComplete().then(function(){return e.page.getAnnots().then(function(e){return e.filter(function(e){return"ink"===e.getType()})})}),d=(null===(n=this.pdfViewer.viewerUI.rootComponent)||void 0===n?void 0:n.pdfUI)||{customs:{}},h=d.customs,f=h.startSDKSpan,p=h.otelService,e.getPDFPage().then(function(n){o.on("panstart",function(e){if(t.startPoint=Tr(r,e),v=s.then(function(e){e.forEach(function(e){t.allInkList[e.getId()]={annot:e,inkList:e.getInkList()}})}),f&&f(t.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;c=t}),p){var n=p.startChildSpan(t.constructor.getStateName()+"Start"),i=n.end,a=n.span;l=i}}),o.on("panmove",function(e){t.lastPoint=t.currentPoint||t.startPoint,t.currentPoint={x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY},v=v.then(function(e){return s.then(function(e){if(0!==e.length||t.currentPoint){var i=t.eraserCircle.getEraseWidth();return t.erase(n,e,t.currentPoint,i)}})})}),o.on("panend",function(n){var i=document.getElementById("eraser");if(i&&i.remove(),v.then(function(n){var i=[],a=[];for(var r in t.eraseInkList){var o=t.allInkList[r],s=t.eraseInkList[r];o.isRemove=s.isRemove,i.push(o),a.push(s)}e.pdfViewer.eventEmitter.emit(br.eraserSuccess,i,a);var c=Object.keys(t.eraseInkList).map(function(e){return t.eraseInkList[e]}).filter(function(e){return!e.isRemove}).map(function(e){return e.annot.exportToJSON()});t.pdfViewer.collaborate(vr.UPDATE_ANNOT,{annots:c})}),p){var a=p.startChildSpan(t.constructor.getStateName()+"End"),r=a.end,o=a.span;u=r}null==u||u(),null==l||l(),null==c||c()})}),[2]})}).call(this)}},{key:"erase",value:function(e,t,n){return we(function(e,t,n){var i,a,r,o,s,c,l,u,d,h,f,p,v,g=arguments;return Ae(this,function(m){switch(m.label){case 0:return i=this,a=g.length>3&&void 0!==g[3]?g[3]:yr,r=this.pdfViewer,o=this.pageRender,s=o.getScale(),c=o.getRotation(),l=w(e.reverseDevicePoint([n.x,n.y],s,c),2),u=l[0],d=l[1],h={x:u,y:d},f=function(e,t){return we(function(){var n;return Ae(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(t))];case 1:return n=i.sent(),[2,e.filter(function(e,t){return n[t]})]}})})()},[4,f(t,function(e){return we(function(){var t;return Ae(this,function(n){switch(n.label){case 0:return t=e.getRect(),[4,this.pdfViewer.getAnnotAuthorityManager()];case 1:return[4,n.sent().getPermission(e)];case 2:return n.sent().isModifiable()?[2,(i=t,a=h,r=a.x>=i.left&&a.x<=i.right,o=a.y>=i.bottom&&a.y<=i.top,r&&o)]:[2,null]}var i,a,r,o})}).call(i)})];case 1:return p=m.sent(),v=p.map(function(e){var t=function(){var t,n=e.getInkList(),i=new kr(a/2).erase(n.map(function(e){return new Rr(e.x,e.y,e.type)}),new Rr(u,d)).reduceRight(function(e,t){var n=e[0];return n&&n.type===Cr.MOVE_TO&&n.type===t.type||e.unshift(t),e},[]),s=(t=i,t.reduce(function(e,t){return t.type===Cr.MOVE_TO&&e.push([]),e[e.length-1].push(t),e},[])).filter(function(e){if(e.length<1)return!1;var t=e[0],n=0;return e.forEach(function(e){n+=e.distanceTo(t),t=e}),n>.01});if(0!==s.length){var c=s.reduce(function(e,t){return e.concat(t)},[]);return e.setInkList(c)}var l=o.getAnnotRender(e.getId());if(l){var h=l.component.annot;return h.getPDFPage().removeAnnot(h).then(function(){r.collaborate(vr.REMOVE_ANNOT,[{annotId:h.getUniqueID(),pageIndex:o.index}])})}Pr.debug("annotRender === undefined",l,s,i)};return e.$$lastErasePromise=(e.$$lastErasePromise||Promise.resolve()).then(t,t).then(function(t){var n=o.getAnnotRender(e.getId());return i.eraseInkList[e.getId()]={annot:e,inkList:e.getInkList(),isRemove:!n},t})}),[2,Promise.all(v)]}})}).apply(this,arguments)}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.eraserCircle.destroy()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return"eraser"}},{key:"getStateHandlerName",value:function(){return"eraserStateHandler"}}]),t}(xr);const _r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";e.endsWith("/")||(e+="/"),t=t.replace(/(\w*?)-(\w*)/,function(e,t,n){return t+"-"+n.toUpperCase()});return function(n,i,a){var r;return $e(r={},a,{Approved:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Approved.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Received.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Confidential.pdf"),fileType:"pdf"}}),$e(r,i,{Accepted:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Accepted.pdf"),fileType:"pdf"},Witness:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Witness.pdf"),fileType:"pdf"},SignHere:{url:"".concat(e,"stamps/").concat(t,"/SignHere/SignHere.pdf"),fileType:"pdf"},Rejected:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Rejected.pdf"),fileType:"pdf"},Initial:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Initial.pdf"),fileType:"pdf"}}),$e(r,n,{Approved:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Approved.pdf"),fileType:"pdf"},Void:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Void.pdf"),fileType:"pdf"},Verified:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Verified.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Received.pdf"),fileType:"pdf"},Final:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Final.pdf"),fileType:"pdf"},Expired:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Expired.pdf"),fileType:"pdf"},Emergency:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Emergency.pdf"),fileType:"pdf"},Draft:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Draft.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Confidential.pdf"),fileType:"pdf"},Completed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Completed.pdf"),fileType:"pdf"}}),r}.apply(undefined,m(["Static","SignHere","Dynamic"]))};var Dr=A.DeviceInfo,Mr=A.PDFViewer,Vr=A.shared.Store;var Lr,Nr=function(){function e(){c(this,e),$e(this,"pdfViewer",void 0),$e(this,"currentStamp",void 0),$e(this,"currentPreviewerImg",void 0),$e(this,"customStamps",{}),$e(this,"defaultStamps",{}),$e(this,"initAnnotationIcons",{}),$e(this,"store",new Vr),$e(this,"lastKey",void 0),$e(this,"defaultStampRewrited",!1);var t=document.createElement("img");t.draggable=!1,t.style.cssText="position: absolute;opacity:0.5;pointer-events:none;",this.currentPreviewerImg=t}return u(e,[{key:"setCurrentStamp",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,s=this.currentStamp,c=this.currentStamp=this.getStampIcon(e,t,i,a,r,o);if(!c)throw new Error("Stamp not found: category: ".concat(e,", name: ").concat(t));this.currentPreviewerImg.src=c.showUrl||"",Promise.resolve().then(function(){n.store.dispatch("switch-stamp-icon",{current:n.currentStamp,last:s})})}},{key:"onSwitchStamp",value:function(e){return this.store.subscribe("switch-stamp-icon",function(t){e(t.current,t.last)})}},{key:"getCurrentStampConfig",value:function(){return this.currentStamp}},{key:"getPreviewerImage",value:function(){return this.currentPreviewerImg}},{key:"setInitAnnotationIcons",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initAnnotationIcons=e}},{key:"setDefaultStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.defaultStamps=e,this.defaultStampRewrited=!0,this.store.dispatch("default-stamps-updated",e)}},{key:"setCustomStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.customStamps=e,this.store.dispatch("custom-stamps-updated",e)}},{key:"updateDefaultStamps",value:function(e,t){if(!this.defaultStampRewrited){var n=this.pdfViewer.libPath,i=this.pdfViewer.getCurrentLanguage(),a=n+i;if(this.lastKey!==a){this.lastKey=a;var r=_r(n,i);if(e){var o=e.category,s=e.name;r[o]=r[o]||{},r[o][s]=e}if(t){var c=t.category,l=t.name;r[c]&&(delete r[c][l],0===Object.keys(r[c]).length&&delete r[c])}this.defaultStamps=r,this.store.dispatch("default-stamps-updated",r)}}}},{key:"getDefaultStamps",value:function(){return this.defaultStamps}},{key:"getCustomStamps",value:function(){return this.customStamps}},{key:"getFavoriteStamps",value:function(){var e=function(e){var n,r,s=t[e].split("."),c=s[0],l=s[1],u=s[2],d=s[s.length-1],h=!1;if(d.includes("__sPage__")){h=!0;var f=d.split("__");c=f[0],l=f[1],u=d}var p={},v=void 0;if(null==i||null===(r=i[c])||void 0===r||null===(n=r[l])||void 0===n?void 0:n.url)v=i[c][l].url,o[c+"-"+l]=mn({fileType:"pdf",url:v},p);else{var g,m=null==a||null===(g=a[c])||void 0===g?void 0:g[l];if(m||a[c]&&"length"in a[c]&&(m=a[c].find(function(e){var t=e.index.split("__"),n=t[t.length-1],i=u.split("__");return n===i[i.length-1]&&t[0]===i[0]})),!m)return"continue";if(Array.isArray(m)){var y=m.find(function(e){return e.index==u});v=y.url,p.width=y.width,p.height=y.height,p.fileType=y.fileType,h&&(p.isImportPDFStamp=y.isImportPDFStamp,p.blob=y.blob,p.pageIndex=y.index)}else v=m.url,p.width=m.width,p.height=m.height,p.fileType=m.fileType,h&&(p.isImportPDFStamp=m.isImportPDFStamp,p.blob=m.blob,p.pageIndex=m.pageIndex);if(!v)return"continue";o[c+"-"+l+"-"+u]=mn({fileType:"pdf",url:v},p)}};this.updateDefaultStamps();var t=this.pdfViewer.getDeprecatedStorage().getItem("FAVORITE-STAMPS-LIST"),n=this.pdfViewer.customs.stampManager;n&&(t=n.getFavoriteStamps());var i=this.getDefaultStamps(),a=this.getCustomStamps(),r=Object.assign({},i);if(!t)return r;if(0===t.length)return r;for(var o={},s=0;s<t.length;s++)e(s);return r.Favorite=o,r}},{key:"getStampIcon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,o=this.defaultStamps[e]&&this.defaultStamps[e][t];Array.isArray(o)&&(o=o.find(function(e){return e.index===n}));var s=this.customStamps[e];if(!o&&s){var c=s[t];o=Array.isArray(c)?c.find(function(e){return e.index==n}):c}if(!o){var l=this.getFavoriteStamps()[e];if(l){var u=l[t];o=Array.isArray(u)?u.find(function(e){return e.index==n}):u}}if(o=o||i){var d=o.width||a,h=o.height||r,f=o.showUrl||o.url;if(!Dr.isTouchDevice&&["pdf","tif","tiff"].includes(o.fileType)){f=f.replace(/\.(pdf|tif|tiff)$/,".svg");var p=new XMLHttpRequest;p.open("get",f),p.send()}return!("index"in o)&&"pageIndex"in o&&(o.index=o.pageIndex),Object.assign({},o,{width:d,height:h,showUrl:f,category:e,name:t})}}},{key:"clearCustomStamps",value:function(){this.customStamps={}}},{key:"addAnnotationIcon",value:function(e){return we(function(){var t,n;return Ae(this,function(i){return t=e.category,n=e.name,t in this.customStamps||(this.customStamps[t]={leaf:1}),this.customStamps[t][n]=[e],this.store.dispatch("custom-stamps-added",this.customStamps,e),this.store.dispatch("custom-stamps-updated",this.customStamps),[2]})}).call(this)}},{key:"removeAnnotationIcon",value:function(e){this.removeIcon(this.initAnnotationIcons,e),this.removeIcon(this.defaultStamps,e)?this.store.dispatch("default-stamps-removed",this.defaultStamps,e):this.removeIcon(this.customStamps,e)&&(this.store.dispatch("custom-stamps-updated",this.customStamps),this.store.dispatch("custom-stamps-removed",this.customStamps,e))}},{key:"onCustomStampRemoved",value:function(e){return this.store.subscribe("custom-stamps-removed",e)}},{key:"onCustomStampUpdated",value:function(e){return this.store.subscribe("custom-stamps-updated",e)}},{key:"onCustomStampAdded",value:function(e){return this.store.subscribe("custom-stamps-added",e)}},{key:"onDefaultStampRemoved",value:function(e){return this.store.subscribe("default-stamps-removed",e)}},{key:"onDefaultStampUpdated",value:function(e){return this.store.subscribe("default-stamps-updated",e)}},{key:"removeIcon",value:function(e,t){var n,i=t.category,a=t.name,r=t.index;for(var o in e){var s=e[o];for(var c in s){var l=s[c];if(a){if(i==o&&c==a){if(Array.isArray(l)){if(void 0===r){delete s[c],n=!0;continue}s[c]=l.reduce(function(e,t,n){return r.length>1&&r==t.index||n+""==r||e.push(t),e},[]);var u=s[c];Array.isArray(u)&&(u.length||delete s[c])}else delete s[c];n=!0}}else i?o==i&&(delete s[c],n=!0):delete s[c]}Object.values(s).some(function(e){return Array.isArray(e)||"[object Object]"===Object.prototype.toString.call(e)})||delete e[o]}return n}}],[{key:"inject",value:function(){return{pdfViewer:Mr}}}]),e}(),Hr=A.stateHandler,Or=A.ViewerEvents,Fr=A.vendors,Ur=(Fr.jQuery,Fr.Hammer),jr=Hr.IStateHandler,Br=Hr.StateHandlerConsts.STATE_HANDLER_CREATE_STAMP,Xr=A.shared,Yr=Xr.getClientX,$r=Xr.getClientY,Gr=A.DeviceInfo.isTouchDevice,zr=function(e){function t(e){return c(this,t),a(this,t,[e])}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler,a=e.pdfViewer;i.addClass("fv__create-stamp-state-handler");var r,o,s=!1,c=i[0],l=this.hammer=new Ur.Manager(c,{recognizers:[[Ur.Tap]]}),u=a.getIoC().getInstanceByClass(Nr),d=u.getPreviewerImage();function h(t){var n=u.getCurrentStampConfig(),a=c.getBoundingClientRect(),r=t.clientX-a.left,o=t.clientY-a.top;Gr||(d.style.cssText+="\n                    transform: scale(".concat(e.getScale(),");\n                    top: ").concat(o-2*n.height/3,"px;\n                    left: ").concat(r-2*n.width/3,"px;\n                "),d.style.display="",i.append(d))}this.previewStampImg=d,a.getStore().subscribe("switchStampEvent",function(e){h(e)}),this.addEvent(i,"mousemove",function(e){s||h(e)});var f=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,p=f.startSDKSpan,v=f.otelService;l.on("tap",function(t){if(!s){var i=c.getBoundingClientRect(),l=t.srcEvent,h="",f=Yr(l),g=$r(l),m=[f-i.left,g-i.top],y=m[0],S=m[1];s=!0;var w=u.getCurrentStampConfig(),A=w.width,b=w.height,E=w.category,k=w.name,R=w.fileType,x=w.url,C=w.field,T=w.blob,P=w.index,I=w.isImportPDFStamp;return p&&p(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;r=t,o=n}),e.getPDFPage().then(function(t){var n=2*A/3*e.scale,i=2*b/3*e.scale,a={left:y-n,right:y+n,top:S-i,bottom:S+i};a=t.reverseDeviceRect(a,e.scale,e.getRotation());var r={rotation:(360-(90*t.getRotation()+e.getRotation()))%360,type:"stamp",flags:4,rect:a,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Stamp"),iconInfo:{category:E,name:k,fileType:R,url:x,field:C,stampPdfBlob:T,isImportPDFStamp:I,pageIndex:P}};return Object.assign(r,e.pdfViewer.getDefaultAnnotConfig()("stamp")||{}),t.addAnnot(r)}).then(function(t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;return h=n,e.pdfViewer.eventEmitter.emit(Or.addAnnotSuccess,n.annot),n}).then(function(t){return e.pdfViewer.getStateHandlerManager().switchTo(),t.getRenderPromise().finally(function(){setTimeout(function(){d.style.cssText+="\n                                    display: none;\n                                    opacity: 0.5;\n                                "},500),d.style.opacity=1}),s=!1,a.activeElement(t),a.config.showCommentList?(h.showReplyDialog(),t):t}).catch(function(e){null==v||v.setSpanException(o,e),s=!1,d.style.cssText+="\n                        display: none;\n                        opacity: 0.5;\n                    "}).finally(function(){null==r||r()})}})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler");var e=this.previewStampImg;e.parentElement&&e.parentElement.removeChild(e),this.destroyList.map(function(e){var t=w(e,3),n=t[0],i=t[1],a=t[2];n.off(i,a)})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addEvent",value:function(e,t,n){this.destroyList=this.destroyList||[],e.on(t,n),this.destroyList.push([e,t,n])}}],[{key:"getStateName",value:function(){return Br}},{key:"setParams",value:function(e,t){var n=e.category,i=e.name,a=e.index,r=t.getIoC().getInstanceByClass(Nr);try{e.url&&e.fileType?r.setCurrentStamp(n,i,a,e):r.setCurrentStamp(n,i,a,void 0)}catch(e){return console.error(e),void Promise.resolve().then(function(){t.getStateHandlerManager().switchTo()})}var o=r.getPreviewerImage(),s=r.getCurrentStampConfig(),c=s.width,l=s.height,u=s.showUrl;Gr||(o.style.cssText+="\n                width: ".concat(4*c/3,"px;\n                height: ").concat(4*l/3,"px;\n            "),o.src=u,"pdf"==s.fileType&&setTimeout(function(){t.previewIconDoc(s).then(function(e){o.parentElement&&(o.src=URL.createObjectURL(e))})},100))}}]),t}(jr),Wr=A.stateHandler,qr=A.ViewerEvents,Kr=Wr.IStateHandler,Jr=Wr.HandStateHandler,Zr=A.vendors,Qr=Zr.Hammer,eo=Zr.jQuery,to=A.shared,no=(to.DebouncePromiseQueue,to.getClientX),io=to.getClientY,ao=Wr.StateHandlerUtils,ro=(ao.getDevicePagePoint,ao.deltaDeviceRect,ao.appendSelectMark,ao.removeSelectMark,Wr.StateHandlerConsts.STATE_HANDLER_CREATE_FILE_ATTACHMENT),oo=function(e){function t(e){var n;return c(this,t),(n=a(this,t,[e])).cursorStyle="fv__cursor-file",n}return f(t,e),u(t,[{key:"pageHandler",value:function(e){var t,n=this;this.pageRender=e;var i=e.$handler;i.addClass(this.cursorStyle);var a=eo('<input id="fileAttachment" type="file" style="display: none;"/>');this.$fileAttachment=a,i.append(a);var r,o,s=i[0],c=this.hammer=new Qr.Manager(s,{recognizers:[[Qr.Tap]]}),l=((null===(t=this.pdfViewer.viewerUI.rootComponent)||void 0===t?void 0:t.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,d=l.otelService;c.on("tap",function(t){var i=s.getBoundingClientRect(),c=t.srcEvent,l=no(c),h=io(c),f=[l-i.left,h-i.top],p=f[0],v=f[1],g=e.pdfViewer;u&&u(n.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;r=t,o=n}),a.off("change").on("change",function(t){var n=t.target.files[0];if(n&&!(g.customs&&g.customs.isAttachFileOverSize&&g.customs.isAttachFileOverSize(n)))if(n.size>268435456)g.viewerUI.confirm({message:"sidebar.attachment.addAttachmentSizeLimit",level:"warning"});else{if(!(["exe"].indexOf(n.name.split(".")[1])>=0))return e.getPDFPage().then(function(t){var i=new FileReader,a=w(t.reverseDevicePoint([p,v],e.scale,e.getRotation()),2),s=a[0],c=a[1];i.readAsArrayBuffer(n),i.onload=function(){var a=new Uint8Array(i.result);t.addAnnot({flags:28,type:"fileattachment",rect:{left:s,right:s+20,top:c,bottom:c-24},buffer:a,fileName:n.name,file:n,subject:g.i18n.t("viewer_:annotSubjects.File")}).then(function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;g.eventEmitter.emit(qr.addAnnotSuccess,i.annot),g.getStateHandlerManager().switchTo(Jr.getStateName()),e.annotsRender.activeAnnot(n.getId())}).catch(function(e){throw null==d||d.setSpanException(o,e),e}).finally(function(){null==r||r()})}});g.viewerUI.confirm({message:"sidebar.attachment.addAttachmentFileFormat",level:"warning"})}}),a.click()})}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.$fileAttachment.remove()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return ro}}]),t}(Kr),so=function(e){return e.STATE_HANDLER_HAND="hand",e.STATE_HANDLER_CHECK_THE_SEARCH="checkTheSearch",e.STATE_HANDLER_CREATE_CARET="createCaret",e.STATE_HANDLER_CREATE_ARROW="createArrow",e.STATE_HANDLER_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CIRCLE="createCircle",e.STATE_HANDLER_CREATE_FILE_ATTACHMENT="createFileAttachment",e.STATE_HANDLER_CREATE_HIGHLIGHT="createHighlight",e.STATE_HANDLER_CREATE_IMAGE="createImage",e.STATE_HANDLER_CREATE_LINK="createLink",e.STATE_HANDLER_CREATE_LINE="createLine",e.STATE_HANDLER_CREATE_DISTANCE="createDistance",e.STATE_HANDLER_CREATE_PERIMETER="createPerimeter",e.STATE_HANDLER_CREATE_AREA="createArea",e.STATE_HANDLER_CREATE_CIRCLE_AREA="createCircleArea",e.STATE_HANDLER_CREATE_PENCIL="createPencil",e.STATE_HANDLER_CREATE_POLYGON_CLOUD="createPolygonCloud",e.STATE_HANDLER_CREATE_POLYGON="createPolygon",e.STATE_HANDLER_CREATE_POLYLINE="createPolyline",e.STATE_HANDLER_CREATE_REPLACE="createReplace",e.STATE_HANDLER_CREATE_SQUARE="createSquare",e.STATE_HANDLER_CREATE_SQUIGGLY="createSquiggly",e.STATE_HANDLER_CREATE_STAMP="createStamp",e.STATE_HANDLER_CREATE_STRIKE_OUT="createStrikeOut",e.STATE_HANDLER_CREATE_TEXT="createText",e.STATE_HANDLER_CREATE_UNDERLINE="createUnderline",e.STATE_HANDLER_MARQUEE="marquee",e.STATE_HANDLER_ERASER="eraser",e.STATE_HANDLER_LOUPE="loupe",e.STATE_HANDLER_SELECT_TEXT_ANNOTATION="select-text-annotation",e.STATE_HANDLER_SELECT_TEXT_IMAGE="select-text-image",e.STATE_HANDLER_SELECT_ANNOTATION="select-annotation",e.STATE_HANDLER_CREATE_FREETEXT_BOX="createFreeTextBox",e.STATE_HANDLER_CREATE_FREETEXT_CALLOUT="createFreeTextCallout",e.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER="createFreeTextTypewriter",e.STATE_HANDLER_CREATE_FIELD_TEXT="CreateTextStateHandler",e.STATE_HANDLER_CREATE_FIELD_SIGNATURE="CreateSignStateHandler",e.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON="CreatePushButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_CHECK_BOX="CreateCheckBoxStateHandler",e.STATE_HANDLER_CREATE_RADIO_BUTTON="CreateRadioButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_COMBO_BOX="CreateComboBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_LIST_BOX="CreateListBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_DATE="CreateDateStateHandler",e.STATE_HANDLER_CREATE_FIELD_IMAGE="CreateImageStateHandler",e.STATE_HANDLER_SNAPSHOT_TOOL="snapshot-tool",e.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT="createDocumentAttachment",e}({}),co="userSpaceUnit",lo="userSpaceScaleValue",uo="realUnit",ho="realScaleValue",fo=($e(Lr={},so.STATE_HANDLER_CREATE_PERIMETER,"perimeter"),$e(Lr,so.STATE_HANDLER_CREATE_DISTANCE,"distance"),$e(Lr,so.STATE_HANDLER_CREATE_AREA,"area"),$e(Lr,so.STATE_HANDLER_CREATE_CIRCLE_AREA,"area"),function(e){function t(e,n){var i;return c(this,t),(i=a(this,t,[e])).target=n,i}return f(t,e),u(t,[{key:"init",value:function(){var e,t,n,i,a=this,r=function(n){if(0===n.button)if(a.isStarted){if(a.isStarted){i=null,a.isStarted=!1;var r=n.clientX-e,o=n.clientY-t;a.emit("end",{deltaX:r,deltaY:o,srcEvent:n})}}else i=a.target.getBoundingClientRect(),a.isStarted=!0,e=n.clientX,t=n.clientY,a.emit("start",{deltaX:0,deltaY:0,srcEvent:n})},o=function(i){if(!a.isLocked)if(a.isStarted){var r=i.clientX-e,o=i.clientY-t;a.emit("move",n={deltaX:r,deltaY:o,srcEvent:i})}else{var s=a.target.getBoundingClientRect(),c=i.clientX-s.left,l=i.clientY-s.top;a.emit("mousemove",{x:c,y:l})}},s=function(n){if(a.isStarted&&!a.isDestroyed&&!a.isLocked&&i){var r=a.target.getBoundingClientRect(),o=e-i.left,s=t-i.top,c=r.width/i.width;e=r.left+o*c,t=r.top+s*c,i=r}};window.addEventListener("scroll",s,!0),this.target.addEventListener("mousedown",r),document.addEventListener("mousemove",o,!0);var c=this.pdfViewer.getStore().subscribe("create-measurement-status",function(e){switch(e){case"complete":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("end",n));break;case"cancel":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("cancel"))}});this.addDestroyHook(function(){a.target.removeEventListener("mousedown",r),document.removeEventListener("mousemove",o),c(),window.removeEventListener("scroll",s,!0)})}}]),t}(Gn)),po=A.stateHandler.CreateMeasurementService,vo=[],go=A.ViewerEvents,mo=A.DeviceInfo.isTouchDevice,yo=A.Consts,So=yo.LineEndingStyle,wo=yo.Intents,Ao=yo.CREATING_MEASUREMENT_CONTEXTMENU,bo=A.shared.ThrottleAsyncTaskExecutor,Eo=A.commons.isSamePoint,ko=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e,So.OpenArrow,So.OpenArrow])).isEnd=!0,t.executor=new bo(20,!0),t}return f(n,t),u(n,[{key:"createInteractionTool",value:function(t,i){return mo?d(e(n.prototype),"createInteractionTool",this).call(this,t,i):new fo(this.pdfViewer,t)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(po).getMeasurementInfo();return{unit:e[uo].name,ratio:{userSpaceValue:e[lo],userSpaceUnit:e[co].name,realValue:e[ho],realUnit:e[uo].name}}}},{key:"createAnnotJson",value:function(e){return e.intent=wo.LINE_DIMENSION,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineDimension")),e}},{key:"pageHandler",value:function(t){var i,a=this;d(e(n.prototype),"pageHandler",this).call(this,t),this.destroyPageHooks=[];var r=this.pdfViewer.viewerUI.createContextMenu(Ao,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){a.interaction.unlock(),a.interaction.emit("end",i)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){a.interaction.unlock(),a.interaction.emit("cancel")}}}}),o=this.pdfViewer.getIoC().getInstanceByClass(Yi),s=r.getItem("complete");r.disable(),this.creatingContextmenu=r,this.interaction.on("start",function(){o.isCreating?a.interaction.cancel():(o.setCreating(a.pageRender.index),a.isEnd=!1,r.enable())}),this.interaction.on("end",function(){o.creatingEnd(),a.isEnd=!0,r.disable()}),this.interaction.on("cancel",function(){o.creatingEnd(),r.disable()}),this.interaction.on("move",function(e){i=e}),r.onHidden(function(){a.interaction.unlock()}),r.onShown(function(){a.interaction.lock(),s.enable()}),this.destroyPageHooks.push(this.pdfViewer.addEventListener(go.zoomToSuccess,function(e){Tn(vo)}),this.pdfViewer.addEventListener(go.changeViewModeSuccess,function(e,t){Tn(vo)}),this.pdfViewer.addEventListener(go.fitWidthResizeViewport,function(){Tn(vo)}))}},{key:"start",value:function(t,i){var a=this;Tn(vo);var r=d(e(n.prototype),"start",this).call(this,t,i,"Distance");return this.pdfViewer.eventEmitter.emit(go.distanceAnnotCreationStart,r),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",function(e){var t=xn(a.pdfViewer),n=It(e.displayUnit.name)?a.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;r.setContent(t+Math.round(100*e.distance)/100+" "+n),r.draw()}),r}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec(function(){return n.getSnappedPoint(t).then(function(i){Eo(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),n.pdfViewer.eventEmitter.emit(go.updateDistanceAnnot,e),e.setEndPoint(i),e.draw()})})}},{key:"end",value:function(){var t=this;this.fakeAnnotation&&this.fakeAnnotation.annotationInfo.content&&(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.executor.waitForLastTask().then(function(){var i=t.fakeAnnotation.annotationInfo,a=i.startPoint,r=i.endPoint;if(Eo(a,r))return Promise.resolve();Cn(t.pdfViewer).markup?(t.fakeAnnotation.annotationInfo.measure=t.getMeasurementInfo(),t.pdfViewer.eventEmitter.emit(go.distanceAnnotCreationEnd,t.fakeAnnotation),d(e(n.prototype),"end",t).call(t)):(t.fakeAnnotation.renderer.setMarkUp(t.pageRender.scale,t.pageRender.rotate),vo.push(t.fakeAnnotation));return Promise.resolve()}))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(Yi).creatingEnd(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(go.distanceAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),this.creatingContextmenu&&this.creatingContextmenu.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach(function(e){return e()}),Tn(vo),d(e(n.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createDistance"}}]),n}(Si),Ro=function(e){function t(e,n){var i;return c(this,t),(i=a(this,t,[e,n,"create-measurement-status"])).target=n,i}return f(t,e),t}(Xi),xo=A.stateHandler.CreateMeasurementService,Co=[],To=A.ViewerEvents,Po=(A.DeviceInfo.isTouchDevice,A.Consts),Io=Po.LineEndingStyle,_o=Po.Intents,Do=Po.CREATING_MEASUREMENT_CONTEXTMENU,Mo=(A.shared.ThrottleAsyncTaskExecutor,function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).isEnd=!0,t}return f(n,t),u(n,[{key:"createInteractionTool",value:function(e){return new Ro(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(xo).getMeasurementInfo();return{unit:e[uo].name,ratio:{userSpaceValue:e[lo],userSpaceUnit:e[co].name,realValue:e[ho],realUnit:e[uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polyline",_o.POLYLINE_DIMENSION);return e.intent=_o.POLYLINE_DIMENSION,e.startStyle=Io.OpenArrow,e.endStyle=Io.OpenArrow,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Perimeter"),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(t){var i,a,r,o,s,c=this;d(e(n.prototype),"pageHandler",this).call(this,t),this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Do,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){c.interaction.unlock(),c.interaction.emit("end",a)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){c.interaction.unlock(),c.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var l=((null===(i=this.pdfViewer.viewerUI.rootComponent)||void 0===i?void 0:i.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,h=l.otelService;this.interaction.on("start",function(){if(c.isEnd=!1,c.contextmenu.enable(),c.completeMenuItem.disable(),Tn(Co),c.pdfViewer.eventEmitter.emit(To.perimeterAnnotCreationStart,c.fakeAnnotation),u&&u(c.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;r=t}),h){var e=h.startChildSpan(c.constructor.getStateName()+"Start"),t=e.end,n=e.span;o=t}}),this.interaction.on("end",function(){if(h){var e=h.startChildSpan(c.constructor.getStateName()+"End"),t=e.end,n=e.span;s=t}null==s||s(),null==o||o(),null==r||r()}),this.interaction.on("cancel",function(){c.contextmenu.disable()}),this.interaction.on("move",function(e){a=e}),this.contextmenu.onHidden(function(){c.interaction.unlock()}),this.contextmenu.onShown(function(){c.interaction.lock(),c.fakeAnnotation.getVertexes().length>=3?c.completeMenuItem.enable():c.completeMenuItem.disable()}),this.destroyPageHooks.push(this.pdfViewer.addEventListener(To.zoomToSuccess,function(e){Tn(Co)}),this.pdfViewer.addEventListener(To.changeViewModeSuccess,function(e,t){Tn(Co)}),this.pdfViewer.addEventListener(To.fitWidthResizeViewport,function(){Tn(Co)}))}},{key:"create",value:function(t,i){var a=this,r=d(e(n.prototype),"create",this).call(this,t,i);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",function(e){var t=xn(a.pdfViewer),n=It(e.displayUnit.name)?a.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;r.setContent(t+Math.round(100*e.perimeter)/100+" "+n),r.draw()}),r}},{key:"adjust",value:function(e,t){t=this.autoAdsorbToStartPoint(e,t)[1],e.setLastPoint(t.deviceX,t.deviceY),this.pdfViewer.eventEmitter.emit(To.updateDistanceAnnot,e),e.draw()}},{key:"canBeCompleted",value:function(e){if(!e)return!1;var t=e.getVertexes();if(0==t.length)return!1;var n=e.getLastPoint();return!(1==t.length&&n&&Math.abs(t[0].x-n.x)<Number.EPSILON&&Math.abs(t[0].y-n.y)<Number.EPSILON)}},{key:"end",value:function(t,i){if(this.fakeAnnotation){if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.fakeAnnotation.getVertexes().length<2)return-1;if(i=this.autoAdsorbToStartPoint(t,i)[1],this.isEnd=!0,this.contextmenu.disable(),Cn(this.pdfViewer).markup)this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(To.distanceAnnotCreationEnd,this.fakeAnnotation),t.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,d(e(n.prototype),"end",this).call(this,t,i);else this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),Co.push(this.fakeAnnotation)}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(To.distanceAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),Tn(Co),d(e(n.prototype),"destroyPageHandler",this).call(this)}},{key:"autoAdsorbToStartPoint",value:function(e,t){var n=!1,i=e.deviceVertexes;if(i.length>2){var a=i[0],r=Math.abs(t.deviceX-a.x),o=Math.abs(t.deviceY-a.y),s=Math.max(r,o);s*s<200&&(n=!0,t={deviceX:a.x,deviceY:a.y})}return[n,t]}},{key:"addPoint",value:function(t,i){var a=this.autoAdsorbToStartPoint(t,i);if(a[0])return this.interaction.cancel(),this.interaction.unlock(),this.interaction.lastMoveData=null,void this.end(t,a[1]);d(e(n.prototype),"addPoint",this).call(this,t,i)}}],[{key:"getStateName",value:function(){return"createPerimeter"}}]),n}(_a)),Vo=function(e){function t(e,n){var i;return c(this,t),(i=a(this,t,[e,n,"create-measurement-status"])).target=n,i}return f(t,e),t}(Xi),Lo=A.stateHandler.CreateMeasurementService,No=[],Ho=A.ViewerEvents,Oo=A.Consts,Fo=Oo.Intents,Uo=Oo.CREATING_MEASUREMENT_CONTEXTMENU,jo=Oo.DISTANCE_TOLERANCE,Bo=Oo.POINT_TOLERANCE;function Xo(e,t){return e.x===t.x&&e.y===t.y}function Yo(e,t){return e.x*t.y-e.y*t.x}function $o(e,t,n,i){var a=Yo({x:i.x-n.x,y:i.y-n.y},{x:e.x-n.x,y:e.y-n.y}),r=Yo({x:i.x-n.x,y:i.y-n.y},{x:t.x-n.x,y:t.y-n.y}),o=Yo({x:t.x-e.x,y:t.y-e.y},{x:n.x-e.x,y:n.y-e.y}),s=Yo({x:t.x-e.x,y:t.y-e.y},{x:i.x-e.x,y:i.y-e.y});return(a>0&&r<0||a<0&&r>0)&&(o>0&&s<0||o<0&&s>0)||!!(0===a&&Xo(e,n)||0===r&&Xo(e,i)||0===o&&Xo(t,n)||0===s&&Xo(t,i))}var Go=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).isEnd=!0,t}return f(n,t),u(n,[{key:"createInteractionTool",value:function(e){return new Vo(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(Lo).getMeasurementInfo();return{unit:e[uo].name,ratio:{userSpaceValue:e[lo],userSpaceUnit:e[co].name,realValue:e[ho],realUnit:e[uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polygon",Fo.POLYGON_DIMENSION);return e.enableCaption=!0,e.intent=Fo.POLYGON_DIMENSION,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Area"),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(t){var i,a,r,o,s,c=this;d(e(n.prototype),"pageHandler",this).call(this,t),this.destroyPageHooks=[],this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Uo,t.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){c.interaction.unlock(),c.interaction.emit("end",a)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){c.interaction.unlock(),c.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu;var l=((null===(i=this.pdfViewer.viewerUI.rootComponent)||void 0===i?void 0:i.pdfUI)||{customs:{}}).customs,u=l.startSDKSpan,h=l.otelService;this.interaction.on("start",function(){if(c.isEnd=!1,c.contextmenu.enable(),c.completeMenuItem.disable(),Tn(No),u&&u(c.constructor.getStateName()).then(function(e){var t=e.end,n=e.span;r=t}),h){var e=h.startChildSpan(c.constructor.getStateName()+"Start"),t=e.end,n=e.span;o=t}}),this.interaction.on("end",function(){if(h){var e=h.startChildSpan(c.constructor.getStateName()+"End"),t=e.end,n=e.span;s=t}null==s||s(),null==o||o(),null==r||r()}),this.interaction.on("cancel",function(){c.contextmenu.disable()}),this.interaction.on("move",function(e){a=e,c.fakeAnnotation&&c.fakeAnnotation.renderer&&(c.fakeAnnotation.renderer.closing=!0)}),this.contextmenu.onHidden(function(){c.interaction.unlock()}),this.contextmenu.onShown(function(){c.interaction.lock(),c.fakeAnnotation.getVertexes().length>=2?c.completeMenuItem.enable():c.completeMenuItem.disable()}),this.destroyPageHooks.push(this.pdfViewer.addEventListener(Ho.zoomToSuccess,function(e){Tn(No)}),this.pdfViewer.addEventListener(Ho.changeViewModeSuccess,function(e,t){Tn(No)}),this.pdfViewer.addEventListener(Ho.fitWidthResizeViewport,function(){Tn(No)}))}},{key:"create",value:function(t,i){var a=this,r=d(e(n.prototype),"create",this).call(this,t,i);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",function(e){var t=xn(a.pdfViewer),n=a.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name));r.setContent(t+Math.round(100*e.area)/100+" sq "+n),r.draw()}),r}},{key:"isPointClosely",value:function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}},{key:"pointDistance",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,a=Math.abs(n),r=Math.abs(i);return Math.sqrt(a*a+r*r)}},{key:"isPointOnLine",value:function(e,t,n){if(this.isPointClosely(e,t,Number.EPSILON)||this.isPointClosely(e,n,Number.EPSILON))return!0;var i=this.pointDistance(e,t),a=this.pointDistance(e,n),r=this.pointDistance(t,n);return Math.abs(i+a-r)<Bo}},{key:"checkLineCrossed",value:function(e,t,n,i){var a,r;if(a=Math.abs(t.x-e.x)<1e-4?Number.POSITIVE_INFINITY:(t.y-e.y)/(t.x-e.x),r=Math.abs(i.x-n.x)<1e-4?Number.POSITIVE_INFINITY:(i.y-n.y)/(i.x-n.x),Number.isFinite(a)&&Number.isFinite(r)&&Math.abs(a-r)<.01||!Number.isFinite(a)&&!Number.isFinite(r))return!(!this.isPointOnLine(e,n,i)&&!this.isPointOnLine(t,n,i));var o,s,c=e.x>t.x?t.x:e.x,l=e.x>t.x?e.x:t.x,u=n.x>i.x?i.x:n.x,d=n.x>i.x?n.x:i.x;if(Number.isFinite(a)){if(Number.isFinite(r))return!((o=(a*e.x-e.y-r*n.x+n.y)/(a-r))<c-Bo||o>l+Bo)&&(!(o<u-Bo||o>d+Bo)&&(s=a*(o-e.x)+e.y,!0));s=a*((o=u)-e.x)+e.y;var h=n.y<i.y?n.y:i.y,f=n.y<i.y?i.y:n.y;return h-Bo<=s&&s<=f+Bo&&c-Bo<=o&&o<=l+Bo}s=r*((o=c)-n.x)+n.y;var p=e.y<t.y?e.y:t.y,v=e.y<t.y?t.y:e.y;return p-Bo<=s&&s<=v+Bo&&u-Bo<=o&&o<=d+Bo}},{key:"checkIfPointAllowAdded",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<1&&!n)return!0;if(2==e.length&&!n)return!this.isPointOnLine(t,e[0],e[1]);var i=function(e,t){for(var n=0;n<e.length-2;n++)if($o(e[n],e[(n+1)%e.length],t,e[e.length-1]))return"disableAdd";for(var i=1;i<e.length-1;i++)if($o(e[i],e[(i+1)%e.length],t,e[0]))return"noClosing";return"success"}(e,t);return"success"==i?(this.fakeAnnotation.setFlag(!0,!0),!0):"noClosing"==i&&!n&&(this.fakeAnnotation.setFlag(!1,!1),!0)}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY,a=w(e.page.reverseDevicePoint([n,i],e.scale,e.rotate),2),r=a[0],o=a[1],s=this.pageRender.$handler;if(this.checkIfPointAllowAdded(e.getVertexes(),{x:r,y:o})){s.removeClass("fv__cursor-disable");var c=e.getVertexes();if(c.length>2&&this.isPointClosely(c[0],{x:r,y:o},jo)){var l=c[c.length-1],u=w(e.page.getDevicePoint([l.x,l.y],e.scale,e.rotate),2),d=u[0],h=u[1],f=e.pageRender.$handler[0].getBoundingClientRect();return this.interaction.lastMoveData={clientX:d+f.left,clientY:h+f.top},void this.pdfViewer.getStore().dispatch("create-measurement-status","complete")}e.addPoint(n,i),e.draw()}else s.addClass("fv__cursor-disable")}},{key:"adjust",value:function(e,t){var n=w(e.page.reverseDevicePoint([t.deviceX,t.deviceY],e.scale,e.rotate),2),i=n[0],a=n[1],r=this.pageRender.$handler;this.checkIfPointAllowAdded(e.getVertexes(),{x:i,y:a})?(r.removeClass("fv__cursor-disable"),e.setLastPoint(t.deviceX,t.deviceY),e.draw(),this.pdfViewer.eventEmitter.emit(Ho.updateDistanceAnnot,e)):r.addClass("fv__cursor-disable")}},{key:"end",value:function(t,i){if(this.fakeAnnotation){this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData();var a=oa(t.getVertexes()).slice(0);if(0!=a.length){if(null!=i){var r=w(t.page.reverseDevicePoint([i.deviceX,i.deviceY],t.scale,t.rotate),2),o=r[0],s=r[1];if(this.isPointClosely(a[a.length-1],{x:o,y:s},jo))i=null;else{var c=this.pageRender.$handler;if(!this.checkIfPointAllowAdded(a,{x:o,y:s},!0))return c.addClass("fv__cursor-disable"),-1;c.removeClass("fv__cursor-disable"),a.push({x:o,y:s})}}if(this.isEnd=!0,this.contextmenu.disable(),Cn(this.pdfViewer).markup){this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(Ho.distanceAnnotCreationEnd,this.fakeAnnotation);var l=this.pdfViewer.getStore().getCurrentValue("measurementData");if(l){var u=xn(this.pdfViewer),h=this.pdfViewer.i18n.t("measurement.units.".concat(l.displayUnit.name));t.setContent(u+Math.round(100*l.area)/100+" sq "+h)}t.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,d(e(n.prototype),"end",this).call(this,t,i)}else{this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),No.push(this.fakeAnnotation)}}}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(Ho.distanceAnnotCreationCancel,this.fakeAnnotation),d(e(n.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),Tn(No),d(e(n.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createArea"}}]),n}(Ea),zo=A.stateHandler.CreateMeasurementService,Wo=[],qo=A.ViewerEvents,Ko=A.Consts.Intents,Jo=function(t){function n(e){var t;return c(this,n),(t=a(this,n,[e])).isEnd=!0,t}return f(n,t),u(n,[{key:"start",value:function(e){var t=this,n={flags:4,subject:this.getSubject()};this.currentFakeAnnot=new _n({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson(n)});var i=e.left,a=e.top;this.currentFakeAnnot.setRect({left:i,top:a,right:i+10,bottom:a-10}),this.pdfViewer.eventEmitter.emit(qo.distanceAnnotCreationStart,this.currentFakeAnnot),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",function(e){var n=xn(t.pdfViewer),i=e.displayUnit,a=e.area,r=e.embeddedScale,o=i&&It(i.name)?t.pdfViewer.i18n.t("measurement.units.".concat(i.name)):i.name;a&&t.currentFakeAnnot.setContent(n+a.toFixed(2)+" sq "+o),r?t.pageMeasureRatio=r:delete t.pageMeasureRatio,t.currentFakeAnnot.draw()}),Tn(Wo)}},{key:"adjust",value:function(t,i,a){d(e(n.prototype),"adjust",this).call(this,t,i,a),this.pdfViewer.eventEmitter.emit(qo.updateDistanceAnnot,t)}},{key:"end",value:function(t,i,a){if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),Cn(this.pdfViewer).markup){if(t.annotationInfo.measure=this.getMeasurementInfo(),this.pageMeasureRatio){var r=this.pageMeasureRatio.split(" = ").map(function(e){var t=e.split(" ");return{value:t[0],unit:t[1]}});r.length<2||(t.annotationInfo.measure=Object.assign({},t.annotationInfo.measure,{ratio:{userSpaceValue:Number(r[0].value),realValue:Number(r[1].value),userSpaceUnit:r[0].unit,realUnit:r[1].unit}}))}this.pdfViewer.eventEmitter.emit(qo.distanceAnnotCreationEnd,t),d(e(n.prototype),"end",this).call(this,t,i,a)}else Wo.push(t)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(zo).getMeasurementInfo();return{unit:e[uo].name,ratio:{userSpaceValue:e[lo],userSpaceUnit:e[co].name,realValue:e[ho],realUnit:e[uo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("circle",Ko.CIRCLE_DIMENSION);return e.enableCaption=!0,e.intent=Ko.CIRCLE_DIMENSION,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(t){d(e(n.prototype),"pageHandler",this).call(this,t),this.destroyPageHooks=[],this.destroyPageHooks.push(this.pdfViewer.addEventListener(qo.zoomToSuccess,function(e){Tn(Wo)}),this.pdfViewer.addEventListener(qo.changeViewModeSuccess,function(e,t){Tn(Wo)}),this.pdfViewer.addEventListener(qo.fitWidthResizeViewport,function(){Tn(Wo)}))}},{key:"destroyPageHandler",value:function(){d(e(n.prototype),"destroyPageHandler",this).call(this),Tn(Wo)}}],[{key:"getStateName",value:function(){return"createCircleArea"}}]),n}(Yn),Zo=function(){function e(){c(this,e),$e(this,"pdfViewer",void 0)}return u(e,[{key:"getInternalStampService",value:function(){var e;return null===(e=this.pdfViewer)||void 0===e?void 0:e.getIoC().getInstanceByClass(Nr)}},{key:"getCurrentStampInfo",value:function(){if(this.pdfViewer.getStateHandlerManager().getCurrentStates()===zr){var e=this.getInternalStampService().getCurrentStampConfig();return e?{category:e.category,iconName:e.name,width:e.width,height:e.height,url:e.url,fileType:e.fileType}:void 0}}},{key:"onSelectStampInfo",value:function(e){var t=this;return this.getInternalStampService().onSwitchStamp(function(){e(t.getCurrentStampInfo())})}},{key:"onCustomStampUpdated",value:function(e){return this.getInternalStampService().onCustomStampUpdated(function(t){var n=Object.keys(t).map(function(e){return Object.keys(t[e]).map(function(n){var i=t[e][n];return Array.isArray(i)?i.map(function(t){return mn({category:e,iconName:n},t)}):(0,Re.isPlainObject)(i)?[mn({category:e,iconName:n},i)]:[]})}).flat().flat();e(n)})}}],[{key:"inject",value:function(){return{pdfViewer:A.PDFViewer}}}]),e}(),Qo=function(){function t(e){c(this,t),this.pdfViewer=e}return u(t,[{key:"getStampService",value:function(){return this.pdfViewer.getIoC().getInstanceByClass(Zo)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showReplyDialog,n=e.hideReplyDialog,i=e.showPopup,a=e.hidePopup,r=e.showPropertiesDialog,o=e.hidePropertiesDialog,s=e.contextMenuIsEnable,c=this.pdfViewer.getStateHandlerManager();c.register(_),c.register(G),c.register(W),c.register(K),c.register(Z),c.register(ne),c.register(ye),c.register(Ye),c.register(nt),c.register(lt),c.register(Bn),c.register(Yn),c.register(Si),c.register(Ei),c.register(Ea),c.register(_a),c.register(Ba),c.register(Ka),c.register(fr),c.register(Ir),c.register(zr),c.register(oo),c.register(ko),c.register(Mo),c.register(Go),c.register(Jo),(t||n||i||a||r||o||s)&&this._overwriteAnnot(t,n,i,a,r,o,s)}},{key:"_overwriteAnnot",value:function(t,n,i,r,o,s,l){this.pdfViewer.getAnnotManager().registerMatchRule(function(h,p){return h.isMarkup()?function(h){function p(){return c(this,p),a(this,p,arguments)}return f(p,h),u(p,[{key:"showReplyDialog",value:function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];var r;return t?t.bind(this).apply(this,m(i)):(r=d(e(p.prototype),"showReplyDialog",this)).call.apply(r,[this].concat(m(i)))}},{key:"hideReplyDialog",value:function(){for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];if(!n){var o;if(t)return;return(o=d(e(p.prototype),"hideReplyDialog",this)).call.apply(o,[this].concat(m(a)))}return n.bind(this).apply(this,m(a))}},{key:"showPopup",value:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var r;return i?i.bind(this).apply(this,m(n)):(r=d(e(p.prototype),"showPopup",this)).call.apply(r,[this].concat(m(n)))}},{key:"hidePopup",value:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];if(!r){var o;if(i)return;return(o=d(e(p.prototype),"hidePopup",this)).call.apply(o,[this].concat(m(n)))}return r.bind(this).apply(this,m(n))}},{key:"showPropertiesDialog",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a;return o?o.bind(this).apply(this,m(n)):(a=d(e(p.prototype),"showPropertiesDialog",this)).call.apply(a,[this].concat(m(n)))}},{key:"hidePropertiesDialog",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!s){var a;if(o)return;return(a=d(e(p.prototype),"hidePropertiesDialog",this)).call.apply(a,[this].concat(m(n)))}return s.bind(this).apply(this,m(n))}},{key:"contextMenuIsEnable",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a;return l?l.bind(this).apply(this,m(n)):(a=d(e(p.prototype),"contextMenuIsEnable",this)).call.apply(a,[this].concat(m(n)))}}]),p}(p):p})}}]),t}()})(),s})());
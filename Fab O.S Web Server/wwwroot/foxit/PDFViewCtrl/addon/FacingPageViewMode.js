!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("PDFViewCtrl").commons):"function"==typeof define&&define.amd?define(["PDFViewCtrl",["PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.FacingPageViewMode=t(require("PDFViewCtrl"),require("PDFViewCtrl").commons):e.FacingPageViewMode=t(e.PDFViewCtrl,e.PDFViewCtrl.commons)}(self,(e,t)=>(()=>{"use strict";var i={778:t=>{t.exports=e},457:e=>{e.exports=t}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return i[e](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e(t)}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(t=function(){return!!e})()}function i(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function n(n,r,o){return r=e(r),i(n,t()?Reflect.construct(r,o||[],e(n).constructor):r.apply(n,o))}function s(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):s(e,t)}function a(e,t){if(!s(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(t,i,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){var r=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=e(t)););return t}(t,i);if(r){var o=Object.getOwnPropertyDescriptor(r,i);return o.get?o.get.call(n||t):o.value}},l(t,i,n||t)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}r.d(o,{default:()=>b});var h=r(457),g=r(778),f=function(e){function t(){return a(this,t),n(this,t,arguments)}return u(t,e),t}(g.viewMode.UsualViewModeShortcutHandler),p=g.ViewerEvents,v=g.vendors,m=g.shared,w=g.viewMode,y=v.jQuery,P=m.keyboardStatus,R=2,x=10,b=function(t){function i(e){var t;a(this,i),t=n(this,i,[e]);var r=e.pdfViewer.store,o=t.modeName=t.constructor.getName();return t.multipage=r.getCurrentValue("multipage-"+o,R),t.pageSpacing=r.getCurrentValue("pageSpacing-"+o,x),t.isMouseDown=!1,t.isScroll=!1,t.isWheel=!1,t.isMoveToBottom=!1,t.isMoveToTop=!1,t.wheel=t.wheel.bind(t),t.mouseDown=t.mouseDown.bind(t),t.mouseUp=t.mouseUp.bind(t),t.adjust=t.adjust.bind(t),t.keyup=t.keyup.bind(t),t.isJump=!1,t.scrollCurrentPageIntoView_debounced=S(20,function(){t.scrollCurrentPageIntoView()}),t}var r,o,s;return u(i,t),r=i,s=[{key:"getName",value:function(){return"facing-page-view-mode"}},{key:"setMultipage",value:function(e){R=e}},{key:"getMultipage",value:function(){return R}},{key:"setPageSpacing",value:function(e){x=e}},{key:"getPageSpacing",value:function(){return x}}],(o=[{key:"getJQItems",value:function(){return y(this.getItems())}},{key:"scrollCurrentPageIntoView",value:function(){if(this.docRender){var e=this.docRender.getCurrentPageIndex(),t=this.docRender.getPDFPageRender(e);t&&!t.pageAreaIsVisible&&t.$ui.get(0).scrollIntoViewIfNeeded(!0)}}},{key:"into",value:function(t,n){var r=this;l(e(i.prototype),"into",this).call(this,t,n);var o=this.modeName,s=["<style>","."+o+" {","overflow:hidden;","margin:0 auto;","display: flex;","flex-wrap: wrap;","}","."+o+".facing-cover-continuous-view-mode::before {",'content: "";',"width: calc("+100/this.multipage+"%);","}","."+o+"::after {",'content: "";',"width: -webkit-fill-available;","}","."+o+" .fv__pdf-view-mode-item {","display: -webkit-box;","display: -ms-flexbox;","display: -webkit-flex;","display: flex;","-ms-flex-pack: center;","-ms-flex-align: center;","-ms-justify-content: flex-end;","-webkit-justify-content: flex-end;","justify-content: flex-end;","align-items: center;","margin-left: 0;","}","."+o+" .fv__pdf-view-mode-item {","margin-right: "+this.pageSpacing+"px;","}","."+o+" .fv__pdf-page-layout {","width: 100%;","}","\n            .".concat(o," .fv__pdf-view-mode-item:nth-child(2n+1)>.fv__pdf-page-layout{\n                margin-left: auto;\n                margin-right: 0;\n            }\n            .").concat(o," .fv__pdf-view-mode-item:nth-child(2n)>.fv__pdf-page-layout{\n                margin-left: 0;\n                margin-right: auto;\n            }\n            "),"</style>"].join("");this.$style=y(s),this.docRender.$container.after(this.$style),this.docRender.$container.addClass(o);var a=this.docRender.viewerRender.scrollWrap;this.scrollHost=a.getScrollHost(),this.currentScrollTop=a.getScrollTop(),this.initPageLayout(),this.bindScrollEvent(),this.wheelHandler=S(200,this.wheel),this.scrollHost.addEventListener("wheel",this.wheelHandler),this.scrollHost.addEventListener("mousedown",this.mouseDown),window.addEventListener("mouseup",this.mouseUp),window.addEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.on(p.zoomToSuccess,this.adjust);var c=this.docRender.getCurrentPageIndex();this.onPageNumberChange=function(e){try{if(c===e)return;r.scrollCurrentPageIntoView_debounced()}finally{c=e}},this.docRender.pdfViewer.eventEmitter.on(p.pageNumberChange,this.onPageNumberChange);var d=this.hammer=new Hammer.Manager(this.scrollHost,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),u=!1;d.on("panstart",function(e){var t=e.srcEvent.target;u=!t.closest(".fv__pdf-page-annot-handler-container")&&!t.closest(".fv__pdf-form-designer-container")}),d.on("panend",function(e){if(u&&"hand"===r.docRender.pdfViewer.getStateHandlerManager().getCurrentStates().getStateName())return e&&8===e.direction&&(r.isMoveToBottom=!0),e&&16===e.direction&&(r.isMoveToTop=!0),e&&1===e.direction&&(e.deltaY>0?r.isMoveToTop=!0:r.isMoveToBottom=!0),r.isNeedAdjust=!0,r.adjust(),!1})}},{key:"bindScrollEvent",value:function(){var e=this;if(this._unwatchScrollEvent&&this._unwatchScrollEvent(),this.docRender){var t=this.docRender.viewerRender.scrollWrap,i=!1,n=S(150,function(t){i||e.isMouseDown||e.isWheel||!e.isScroll||(e.scroll(t),e.isWheel=!1)}),r=t.addScrollEventListener(function(){P.isCtrlDown||(e.isScroll=!0,n(t.getScrollTop()-e.currentScrollTop),e.currentScrollTop=t.getScrollTop(),clearTimeout(e.scrollEventTimer),e.scrollEventTimer=setTimeout(function(){if(!i){e.isScroll=!1;var t=e.docRender;if(t){var n=e.docRender.pagesRender;n&&n.renderVisiblePages().then(function(){i||(e.getCurrentPageIndex(),t.isGoto?setTimeout(function(){t.isGoto=!1},40):t.setCurrentPageIndex(e.getCurrentPageIndex()),e.isNeedAdjust&&!e.isJump&&e.adjust(),e.isJump=!1)}).catch(function(){})}}},100))});this._unwatchScrollEvent=function(){e._unwatchScrollEvent=function(){},i=!0,r()}}}},{key:"initPageLayout",value:function(){for(var e=this.getJQItems(),t=this.multipage,i=0;i<e.length;i++)e.eq(i).css({width:"calc("+100/t+"% - var(--facing-margin))"})}},{key:"keyup",value:function(e){var t=this;this.reset();var i=e.keyCode;i!==h.KeyCodes.PageDown&&i!==h.KeyCodes.DownArrow||(this.isMoveToBottom=!0),i!==h.KeyCodes.UpArrow&&i!==h.KeyCodes.PageUp||(this.isMoveToTop=!0),i===h.KeyCodes.PageUp||i===h.KeyCodes.PageDown?setTimeout(function(){t.isNeedAdjust=!0},50):i!==h.KeyCodes.UpArrow&&i!==h.KeyCodes.DownArrow||(this.isNeedAdjust=!0)}},{key:"wheel",value:function(e){if(!P.isCtrlDown&&this.docRender&&!P.isShiftDown){this.isWheel=!0;var t=this.docRender.viewerRender.scrollWrap;if(this.currentPageIndex=this.getCurrentPageIndex(),t.getHeight(),t.getScrollLeft(),this.getJQItems().eq(this.currentPageIndex).children(".fv__pdf-page-layout").height(),this.getVisibleIndexes().length>2)if(e.deltaY>0){var i=this.docRender.doc.getPageCount(),n=this.currentPageIndex+this.multipage;this.goToPage(Math.min(n,i-1))}else{var r=this.currentPageIndex-this.multipage;r<=0&&(r=0),this.goToPage(r)}}}},{key:"mouseDown",value:function(e){this.isMouseDown=!0,this.startPointY=e.screenY;var t=this.docRender.viewerRender.scrollWrap.getScrollHost(),i=y(t).offset(),n=i.top,r=i.left,o=r+t.clientWidth,s=n+t.clientHeight;this.dragging=!0;var a=e.clientX,c=e.clientY;this.scrollType=r<=a&&a<=o&&n<=c&&c<=s?0:o<a&&n<c?1:2}},{key:"mouseUp",value:function(e){this.isMouseDown=!1,this.isNeedAdjust=!0}},{key:"goToPage",value:function(e,t){this.reset();var i=this.getJQItems(),n=i.get(e),r=i.eq(e),o=n.offsetHeight,s=(n.offsetWidth,parseInt(r.css("margin-top"))),a=this.docRender.viewerRender.scrollWrap,c=a.getHeight(),l=a.getScrollOffsetLeft(),d=n.offsetTop;d=t?r.position().top+o-c+s+s/2:r.position().top+s/2,a.scrollTo(l,d),a.disabled||this.scrollCurrentPageIntoView_debounced()}},{key:"adjust",value:function(){if(this.isWheel||this.isScroll||2===this.scrollType)return this.isWheel=!1;var e=this.getVisibleIndexes(),t=this.docRender.viewerRender.scrollWrap,i=(t.getScrollTop(),t.getScrollLeft(),this.scrollHost.clientHeight,this.getCurrentPageIndex());if(e.length>2)return this.isMoveToBottom&&(i=e[2]),this.isMoveToTop&&(i=e[0]),this.goToPage(i);this.reset()}},{key:"reset",value:function(){this.isMoveToBottom=!1,this.isMoveToTop=!1,this.isNeedAdjust=!1}},{key:"scroll",value:function(e){this.docRender.doc.getPageCount();var t=this.docRender.viewerRender.scrollWrap,i=(t.getScrollTop(),this.lastScrollTop,t.getScrollLeft(),this.scrollHost.clientHeight,this.currentPageIndex,this.getJQItems(),this.getVisibleIndexes());if(i.length>2){if(e>0){var n=i[2]||i[0];this.goToPage(n)}if(e<0){var r=i[0]||0;this.goToPage(r)}}}},{key:"fixMargin",value:function(e,t){var i=this.docRender.viewerRender.scrollWrap.getHeight(),n=this.multipage;this.docRender.pagesRender.$ui.css({width:"calc(".concat(e*n,"px + ").concat(n," * var(--facing-margin))")});var r=this.getJQItems();t<i?y(r).css({width:"calc("+100/n+"% - var(--facing-margin))",height:"calc("+i+"px - 1rem)"}):y(r).css({width:"calc("+100/n+"% - var(--facing-margin))",height:t})}},{key:"renderViewMode",value:function(e,t,i,n,r){var o=this;if(this.docRender){var s=e.index,a=this.getMaxPageWidth(),c=this.multipage;this.docRender.pagesRender.$ui.css({width:"calc(".concat(a*c*e.scale,"px + ").concat(c," * var(--facing-margin))")});for(var l=Math.floor(s/c),d=0,u=this.docRender.doc.getPageCount(),h=this.docRender.viewerRender.scrollWrap.getHeight(),g=[],f=this.docRender.getRotation(),p=0;p<c;p++){var v=l*c+p;v<u&&g.push(this.docRender.getPDFDoc().getPageByIndex(v).then(function(e){var t;t=90===f||270===f?e.getPxWidth():e.getPxHeight(),d=Math.max(t,d)}))}return Promise.all(g).then(function(){var e=o.getJQItems(),i=d*t;i<h?y(e[s]).css({width:"calc("+100/c+"% - var(--facing-margin))",height:"calc("+h+"px - 1rem)"}):y(e[s]).css({width:"calc("+100/c+"% - var(--facing-margin))",height:i})}).catch(function(e){})}}},{key:"getMaxPageWidth",value:function(){var e=0,t=this.docRender.doc,i=this.docRender.getRotation(),n="width";90!==i&&270!==i||(n="height");var r=t.getPageSizesSync();for(var o in r){var s=4*r[o][n]/3;s>e&&(e=s)}return e}},{key:"jumpToPage",value:function(e,t){var i=this,n=t.x,r=void 0===n?0:n,o=t.y,s=void 0===o?0:o;this.isJump=!0,this.isWheel=!0;var a=this.getJQItems();e>=a.length?e=a.length-1:e<0&&(e=0);var c=a.eq(e),l=c.position().left+r,d=this.docRender.viewerRender.scrollWrap,u=d.getHeight(),h=a.get(e).offsetHeight,g=h/2;s>g&&(s=g);var f=c.position().top+s,p=parseInt(c.css("margin-top"));h<u&&(f=c.position().top+p/2),this._unwatchScrollEvent&&this._unwatchScrollEvent(),this.docRender.viewerRender.scrollWrap.scrollTo(l,f),this.currentJumpPageIndex=e,this.docRender.setCurrentPageIndex(e),d.disabled||this.scrollCurrentPageIntoView_debounced(),setTimeout(function(){i.bindScrollEvent()})}},{key:"getFitHeight",value:function(e){var t=this.docRender.viewerRender.scrollWrap;return t.getHeight()-t.getScrollOffsetTop()}},{key:"getFitWidth",value:function(e){var t=this.getMaxPageWidth(),i=this.docRender.getRotation(),n="width";90!==i&&270!==i||(n="height");var r=this.docRender.viewerRender.scrollWrap,o=this.multipage,s=(r.getWidth()-16-o*this.pageSpacing)/o,a=this.docRender.doc.getPageSize(e);return a||(a=this.docRender.doc.getPageSize(0)),s*a[n]*4/(3*t)}},{key:"out",value:function(){this.docRender.$container.removeClass(this.modeName),this.docRender.pagesRender.$ui.removeAttr("style"),this.$style&&this.$style.remove(),this._unwatchScrollEvent&&this._unwatchScrollEvent();for(var t=this.getJQItems(),n=0;n<t.length;n++)y(t[n]).css({width:"",height:""});this.scrollHost&&this.scrollHost.removeEventListener("wheel",this.wheelHandler),this.scrollHost&&this.scrollHost.removeEventListener("mousedown",this.mouseDown),window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.off(p.zoomToSuccess,this.adjust),this.docRender.pdfViewer.eventEmitter.off(p.pageNumberChange,this.onPageNumberChange),this.hammer.destroy(),l(e(i.prototype),"out",this).call(this)}},{key:"getCurrentPageIndex",value:function(){if(this.isJump)return this.currentJumpPageIndex;for(var e=this.getJQItems(),t=this.docRender.viewerRender.scrollWrap,i=t.getScrollTop(),n=i+t.getHeight(),r=t.getScrollLeft(),o=r+t.getWidth(),s=this.currentPageIndex,a=[],c=0;c<e.length;c++){var l=e[c],d=y(l).width(),u=y(l).height(),h=l.offsetTop,g=h+u,f=l.offsetLeft,p=f+d;if(f<=o&&p>=r&&g>=i&&h<=n){var v=Math.max(r,f),m=Math.min(o,p),w=Math.max(i,h),P=(m-v)*(Math.min(n,g)-w);a.push({index:c,areaSize:P})}}if(0===a.length)return s;var R=0;return a.forEach(function(e,t){e.areaSize>a[R].areaSize&&(R=t)}),a[R].index}},{key:"getNextPageIndex",value:function(){var e=this.docRender.doc.getPageCount(),t=this.getCurrentPageIndex();if(t<e-1){var i=this.docRender.viewerRender.scrollWrap,n=this.docRender.pagesRender.$ui.width(),r=i.getWidth()-16,o=this.multipage;r>=n?t=Math.ceil((t+1)/o)*o:t++}return t>e-1&&(t=e-1),t}},{key:"getPrevPageIndex",value:function(){var e=this.getCurrentPageIndex();if(e>0){var t=this.docRender.viewerRender.scrollWrap,i=this.docRender.pagesRender.$ui.width(),n=t.getWidth()-16,r=this.multipage;n>=i?e=(Math.ceil((e+1)/r)-2)*r:e--}return e<0&&(e=0),e}},{key:"generateShortcutEventHandler",value:function(){return new f(this)}}])&&c(r.prototype,o),s&&c(r,s),i}(w.IViewMode),S=function(e,t){var i;return function(){var n=this,r=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(n,r)},e)}}})(),o=o.default})());